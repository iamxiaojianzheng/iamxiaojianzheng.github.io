<!doctypehtml><html lang=zh-CN><meta charset=UTF-8><meta content=width=device-width name=viewport><meta content=#222 name=theme-color><meta content="Hexo 7.3.0" name=generator><link href=/images/apple-touch-icon-next.png rel=apple-touch-icon sizes=180x180><link href=/images/favicon-32x32-next.png rel=icon sizes=32x32 type=image/png><link href=/images/favicon-16x16-next.png rel=icon sizes=16x16 type=image/png><link color=#222 href=/images/logo.svg rel=mask-icon><style>:root{--body-bg-color:#eee;--content-bg-color:rgba(255,255,255,0.9);--card-bg-color:#f5f5f5;--text-color:#555;--selection-bg:#262a30;--selection-color:#eee;--blockquote-color:#666;--link-color:#555;--link-hover-color:#222;--brand-color:#fff;--brand-hover-color:#fff;--table-row-odd-bg-color:#f9f9f9;--table-row-hover-bg-color:#f5f5f5;--menu-item-bg-color:#f5f5f5;--theme-color:#222;--btn-default-bg:#fff;--btn-default-color:#555;--btn-default-border-color:#555;--btn-default-hover-bg:#222;--btn-default-hover-color:#fff;--btn-default-hover-border-color:#222;--highlight-background:#0d1117;--highlight-foreground:#c9d1d9;--highlight-gutter-background:#1f242a;--highlight-gutter-foreground:#b6bdc5;color-scheme:light}html{line-height:1.15;-webkit-text-size-adjust:100%}details,main{display:block}pre{font-size:1em;overflow:auto;padding:10px}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,samp{font-family:monospace,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:ButtonText dotted 1px}fieldset{padding:.35em .75em .625em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{vertical-align:baseline}.table-container,textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}summary{display:list-item}[hidden],template{display:none}::selection{background:var(--selection-bg);color:var(--selection-color)}body,html{height:100%}body{margin:0;background:var(--body-bg-color);box-sizing:border-box;color:var(--text-color);font-family:Noto Serif SC,PingFang SC,Microsoft YaHei,sans-serif,Lato,"Noto Serif SC","PingFang SC","Microsoft YaHei",sans-serif;font-size:1.1em;line-height:2;min-height:100%;position:relative;transition:padding .2s ease-in-out}h1,h2,h3,h4,h5,h6{font-family:Noto Serif SC,PingFang SC,Microsoft YaHei,sans-serif,Lato,'PingFang SC','Microsoft YaHei',sans-serif;font-weight:700;line-height:1.5;margin:30px 0 15px}p{margin:0 0 20px}a{background:0 0;border-bottom:1px solid #999;color:var(--link-color);cursor:pointer;outline:0;text-decoration:none;overflow-wrap:break-word}a:hover{border-bottom-color:var(--link-hover-color);color:var(--link-hover-color)}embed,iframe,img,video{display:block;margin-left:auto;margin-right:auto;max-width:100%}hr{box-sizing:content-box;overflow:visible;background-image:repeating-linear-gradient(-45deg,#ddd,#ddd 4px,transparent 4px,transparent 8px);border:0;height:3px;margin:40px 0}blockquote{border-left:4px solid #ddd;color:var(--blockquote-color);margin:0;padding:0 15px}blockquote cite::before{content:'-';padding:0 5px}dt{font-weight:700}dd{margin:0;padding:0}table{border-collapse:collapse;border-spacing:0;font-size:.875em;margin:0 0 20px;width:100%}tbody tr:nth-of-type(odd){background:var(--table-row-odd-bg-color)}tbody tr:hover{background:var(--table-row-hover-bg-color)}caption,td,th{padding:8px}td,th{border:1px solid #ddd;border-bottom:3px solid #ddd}th{font-weight:700;padding-bottom:10px}td{border-bottom-width:1px}.btn{background:var(--btn-default-bg);border:2px solid var(--btn-default-border-color);border-radius:2px;color:var(--btn-default-color);display:inline-block;font-size:.875em;line-height:2;padding:0 20px;transition:background-color .2s ease-in-out}.btn:hover{background:var(--btn-default-hover-bg);border-color:var(--btn-default-hover-border-color);color:var(--btn-default-hover-color)}.btn+.btn{margin:0 0 8px 8px}.btn .fa-fw{text-align:left;width:1.285714285714286em}.toggle{line-height:0}.toggle .toggle-line{background:#fff;display:block;height:2px;left:0;position:relative;top:0;transition:left .4s,opacity .4s,top .4s,transform .4s,width .4s;width:100%}.toggle .toggle-line:first-child{margin-top:1px}.toggle .toggle-line:not(:first-child){margin-top:4px}.toggle.toggle-arrow :first-child{left:50%;top:2px;transform:rotate(45deg);width:50%}.toggle.toggle-arrow :last-child{left:50%;top:-2px;transform:rotate(-45deg);width:50%}.toggle.toggle-close :nth-child(2){opacity:0}.toggle.toggle-close :first-child{top:6px;transform:rotate(45deg)}.toggle.toggle-close :last-child{top:-6px;transform:rotate(-45deg)}pre code.hljs{display:block;overflow-x:auto;padding:1em}code.hljs{padding:3px 5px}/*!
  Theme: GitHub Dark
  Description: Dark theme as seen on github.com
  Author: github.com
  Maintainer: @Hirse
  Updated: 2021-05-15

  Outdated base version: https://github.com/primer/github-syntax-dark
  Current colors taken from GitHub's CSS
*/.hljs{color:#c9d1d9;background:#0d1117}.hljs-doctag,.hljs-keyword,.hljs-meta .hljs-keyword,.hljs-template-tag,.hljs-template-variable,.hljs-type,.hljs-variable.language_{color:#ff7b72}.hljs-title,.hljs-title.class_,.hljs-title.class_.inherited__,.hljs-title.function_{color:#d2a8ff}.hljs-attr,.hljs-attribute,.hljs-literal,.hljs-meta,.hljs-number,.hljs-operator,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-id,.hljs-variable{color:#79c0ff}.hljs-meta .hljs-string,.hljs-regexp,.hljs-string{color:#a5d6ff}.hljs-built_in,.hljs-symbol{color:#ffa657}.hljs-code,.hljs-comment,.hljs-formula{color:#8b949e}.hljs-name,.hljs-quote,.hljs-selector-pseudo,.hljs-selector-tag{color:#7ee787}.hljs-subst{color:#c9d1d9}.hljs-section{color:#1f6feb;font-weight:700}.hljs-bullet{color:#f2cc60}.hljs-emphasis{color:#c9d1d9;font-style:italic}.hljs-strong{color:#c9d1d9;font-weight:700}.hljs-addition{color:#aff5b4;background-color:#033a16}.hljs-deletion{color:#ffdcd7;background-color:#67060c}.code-container:hover .copy-btn,.highlight:hover .copy-btn{opacity:1}.code-container{position:relative}.copy-btn{color:#333;cursor:pointer;line-height:1.6;opacity:0;padding:2px 6px;position:absolute;transition:opacity .2s ease-in-out;color:var(--highlight-foreground);font-size:14px;right:0;top:2px}figure.highlight{border-radius:5px;box-shadow:0 10px 30px 0 rgba(0,0,0,.4);padding-top:30px;overflow:auto;position:relative}figure.highlight .table-container{border-radius:0 0 5px 5px}figure.highlight::before{background:#fc625d;box-shadow:20px 0 #fdbc40,40px 0 #35cd4b;left:12px;margin-top:-20px;position:absolute;border-radius:50%;content:' ';height:12px;width:12px}.expand-btn{bottom:0;color:var(--highlight-foreground);cursor:pointer;display:none;left:0;right:0;position:absolute;text-align:center}.fold-cover{background-image:linear-gradient(to top,var(--highlight-background) 0,rgba(0,0,0,0) 100%);bottom:0;display:none;height:50px;left:0;right:0;position:absolute}.highlight-fold{max-height:500px;overflow-y:hidden!important}.highlight-fold .expand-btn,.highlight-fold .fold-cover{display:block}code,figure.highlight,kbd,pre{background:var(--highlight-background);color:var(--highlight-foreground)}figure.highlight,pre{line-height:1.6;margin:0 auto 20px}figure.highlight figcaption,pre .caption{background:var(--highlight-gutter-background);color:var(--highlight-foreground);display:flow-root;font-size:.875em;line-height:1.2;padding:.5em}figure.highlight figcaption a,pre .caption a{color:var(--highlight-foreground);float:right}figure.highlight figcaption a:hover,pre .caption a:hover{border-bottom-color:var(--highlight-foreground)}code,pre{font-family:Roboto Mono,consolas,Menlo,monospace,'PingFang SC','Microsoft YaHei'}code{border-radius:3px;font-size:.875em;padding:2px 4px;overflow-wrap:break-word;background:#f1f2f6;color:#e74c3c}kbd{border:2px solid #ccc;border-radius:.2em;box-shadow:.1em .1em .2em rgba(0,0,0,.1);font-family:inherit;padding:.1em .3em;white-space:nowrap}figure.highlight pre{border:0;margin:0;padding:10px 0}figure.highlight table{border:0;margin:0;width:auto}figure.highlight td{border:0;padding:0}figure.highlight .gutter{-webkit-user-select:none;user-select:none}figure.highlight .gutter pre{background:var(--highlight-gutter-background);color:var(--highlight-gutter-foreground);padding-left:10px;padding-right:10px;text-align:right}figure.highlight .code pre{padding-left:10px;width:100%}figure.highlight .marked{background:rgba(0,0,0,.3)}pre .caption{margin-bottom:10px}.gist table{width:auto}.gist table td{border:0}pre code{background:0 0;padding:0;text-shadow:none}.blockquote-center{border-left:0;margin:40px 0;padding:0;position:relative;text-align:center}.blockquote-center::after,.blockquote-center::before{left:0;line-height:1;opacity:.6;position:absolute;width:100%}.blockquote-center::before{border-top:1px solid #ccc;text-align:left;top:-20px;content:'\f10d';font-family:'Font Awesome 6 Free';font-weight:900}.blockquote-center::after{border-bottom:1px solid #ccc;bottom:-20px;text-align:right;content:'\f10e';font-family:'Font Awesome 6 Free';font-weight:900}.blockquote-center div,.blockquote-center p{text-align:center}.group-picture{margin-bottom:20px}.group-picture .group-picture-row{display:flex;gap:3px;margin-bottom:3px}.group-picture .group-picture-column{flex:1}.group-picture .group-picture-column img{height:100%;margin:0;object-fit:cover;width:100%}.post-body .label{color:#555;padding:0 2px}.post-body .label.default{background:#f0f0f0}.post-body .label.primary{background:#efe6f7}.post-body .label.info{background:#e5f2f8}.post-body .label.success{background:#e7f4e9}.post-body .label.warning{background:#fcf6e1}.post-body .label.danger{background:#fae8eb}.post-body .link-grid{display:grid;grid-gap:1.5rem;gap:1.5rem;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));margin-bottom:20px;padding:1rem}.post-body .link-grid .link-grid-container{border:solid #ddd;box-shadow:1rem 1rem .5rem rgba(0,0,0,.5);min-height:5rem;min-width:0;padding:.5rem;position:relative;transition:background .3s}.post-body .link-grid .link-grid-container:hover{animation:.5s next-shake;background:var(--card-bg-color)}.post-body .link-grid .link-grid-container:active{box-shadow:.5rem .5rem .25rem rgba(0,0,0,.5);transform:translate(.2rem,.2rem)}.post-body .link-grid .link-grid-container .link-grid-image{border:1px solid #ddd;border-radius:50%;box-sizing:border-box;height:5rem;padding:3px;position:absolute;width:5rem}.post-body .link-grid .link-grid-container p{margin:0 1rem 0 6rem}.post-body .link-grid .link-grid-container p:first-of-type{font-size:1.2em}.post-body .link-grid .link-grid-container p:last-of-type{font-size:.8em;line-height:1.3rem;opacity:.7}.post-body .link-grid .link-grid-container a{border:0;height:100%;left:0;position:absolute;top:0;width:100%}@keyframes next-shake{0%{transform:translate(1pt,1pt) rotate(0)}10%{transform:translate(-1pt,-2pt) rotate(-1deg)}20%{transform:translate(-3pt,0) rotate(1deg)}30%{transform:translate(3pt,2pt) rotate(0)}40%{transform:translate(1pt,-1pt) rotate(1deg)}50%{transform:translate(-1pt,2pt) rotate(-1deg)}60%{transform:translate(-3pt,1pt) rotate(0)}70%{transform:translate(3pt,1pt) rotate(-1deg)}80%{transform:translate(-1pt,-1pt) rotate(1deg)}90%{transform:translate(1pt,2pt) rotate(0)}100%{transform:translate(1pt,-2pt) rotate(-1deg)}}.post-body .note{border-radius:3px;margin-bottom:20px;padding:1em;position:relative;border:1px solid #eee;border-left-width:5px}.post-body .note summary{cursor:pointer;outline:0}.post-body .note summary p{display:inline}.post-body .note h2,.post-body .note h3,.post-body .note h4,.post-body .note h5,.post-body .note h6{border-bottom:initial;margin:0;padding-top:0}.post-body .note :first-child{margin-top:0}.post-body .note :last-child{margin-bottom:0}.post-body .note.default{border-left-color:#777}.post-body .note.default h2,.post-body .note.default h3,.post-body .note.default h4,.post-body .note.default h5,.post-body .note.default h6{color:#777}.post-body .note.primary{border-left-color:#6f42c1}.post-body .note.primary h2,.post-body .note.primary h3,.post-body .note.primary h4,.post-body .note.primary h5,.post-body .note.primary h6{color:#6f42c1}.post-body .note.info{border-left-color:#428bca}.post-body .note.info h2,.post-body .note.info h3,.post-body .note.info h4,.post-body .note.info h5,.post-body .note.info h6{color:#428bca}.post-body .note.success{border-left-color:#5cb85c}.post-body .note.success h2,.post-body .note.success h3,.post-body .note.success h4,.post-body .note.success h5,.post-body .note.success h6{color:#5cb85c}.post-body .note.warning{border-left-color:#f0ad4e}.post-body .note.warning h2,.post-body .note.warning h3,.post-body .note.warning h4,.post-body .note.warning h5,.post-body .note.warning h6{color:#f0ad4e}.post-body .note.danger{border-left-color:#d9534f}.post-body .note.danger h2,.post-body .note.danger h3,.post-body .note.danger h4,.post-body .note.danger h5,.post-body .note.danger h6{color:#d9534f}.pdfobject-container embed,.pdfobject-container iframe{height:800px;width:100%}.post-body .tabs{margin-bottom:20px}.post-body .tabs,.tabs-comment{padding-top:10px}.post-body .tabs ul.nav-tabs,.tabs-comment ul.nav-tabs{background:var(--content-bg-color);display:flex;display:flex;flex-wrap:wrap;justify-content:center;margin:0;padding:0;position:sticky;top:0;z-index:5}.post-body .tabs ul.nav-tabs li.tab,.tabs-comment ul.nav-tabs li.tab{border-bottom:1px solid #ddd;border-left:1px solid transparent;border-right:1px solid transparent;border-radius:0;border-top:3px solid transparent;flex-grow:1;list-style-type:none}@media (max-width:413px){.post-body .tabs ul.nav-tabs,.tabs-comment ul.nav-tabs{display:block;margin-bottom:5px}.post-body .tabs ul.nav-tabs li.tab,.tabs-comment ul.nav-tabs li.tab{border-bottom:1px solid transparent;border-left:3px solid transparent;border-right:1px solid transparent;border-top:1px solid transparent;border-radius:0}}.post-body .tabs ul.nav-tabs li.tab a,.tabs-comment ul.nav-tabs li.tab a{border-bottom:initial;display:block;line-height:1.8;padding:.25em .75em;text-align:center;transition:.2s ease-out}.post-body .tabs ul.nav-tabs li.tab a i[class^=fa],.tabs-comment ul.nav-tabs li.tab a i[class^=fa]{width:1.285714285714286em}.post-body .tabs ul.nav-tabs li.tab.active,.tabs-comment ul.nav-tabs li.tab.active{border-color:#fc6423 #ddd transparent}@media (max-width:413px){.post-body .tabs ul.nav-tabs li.tab.active,.tabs-comment ul.nav-tabs li.tab.active{border-color:#ddd #ddd #ddd #fc6423}}.post-body .tabs ul.nav-tabs li.tab.active a,.tabs-comment ul.nav-tabs li.tab.active a{cursor:default}.post-body .tabs .tab-content,.tabs-comment .tab-content{border:1px solid #ddd;border-radius:0;border-top-color:transparent}@media (max-width:413px){.post-body .tabs .tab-content,.tabs-comment .tab-content{border-radius:0;border-top-color:#ddd}}.post-body .tabs .tab-content .tab-pane,.tabs-comment .tab-content .tab-pane{padding:20px 20px 0}.post-body .tabs .tab-content .tab-pane:not(.active),.tabs-comment .tab-content .tab-pane:not(.active){display:none}.pagination .next,.pagination .page-number,.pagination .prev,.pagination .space{display:inline-block;margin:-1px 10px 0;padding:0 10px}.pagination .page-number.current{background:#ccc;border-color:#ccc;color:var(--content-bg-color)}.pagination{border-top:1px solid #eee;margin:120px 0 0;text-align:center}.pagination .next,.pagination .page-number,.pagination .prev{border-bottom:0;border-top:1px solid #eee;transition:border-color .2s ease-in-out}.pagination .next:hover,.pagination .page-number:hover,.pagination .prev:hover{border-top-color:var(--link-hover-color)}@media (max-width:767px){.pagination .next,.pagination .page-number,.pagination .prev,.pagination .space{margin:0 5px}.pagination{border-top:0}.pagination .next,.pagination .page-number,.pagination .prev{border-bottom:1px solid #eee;border-top:0}.pagination .next:hover,.pagination .page-number:hover,.pagination .prev:hover{border-bottom-color:var(--link-hover-color)}.site-meta{text-align:center}}.pagination .space{margin:0;padding:0}.comments{margin-top:60px;overflow:hidden}.comment-button-group{display:flex;display:flex;flex-wrap:wrap;justify-content:center;justify-content:center;margin:1em 0}.comment-button-group .comment-button{margin:.1em .2em}.comment-button-group .comment-button.active{background:var(--btn-default-hover-bg);border-color:var(--btn-default-hover-border-color);color:var(--btn-default-hover-color)}.comment-position{display:none}.comment-position.active{display:block}.tabs-comment{margin-top:4em;padding-top:0}.tabs-comment .comments{margin-top:0;padding-top:0}.headband{background:var(--theme-color);height:3px}@media (max-width:991px){.headband{display:none}}.site-brand-container{display:flex;flex-shrink:0;padding:0 10px}.use-motion .column,.use-motion .site-brand-container .toggle{opacity:0}.site-meta{flex-grow:1;text-align:center}.custom-logo-image{margin-top:20px}@media (max-width:991px){.custom-logo-image{display:none}}.brand{border-bottom:0;color:var(--brand-color);display:inline-block;padding:0}.brand:hover{color:var(--brand-hover-color)}.site-title{font-family:Noto Serif SC,PingFang SC,Microsoft YaHei,sans-serif,Lato,'PingFang SC','Microsoft YaHei',sans-serif;font-size:1.375em;font-weight:400;line-height:1.5;margin:0}.site-subtitle{color:#ddd;margin:10px 10px 0}.use-motion .custom-logo-image,.use-motion .site-subtitle,.use-motion .site-title{opacity:0;position:relative;top:-10px}.site-nav-right,.site-nav-toggle{display:none}.site-nav-right .toggle,.site-nav-toggle .toggle{color:var(--text-color);padding:10px;width:22px}.site-nav-right .toggle .toggle-line,.site-nav-toggle .toggle .toggle-line{background:var(--text-color);border-radius:1px}@media (max-width:767px){.site-nav-right,.site-nav-toggle{display:flex;flex-direction:column;justify-content:center}.site-nav{--scroll-height:0;height:0;overflow:hidden;transition:height .2s ease-in-out,visibility .2s ease-in-out;visibility:hidden}body:not(.site-nav-on) .site-nav .animated{animation:none}body.site-nav-on .site-nav{height:var(--scroll-height);visibility:unset}}.menu{margin:0;padding:1em 0;text-align:center}.menu-item{display:inline-block;list-style:none;margin:0 10px}@media (max-width:767px){.menu-item{display:block;margin-top:10px}.menu-item.menu-item-search{display:none}}.menu-item a{border-bottom:0;display:block;font-size:.8125em;transition:border-color .2s ease-in-out}.menu-item a.menu-item-active,.menu-item a:hover{background:var(--menu-item-bg-color)}.menu-item i[class^=fa]{margin-right:8px}.menu-item .badge{background:#ccc;border-radius:10px;color:var(--content-bg-color);font-weight:700;line-height:1;margin-left:.35em;padding:2px 5px;text-shadow:1px 1px 0 rgba(0,0,0,.1)}.use-motion .menu-item{visibility:hidden}.book-mark-link{border-bottom:0;position:fixed;top:-10px;transition:top .3s;right:30px}.book-mark-link::before{color:#222;font-size:32px;line-height:1;content:'\f02e';font-family:'Font Awesome 6 Free';font-weight:900}.book-mark-link-fixed,.book-mark-link:hover{top:-2px}@media (max-width:991px){.book-mark-link{right:20px;display:none}.sidebar{left:-320px;background:#222;bottom:0;max-height:100vh;overflow-y:auto;position:fixed;top:0;transition:left .2s ease-out,right .2s ease-out;width:320px;z-index:20}.sidebar-active .sidebar{left:0}.sidebar a{border-bottom-color:#555;color:#999}.sidebar a:hover{border-bottom-color:#eee;color:#eee}.links-of-author:not(:first-child){margin-top:15px}.links-of-author a{border-bottom-color:#555;display:inline-block;margin-bottom:10px;margin-right:10px;vertical-align:middle}.links-of-author a::before{background:#14ff49;display:inline-block;margin-right:3px;transform:translateY(-2px);border-radius:50%;content:' ';height:4px;width:4px}.links-of-blogroll-item{padding:0 5px}.popular-posts .popular-posts-item .popular-posts-link:hover{background:0 0}.sidebar-dimmer{background:#000;height:100%;left:0;opacity:0;position:fixed;top:0;transition:visibility .4s,opacity .4s;visibility:hidden;width:100%;z-index:10}.sidebar-active .sidebar-dimmer{opacity:.7;visibility:visible}}.sidebar-inner{color:#999;padding:18px 10px;text-align:center;display:flex;flex-direction:column;justify-content:center}.sidebar-toggle{bottom:61px;height:16px;padding:5px;width:16px;background:#222;cursor:pointer;opacity:.6;position:fixed;z-index:30;left:30px}.sidebar-toggle:hover{opacity:.8}@media (max-width:991px){.sidebar-toggle{left:20px;opacity:.8}}.sidebar-toggle:hover .toggle-line{background:#fc6423}@media (any-hover:hover){body:not(.sidebar-active) .sidebar-toggle:hover :first-child{left:50%;top:2px;transform:rotate(45deg);width:50%}body:not(.sidebar-active) .sidebar-toggle:hover :last-child{left:50%;top:-2px;transform:rotate(-45deg);width:50%}}.sidebar-active .sidebar-toggle :nth-child(2){opacity:0}.sidebar-active .sidebar-toggle :first-child{top:6px;transform:rotate(45deg)}.sidebar-active .sidebar-toggle :last-child{top:-6px;transform:rotate(-45deg)}.sidebar-nav{font-size:.875em;height:0;margin:0;overflow:hidden;padding-left:0;pointer-events:none;transition:height .2s ease-in-out,visibility .2s ease-in-out;visibility:hidden}.sidebar-nav-active .sidebar-nav{height:calc(2em + 1px);pointer-events:unset;visibility:unset}.sidebar-nav li{border-bottom:1px solid transparent;color:var(--text-color);cursor:pointer;display:inline-block;transition:border-bottom-color .2s ease-in-out,color .2s ease-in-out}.sidebar-nav li.sidebar-nav-overview{margin-left:10px}.sidebar-nav li:hover{color:#fc6423}.sidebar-overview-active .sidebar-nav-overview,.sidebar-toc-active .sidebar-nav-toc{border-bottom-color:#fc6423;color:#fc6423;transition-delay:0.2s}.sidebar-overview-active .sidebar-nav-overview:hover,.sidebar-toc-active .sidebar-nav-toc:hover{color:#fc6423}.sidebar-panel-container{align-items:start;display:grid;flex:1;overflow-x:hidden;overflow-y:auto;padding-top:0;transition:padding-top .2s ease-in-out}.sidebar-nav-active .sidebar-panel-container{padding-top:20px}.sidebar-panel{animation:.2s ease-in-out deactivate-sidebar-panel;grid-area:1/1;height:0;opacity:0;overflow:hidden;pointer-events:none;transform:translateY(0);transition:.2s ease-in-out;transition-property:opacity,transform,visibility;visibility:hidden}.sidebar-nav-active .sidebar-panel,.sidebar-overview-active .sidebar-panel.post-toc-wrap{transform:translateY(-20px)}.sidebar-overview-active:not(.sidebar-nav-active) .sidebar-panel.post-toc-wrap{transition-delay:0s,0.2s,0s}.sidebar-overview-active .sidebar-panel.site-overview-wrap,.sidebar-toc-active .sidebar-panel.post-toc-wrap{animation-name:activate-sidebar-panel;height:auto;opacity:1;pointer-events:unset;transform:translateY(0);transition-delay:0.2s,0.2s,0s;visibility:unset}.sidebar-panel.site-overview-wrap{display:flex;flex-direction:column;justify-content:center;gap:10px;justify-content:flex-start}@keyframes deactivate-sidebar-panel{from{height:var(--inactive-panel-height,0)}to{height:var(--active-panel-height,0)}}@keyframes activate-sidebar-panel{from{height:var(--inactive-panel-height,auto)}to{height:var(--active-panel-height,auto)}}.post-toc{font-size:.875em}.post-toc ol{list-style:none;margin:0;padding:0 2px 0 10px;text-align:left}.post-toc ol>:last-child{margin-bottom:5px}.post-toc ol>ol{padding-left:0}.post-toc ol a{transition:.2s ease-in-out}.post-toc .nav-item{line-height:1.8;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.post-toc .nav .nav-child{--height:0;height:0;opacity:0;overflow:hidden;transition:.2s ease-in-out;visibility:hidden}.post-toc .nav .active>.nav-child{height:var(--height,auto);opacity:1;visibility:unset}.post-toc .nav .active>a{border-bottom-color:#fc6423;color:#fc6423}.post-toc .nav .active-current>a,.post-toc .nav .active-current>a:hover{color:#fc6423}.site-author-image{border:1px solid #eee;max-width:120px;padding:2px;border-radius:50%}.site-author-name{color:var(--text-color);font-weight:600;margin:0}.site-description{color:#999;font-size:.8125em;margin-top:0}.site-state{display:flex;flex-wrap:wrap;justify-content:center;line-height:1.4}.site-state-item{padding:0 15px}.site-state-item a{border-bottom:0;display:block}.site-state-item-count{display:block;font-size:1em;font-weight:600}.site-state-item-name{color:#999;font-size:.8125em}.sidebar .sidebar-button:not(:first-child){margin-top:15px}.sidebar .sidebar-button button{background:0 0;color:#fc6423;cursor:pointer;line-height:2;padding:0 15px;border:1px solid #fc6423;border-radius:4px}.sidebar .sidebar-button button:hover{background:#fc6423;color:#fff}.sidebar .sidebar-button button i[class^=fa]{margin-right:5px}.links-of-author a{font-size:.8125em}.links-of-author i[class^=fa]{margin-right:2px}.cc-license .cc-opacity{border-bottom:0;opacity:.7}.cc-license .cc-opacity:hover{opacity:.9}.cc-license img{display:inline-block}.links-of-blogroll{font-size:.8125em}.links-of-blogroll-title{font-size:.875em;font-weight:600}.links-of-blogroll-list{list-style:none;gap:5px;margin:5px 0 0;padding:0;display:flex;flex-wrap:wrap;justify-content:center}.links-of-blogroll-item{max-width:calc(100% - 20px)}.links-of-blogroll-item a{box-sizing:border-box;display:inline-block;max-width:100%;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.footer{color:#999;font-size:.875em;padding:20px 0;transition:left .2s ease-in-out,right .2s ease-in-out}.footer.footer-fixed{bottom:0;left:0;position:absolute;right:0}.footer-inner{box-sizing:border-box;text-align:center;display:flex;flex-direction:column;justify-content:center;margin:0 auto;width:calc(100% - 20px)}@media (max-width:767px){.footer-inner{width:auto}}@media (min-width:1200px){.footer-inner{width:1160px}}@media (min-width:1600px){.footer-inner{width:73%}}.use-motion .footer{opacity:0}.languages{display:inline-block;font-size:1.125em;position:relative}.languages .lang-select-label span{margin:0 .5em}.languages .lang-select{height:100%;left:0;opacity:0;position:absolute;top:0;width:100%}.with-love{color:red;display:inline-block;margin:0 5px}.busuanzi-count #busuanzi_container_site_pv,.busuanzi-count #busuanzi_container_site_uv{display:none}@keyframes icon-animate{0%,100%{transform:scale(1)}10%,30%{transform:scale(.9)}20%,40%,50%,60%,70%,80%{transform:scale(1.1)}}@media (max-width:567px){.main-inner{padding:initial!important}.posts-expand .post-header{margin-bottom:10px!important}.post-block{margin-top:initial!important;padding:8px 18px!important}.post-body h1,.post-body h2,.post-body h3,.post-body h4,.post-body h5,.post-body h6{margin:20px 0 8px}.post-body .note h1,.post-body .note h2,.post-body .note h3,.post-body .note h4,.post-body .note h5,.post-body .note h6,.post-body .tabs .tab-content .tab-pane h1,.post-body .tabs .tab-content .tab-pane h2,.post-body .tabs .tab-content .tab-pane h3,.post-body .tabs .tab-content .tab-pane h4,.post-body .tabs .tab-content .tab-pane h5,.post-body .tabs .tab-content .tab-pane h6{margin:0 5px}.post-body>p{margin:0 0 10px}.post-body .note>p,.post-body .tabs .tab-content .tab-pane>p{padding:0 5px}.post-body img,.post-body video{margin-bottom:10px!important}.post-body figure:not(.highlight) figcaption{margin:-5px auto 15px!important}.post-body .note{margin-bottom:10px!important;padding:10px!important}.post-body .tabs .tab-content .tab-pane{padding:10px 10px 0!important}.post-eof{margin:40px auto 20px!important}.pagination{margin-top:40px}}.back-to-top{font-size:12px;margin:8px -10px -20px;opacity:0;transition:opacity .2s ease-in-out}.back-to-top span{margin-right:8px}.back-to-top .fa{text-align:center;width:26px}.back-to-top.back-to-top-on{cursor:pointer;opacity:.6}.back-to-top.back-to-top-on:hover{opacity:.8}.rtl.post-body a,.rtl.post-body h1,.rtl.post-body h2,.rtl.post-body h3,.rtl.post-body h4,.rtl.post-body h5,.rtl.post-body h6,.rtl.post-body li,.rtl.post-body ol,.rtl.post-body p,.rtl.post-body ul{direction:rtl;font-family:UKIJ Ekran}.rtl.post-title{font-family:UKIJ Ekran}.post-button{margin-top:40px;text-align:center}.use-motion .collection-header,.use-motion .comments,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{visibility:hidden}.posts-collapse .post-content{margin-bottom:35px;margin-left:35px;position:relative}@media (max-width:767px){.posts-collapse .post-content{margin-left:0;margin-right:0}}.posts-collapse .post-content .collection-title{font-size:1.125em;position:relative}.posts-collapse .post-content .collection-title::before{background:#999;border:1px solid #fff;margin-left:-6px;margin-top:-4px;position:absolute;top:50%;border-radius:50%;content:' ';height:10px;width:10px}.posts-collapse .post-content .collection-year{font-size:1.5em;font-weight:700;margin:60px 0;position:relative}.posts-collapse .post-content .collection-year .collection-year-count{font-size:.75em;background:#ccc;border-radius:10px;color:var(--content-bg-color);font-weight:700;line-height:1;margin-left:.35em;padding:2px 5px;text-shadow:1px 1px 0 rgba(0,0,0,.1)}.posts-collapse .post-content .collection-year::before{background:#bbb;margin-left:-4px;margin-top:-4px;position:absolute;top:50%;border-radius:50%;content:' ';height:8px;width:8px}.posts-collapse .post-content .collection-header{display:block;margin-left:20px}.posts-collapse .post-content .collection-header small{color:#bbb;margin-left:5px}.posts-collapse .post-content .post-header{border-bottom:1px dashed #ccc;margin:30px 2px 0;padding-left:15px;position:relative;transition:border .2s ease-in-out}.posts-collapse .post-content .post-header::before{background:#bbb;border:1px solid #fff;left:-6px;position:absolute;top:.75em;transition:background .2s ease-in-out;border-radius:50%;content:' ';height:6px;width:6px}.posts-collapse .post-content .post-header:hover{border-bottom-color:#666}.posts-collapse .post-content .post-header:hover::before{background:#222}.posts-collapse .post-content .post-meta-container{display:inline;font-size:.75em;margin-right:10px}.posts-collapse .post-content .post-title{display:inline}.posts-collapse .post-content .post-title a{border-bottom:0;color:var(--link-color)}.posts-collapse .post-content .post-title .fa{font-size:.875em;margin-left:5px}.posts-collapse .post-content::before{background:#f5f5f5;content:' ';height:100%;margin-left:-2px;position:absolute;top:1.25em;width:4px}.post-body{overflow-wrap:break-word}@media (min-width:1200px){.post-body{font-size:1.125em}}@media (min-width:992px){.post-body{text-align:left}}.post-body h1 .header-anchor,.post-body h1 .headerlink,.post-body h2 .header-anchor,.post-body h2 .headerlink,.post-body h3 .header-anchor,.post-body h3 .headerlink,.post-body h4 .header-anchor,.post-body h4 .headerlink,.post-body h5 .header-anchor,.post-body h5 .headerlink,.post-body h6 .header-anchor,.post-body h6 .headerlink{border-bottom-style:none;color:inherit;float:right;font-size:.875em;margin-left:10px;opacity:0}.post-body h1 .header-anchor::before,.post-body h1 .headerlink::before,.post-body h2 .header-anchor::before,.post-body h2 .headerlink::before,.post-body h3 .header-anchor::before,.post-body h3 .headerlink::before,.post-body h4 .header-anchor::before,.post-body h4 .headerlink::before,.post-body h5 .header-anchor::before,.post-body h5 .headerlink::before,.post-body h6 .header-anchor::before,.post-body h6 .headerlink::before{content:'\f0c1';font-family:'Font Awesome 6 Free';font-weight:900}.post-body h1:hover .header-anchor,.post-body h1:hover .headerlink,.post-body h2:hover .header-anchor,.post-body h2:hover .headerlink,.post-body h3:hover .header-anchor,.post-body h3:hover .headerlink,.post-body h4:hover .header-anchor,.post-body h4:hover .headerlink,.post-body h5:hover .header-anchor,.post-body h5:hover .headerlink,.post-body h6:hover .header-anchor,.post-body h6:hover .headerlink{opacity:.5}.post-body h1:hover .header-anchor:hover,.post-body h1:hover .headerlink:hover,.post-body h2:hover .header-anchor:hover,.post-body h2:hover .headerlink:hover,.post-body h3:hover .header-anchor:hover,.post-body h3:hover .headerlink:hover,.post-body h4:hover .header-anchor:hover,.post-body h4:hover .headerlink:hover,.post-body h5:hover .header-anchor:hover,.post-body h5:hover .headerlink:hover,.post-body h6:hover .header-anchor:hover,.post-body h6:hover .headerlink:hover{opacity:1}.post-body .exturl .fa{font-size:.875em;margin-left:4px}.post-body figure:not(.highlight) figcaption{color:#999;font-size:.875em;font-weight:700;line-height:1;margin:-15px auto 15px;text-align:center}.post-body embed,.post-body iframe,.post-body img,.post-body video{margin-bottom:20px}.post-body .video-container{height:0;margin-bottom:20px;overflow:hidden;padding-top:75%;position:relative;width:100%}.post-body .video-container embed,.post-body .video-container iframe,.post-body .video-container object{height:100%;left:0;margin:0;position:absolute;top:0;width:100%}.post-gallery{display:flex;min-height:200px}.post-gallery .post-gallery-image{flex:1}.post-gallery .post-gallery-image:not(:first-child){clip-path:polygon(40px 0,100% 0,100% 100%,0 100%);margin-left:-20px}.post-gallery .post-gallery-image:not(:last-child){margin-right:-20px}.post-gallery .post-gallery-image img{height:100%;object-fit:cover;opacity:1;width:100%}.posts-expand .post-gallery{margin-bottom:60px}.posts-collapse .post-gallery{margin:15px 0}.posts-expand .post-header{font-size:1.125em;margin-bottom:60px;text-align:center}.posts-expand .post-title{font-size:1.5em;font-weight:400;margin:initial;overflow-wrap:break-word}.posts-expand .post-title-link{border-bottom:0;color:var(--link-color);display:inline-block;position:relative}.posts-expand .post-title-link::before{background:var(--link-color);bottom:0;content:'';height:2px;left:0;position:absolute;transform:scaleX(0);transition:transform .2s ease-in-out;width:100%}.posts-expand .post-title-link:hover::before{transform:scaleX(1)}.posts-expand .post-title-link .fa{font-size:.875em;margin-left:5px}.post-sticky-flag{display:inline-block;margin-right:8px;transform:rotate(30deg)}.posts-expand .post-meta-container{color:#999;font-family:Noto Serif SC,PingFang SC,Microsoft YaHei,sans-serif,Lato,'PingFang SC','Microsoft YaHei',sans-serif;font-size:.75em;margin-top:3px}.posts-expand .post-meta-container .post-description{font-size:.875em;margin-top:2px}.posts-expand .post-meta-container time{border-bottom:1px dashed #999}.post-meta{display:flex;flex-wrap:wrap;justify-content:center}:not(.post-meta-break)+.post-meta-item::before{content:'|';margin:0 .5em}.post-meta-item-icon{margin-right:3px}@media (max-width:991px){.post-body{text-align:justify}.post-meta-item-text{display:none}}.post-meta-break{flex-basis:100%;height:0}#busuanzi_container_page_pv{display:none}.post-nav{border-top:1px solid #eee;display:flex;gap:30px;justify-content:space-between;margin-top:1em;padding:10px 5px 0}.post-nav-item{flex:1}.post-nav-item a{border-bottom:0;display:block;font-size:.875em;line-height:1.6}.post-nav-item a:active{top:2px}.post-nav-item .fa{font-size:.75em}.post-nav-item:first-child .fa{margin-right:5px}.post-nav-item:last-child{text-align:right}.post-nav-item:last-child .fa{margin-left:5px}.post-footer{display:flex;flex-direction:column;justify-content:center}.post-eof{background:#ccc;height:1px;margin:80px auto 60px;width:8%}.post-block:last-of-type .post-eof{display:none}.post-copyright ul{list-style:none;overflow:hidden;padding:.5em 1em;position:relative;background:var(--card-bg-color);border-left:3px solid #ff2a2a;margin:1em 0 0}.post-copyright ul::after{content:'\f25e';font-family:'Font Awesome 6 Brands';font-size:200px;opacity:.1;position:absolute;right:-50px;top:-150px}.post-tags{margin-top:40px;text-align:center}.post-tags a{display:inline-block;font-size:.8125em}.post-tags a:not(:last-child){margin-right:10px}.social-like{border-top:1px solid #eee;font-size:.875em;margin-top:1em;padding-top:1em;display:flex;flex-wrap:wrap;justify-content:center}.social-like a{border-bottom:none}.reward-container{margin:1em 0 0;padding:1em 0;text-align:center}.reward-container button{background:0 0;color:#fc6423;cursor:pointer;line-height:2;padding:0 15px;border:2px solid #fc6423;border-radius:2px;outline:0;vertical-align:text-top}.reward-container button:hover{background:#fc6423;color:#fff}.post-reward{display:none;padding-top:20px}.post-reward.active{display:block}.post-reward div{display:inline-block}.post-reward div span{display:block}.post-reward img{display:inline-block;margin:.8em 2em 0;max-width:100%;width:180px}@keyframes next-roll{from{transform:rotateZ(30deg)}to{transform:rotateZ(-30deg)}}.category-all-page .category-all-title{text-align:center}.category-all-page .category-all{margin-top:20px}.category-all-page .category-list{list-style:none;margin:0;padding:0}.category-all-page .category-list-item{margin:5px 10px}.category-all-page .category-list-count{font-size:.75em;background:#ccc;border-radius:10px;color:var(--content-bg-color);font-weight:700;line-height:1;margin-left:.35em;padding:2px 5px;text-shadow:1px 1px 0 rgba(0,0,0,.1)}.category-all-page .category-list-child{padding-left:10px}.event-list hr{background:#222;margin:20px 0 45px}.event-list hr::after{background:#222;color:#fff;content:'NOW';display:inline-block;font-weight:700;padding:0 5px}.event-list .event{--event-background:#222;--event-foreground:#bbb;--event-title:#fff;background:var(--event-background);padding:15px}.event-list .event .event-summary{border-bottom:0;color:var(--event-title);margin:0;padding:0 0 0 35px;position:relative}.event-list .event .event-summary::before{animation:1s ease-in-out infinite alternate dot-flash;background:var(--event-title);left:0;margin-top:-6px;position:absolute;top:50%;border-radius:50%;content:' ';height:12px;width:12px}.event-list .event:nth-of-type(odd) .event-summary::before{animation-delay:.5s}.event-list .event:not(:last-child){margin-bottom:20px}.event-list .event .event-relative-time{color:var(--event-foreground);display:inline-block;font-size:12px;font-weight:400;padding-left:12px}.event-list .event .event-details{color:var(--event-foreground);display:block;line-height:18px;padding:6px 0 6px 35px}.event-list .event .event-details::before{color:var(--event-foreground);display:inline-block;margin-right:9px;width:14px;font-family:'Font Awesome 6 Free';font-weight:900}.event-list .event .event-details.event-location::before{content:'\f041'}.event-list .event .event-details.event-duration::before{content:'\f017'}.event-list .event .event-details.event-description::before{content:'\f024'}.event-list .event-past{--event-background:#f5f5f5;--event-foreground:#999;--event-title:#222}@keyframes dot-flash{from{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(.8)}}ul.breadcrumb{font-size:.75em;list-style:none;margin:1em 0;padding:0 2em;text-align:center}ul.breadcrumb li{display:inline}ul.breadcrumb li:not(:first-child)::before{content:'/\00a0';font-weight:400;padding:.5em}ul.breadcrumb li:last-child{font-weight:700}.tag-cloud{text-align:center}.tag-cloud a{display:inline-block;margin:10px}.tag-cloud-0{border-bottom-color:#aaa;color:#aaa}.tag-cloud-1{border-bottom-color:#9a9a9a;color:#9a9a9a}.tag-cloud-2{border-bottom-color:#8b8b8b;color:#8b8b8b}.tag-cloud-3{border-bottom-color:#7c7c7c;color:#7c7c7c}.tag-cloud-4{border-bottom-color:#6c6c6c;color:#6c6c6c}.tag-cloud-5{border-bottom-color:#5d5d5d;color:#5d5d5d}.tag-cloud-6{border-bottom-color:#4e4e4e;color:#4e4e4e}.tag-cloud-7{border-bottom-color:#3e3e3e;color:#3e3e3e}.tag-cloud-8{border-bottom-color:#2f2f2f;color:#2f2f2f}.tag-cloud-9{border-bottom-color:#202020;color:#202020}.tag-cloud-10{border-bottom-color:#111;color:#111}.search-active{overflow:hidden}.search-pop-overlay{background:rgba(0,0,0,0);display:flex;height:100%;left:0;position:fixed;top:0;transition:visibility .4s,background .4s;visibility:hidden;width:100%;z-index:40}.search-active .search-pop-overlay{background:rgba(0,0,0,.3);visibility:visible}.search-popup{background:var(--card-bg-color);border-radius:5px;height:80%;margin:auto;transform:scale(0);transition:transform .4s;width:700px}.search-active .search-popup{transform:scale(1)}@media (max-width:767px){.search-popup{border-radius:0;height:100%;width:100%}}.search-popup .popup-btn-close,.search-popup .search-icon{color:#999;font-size:18px;padding:0 10px}.search-popup .popup-btn-close{cursor:pointer}.search-popup .popup-btn-close:hover .fa{color:#222}.search-popup .search-header{background:#eee;border-top-left-radius:5px;border-top-right-radius:5px;display:flex;padding:5px}.search-popup input.search-input{background:0 0;border:0;outline:0;width:100%}.search-popup input.search-input::-webkit-search-cancel-button{display:none}.search-popup .search-result-container{display:flex;flex-direction:column;height:calc(100% - 55px);overflow:auto;padding:5px 25px}.search-popup .search-result-container hr{flex-shrink:0;margin:5px 0 10px}.search-popup .search-result-container hr:first-child{display:none}.search-popup .search-result-list{margin:0 5px;padding:0}.search-popup a.search-result-title{font-weight:700}.search-popup p.search-result{border-bottom:1px dashed #ccc;padding:5px 0}.search-popup .search-input-container{flex-grow:1;padding:2px}.search-popup .search-result-icon{color:#ccc;margin:auto}mark.search-keyword{background:0 0;border-bottom:1px dashed #ff2a2a;color:#ff2a2a;font-weight:700}.use-motion .animated{animation-fill-mode:none;visibility:inherit}.use-motion .sidebar .animated{animation-fill-mode:both}header.header{background:var(--content-bg-color);border-radius:20px;box-shadow:0 2px 2px 0 rgba(0,0,0,.12),0 3px 1px -2px rgba(0,0,0,.06),0 1px 5px 0 rgba(0,0,0,.12)}.main{align-items:stretch;display:flex;justify-content:space-between;margin:0 auto;width:calc(100% - 20px)}@media (max-width:767px){.main{width:auto}}@media (min-width:1200px){.main{width:1160px}}@media (min-width:1600px){.main{width:73%}}@media (max-width:991px){header.header{border-radius:initial}.main{display:block;width:auto}}.main-inner{border-radius:20px;box-sizing:border-box;width:calc(100% - 252px)}.footer-inner{padding-left:252px}@media (max-width:991px){.main-inner{border-radius:initial;width:100%}.footer-inner{padding-left:0;padding-right:0;width:auto}}.column{width:240px}.site-brand-container{background:var(--theme-color)}.site-meta{padding:20px 0}.site-nav-right .toggle,.site-nav-toggle .toggle{color:#fff}.site-nav-right .toggle .toggle-line,.site-nav-toggle .toggle .toggle-line{background:#fff}@media (min-width:768px) and (max-width:991px){.site-nav-right,.site-nav-toggle{display:flex;flex-direction:column;justify-content:center}.site-nav{--scroll-height:0;height:0;overflow:hidden;transition:height .2s ease-in-out,visibility .2s ease-in-out;visibility:hidden}body:not(.site-nav-on) .site-nav .animated{animation:none}body.site-nav-on .site-nav{height:var(--scroll-height);visibility:unset}}.menu .menu-item{display:block;margin:0}.menu .menu-item a{padding:5px 20px;position:relative;transition-property:background-color;display:flex;align-items:center}.menu .menu-item a .badge{margin-left:auto}@media (max-width:991px){.column{width:auto}.site-nav-on .site-brand-container{box-shadow:0 0 16px rgba(0,0,0,.5)}.menu .menu-item.menu-item-search{display:none}}.main-menu .menu-item-active::after{background:#bbb;border-radius:50%;content:' ';height:6px;margin-top:-3px;position:absolute;right:15px;top:50%;width:6px}.sub-menu{margin:0;padding:6px 0}.sub-menu .menu-item{display:inline-block}.sub-menu .menu-item a{background:0 0;margin:5px 10px;padding:initial}.sub-menu .menu-item a:hover{background:0 0;color:#fc6423}.sub-menu .menu-item-active{border-bottom-color:#fc6423;color:#fc6423}.sub-menu .menu-item-active:hover{border-bottom-color:#fc6423}@media (min-width:992px){.sidebar{position:sticky;top:12px}.sidebar-toggle{display:none}.sidebar-inner{background:var(--content-bg-color);border-radius:20px;box-shadow:0 2px 2px 0 rgba(0,0,0,.12),0 3px 1px -2px rgba(0,0,0,.06),0 1px 5px 0 rgba(0,0,0,.12),0 -1px .5px 0 rgba(0,0,0,.09);box-sizing:border-box;color:var(--text-color);margin-top:12px;max-height:calc(100vh - 24px)}.site-state-item{padding:0 10px}.sidebar .sidebar-button{border-bottom:1px dotted #ccc;border-top:1px dotted #ccc}.sidebar .sidebar-button button{border:0;color:#fc6423;display:block;width:100%}.sidebar .sidebar-button button:hover{background:0 0;border:0;color:#e34603}.links-of-author{display:flex;flex-wrap:wrap;justify-content:center}.links-of-author-item{margin:5px 0 0;width:50%}.links-of-author-item a{border-bottom:0;border-radius:4px;padding:0 5px;box-sizing:border-box;display:inline-block;max-width:100%;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.links-of-author-item a:hover{background:var(--body-bg-color)}.links-of-blogroll-item a{padding:0 5px}.back-to-top{background:var(--body-bg-color);margin:-4px -10px -18px;transition-property:bottom,margin-top}.back-to-top.back-to-top-on{margin-top:16px}}.main-inner .comment-position .comments,.main-inner .pagination,.main-inner .post-block,.main-inner .sub-menu,.main-inner .tabs-comment,.main-inner>.comments{background:var(--content-bg-color);border-radius:20px;box-shadow:0 2px 2px 0 rgba(0,0,0,.12),0 3px 1px -2px rgba(0,0,0,.06),0 1px 5px 0 rgba(0,0,0,.12)}.main-inner .post-block:not(:first-child):not(:first-child){border-radius:20px;box-shadow:0 2px 2px 0 rgba(0,0,0,.12),0 3px 1px -2px rgba(0,0,0,.06),0 1px 5px 0 rgba(0,0,0,.12),0 -1px .5px 0 rgba(0,0,0,.09);margin-top:12px}@media (min-width:768px) and (max-width:991px){.main-inner .post-block:not(:first-child):not(:first-child){margin-top:10px}}@media (max-width:767px){.main-inner .post-block:not(:first-child):not(:first-child){margin-top:8px}}.main-inner .comment-position .comments,.main-inner .pagination,.main-inner .tabs-comment,.main-inner>.comments{border-radius:20px;box-shadow:0 2px 2px 0 rgba(0,0,0,.12),0 3px 1px -2px rgba(0,0,0,.06),0 1px 5px 0 rgba(0,0,0,.12),0 -1px .5px 0 rgba(0,0,0,.09);margin-top:12px}@media (min-width:768px) and (max-width:991px){.main-inner .comment-position .comments,.main-inner .pagination,.main-inner .tabs-comment,.main-inner>.comments{margin-top:10px}}@media (max-width:767px){.main-inner .comment-position .comments,.main-inner .pagination,.main-inner .tabs-comment,.main-inner>.comments{margin-top:8px}}.comments,.post-block{padding:40px}.post-eof{display:none}.pagination{border-top:initial;padding:10px 0}.post-body h1,.post-body h2{border-bottom:1px solid #eee}.post-body h3{border-bottom:1px dotted #eee}@media (min-width:768px) and (max-width:991px){.main-inner{padding:10px}.posts-expand .post-button{margin-top:20px}.post-block{padding:20px}.comments{padding:10px 20px}}.post-block{margin-top:12px!important}.main-inner .post-block:not(:first-child):not(:first-child)+mobile (),.post-block+mobile (){border-radius:0!important}ul.sub-menu{margin-top:12px}.site-title{opacity:0}.site-subtitle{font-family:"华文行楷";font-size:1em}.back-to-top{border-radius:0 0 100px}@media (max-width:767px){.main-inner{padding:8px}.posts-expand .post-button{margin:12px 0}.post-block{padding:12px}.comments{padding:10px 12px}ul.sub-menu{margin-top:8px;border-radius:0!important}.back-to-top,.back-to-top-on{bottom:61px;position:absolute;right:20px;color:#fff;font-size:1em;height:26px;line-height:26px;margin:0}.followme{display:none}}.btn{background:rgba(255,255,255,.5)}.site-brand-container{background:url("/images/avatar.jpg") 50% 50%/cover}.post-body{font-family:'Noto Serif SC','Microsoft YaHei';text-align:start;color:#000}.menu .menu-item a,.posts-expand .post-title,.posts-expand .post-title-link{font-family:'Noto Serif SC','Microsoft YaHei';color:#000}.site-description{font-family:'Noto Serif SC','Microsoft YaHei'}.post-copyright ul{font-family:'Noto Serif SC','Microsoft YaHei';color:#000}.sidebar-inner{font-family:'Noto Serif SC','Microsoft YaHei'}@media (max-width:767px){.sidebar-blogroll{display:none;bottom:90px;position:absolute}}.search-popup .search-input-container,.search-popup .search-result-container{font-family:'Noto Serif SC','Microsoft YaHei'}h1{font-size:1.5em}h2{font-size:1.375em}h3{font-size:1.25em}h4{font-size:1.125em}h5{font-size:1em}h6{font-size:.875em}</style><link href=https://use.sevencdn.com/css2?family=Noto+Serif+SC:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&family=PingFang+SC:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&family=Microsoft+YaHei:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&family=sans-serif:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&family=Lato:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&family=Roboto+Mono:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&display=swap&subset=latin,latin-ext rel=stylesheet><link crossorigin href=https://use.sevencdn.com/ajax/libs/font-awesome/6.6.0/css/all.min.css integrity=sha256-5eIC48iZUHmSlSUz9XtjRyK2mzQkHScZY1WdMaoz74E= rel=stylesheet><link crossorigin href=https://use.sevencdn.com/ajax/libs/fancyapps-ui/5.0.31/fancybox/fancybox.css integrity=sha256-gkQVf8UKZgQ0HyuxL/VnacadJ+D2Kox2TCEBuNQg5+w= rel=stylesheet><script class=next-config data-name=main type=application/json>{"hostname":"xiaojianzheng.cn","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.21.1","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":true,"style":"mac"},"fold":{"enable":true,"height":500},"bookmark":{"enable":true,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":true,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":false,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.json","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":true,"trigger":"auto"}}</script><script src=https://use.sevencdn.com/ajax/libs/hexo-theme-next/8.21.1/config.min.js></script><meta content="原文地址：https://zhuanlan.zhihu.com/p/384752564   本文将会从：安装 -> 全局配置 -> 常用的各种配置 来书写，其中常用配置写的炒鸡详细，需要的童鞋可以直接滑倒相应的位置查看。  安装 nginx下载 nginx 的压缩包文件到根目录，官网下载地址：https://nginx.org/download/ yum update #更新系统软件" name=description><meta content=article property=og:type><meta content=Nginx最全操作总结 property=og:title><meta content=http://xiaojianzheng.cn/archives/fe6b5ad8.html property=og:url><meta content=JiaHe property=og:site_name><meta content="原文地址：https://zhuanlan.zhihu.com/p/384752564   本文将会从：安装 -> 全局配置 -> 常用的各种配置 来书写，其中常用配置写的炒鸡详细，需要的童鞋可以直接滑倒相应的位置查看。  安装 nginx下载 nginx 的压缩包文件到根目录，官网下载地址：https://nginx.org/download/ yum update #更新系统软件" property=og:description><meta content=zh_CN property=og:locale><meta content=https://pic1.zhimg.com/v2-0667d0978874e27df93a00cb29e49018_r.jpg property=og:image><meta content=https://www.zhihu.com/equation?tex=sent_http_cache_control%E3%80%81 property=og:image><meta content=2021-07-07T07:04:00.000Z property=article:published_time><meta content=2021-07-07T07:04:00.000Z property=article:modified_time><meta content=JiaHe property=article:author><meta content=Nginx property=article:tag><meta content=summary name=twitter:card><meta content=https://pic1.zhimg.com/v2-0667d0978874e27df93a00cb29e49018_r.jpg name=twitter:image><link href=http://xiaojianzheng.cn/archives/fe6b5ad8.html rel=canonical><script class=next-config data-name=page type=application/json>{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://xiaojianzheng.cn/archives/fe6b5ad8.html","path":"archives/fe6b5ad8.html","title":"Nginx最全操作总结"}</script><script class=next-config data-name=calendar type=application/json>""</script><title>Nginx最全操作总结 | JiaHe</title><noscript><link href=/css/noscript.css rel=stylesheet></noscript><link href=/atom.xml rel=alternate title=JiaHe type=application/atom+xml><body itemscope itemtype=http://schema.org/WebPage><div class=headband></div><main class=main><div class=column><header class=header itemscope itemtype=http://schema.org/WPHeader><div class=site-brand-container><div class=site-nav-toggle><div aria-label=切换导航栏 class=toggle role=button><span class=toggle-line></span><span class=toggle-line></span><span class=toggle-line></span></div></div><div class=site-meta><a class=brand href=/ rel=start> <i class=logo-line></i> <p class=site-title>JiaHe</p> <i class=logo-line></i> </a><p class=site-subtitle itemprop=description>相遇即是缘</div><div class=site-nav-right><div class="toggle popup-trigger" aria-label=搜索 role=button><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class=site-nav><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href=/ rel=section><i class="fa fa-home fa-fw"></i>首页</a><li class="menu-item menu-item-归档"><a href=/archives/ rel=section><i class="fa fa-archive fa-fw"></i>归档</a><li class="menu-item menu-item-导航"><a href=/navigation/ rel=section><i class="fa fa-location-arrow fa-fw"></i>导航</a><li class="menu-item menu-item-文档"><a href=/docs/ rel=section><i class="fa fa-book fa-fw fa-fw"></i>文档</a><li class="menu-item menu-item-应用下载"><a href=/app-download/ rel=section><i class="fas fa-download fa-fw fa-fw"></i>应用下载</a><li class="menu-item menu-item-小贴士"><a href=/cheat-sheet/ rel=section><i class="fas fa-pen fa-fw"></i>小贴士</a><li class="menu-item menu-item-在线工具"><a href=https://tool.xiaojianzheng.cn/ rel=section target=_blank><i class="fas fa-regular fa-screwdriver-wrench fa-fw"></i>在线工具</a><li class="menu-item menu-item-在线转换"><a href=/online-convert/ rel=section><i class="fas fa-arrow-right-arrow-left fa-fw"></i>在线转换</a><li class="menu-item menu-item-软件安装部署"><a href=/software-install-and-deploy/ rel=section><i class="fab fa-windows fa-fw"></i>软件安装部署</a><li class="menu-item menu-item-linux命令"><a href=https://wangchujiang.com/linux-command/ rel=section target=_blank><i class="fab fa-linux fa-fw"></i>Linux命令</a><li class="menu-item menu-item-search"><a class=popup-trigger role=button><i class="fa fa-search fa-fw"></i>搜索 </a></ul></nav><div class=search-pop-overlay><div class="popup search-popup"><div class=search-header><span class=search-icon> <i class="fa fa-search"></i> </span><div class=search-input-container><input autocapitalize=off autocomplete=off class=search-input maxlength=80 placeholder=搜索... spellcheck=false type=search></div><span class=popup-btn-close role=button> <i class="fa fa-times-circle"></i> </span></div><div class=search-result-container><div class=search-result-icon><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></header><aside class=sidebar><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class=sidebar-nav><li class=sidebar-nav-toc>文章目录<li class=sidebar-nav-overview>站点概览</ul><div class=sidebar-panel-container><!--noindex--><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class=nav><li class="nav-item nav-level-1"><a class=nav-link href=#%E5%AE%89%E8%A3%85-nginx><span class=nav-number>1.</span> <span class=nav-text>安装 nginx</span></a><li class="nav-item nav-level-1"><a class=nav-link href=#nginx-%E9%85%8D%E7%BD%AE><span class=nav-number>2.</span> <span class=nav-text>nginx 配置</span></a><ol class=nav-child><li class="nav-item nav-level-2"><a class=nav-link href=#%E5%9F%BA%E6%9C%AC%E7%BB%93%E6%9E%84><span class=nav-number>2.1.</span> <span class=nav-text>基本结构</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#%E4%B8%BB%E8%A6%81%E9%85%8D%E7%BD%AE%E5%90%AB%E4%B9%89><span class=nav-number>2.2.</span> <span class=nav-text>主要配置含义</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#nginx-conf-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E7%9A%84%E8%AF%AD%E6%B3%95%E8%A7%84%E5%88%99><span class=nav-number>2.3.</span> <span class=nav-text>nginx.conf 配置文件的语法规则</span></a></ol><li class="nav-item nav-level-1"><a class=nav-link href=#%E5%86%85%E7%BD%AE%E5%8F%98%E9%87%8F><span class=nav-number>3.</span> <span class=nav-text>内置变量</span></a><li class="nav-item nav-level-1"><a class=nav-link href=#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4><span class=nav-number>4.</span> <span class=nav-text>常用命令</span></a><li class="nav-item nav-level-1"><a class=nav-link href=#%E9%85%8D%E7%BD%AE-nginx-%E5%BC%80%E6%9C%BA%E8%87%AA%E5%90%AF><span class=nav-number>5.</span> <span class=nav-text>配置 nginx 开机自启</span></a><li class="nav-item nav-level-1"><a class=nav-link href=#%E9%85%8D%E7%BD%AE-nginx-%E5%85%A8%E5%B1%80%E5%8F%AF%E7%94%A8><span class=nav-number>6.</span> <span class=nav-text>配置 nginx 全局可用</span></a><li class="nav-item nav-level-1"><a class=nav-link href=#nginx-%E5%B8%B8%E7%94%A8%E5%8A%9F%E8%83%BD><span class=nav-number>7.</span> <span class=nav-text>nginx 常用功能</span></a><ol class=nav-child><li class="nav-item nav-level-2"><a class=nav-link href=#%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86><span class=nav-number>7.1.</span> <span class=nav-text>反向代理</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6><span class=nav-number>7.2.</span> <span class=nav-text>访问控制</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1><span class=nav-number>7.3.</span> <span class=nav-text>负载均衡</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#%E8%BD%AE%E8%AF%A2%E7%AD%96%E7%95%A5%EF%BC%88%E9%BB%98%E8%AE%A4%EF%BC%89><span class=nav-number>7.3.1.</span> <span class=nav-text>轮询策略（默认）</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#%E6%A0%B9%E6%8D%AE%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%9D%83%E9%87%8D><span class=nav-number>7.3.2.</span> <span class=nav-text>根据服务器权重</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#%E5%AE%A2%E6%88%B7%E7%AB%AF-ip-%E7%BB%91%E5%AE%9A%EF%BC%88ip-hash%EF%BC%89><span class=nav-number>7.3.3.</span> <span class=nav-text>客户端 ip 绑定（ip_hash）</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#%E6%9C%80%E5%B0%8F%E8%BF%9E%E6%8E%A5%E6%95%B0%E7%AD%96%E7%95%A5><span class=nav-number>7.3.4.</span> <span class=nav-text>最小连接数策略</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#%E6%9C%80%E5%BF%AB%E5%93%8D%E5%BA%94%E6%97%B6%E9%97%B4%E7%AD%96%E7%95%A5%EF%BC%88%E4%BE%9D%E8%B5%96%E4%BA%8E%E7%AC%AC%E4%B8%89%E6%96%B9-NGINX-Plus%EF%BC%89><span class=nav-number>7.3.5.</span> <span class=nav-text>最快响应时间策略（依赖于第三方 NGINX Plus）</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#%E6%8C%89%E8%AE%BF%E9%97%AE-url-%E7%9A%84-hash-%E7%BB%93%E6%9E%9C%EF%BC%88%E7%AC%AC%E4%B8%89%E6%96%B9%EF%BC%89><span class=nav-number>7.3.6.</span> <span class=nav-text>按访问 url 的 hash 结果（第三方）</span></a></ol><li class="nav-item nav-level-2"><a class=nav-link href=#gzip-%E5%8E%8B%E7%BC%A9><span class=nav-number>7.4.</span> <span class=nav-text>gzip 压缩</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#HTTP-%E6%9C%8D%E5%8A%A1%E5%99%A8><span class=nav-number>7.5.</span> <span class=nav-text>HTTP 服务器</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#%E5%8A%A8%E9%9D%99%E5%88%86%E7%A6%BB><span class=nav-number>7.6.</span> <span class=nav-text>动静分离</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#%E8%AF%B7%E6%B1%82%E9%99%90%E5%88%B6><span class=nav-number>7.7.</span> <span class=nav-text>请求限制</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#%E6%AD%A3%E5%90%91%E4%BB%A3%E7%90%86><span class=nav-number>7.8.</span> <span class=nav-text>正向代理</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#%E5%9B%BE%E7%89%87%E9%98%B2%E7%9B%97%E9%93%BE><span class=nav-number>7.9.</span> <span class=nav-text>图片防盗链</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#%E9%80%82%E9%85%8D-PC-%E6%88%96%E7%A7%BB%E5%8A%A8%E8%AE%BE%E5%A4%87><span class=nav-number>7.10.</span> <span class=nav-text>适配 PC 或移动设备</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#%E8%AE%BE%E7%BD%AE%E4%BA%8C%E7%BA%A7%E5%9F%9F%E5%90%8D><span class=nav-number>7.11.</span> <span class=nav-text>设置二级域名</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#%E9%85%8D%E7%BD%AE-HTTPS><span class=nav-number>7.12.</span> <span class=nav-text>配置 HTTPS</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#%E9%85%8D%E7%BD%AE-HTTP-%E8%BD%AC-HTTPS><span class=nav-number>7.13.</span> <span class=nav-text>配置 HTTP 转 HTTPS</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#%E5%8D%95%E9%A1%B5%E9%9D%A2%E9%A1%B9%E7%9B%AE-history-%E8%B7%AF%E7%94%B1%E9%85%8D%E7%BD%AE><span class=nav-number>7.14.</span> <span class=nav-text>单页面项目 history 路由配置</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#%E9%85%8D%E7%BD%AE%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%EF%BC%88%E5%8F%8C%E6%9C%BA%E7%83%AD%E5%A4%87%EF%BC%89><span class=nav-number>7.15.</span> <span class=nav-text>配置高可用集群（双机热备）</span></a></ol><li class="nav-item nav-level-1"><a class=nav-link href=#%E5%85%B6%E5%AE%83%E5%8A%9F%E8%83%BD%E5%92%8C%E6%8A%80%E5%B7%A7><span class=nav-number>8.</span> <span class=nav-text>其它功能和技巧</span></a><ol class=nav-child><li class="nav-item nav-level-2"><a class=nav-link href=#%E4%BB%A3%E7%90%86%E7%BC%93%E5%AD%98><span class=nav-number>8.1.</span> <span class=nav-text>代理缓存</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#%E8%AE%BF%E9%97%AE%E6%97%A5%E5%BF%97><span class=nav-number>8.2.</span> <span class=nav-text>访问日志</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#%E9%94%99%E8%AF%AF%E6%97%A5%E5%BF%97><span class=nav-number>8.3.</span> <span class=nav-text>错误日志</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E6%9C%8D%E5%8A%A1%E5%99%A8><span class=nav-number>8.4.</span> <span class=nav-text>静态资源服务器</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#%E7%A6%81%E6%AD%A2%E6%8C%87%E5%AE%9A-user-agent><span class=nav-number>8.5.</span> <span class=nav-text>禁止指定 user_agent</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#%E8%AF%B7%E6%B1%82%E8%BF%87%E6%BB%A4><span class=nav-number>8.6.</span> <span class=nav-text>请求过滤</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#%E6%A0%B9%E6%8D%AE%E8%AF%B7%E6%B1%82%E7%B1%BB%E5%9E%8B%E8%BF%87%E6%BB%A4><span class=nav-number>8.6.1.</span> <span class=nav-text>根据请求类型过滤</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#%E6%A0%B9%E6%8D%AE%E7%8A%B6%E6%80%81%E7%A0%81%E8%BF%87%E6%BB%A4><span class=nav-number>8.6.2.</span> <span class=nav-text>根据状态码过滤</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#%E6%A0%B9%E6%8D%AE-URL-%E5%90%8D%E7%A7%B0%E8%BF%87%E6%BB%A4><span class=nav-number>8.6.3.</span> <span class=nav-text>根据 URL 名称过滤</span></a></ol><li class="nav-item nav-level-2"><a class=nav-link href=#ab-%E5%91%BD%E4%BB%A4><span class=nav-number>8.7.</span> <span class=nav-text>ab 命令</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#%E6%B3%9B%E5%9F%9F%E5%90%8D%E8%B7%AF%E5%BE%84%E5%88%86%E7%A6%BB><span class=nav-number>8.8.</span> <span class=nav-text>泛域名路径分离</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#%E6%B3%9B%E5%9F%9F%E5%90%8D%E8%BD%AC%E5%8F%91><span class=nav-number>8.9.</span> <span class=nav-text>泛域名转发</span></a></ol><li class="nav-item nav-level-1"><a class=nav-link href=#%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98><span class=nav-number>9.</span> <span class=nav-text>常见问题</span></a><ol class=nav-child><li class="nav-item nav-level-2"><a class=nav-link href=#nginx-%E4%B8%AD%E6%80%8E%E4%B9%88%E8%AE%BE%E7%BD%AE%E5%8F%98%E9%87%8F><span class=nav-number>9.1.</span> <span class=nav-text>nginx 中怎么设置变量</span></a></ol><li class="nav-item nav-level-1"><a class=nav-link href=#%E9%99%84-nginx-%E5%86%85%E7%BD%AE%E9%A2%84%E5%AE%9A%E4%B9%89%E5%8F%98%E9%87%8F><span class=nav-number>10.</span> <span class=nav-text>附 nginx 内置预定义变量</span></a><li class="nav-item nav-level-1"><a class=nav-link href=#%E9%99%84-nginx-%E6%A8%A1%E5%9D%97><span class=nav-number>11.</span> <span class=nav-text>附 nginx 模块</span></a><li class="nav-item nav-level-1"><a class=nav-link href=#nginx-%E6%A8%A1%E5%9D%97%E5%88%86%E7%B1%BB><span class=nav-number>12.</span> <span class=nav-text>nginx 模块分类</span></a><li class="nav-item nav-level-1"><a class=nav-link href=#%E6%A8%A1%E5%9D%97%E6%B8%85%E5%8D%95><span class=nav-number>13.</span> <span class=nav-text>模块清单</span></a></ol></div></div><!--/noindex--><div class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop=author itemscope itemtype=http://schema.org/Person><img alt=JiaHe class=site-author-image itemprop=image src=/images/avatar.jpg><p class=site-author-name itemprop=name>JiaHe<div class=site-description itemprop=description>无缘等有缘</div></div><div class="site-state-wrap animated"><nav class=site-state><div class="site-state-item site-state-posts"><a href=/archives/> <span class=site-state-item-count>163</span> <span class=site-state-item-name>日志</span> </a></div><div class="site-state-item site-state-categories"><a href=/categories/> <span class=site-state-item-count>26</span> <span class=site-state-item-name>分类</span></a></div><div class="site-state-item site-state-tags"><a href=/tags/> <span class=site-state-item-count>124</span> <span class=site-state-item-name>标签</span></a></div></nav></div><div class="links-of-author animated"><span class=links-of-author-item> <a rel="noopener me" title="RSS → /atom.xml" href=/atom.xml><i class="fa fa-rss fa-fw"></i>RSS</a> </span></div><div style="margin-top: 10px" class=digit-canvas><canvas id=canvas style=width:58%;></canvas></div><script>(function(){

   var digit=
    [
        [
            [0,0,1,1,1,0,0],
            [0,1,1,0,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,0,1,1,0],
            [0,0,1,1,1,0,0]
        ],//0
        [
            [0,0,0,1,1,0,0],
            [0,1,1,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [1,1,1,1,1,1,1]
        ],//1
        [
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,0,1,1,0,0,0],
            [0,1,1,0,0,0,0],
            [1,1,0,0,0,0,0],
            [1,1,0,0,0,1,1],
            [1,1,1,1,1,1,1]
        ],//2
        [
            [1,1,1,1,1,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,0,0,1,1,0],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//3
        [
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,1,0],
            [0,0,1,1,1,1,0],
            [0,1,1,0,1,1,0],
            [1,1,0,0,1,1,0],
            [1,1,1,1,1,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,0,1,1,0],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,1,1]
        ],//4
        [
            [1,1,1,1,1,1,1],
            [1,1,0,0,0,0,0],
            [1,1,0,0,0,0,0],
            [1,1,1,1,1,1,0],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//5
        [
            [0,0,0,0,1,1,0],
            [0,0,1,1,0,0,0],
            [0,1,1,0,0,0,0],
            [1,1,0,0,0,0,0],
            [1,1,0,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//6
        [
            [1,1,1,1,1,1,1],
            [1,1,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,1,1,0,0,0],
            [0,0,1,1,0,0,0],
            [0,0,1,1,0,0,0],
            [0,0,1,1,0,0,0]
        ],//7
        [
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//8
        [
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,1,1,0,0,0,0]
        ],//9
        [
            [0,0,0,0,0,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,0,0,0,0,0]
        ]//:
    ];

var canvas = document.getElementById('canvas');

//定义一个函数判断是手机端还是pc端
function isMobile(){
    if(window.navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i)) {
      document.querySelector('.digit-canvas').style.display = 'none'
      return true; // 移动端
    }else{
      return false; // PC端
    }
}

if(!isMobile() && canvas.getContext){
    var cxt = canvas.getContext('2d');
    //声明canvas的宽高
    var H = 100,W = 700;
    canvas.height = H;
    canvas.width = W;
    cxt.fillStyle = '#f00';
    cxt.fillRect(10,10,50,50);

    //存储时间数据
    var data = [];
    //存储运动的小球
    var balls = [];
    //设置粒子半径
    var R = canvas.height/20-1;
    (function(){
        var temp = /(\d)(\d):(\d)(\d):(\d)(\d)/.exec(new Date());
        //存储时间数字，由十位小时、个位小时、冒号、十位分钟、个位分钟、冒号、十位秒钟、个位秒钟这7个数字组成
        data.push(temp[1],temp[2],10,temp[3],temp[4],10,temp[5],temp[6]);
    })();

    /*生成点阵数字*/
    function renderDigit(index,num){
        for(var i = 0; i < digit[num].length; i++){
            for(var j = 0; j < digit[num][i].length; j++){
                if(digit[num][i][j] == 1){
                    cxt.beginPath();
                    cxt.arc(14*(R+2)*index + j*2*(R+1)+(R+1),i*2*(R+1)+(R+1),R,0,2*Math.PI);
                    cxt.closePath();
                    cxt.fill();
                }
            }
        }
    }

    /*更新时钟*/
    function updateDigitTime(){
        var changeNumArray = [];
        var temp = /(\d)(\d):(\d)(\d):(\d)(\d)/.exec(new Date());
        var NewData = [];
        NewData.push(temp[1],temp[2],10,temp[3],temp[4],10,temp[5],temp[6]);
        for(var i = data.length-1; i >=0 ; i--){
            //时间发生变化
            if(NewData[i] !== data[i]){
                //将变化的数字值和在data数组中的索引存储在changeNumArray数组中
                changeNumArray.push(i+'_'+(Number(data[i])+1)%10);
            }
        }
        //增加小球
        for(var i = 0; i< changeNumArray.length; i++){
            addBalls.apply(this,changeNumArray[i].split('_'));
        }
        data = NewData.concat();
    }

    /*更新小球状态*/
    function updateBalls(){
        for(var i = 0; i < balls.length; i++){
            balls[i].stepY += balls[i].disY;
            balls[i].x += balls[i].stepX;
            balls[i].y += balls[i].stepY;
            if(balls[i].x > W + R || balls[i].y > H + R){
                balls.splice(i,1);
                i--;
            }
        }
    }

    /*增加要运动的小球*/
    function addBalls(index,num){
        var numArray = [1,2,3];
        var colorArray =  ["#3BE","#09C","#A6C","#93C","#9C0","#690","#FB3","#F80","#F44","#C00"];
        for(var i = 0; i < digit[num].length; i++){
            for(var j = 0; j < digit[num][i].length; j++){
                if(digit[num][i][j] == 1){
                    var ball = {
                        x:14*(R+2)*index + j*2*(R+1)+(R+1),
                        y:i*2*(R+1)+(R+1),
                        stepX:Math.floor(Math.random() * 4 -2),
                        stepY:-2*numArray[Math.floor(Math.random()*numArray.length)],
                        color:colorArray[Math.floor(Math.random()*colorArray.length)],
                        disY:1
                    };
                    balls.push(ball);
                }
            }
        }
    }

    /*渲染*/
    function render(){
        //重置画布宽度，达到清空画布的效果
        canvas.height = 100;
        //渲染时钟
        for(var i = 0; i < data.length; i++){
            renderDigit(i,data[i]);
        }
        //渲染小球
        for(var i = 0; i < balls.length; i++){
            cxt.beginPath();
            cxt.arc(balls[i].x,balls[i].y,R,0,2*Math.PI);
            cxt.fillStyle = balls[i].color;
            cxt.closePath();
            cxt.fill();
        }
    }

    clearInterval(oTimer);
    var oTimer = setInterval(function(){
        //更新时钟
        updateDigitTime();
        //更新小球状态
        updateBalls();
        //渲染
        render();
    },50);
}

})();</script><div class="site-overview-wrap sidebar-panel sidebar-panel-active"><div class=site-overview></div></div></div></div><div class="back-to-top animated" aria-label=返回顶部 role=button><i class="fa fa-arrow-up"></i><span>0%</span></div></div><div class="sidebar-inner sidebar-blogroll"><div class="links-of-blogroll animated"><div class=links-of-blogroll-title><i class="fa fa-globe fa-fw"></i> 链接</div><ul class=links-of-blogroll-list><li class=links-of-blogroll-item><a href=https://cn.bing.com/ rel=noopener target=_blank title=https://cn.bing.com/>Bing</a><li class=links-of-blogroll-item><a href=https://www.google.com/ rel=noopener target=_blank title=https://www.google.com/>Google</a><li class=links-of-blogroll-item><a href=https://zh.wikipedia.org/wiki/Wikipedia:%E9%A6%96%E9%A1%B5 rel=noopener target=_blank title=https://zh.wikipedia.org/wiki/Wikipedia:%E9%A6%96%E9%A1%B5>Wiki</a><li class=links-of-blogroll-item><a href=https://linux.do/ rel=noopener target=_blank title=https://linux.do/>Linux DO</a><li class=links-of-blogroll-item><a href=https://docs.gitlab.com/ee/api/api_resources.html rel=noopener target=_blank title=https://docs.gitlab.com/ee/api/api_resources.html>Gitlab Api</a></ul></div></div></aside></div><div class="main-inner post posts-expand"><div class=post-block><article class=post-content itemscope itemtype=http://schema.org/Article lang=zh-CN><link href=http://xiaojianzheng.cn/archives/fe6b5ad8.html itemprop=mainEntityOfPage><span hidden itemprop=author itemscope itemtype=http://schema.org/Person> <meta content=/images/avatar.jpg itemprop=image> <meta content=JiaHe itemprop=name> </span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization> <meta content=JiaHe itemprop=name> <meta content=无缘等有缘 itemprop=description> </span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork> <meta content="Nginx最全操作总结 | JiaHe" itemprop=name> <meta itemprop=description> </span><header class=post-header><h1 itemprop="name headline" class=post-title>Nginx最全操作总结</h1><div class=post-meta-container><div class=post-meta><span class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-calendar"></i> </span> <span class=post-meta-item-text>发表于</span> <time itemprop="dateCreated datePublished" title="创建时间：2021-07-07 15:04:00" datetime=2021-07-07T15:04:00+08:00>2021-07-07</time> </span><span class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-folder"></i> </span> <span class=post-meta-item-text>分类于</span> <span itemprop=about itemscope itemtype=http://schema.org/Thing> <a href=/categories/%E7%BC%96%E7%A8%8B%E6%8A%80%E6%9C%AF/ itemprop=url rel=index><span itemprop=name>编程技术</span></a> </span> </span><span class=post-meta-item id=busuanzi_container_page_pv title=阅读次数> <span class=post-meta-item-icon> <i class="far fa-eye"></i> </span> <span class=post-meta-item-text>阅读次数：</span> <span id=busuanzi_value_page_pv></span> </span><span class=post-meta-break></span><span class=post-meta-item title=本文字数> <span class=post-meta-item-icon> <i class="far fa-file-word"></i> </span> <span class=post-meta-item-text>本文字数：</span> <span>8.9k</span> </span><span class=post-meta-item title=阅读时长> <span class=post-meta-item-icon> <i class="far fa-clock"></i> </span> <span class=post-meta-item-text>阅读时长 ≈</span> <span>32 分钟</span> </span></div></div></header><div class=post-body itemprop=articleBody><blockquote><p>原文地址：<a href=https://zhuanlan.zhihu.com/p/384752564 rel=noopener target=_blank>https://zhuanlan.zhihu.com/p/384752564</a></blockquote><blockquote><p>本文将会从：安装 -> 全局配置 -> 常用的各种配置 来书写，其中常用配置写的炒鸡详细，需要的童鞋可以直接滑倒相应的位置查看。</blockquote><h1 id=安装-nginx><a title="安装 nginx" class=headerlink href=#安装-nginx></a>安装 nginx</h1><p><strong>下载 nginx 的压缩包文件到根目录，官网下载地址：<a href=https://nginx.org/download/ rel=noopener target=_blank>https://nginx.org/download/</a></strong><figure class="highlight shell"><table><tr><td class=code><pre><span class=line>yum update #更新系统软件</span><br><span class=line>cd /</span><br><span class=line>wget nginx.org/download/nginx-1.17.2.tar.gz</span><br></pre></table></figure><p><strong>解压 tar.gz 压缩包文件，进去 nginx-1.17.2</strong><figure class="highlight shell"><table><tr><td class=code><pre><span class=line>tar -xzvf nginx-1.17.2.tar.gz</span><br><span class=line>cd nginx-1.17.2</span><br></pre></table></figure><p><strong>进入文件夹后进行配置检查</strong><figure class="highlight shell"><table><tr><td class=code><pre><span class=line>./configure</span><br></pre></table></figure><p><strong>通过安装前的配置检查，发现有报错。检查中发现一些依赖库没有找到，这时候需要先安装 nginx 的一些依赖库</strong><figure class="highlight shell"><table><tr><td class=code><pre><span class=line>yum -y install pcre* #安装使nginx支持rewrite</span><br><span class=line>yum -y install gcc-c++</span><br><span class=line>yum -y install zlib*</span><br><span class=line>yum -y install openssl openssl-devel</span><br></pre></table></figure><p><strong>再次进行检查操作 ./configure 没发现报错显示，接下来进行编译并安装的操作</strong><figure class="highlight shell"><table><tr><td class=code><pre><span class=line><span class="meta prompt_"># </span><span class=language-bash>检查模块支持</span></span><br><span class=line>./configure  --prefix=/usr/local/nginx  --with-http_ssl_module --with-http_v2_module --with-http_realip_module --with-http_addition_module --with-http_sub_module --with-http_dav_module --with-http_flv_module --with-http_mp4_module --with-http_gunzip_module --with-http_gzip_static_module --with-http_auth_request_module --with-http_random_index_module --with-http_secure_link_module --with-http_degradation_module --with-http_slice_module --with-http_stub_status_module --with-mail --with-mail_ssl_module --with-stream --with-stream_ssl_module --with-stream_realip_module --with-stream_ssl_preread_module --with-threads --user=www --group=www</span><br></pre></table></figure><p>这里得特别注意下，你以后需要用到的功能模块是否存在，不然以后添加新的包会比较麻烦。<p><strong>查看默认安装的模块支持</strong><p>命令 <code>ls nginx-1.17.2</code> 查看 nginx 的文件列表，可以发现里面有一个 auto 的目录。<p>在这个 auto 目录中有一个 options 文件，这个文件里面保存的就是 nginx 编译过程中的所有选项配置。<p>通过命令：<code>cat nginx-1.17.2/auto/options | grep YES</code>就可以查看<p><strong><a href=https://link.zhihu.com/?target=https://jingyan.baidu.com/article/454316ab354edcf7a7c03a81.html>nginx 编译安装时，怎么查看安装模块</a></strong><p><strong>编译并安装</strong><figure class="highlight shell"><table><tr><td class=code><pre><span class=line>make && make install</span><br></pre></table></figure><p>这里需要注意，模块的支持跟后续的 nginx 配置有关，比如 SSL，gzip 压缩等等，编译安装前最好检查需要配置的模块存不存在。<p><strong>查看 nginx 安装后在的目录，可以看到已经安装到 /usr/local/nginx 目录了</strong><figure class="highlight shell"><table><tr><td class=code><pre><span class=line>whereis nginx</span><br><span class=line><span class="meta prompt_">$</span><span class=language-bash>nginx: /usr/local/nginx</span></span><br></pre></table></figure><p><strong>启动 nginx 服务</strong><figure class="highlight shell"><table><tr><td class=code><pre><span class=line>cd /usr/local/nginx/sbin/</span><br><span class=line>./nginx</span><br></pre></table></figure><p>服务启动的时候报错了：<code>nginx: [emerg] bind() to 0.0.0.0:80 failed (98: Address already in use)</code> ，通过命令查看本机网络地址和端口等一些信息，找到被占用的 80 端口 <code>netstat -ntpl</code> 的 tcp 连接，并杀死进程 (kill 进程 pid)<figure class="highlight shell"><table><tr><td class=code><pre><span class=line>netstat -ntpl</span><br><span class=line>kill 进程PID</span><br></pre></table></figure><p>继续启动 nginx 服务，启动成功<figure class="highlight shell"><table><tr><td class=code><pre><span class=line>./nginx</span><br></pre></table></figure><p>在浏览器直接访问 ip 地址，页面出现 Welcome to Nginx! 则安装成功。</p><span id=more></span><h1 id=nginx-配置><a title="nginx 配置" class=headerlink href=#nginx-配置></a>nginx 配置</h1><h2 id=基本结构><a class=headerlink href=#基本结构 title=基本结构></a>基本结构</h2><figure class="highlight plaintext"><table><tr><td class=code><pre><span class=line>main        # 全局配置，对全局生效</span><br><span class=line>├── events  # 配置影响 nginx 服务器或与用户的网络连接</span><br><span class=line>├── http    # 配置代理，缓存，日志定义等绝大多数功能和第三方模块的配置</span><br><span class=line>│   ├── upstream # 配置后端服务器具体地址，负载均衡配置不可或缺的部分</span><br><span class=line>│   ├── server   # 配置虚拟主机的相关参数，一个 http 块中可以有多个 server 块</span><br><span class=line>│   ├── server</span><br><span class=line>│   │   ├── location  # server 块可以包含多个 location 块，location 指令用于匹配 uri</span><br><span class=line>│   │   ├── location</span><br><span class=line>│   │   └── ...</span><br><span class=line>│   └── ...</span><br><span class=line>└── ...</span><br></pre></table></figure><h2 id=主要配置含义><a class=headerlink href=#主要配置含义 title=主要配置含义></a>主要配置含义</h2><ul><li>main:nginx 的全局配置，对全局生效。<li>events: 配置影响 nginx 服务器或与用户的网络连接。<li>http：可以嵌套多个 server，配置代理，缓存，日志定义等绝大多数功能和第三方模块的配置。<li>server：配置虚拟主机的相关参数，一个 http 中可以有多个 server。<li>location：配置请求的路由，以及各种页面的处理情况。<li>upstream：配置后端服务器具体地址，负载均衡配置不可或缺的部分。</ul><h2 id=nginx-conf-配置文件的语法规则><a title="nginx.conf 配置文件的语法规则" class=headerlink href=#nginx-conf-配置文件的语法规则></a>nginx.conf 配置文件的语法规则</h2><ol><li>配置文件由指令与指令块构成<li>每条指令以 “;” 分号结尾，指令与参数间以空格符号分隔<li>指令块以 {} 大括号将多条指令组织在一起<li>include 语句允许组合多个配置文件以提升可维护性<li>通过 # 符号添加注释，提高可读性<li>通过 $ 符号使用变量<li>部分指令的参数支持正则表达式，例如常用的 location 指令</ol><h1 id=内置变量><a class=headerlink href=#内置变量 title=内置变量></a>内置变量</h1><p>nginx 常用的内置全局变量，你可以在配置中随意使用：<table><thead><tr><th>TCP<th>UDP<tbody><tr><td>$host<td>请求信息中的 Host，如果请求中没有Host行，则等于设置的服务器名<tr><td>$request_method<td>客户端请求类型,如 GET、POST<tr><td>$remote_addr<td>客户端的 IP 地址<tr><td>$args<td>请求中的参数<tr><td>$content_length<td>请求头中的 Content-length 字段<tr><td>$http_user_agent<td>客户端 agent 信<tr><td>$httpcookie<td>客户端 cookie 信息<tr><td>$remote_port<td>客户端的端口<tr><td>$server_protoco<td>请求使用的协议，如HTTP/1.1<tr><td>$server_addr<td>服务器地址<tr><td>$server_name<td>服务器名称<tr><td>$server_port<td>服务器的端口号</table><h1 id=常用命令><a class=headerlink href=#常用命令 title=常用命令></a>常用命令</h1><p>这里列举几个常用的命令：<figure class="highlight shell"><table><tr><td class=code><pre><span class=line>nginx -s reload  # 向主进程发送信号，重新加载配置文件，热重启</span><br><span class=line>nginx -s reopen  # 重启 Nginx</span><br><span class=line>nginx -s stop    # 快速关闭</span><br><span class=line>nginx -s quit    # 等待工作进程处理完成后关闭</span><br><span class=line>nginx -T         # 查看当前 Nginx 最终的配置</span><br><span class=line>nginx -t -c <配置路径>  # 检查配置是否有问题，如果已经在配置目录，则不需要 -c</span><br></pre></table></figure><p>以上命令通过 <code>nginx -h</code> 就可以查看到，还有其它不常用这里未列出。<p>Linux 系统应用管理工具 systemd 关于 nginx 的常用命令：<figure class="highlight shell"><table><tr><td class=code><pre><span class=line>systemctl start nginx    # 启动 Nginx</span><br><span class=line>systemctl stop nginx     # 停止 Nginx</span><br><span class=line>systemctl restart nginx  # 重启 Nginx</span><br><span class=line>systemctl reload nginx   # 重新加载 Nginx，用于修改配置后</span><br><span class=line>systemctl enable nginx   # 设置开机启动 Nginx</span><br><span class=line>systemctl disable nginx  # 关闭开机启动 Nginx</span><br><span class=line>systemctl status nginx   # 查看 Nginx 运行状态</span><br></pre></table></figure><h1 id=配置-nginx-开机自启><a title="配置 nginx 开机自启" class=headerlink href=#配置-nginx-开机自启></a>配置 nginx 开机自启</h1><p><strong>利用 systemctl 命令</strong>：<p>如果用 yum install 命令安装的 nginx，yum 命令会自动创建 nginx.service 文件，直接用命令:<figure class="highlight shell"><table><tr><td class=code><pre><span class=line>systemctl enable nginx   # 设置开机启动 Nginx</span><br><span class=line>systemctl disable nginx  # 关闭开机启动 Nginx</span><br></pre></table></figure><p>就可以设置开机自启，否则需要在系统服务目录里创建 nginx.service 文件。<p>创建并打开 nginx.service 文件：<figure class="highlight shell"><table><tr><td class=code><pre><span class=line>vi /lib/systemd/system/nginx.service</span><br></pre></table></figure><p>内容如下：<figure class="highlight plaintext"><table><tr><td class=code><pre><span class=line>[Unit]</span><br><span class=line>Description=nginx</span><br><span class=line>After=network.target</span><br><span class=line></span><br><span class=line>[Service]</span><br><span class=line>Type=forking</span><br><span class=line>ExecStart=/usr/local/nginx/sbin/nginx</span><br><span class=line>ExecReload=/usr/local/nginx/sbin/nginx -s reload</span><br><span class=line>ExecStop=/usr/local/nginx/sbin/nginx -s quit</span><br><span class=line>PrivateTmp=true</span><br><span class=line></span><br><span class=line>[Install]</span><br><span class=line>WantedBy=multi-user.target</span><br></pre></table></figure><p><code>:wq</code> 保存退出，运行 <code>systemctl daemon-reload</code> 使文件生效。<p>这样便可以通过以下命令操作 nginx 了：<figure class="highlight shell"><table><tr><td class=code><pre><span class=line>systemctl start nginx.service # 启动nginx服务</span><br><span class=line>systemctl enable nginx.service # 设置开机启动</span><br><span class=line>systemctl disable nginx.service # 停止开机自启动</span><br><span class=line>systemctl status nginx.service # 查看服务当前状态</span><br><span class=line>systemctl restart nginx.service # 重新启动服务</span><br><span class=line>systemctl is-enabled nginx.service #查询服务是否开机启动</span><br></pre></table></figure><p><strong>通过开机启动命令脚本实现开机自启</strong><p>创建开机启动命令脚本文件：<figure class="highlight shell"><table><tr><td class=code><pre><span class=line>vi /etc/init.d/nginx</span><br></pre></table></figure><p>在这个 nginx 文件中插入一下启动脚本代码，启动脚本代码来源网络复制，实测有效：<figure class="highlight shell"><table><tr><td class=code><pre><span class=line><span class="meta prompt_">#</span><span class=language-bash>! /bin/bash</span></span><br><span class=line><span class="meta prompt_"># </span><span class=language-bash>chkconfig: - 85 15</span></span><br><span class=line>PATH=/usr/local/nginx</span><br><span class=line>DESC="nginx daemon"</span><br><span class=line>NAME=nginx</span><br><span class=line>DAEMON=$PATH/sbin/$NAME</span><br><span class=line>CONFIGFILE=$PATH/conf/$NAME.conf</span><br><span class=line>PIDFILE=$PATH/logs/$NAME.pid</span><br><span class=line>scriptNAME=/etc/init.d/$NAME</span><br><span class=line>set -e</span><br><span class=line>[ -x "$DAEMON" ] || exit 0</span><br><span class=line>do_start() {</span><br><span class=line><span class="meta prompt_">$</span><span class=language-bash>DAEMON -c <span class=variable>$CONFIGFILE</span> || <span class=built_in>echo</span> -n <span class=string>"nginx already running"</span></span></span><br><span class=line>}</span><br><span class=line>do_stop() {</span><br><span class=line><span class="meta prompt_">$</span><span class=language-bash>DAEMON -s stop || <span class=built_in>echo</span> -n <span class=string>"nginx not running"</span></span></span><br><span class=line>}</span><br><span class=line>do_reload() {</span><br><span class=line><span class="meta prompt_">$</span><span class=language-bash>DAEMON -s reload || <span class=built_in>echo</span> -n <span class=string>"nginx can't reload"</span></span></span><br><span class=line>}</span><br><span class=line>case "$1" in</span><br><span class=line>start)</span><br><span class=line>echo -n "Starting $DESC: $NAME"</span><br><span class=line>do_start</span><br><span class=line>echo "."</span><br><span class=line>;;</span><br><span class=line>stop)</span><br><span class=line>echo -n "Stopping $DESC: $NAME"</span><br><span class=line>do_stop</span><br><span class=line>echo "."</span><br><span class=line>;;</span><br><span class=line>reload|graceful)</span><br><span class=line>echo -n "Reloading $DESC configuration..."</span><br><span class=line>do_reload</span><br><span class=line>echo "."</span><br><span class=line>;;</span><br><span class=line>restart)</span><br><span class=line>echo -n "Restarting $DESC: $NAME"</span><br><span class=line>do_stop</span><br><span class=line>do_start</span><br><span class=line>echo "."</span><br><span class=line>;;</span><br><span class=line>*)</span><br><span class=line>echo "Usage: $scriptNAME {start|stop|reload|restart}" >&2</span><br><span class=line>exit 3</span><br><span class=line>;;</span><br><span class=line>esac</span><br><span class=line>exit 0</span><br></pre></table></figure><p>设置所有人都有对这个启动脚本 nginx 文件的执行权限：<figure class="highlight shell"><table><tr><td class=code><pre><span class=line>chmod a+x /etc/init.d/nginx</span><br></pre></table></figure><p>把 nginx 加入系统服务中：<figure class="highlight shell"><table><tr><td class=code><pre><span class=line>chkconfig --add nginx</span><br></pre></table></figure><p>把服务设置为开机启动：<figure class="highlight shell"><table><tr><td class=code><pre><span class=line>chkconfig nginx on</span><br></pre></table></figure><p>reboot 重启系统生效，可以使用上面 systemctl 方法相同的命令：<figure class="highlight shell"><table><tr><td class=code><pre><span class=line>systemctl start nginx.service # 启动nginx服务</span><br><span class=line>systemctl enable nginx.service # 设置开机启动</span><br><span class=line>systemctl disable nginx.service # 停止开机自启动</span><br><span class=line>systemctl status nginx.service # 查看服务当前状态</span><br><span class=line>systemctl restart nginx.service # 重新启动服务</span><br><span class=line>systemctl is-enabled nginx.service #查询服务是否开机启动</span><br></pre></table></figure><p>如果服务启动的时候出现 <code>Restarting nginx daemon: nginxnginx: [error] open() "/usr/local/nginx/logs/nginx.pid" failed (2: No such file or directory) nginx not running</code> 的错误，通过 nginx -c 参数指定配置文件即可解决<figure class="highlight shell"><table><tr><td class=code><pre><span class=line>/usr/local/nginx/sbin/nginx -c /usr/local/nginx/conf/nginx.conf</span><br></pre></table></figure><p>如果服务启动中出现 <code>nginx: [emerg] bind() to 0.0.0.0:80 failed (98: Address already in use)</code> 的错误，可以先通过 <code>service nginx stop</code> 停止服务，再启动就好。<h1 id=配置-nginx-全局可用><a title="配置 nginx 全局可用" class=headerlink href=#配置-nginx-全局可用></a>配置 nginx 全局可用</h1><p>当你每次改了 <code>nginx.conf</code> 配置文件的内容都需要重新到 nginx 启动目录去执行命令，或者通过 -p 参数指向特定目录，会不会感觉很麻烦？<p>例如： 直接执行 <code>nginx -s reload</code> 会报错 <code>-bash: nginx: command not found</code>，需要到 <code>/usr/local/nginx/sbin</code> 目录下面去执行，并且是执行 <code>./nginx -s reload</code>。<p>这里有两种方式可以解决，一种是通过脚本对 nginx 命令包装，这里介绍另外一种比较简单：通过把 nginx 配置到环境变量里，用 nginx 执行指令即可。步骤如下：<p>1、编辑 /etc/profile<figure class="highlight shell"><table><tr><td class=code><pre><span class=line>vi /etc/profile</span><br></pre></table></figure><p>2、在最后一行添加配置，:wq 保存<figure class="highlight shell"><table><tr><td class=code><pre><span class=line>export PATH=$PATH:/usr/local/nginx/sbin</span><br></pre></table></figure><p>3、使配置立即生效<figure class="highlight shell"><table><tr><td class=code><pre><span class=line>source /etc/profile</span><br></pre></table></figure><p>这样就可以愉快的直接在全局使用 nginx 命令了。<h1 id=nginx-常用功能><a title="nginx 常用功能" class=headerlink href=#nginx-常用功能></a>nginx 常用功能</h1><h2 id=反向代理><a class=headerlink href=#反向代理 title=反向代理></a>反向代理</h2><p>我们最常说的反向代理的是通过反向代理解决跨域问题。<p>其实反向代理还可以用来控制缓存（代理缓存 proxy cache），进行访问控制等等，以及后面说的负载均衡其实都是通过反向代理来实现的。<figure class="highlight plaintext"><table><tr><td class=code><pre><span class=line>server {</span><br><span class=line></span><br><span class=line>    listen    8080;</span><br><span class=line></span><br><span class=line>    # 用户访问 ip:8080/test 下的所有路径代理到 github</span><br><span class=line>    location /test {</span><br><span class=line>     proxy_pass   https://github.com;</span><br><span class=line>    }</span><br><span class=line></span><br><span class=line>    # 所有 /api 下的接口访问都代理到本地的 8888 端口</span><br><span class=line>    # 例如你本地运行的 java 服务的端口是 8888，接口都是以 /api 开头</span><br><span class=line>    location /api {</span><br><span class=line>        proxy_pass   http://127.0.0.1:8888;</span><br><span class=line>    }</span><br><span class=line></span><br><span class=line>}</span><br></pre></table></figure><h2 id=访问控制><a class=headerlink href=#访问控制 title=访问控制></a>访问控制</h2><figure class="highlight plaintext"><table><tr><td class=code><pre><span class=line>server {</span><br><span class=line>    location ~ ^/index.html {</span><br><span class=line>        # 匹配 index.html 页面 除了 127.0.0.1 以外都可以访问</span><br><span class=line>        deny 192.168.1.1;</span><br><span class=line>        deny 192.168.1.2;</span><br><span class=line>        allow all;</span><br><span class=line>    }</span><br><span class=line>}</span><br></pre></table></figure><p>上面的命令表示禁止 192.168.1.1 和 192.168.1.2 两个 ip 访问，其它全部允许。从上到下的顺序，匹配到了便跳出，可以按你的需求设置。<h2 id=负载均衡><a class=headerlink href=#负载均衡 title=负载均衡></a>负载均衡</h2><p>通过负载均衡充利用服务器资源，nginx 目前支持自带 4 种负载均衡策略，还有 2 种常用的第三方策略。<h3 id=轮询策略（默认）><a class=headerlink href=#轮询策略（默认） title=轮询策略（默认）></a>轮询策略（默认）</h3><p>每个请求按时间顺序逐一分配到不同的后端服务器，如果有后端服务器挂掉，能自动剔除。但是如果其中某一台服务器压力太大，出现延迟，会影响所有分配在这台服务器下的用户。<figure class="highlight plaintext"><table><tr><td class=code><pre><span class=line>http {</span><br><span class=line>    upstream test.com {</span><br><span class=line>        server 192.168.1.12:8887;</span><br><span class=line>        server 192.168.1.13:8888;</span><br><span class=line>    }</span><br><span class=line>    server {</span><br><span class=line>        location /api {</span><br><span class=line>            proxy_pass  http://test.com;</span><br><span class=line>        }</span><br><span class=line>    }</span><br><span class=line>}</span><br></pre></table></figure><h3 id=根据服务器权重><a class=headerlink href=#根据服务器权重 title=根据服务器权重></a>根据服务器权重</h3><p>例如要配置：10 次请求中大概 1 次访问到 8888 端口，9 次访问到 8887 端口：<figure class="highlight plaintext"><table><tr><td class=code><pre><span class=line>http {</span><br><span class=line>    upstream test.com {</span><br><span class=line>        server 192.168.1.12:8887 weight=9;</span><br><span class=line>        server 192.168.1.13:8888 weight=1;</span><br><span class=line>    }</span><br><span class=line>    server {</span><br><span class=line>        location /api {</span><br><span class=line>            proxy_pass  http://test.com;</span><br><span class=line>        }</span><br><span class=line>    }</span><br><span class=line>}</span><br></pre></table></figure><h3 id=客户端-ip-绑定（ip-hash）><a title="客户端 ip 绑定（ip_hash）" class=headerlink href=#客户端-ip-绑定（ip-hash）></a>客户端 ip 绑定（ip_hash）</h3><p>来自同一个 ip 的请求永远只分配一台服务器，有效解决了动态网页存在的 session 共享问题。例如：比如把登录信息保存到了 session 中，那么跳转到另外一台服务器的时候就需要重新登录了。<p>所以很多时候我们需要一个客户只访问一个服务器，那么就需要用 ip_hash 了。<figure class="highlight plaintext"><table><tr><td class=code><pre><span class=line>http {</span><br><span class=line>    upstream test.com {</span><br><span class=line>     ip_hash;</span><br><span class=line>        server 192.168.1.12:8887;</span><br><span class=line>        server 192.168.1.13:8888;</span><br><span class=line>    }</span><br><span class=line>    server {</span><br><span class=line>        location /api {</span><br><span class=line>            proxy_pass  http://test.com;</span><br><span class=line>        }</span><br><span class=line>    }</span><br><span class=line>}</span><br></pre></table></figure><h3 id=最小连接数策略><a class=headerlink href=#最小连接数策略 title=最小连接数策略></a>最小连接数策略</h3><p>将请求优先分配给压力较小的服务器，它可以平衡每个队列的长度，并避免向压力大的服务器添加更多的请求。<figure class="highlight plaintext"><table><tr><td class=code><pre><span class=line>http {</span><br><span class=line>    upstream test.com {</span><br><span class=line>     least_conn;</span><br><span class=line>        server 192.168.1.12:8887;</span><br><span class=line>        server 192.168.1.13:8888;</span><br><span class=line>    }</span><br><span class=line>    server {</span><br><span class=line>        location /api {</span><br><span class=line>            proxy_pass  http://test.com;</span><br><span class=line>        }</span><br><span class=line>    }</span><br><span class=line>}</span><br></pre></table></figure><h3 id=最快响应时间策略（依赖于第三方-NGINX-Plus）><a title="最快响应时间策略（依赖于第三方 NGINX Plus）" class=headerlink href=#最快响应时间策略（依赖于第三方-NGINX-Plus）></a>最快响应时间策略（依赖于第三方 NGINX Plus）</h3><p>依赖于 NGINX Plus，优先分配给响应时间最短的服务器。<figure class="highlight plaintext"><table><tr><td class=code><pre><span class=line>http {</span><br><span class=line>    upstream test.com {</span><br><span class=line>     fair;</span><br><span class=line>        server 192.168.1.12:8887;</span><br><span class=line>        server 192.168.1.13:8888;</span><br><span class=line>    }</span><br><span class=line>    server {</span><br><span class=line>        location /api {</span><br><span class=line>            proxy_pass  http://test.com;</span><br><span class=line>        }</span><br><span class=line>    }</span><br><span class=line>}</span><br></pre></table></figure><h3 id=按访问-url-的-hash-结果（第三方）><a title="按访问 url 的 hash 结果（第三方）" class=headerlink href=#按访问-url-的-hash-结果（第三方）></a>按访问 url 的 hash 结果（第三方）</h3><p>按访问 url 的 hash 结果来分配请求，使每个 url 定向到同一个后端服务器，后端服务器为缓存时比较有效。 在 upstream 中加入 hash 语句，server 语句中不能写入 weight 等其他的参数，hash_method 是使用的 hash 算法<figure class="highlight plaintext"><table><tr><td class=code><pre><span class=line>http {</span><br><span class=line>    upstream test.com {</span><br><span class=line>     hash $request_uri;</span><br><span class=line>     hash_method crc32;</span><br><span class=line>     server 192.168.1.12:8887;</span><br><span class=line>     server 192.168.1.13:8888;</span><br><span class=line>    }</span><br><span class=line>    server {</span><br><span class=line>        location /api {</span><br><span class=line>            proxy_pass  http://test.com;</span><br><span class=line>        }</span><br><span class=line>    }</span><br><span class=line>}</span><br></pre></table></figure><p>采用 HAproxy 的 loadbalance uri 或者 nginx 的 upstream_hash 模块，都可以做到针对 url 进行哈希算法式的负载均衡转发。<h2 id=gzip-压缩><a title="gzip 压缩" class=headerlink href=#gzip-压缩></a>gzip 压缩</h2><p>开启 gzip 压缩可以大幅减少 http 传输过程中文件的大小，可以极大的提高网站的访问速度，基本是必不可少的优化操作：<figure class="highlight plaintext"><table><tr><td class=code><pre><span class=line>gzip  on; # 开启gzip 压缩</span><br><span class=line># gzip_types</span><br><span class=line># gzip_static on;</span><br><span class=line># gzip_proxied expired no-cache no-store private auth;</span><br><span class=line># gzip_buffers 16 8k;</span><br><span class=line>gzip_min_length 1k;</span><br><span class=line>gzip_comp_level 4;</span><br><span class=line>gzip_http_version 1.0;</span><br><span class=line>gzip_vary off;</span><br><span class=line>gzip_disable "MSIE [1-6]\.";</span><br></pre></table></figure><p>解释一下：<ol><li>gzip_types：要采用 gzip 压缩的 MIME 文件类型，其中 text/html 被系统强制启用；<li>gzip_static：默认 off，该模块启用后，Nginx 首先检查是否存在请求静态文件的 gz 结尾的文件，如果有则直接返回该 .gz 文件内容；<li>gzip_proxied：默认 off，nginx 做为反向代理时启用，用于设置启用或禁用从代理服务器上收到相应内容 gzip 压缩；<li>gzip_buffers：获取多少内存用于缓存压缩结果，16 8k 表示以 8k*16 为单位获得；<li>gzip_min_length：允许压缩的页面最小字节数，页面字节数从 header 头中的 Content-Length 中进行获取。默认值是 0，不管页面多大都压缩。建议设置成大于 1k 的字节数，小于 1k 可能会越压越大；<li>gzip_comp_level：gzip 压缩比，压缩级别是 1-9，1 压缩级别最低，9 最高，级别越高压缩率越大，压缩时间越长，建议 4-6；<li>gzip_http_version：默认 1.1，启用 gzip 所需的 HTTP 最低版本；<li>gzip_vary：用于在响应消息头中添加 Vary：Accept-Encoding，使代理服务器根据请求头中的 Accept-Encoding 识别是否启用 gzip 压缩；<li>gzip_disable 指定哪些不需要 gzip 压缩的浏览器</ol><p>其中第 2 点，普遍是结合前端打包的时候打包成 gzip 文件后部署到服务器上，这样服务器就可以直接使用 gzip 的文件了，并且可以把压缩比例提高，这样 nginx 就不用压缩，也就不会影响速度。一般不追求极致的情况下，前端不用做任何配置就可以使用啦~<p>附前端 webpack 开启 gzip 压缩配置，在 vue-cli3 的 vue.config.js 配置文件中：<figure class="highlight js"><table><tr><td class=code><pre><span class=line><span class=keyword>const</span> <span class="title class_">CompressionWebpackPlugin</span> = <span class=built_in>require</span>(<span class=string>'compression-webpack-plugin'</span>)</span><br><span class=line></span><br><span class=line><span class="variable language_">module</span>.<span class=property>exports</span> = {</span><br><span class=line>  <span class=comment>// gzip 配置</span></span><br><span class=line>  <span class=attr>configureWebpack</span>: <span class=function><span class=params>config</span> =></span> {</span><br><span class=line>    <span class=keyword>if</span> (process.<span class=property>env</span>.<span class=property>NODE_ENV</span> === <span class=string>'production'</span>) {</span><br><span class=line>      <span class=comment>// 生产环境</span></span><br><span class=line>      <span class=keyword>return</span> {</span><br><span class=line>        <span class=attr>plugins</span>: [<span class=keyword>new</span> <span class="title class_">CompressionWebpackPlugin</span>({</span><br><span class=line>          <span class=attr>test</span>: <span class=regexp>/\.js$|\.html$|\.css/</span>,    <span class=comment>// 匹配文件名</span></span><br><span class=line>          <span class=attr>threshold</span>: <span class=number>1024</span>,               <span class=comment>// 文件压缩阈值，对超过 1k 的进行压缩</span></span><br><span class=line>          <span class=attr>deleteOriginalAssets</span>: <span class=literal>false</span>     <span class=comment>// 是否删除源文件</span></span><br><span class=line>        })]</span><br><span class=line>      }</span><br><span class=line>    }</span><br><span class=line>  },</span><br><span class=line>  ...</span><br><span class=line>}</span><br></pre></table></figure><h2 id=HTTP-服务器><a title="HTTP 服务器" class=headerlink href=#HTTP-服务器></a>HTTP 服务器</h2><p>nginx 本身也是一个静态资源的服务器，当只有静态资源的时候，就可以使用 nginx 来做服务器：<figure class="highlight plaintext"><table><tr><td class=code><pre><span class=line>server {</span><br><span class=line>  listen       80;</span><br><span class=line>  server_name  localhost;</span><br><span class=line></span><br><span class=line>  location / {</span><br><span class=line>      root   /usr/local/app;</span><br><span class=line>      index  index.html;</span><br><span class=line>  }</span><br><span class=line>}</span><br></pre></table></figure><p>这样如果访问 <a href=https://link.zhihu.com/?target=http://ip>http://ip</a> 就会默认访问到 /usr/local/app 目录下面的 index.html，如果一个网站只是静态页面的话，那么就可以通过这种方式来实现部署，比如一个静态官网。<h2 id=动静分离><a class=headerlink href=#动静分离 title=动静分离></a>动静分离</h2><p>就是把动态和静态的请求分开。方式主要有两种：<ul><li>一种是纯粹把静态文件独立成单独的域名，放在独立的服务器上，也是目前主流推崇的方案<li>一种方法就是动态跟静态文件混合在一起发布， 通过 nginx 配置来分开</ul><figure class="highlight plaintext"><table><tr><td class=code><pre><span class=line># 所有静态请求都由nginx处理，存放目录为 html</span><br><span class=line>location ~ \.(gif|jpg|jpeg|png|bmp|swf|css|js)$ {</span><br><span class=line>    root    /usr/local/resource;</span><br><span class=line>    expires     10h; # 设置过期时间为10小时</span><br><span class=line>}</span><br><span class=line></span><br><span class=line># 所有动态请求都转发给 tomcat 处理</span><br><span class=line>location ~ \.(jsp|do)$ {</span><br><span class=line>    proxy_pass  127.0.0.1:8888;</span><br><span class=line>}</span><br></pre></table></figure><p>注意上面设置了 expires，当 nginx 设置了 expires 后，例如设置为：expires 10d; 那么，所在的 location 或 if 的内容，用户在 10 天内请求的时候，都只会访问浏览器中的缓存，而不会去请求 nginx 。<h2 id=请求限制><a class=headerlink href=#请求限制 title=请求限制></a>请求限制</h2><p>对于大流量恶意的访问，会造成带宽的浪费，给服务器增加压力。可以通过 nginx 对于同一 IP 的连接数以及并发数进行限制。合理的控制还可以用来防止 DDos 和 CC 攻击。<p>关于请求限制主要使用 nginx 默认集成的 2 个模块：<ul><li>limit_conn_module 连接频率限制模块<li>limit_req_module 请求频率限制模块</ul><p>涉及到的配置主要是：<ul><li>limit_req_zone 限制请求数<li>limit_conn_zone 限制并发连接数</ul><p><strong>通过 limit_req_zone 限制请求数</strong><figure class="highlight plaintext"><table><tr><td class=code><pre><span class=line>http {</span><br><span class=line>	limit_conn_zone $binary_remote_addrzone=limit:10m; // 设置共享内存空间大</span><br><span class=line>    server{</span><br><span class=line>        location / {</span><br><span class=line>            limit_conn addr 5; # 同一用户地址同一时间只允许有5个连接。</span><br><span class=line>        }</span><br><span class=line>    }</span><br><span class=line>}</span><br></pre></table></figure><p>如果共享内存空间被耗尽，服务器将会对后续所有的请求返回 503 (Service Temporarily Unavailable) 错误。<p>当多个 limit_conn_zone 指令被配置时，所有的连接数限制都会生效。比如，下面配置不仅会限制单一 IP 来源的连接数，同时也会限制单一虚拟服务器的总连接数：<figure class="highlight plaintext"><table><tr><td class=code><pre><span class=line>limit_conn_zone $binary_remote_addr zone=perip:10m;</span><br><span class=line>limit_conn_zone $server_name zone=perserver:10m;</span><br><span class=line>server {</span><br><span class=line>    limit_conn perip 10; # 限制每个 ip 连接到服务器的数量</span><br><span class=line>    limit_conn perserver 2000; # 限制连接到服务器的总数</span><br><span class=line>}</span><br></pre></table></figure><p><strong>通过 limit_conn_zone 限制并发连接数</strong><figure class="highlight plaintext"><table><tr><td class=code><pre><span class=line>limit_req_zone $binary_remote_addr zone=creq:10 mrate=10r/s;</span><br><span class=line>server {</span><br><span class=line>    location / {</span><br><span class=line>    	limit_req zone=creq burst=5;</span><br><span class=line>    }</span><br><span class=line>}</span><br></pre></table></figure><p>限制平均每秒不超过一个请求，同时允许超过频率限制的请求数不多于 5 个。 如果不希望超过的请求被延迟，可以用 nodelay 参数, 如：<p><code>limit_req zone=creq burst=5 nodelay;</code><p>这里只是简单讲讲，让大家有这个概念，配置的时候可以深入去找找资料。<h2 id=正向代理><a class=headerlink href=#正向代理 title=正向代理></a>正向代理</h2><p>正向代理，意思是一个位于客户端和原始服务器 (origin server) 之间的服务器，为了从原始服务器取得内容，客户端向代理发送一个请求并指定目标(原始服务器)，然后代理向原始服务器转交请求并将获得的内容返回给客户端。客户端才能使用正向代理，比如我们使用的 VPN 服务就是正向代理，直观区别（图片来源于 **<a href=https://link.zhihu.com/?target=https://juejin.im/post/6844903793918738440>前端开发者必备的 Nginx 知识</a>**）：<p><img data-src=https://pic1.zhimg.com/v2-0667d0978874e27df93a00cb29e49018_r.jpg><p>配置正向代理：<figure class="highlight plaintext"><table><tr><td class=code><pre><span class=line>resolver 8.8.8.8 # 谷歌的域名解析地址</span><br><span class=line>server {</span><br><span class=line>    resolver_timeout 5s; // 设超时时间</span><br><span class=line>    location / {</span><br><span class=line>        # 当客户端请求我的时候，我会把请求转发给它</span><br><span class=line>        # $host 要访问的主机名 $request_uri 请求路径</span><br><span class=line>        proxy_pass http://$host$request_uri;</span><br><span class=line>    }</span><br><span class=line>}</span><br></pre></table></figure><p>正向代理的对象是客户端，服务器端看不到真正的客户端。<h2 id=图片防盗链><a class=headerlink href=#图片防盗链 title=图片防盗链></a>图片防盗链</h2><figure class="highlight plaintext"><table><tr><td class=code><pre><span class=line>server {</span><br><span class=line>    listen       80;</span><br><span class=line>    server_name  *.test;</span><br><span class=line></span><br><span class=line>    # 图片防盗链</span><br><span class=line>    location ~* \.(gif|jpg|jpeg|png|bmp|swf)$ {</span><br><span class=line>        valid_referers none blocked server_names ~\.google\. ~\.baidu\. *.qq.com;  # 只允许本机 IP 外链引用，将百度和谷歌也加入白名单有利于 SEO</span><br><span class=line>        if ($invalid_referer){</span><br><span class=line>            return 403;</span><br><span class=line>        }</span><br><span class=line>    }</span><br><span class=line>}</span><br></pre></table></figure><p>以上设置就能防止其它网站利用外链访问我们的图片，有利于节省流量<h2 id=适配-PC-或移动设备><a title="适配 PC 或移动设备" class=headerlink href=#适配-PC-或移动设备></a>适配 PC 或移动设备</h2><p>根据用户设备不同返回不同样式的站点，以前经常使用的是纯前端的自适应布局，但是复杂的网站并不适合响应式，无论是复杂性和易用性上面还是不如分开编写的好，比如我们常见的淘宝、京东。<p>根据用户请求的 user-agent 来判断是返回 PC 还是 H5 站点：<figure class="highlight plaintext"><table><tr><td class=code><pre><span class=line>server {</span><br><span class=line>    listen 80;</span><br><span class=line>    server_name test.com;</span><br><span class=line></span><br><span class=line>    location / {</span><br><span class=line>     root  /usr/local/app/pc; # pc 的 html 路径</span><br><span class=line>        if ($http_user_agent ~* '(Android|webOS|iPhone|iPod|BlackBerry)') {</span><br><span class=line>            root /usr/local/app/mobile; # mobile 的 html 路径</span><br><span class=line>        }</span><br><span class=line>        index index.html;</span><br><span class=line>    }</span><br><span class=line>}</span><br></pre></table></figure><h2 id=设置二级域名><a class=headerlink href=#设置二级域名 title=设置二级域名></a>设置二级域名</h2><p>新建一个 server 即可：<figure class="highlight plaintext"><table><tr><td class=code><pre><span class=line>server {</span><br><span class=line>    listen 80;</span><br><span class=line>    server_name admin.test.com; // 二级域名</span><br><span class=line></span><br><span class=line>    location / {</span><br><span class=line>        root  /usr/local/app/admin; # 二级域名的 html 路径</span><br><span class=line>        index index.html;</span><br><span class=line>    }</span><br><span class=line>}</span><br></pre></table></figure><h2 id=配置-HTTPS><a title="配置 HTTPS" class=headerlink href=#配置-HTTPS></a>配置 HTTPS</h2><p>这里我使用的是 certbot 免费证书，但申请一次有效期只有 3 个月（好像可以用 crontab 尝试配置自动续期，我暂时没试过）：<p>先安装 certbot<figure class="highlight plaintext"><table><tr><td class=code><pre><span class=line>wget https://dl.eff.org/certbot-auto</span><br><span class=line>chmod a+x certbot-auto</span><br></pre></table></figure><p>申请证书（注意：需要把要申请证书的域名先解析到这台服务器上，才能申请）:<figure class="highlight plaintext"><table><tr><td class=code><pre><span class=line>sudo ./certbot-auto certonly --standalone --email admin@abc.com -d test.com -d www.test.com</span><br></pre></table></figure><p>执行上面指令，按提示操作。<p>Certbot 会启动一个临时服务器来完成验证（会占用 80 端口或 443 端口，因此需要暂时关闭 Web 服务器），然后 Certbot 会把证书以文件的形式保存，包括完整的证书链文件和私钥文件。<p>文件保存在 /etc/letsencrypt/live/ 下面的域名目录下。<p>修改 nginx 配置：<figure class="highlight plaintext"><table><tr><td class=code><pre><span class=line>server{</span><br><span class=line>    listen 443 ssl http2; // 这里还启用了 http/2.0</span><br><span class=line></span><br><span class=line>    ssl_certificate /etc/letsencrypt/live/test.com/fullchain.pem; # 证书文件地址</span><br><span class=line>    ssl_certificate_key /etc/letsencrypt/live/test.com/privkey.pem; # 私钥文件地址</span><br><span class=line></span><br><span class=line>    server_name test.com www.test.com; // 证书绑定的域名</span><br><span class=line>}</span><br></pre></table></figure><h2 id=配置-HTTP-转-HTTPS><a title="配置 HTTP 转 HTTPS" class=headerlink href=#配置-HTTP-转-HTTPS></a>配置 HTTP 转 HTTPS</h2><figure class="highlight plaintext"><table><tr><td class=code><pre><span class=line>server {</span><br><span class=line>    listen      80;</span><br><span class=line>    server_name test.com www.test.com;</span><br><span class=line></span><br><span class=line>    # 单域名重定向</span><br><span class=line>    if ($host = 'www.sherlocked93.club'){</span><br><span class=line>        return 301 https://www.sherlocked93.club$request_uri;</span><br><span class=line>    }</span><br><span class=line></span><br><span class=line>    # 全局非 https 协议时重定向</span><br><span class=line>    if ($scheme != 'https') {</span><br><span class=line>        return 301 https://$server_name$request_uri;</span><br><span class=line>    }</span><br><span class=line></span><br><span class=line>    # 或者全部重定向</span><br><span class=line>    return 301 https://$server_name$request_uri;</span><br><span class=line>}</span><br></pre></table></figure><p>以上配置选择自己需要的一条即可，不用全部加。<h2 id=单页面项目-history-路由配置><a title="单页面项目 history 路由配置" class=headerlink href=#单页面项目-history-路由配置></a>单页面项目 history 路由配置</h2><figure class="highlight plaintext"><table><tr><td class=code><pre><span class=line>server {</span><br><span class=line>    listen       80;</span><br><span class=line>    server_name  fe.sherlocked93.club;</span><br><span class=line></span><br><span class=line>    location / {</span><br><span class=line>        root       /usr/local/app/dist;  # vue 打包后的文件夹</span><br><span class=line>        index      index.html index.htm;</span><br><span class=line>        try_files  $uri $uri/ /index.html @rewrites; # 默认目录下的 index.html，如果都不存在则重定向</span><br><span class=line></span><br><span class=line>        expires -1;                          # 首页一般没有强制缓存</span><br><span class=line>        add_header Cache-Control no-cache;</span><br><span class=line>    }</span><br><span class=line></span><br><span class=line>    location @rewrites { // 重定向设置</span><br><span class=line>        rewrite ^(.+)$ /index.html break;</span><br><span class=line>    }</span><br><span class=line>}</span><br></pre></table></figure><p><strong><a href=https://link.zhihu.com/?target=https://router.vuejs.org/zh/guide/essentials/history-mode.html%23%25E5%2590%258E%25E7%25AB%25AF%25E9%2585%258D%25E7%25BD%25AE%25E4%25BE%258B%25E5%25AD%2590>vue-router</a></strong> 官网只有一句话 <code>try_files $uri $uri/ /index.html;</code>，而上面做了一些重定向处理。<h2 id=配置高可用集群（双机热备）><a class=headerlink href=#配置高可用集群（双机热备） title=配置高可用集群（双机热备）></a>配置高可用集群（双机热备）</h2><p>当主 nginx 服务器宕机之后，切换到备份的 nginx 服务器<p>首先安装 keepalived:<figure class="highlight shell"><table><tr><td class=code><pre><span class=line>yum install keepalived -y</span><br></pre></table></figure><p>然后编辑 <code>/etc/keepalived/keepalived.conf</code> 配置文件，并在配置文件中增加 <code>vrrp_script</code> 定义一个外围检测机制，并在 <code>vrrp_instance</code> 中通过定义 <code>track_script</code> 来追踪脚本执行过程，实现节点转移：<figure class="highlight plaintext"><table><tr><td class=code><pre><span class=line>global_defs{</span><br><span class=line>   notification_email {</span><br><span class=line>        cchroot@gmail.com</span><br><span class=line>   }</span><br><span class=line>   notification_email_from test@firewall.loc</span><br><span class=line>   smtp_server 127.0.0.1</span><br><span class=line>   smtp_connect_timeout 30 // 上面都是邮件配置</span><br><span class=line>   router_id LVS_DEVEL     // 当前服务器名字，用 hostname 命令来查看</span><br><span class=line>}</span><br><span class=line>vrrp_script chk_maintainace { // 检测机制的脚本名称为chk_maintainace</span><br><span class=line>    script "[[ -e/etc/keepalived/down ]] && exit 1 || exit 0" // 可以是脚本路径或脚本命令</span><br><span class=line>    // script "/etc/keepalived/nginx_check.sh"    // 比如这样的脚本路径</span><br><span class=line>    interval 2  // 每隔2秒检测一次</span><br><span class=line>    weight -20  // 当脚本执行成立，那么把当前服务器优先级改为-20</span><br><span class=line>}</span><br><span class=line>vrrp_instanceVI_1 {   // 每一个vrrp_instance就是定义一个虚拟路由器</span><br><span class=line>    state MASTER      // 主机为MASTER，备用机为BACKUP</span><br><span class=line>    interface eth0    // 网卡名字，可以从ifconfig中查找</span><br><span class=line>    virtual_router_id 51 // 虚拟路由的id号，一般小于255，主备机id需要一样</span><br><span class=line>    priority 100      // 优先级，master的优先级比backup的大</span><br><span class=line>    advert_int 1      // 默认心跳间隔</span><br><span class=line>    authentication {  // 认证机制</span><br><span class=line>        auth_type PASS</span><br><span class=line>        auth_pass 1111   // 密码</span><br><span class=line>    }</span><br><span class=line>    virtual_ipaddress {  // 虚拟地址vip</span><br><span class=line>       172.16.2.8</span><br><span class=line>    }</span><br><span class=line>}</span><br></pre></table></figure><p>其中检测脚本 <code>nginx_check.sh</code>，这里提供一个：<figure class="highlight shell"><table><tr><td class=code><pre><span class=line><span class="meta prompt_">#</span><span class=language-bash>!/bin/bash</span></span><br><span class=line>A=`ps -C nginx --no-header | wc -l`</span><br><span class=line>if [ $A -eq 0 ];then</span><br><span class=line>    /usr/sbin/nginx # 尝试重新启动nginx</span><br><span class=line>    sleep 2         # 睡眠2秒</span><br><span class=line>    if [ `ps -C nginx --no-header | wc -l` -eq 0 ];then</span><br><span class=line>        killall keepalived # 启动失败，将keepalived服务杀死。将vip漂移到其它备份节点</span><br><span class=line>    fi</span><br><span class=line>fi</span><br></pre></table></figure><p>复制一份到备份服务器，备份 nginx 的配置要将 <code>state</code> 后改为 <code>BACKUP</code>，<code>priority</code> 改为比主机小。 设置完毕后各自 <code>service keepalived start</code> 启动，经过访问成功之后，可以把 Master 机的 keepalived 停掉，此时 Master 机就不再是主机了 <code>service keepalived stop</code>，看访问虚拟 IP 时是否能够自动切换到备机 ip addr。<p>再次启动 Master 的 keepalived，此时 vip 又变到了主机上。<p>配置高可用集群的内容来源于：**<a href=https://link.zhihu.com/?target=https://juejin.im/post/6844904144235413512%23heading-11>Nginx 从入门到实践，万字详解！</a>**<h1 id=其它功能和技巧><a class=headerlink href=#其它功能和技巧 title=其它功能和技巧></a>其它功能和技巧</h1><h2 id=代理缓存><a class=headerlink href=#代理缓存 title=代理缓存></a>代理缓存</h2><p>nginx 的 http_proxy 模块，提供类似于 Squid 的缓存功能，使用 proxy_cache_path 来配置。<p>nginx 可以对访问过的内容在 nginx 服务器本地建立副本，这样在一段时间内再次访问该数据，就不需要通过 nginx 服务器再次向后端服务器发出请求，减小数据传输延迟，提高访问速度：<figure class="highlight plaintext"><table><tr><td class=code><pre><span class=line>proxy_cache_path usr/local/cache levels=1:2 keys_zone=my_cache:10m;</span><br><span class=line></span><br><span class=line>server {</span><br><span class=line>  listen       80;</span><br><span class=line>  server_name  test.com;</span><br><span class=line></span><br><span class=line>  location / {</span><br><span class=line>      proxy_cache my_cache;</span><br><span class=line>      proxy_pass http://127.0.0.1:8888;</span><br><span class=line>      proxy_set_header Host $host;</span><br><span class=line>  }</span><br><span class=line>}</span><br></pre></table></figure><p>上面的配置表示： nginx 提供一块 10 M 的内存用于缓存，名字为 my_cache, levels 等级为 1:2，缓存存放的路径为 <code>usr/local/cache</code>。<h2 id=访问日志><a class=headerlink href=#访问日志 title=访问日志></a>访问日志</h2><p>访问日志默认是注释的状态，需要可以打开和进行更详细的配置，一下是 nginx 的默认配置：<figure class="highlight plaintext"><table><tr><td class=code><pre><span class=line>http {</span><br><span class=line>    log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '</span><br><span class=line>                      '$status $body_bytes_sent "$http_referer" '</span><br><span class=line>                      '"$http_user_agent" "$http_x_forwarded_for"';</span><br><span class=line></span><br><span class=line>    access_log  logs/access.log  main;</span><br><span class=line>}</span><br></pre></table></figure><h2 id=错误日志><a class=headerlink href=#错误日志 title=错误日志></a>错误日志</h2><p>错误日志放在 main 全局区块中，童鞋们打开 nginx.conf 就可以看见在配置文件中和下面一样的代码了：<figure class="highlight plaintext"><table><tr><td class=code><pre><span class=line>#error_log  logs/error.log;</span><br><span class=line>#error_log  logs/error.log  notice;</span><br><span class=line>#error_log  logs/error.log  info;</span><br></pre></table></figure><p>nginx 错误日志默认配置为：<p><code>error_log logs/error.log error;</code><h2 id=静态资源服务器><a class=headerlink href=#静态资源服务器 title=静态资源服务器></a>静态资源服务器</h2><figure class="highlight plaintext"><table><tr><td class=code><pre><span class=line>server {</span><br><span class=line>    listen       80;</span><br><span class=line>    server_name  static.bin;</span><br><span class=line>    charset utf-8;    # 防止中文文件名乱码</span><br><span class=line></span><br><span class=line>    location /download {</span><br><span class=line>        alias           /usr/share/nginx/static;  # 静态资源目录</span><br><span class=line></span><br><span class=line>        autoindex               on;    # 开启静态资源列目录，浏览目录权限</span><br><span class=line>        autoindex_exact_size    off;   # on(默认)显示文件的确切大小，单位是byte；off显示文件大概大小，单位KB、MB、GB</span><br><span class=line>        autoindex_localtime     off;   # off(默认)时显示的文件时间为GMT时间；on显示的文件时间为服务器时间</span><br><span class=line>    }</span><br><span class=line>}</span><br></pre></table></figure><h2 id=禁止指定-user-agent><a title="禁止指定 user_agent" class=headerlink href=#禁止指定-user-agent></a>禁止指定 user_agent</h2><p>nginx 可以禁止指定的浏览器和爬虫框架访问：<figure class="highlight plaintext"><table><tr><td class=code><pre><span class=line># http_user_agent 为浏览器标识</span><br><span class=line># 禁止 user_agent 为baidu、360和sohu，~*表示不区分大小写匹配</span><br><span class=line>if ($http_user_agent ~* 'baidu|360|sohu') {</span><br><span class=line>    return 404;</span><br><span class=line>}</span><br><span class=line></span><br><span class=line># 禁止 Scrapy 等工具的抓取</span><br><span class=line>if ($http_user_agent ~* (Scrapy|Curl|HttpClient)) {</span><br><span class=line>    return 403;</span><br></pre></table></figure><h2 id=请求过滤><a class=headerlink href=#请求过滤 title=请求过滤></a>请求过滤</h2><h3 id=根据请求类型过滤><a class=headerlink href=#根据请求类型过滤 title=根据请求类型过滤></a>根据请求类型过滤</h3><figure class="highlight plaintext"><table><tr><td class=code><pre><span class=line># 非指定请求全返回 403</span><br><span class=line>if ( $request_method !~ ^(GET|POST|HEAD)$ ) {</span><br><span class=line>    return 403;</span><br><span class=line>}</span><br></pre></table></figure><h3 id=根据状态码过滤><a class=headerlink href=#根据状态码过滤 title=根据状态码过滤></a>根据状态码过滤</h3><figure class="highlight plaintext"><table><tr><td class=code><pre><span class=line>error_page 502 503 /50x.html;</span><br><span class=line>location = /50x.html {</span><br><span class=line>    root /usr/share/nginx/html;</span><br><span class=line>}</span><br></pre></table></figure><p>这样实际上是一个内部跳转，当访问出现 502、503 的时候就能返回 50x.html 中的内容，这里需要注意是否可以找到 50x.html 页面，所以加了个 location 保证找到你自定义的 50x 页面。<h3 id=根据-URL-名称过滤><a title="根据 URL 名称过滤" class=headerlink href=#根据-URL-名称过滤></a>根据 URL 名称过滤</h3><figure class="highlight plaintext"><table><tr><td class=code><pre><span class=line>if ($host = zy.com') {</span><br><span class=line>    #其中 $1是取自regex部分()里的内容,匹配成功后跳转到的URL。</span><br><span class=line>    rewrite ^/(.*)$ http://www.zy.com/$1  permanent；</span><br><span class=line>}</span><br><span class=line></span><br><span class=line>location /test {</span><br><span class=line>	// /test 全部重定向到首页</span><br><span class=line>	rewrite  ^(.*)$ /index.html  redirect;</span><br><span class=line>}</span><br></pre></table></figure><h2 id=ab-命令><a title="ab 命令" class=headerlink href=#ab-命令></a>ab 命令</h2><p>ab 命令全称为：Apache bench，是 Apache 自带的压力测试工具，也可以测试 Nginx、IIS 等其他 Web 服务器:<ul><li>-n 总共的请求数<li>-c 并发的请求数<li>-t 测试所进行的最大秒数，默认值 为 50000<li>-p 包含了需要的 POST 的数据文件<li>-T POST 数据所使用的 Content-type 头信息</ul><figure class="highlight plaintext"><table><tr><td class=code><pre><span class=line>ab -n 1000 -c 5000 http://127.0.0.1/ # 每次发送1000并发的请求数，请求数总数为5000。</span><br></pre></table></figure><p>测试前需要安装 httpd-tools： <code>yum install httpd-tools</code><h2 id=泛域名路径分离><a class=headerlink href=#泛域名路径分离 title=泛域名路径分离></a>泛域名路径分离</h2><p>这是一个非常实用的技能，经常有时候我们可能需要配置一些二级或者三级域名，希望通过 nginx 自动指向对应目录，比如：<ol><li>test1.doc.test.club 自动指向 /usr/local/html/doc/test1 服务器地址；<li>test2.doc.test.club 自动指向 /usr/local/html/doc/test2 服务器地址；</ol><figure class="highlight plaintext"><table><tr><td class=code><pre><span class=line>server {</span><br><span class=line>    listen       80;</span><br><span class=line>    server_name  ~^([\w-]+)\.doc\.test\.club$;</span><br><span class=line>    root /usr/local/html/doc/$1;</span><br><span class=line>}</span><br></pre></table></figure><h2 id=泛域名转发><a class=headerlink href=#泛域名转发 title=泛域名转发></a>泛域名转发</h2><p>和之前的功能类似，有时候我们希望把二级或者三级域名链接重写到我们希望的路径，让后端就可以根据路由解析不同的规则：<ol><li>test1.serv.test.club/api?name=a 自动转发到 127.0.0.1:8080/test1/api?name=a<li>test2.serv.test.club/api?name=a 自动转发到 127.0.0.1:8080/test2/api?name=a</ol><figure class="highlight plaintext"><table><tr><td class=code><pre><span class=line>server {</span><br><span class=line>    listen       80;</span><br><span class=line>    server_name ~^([\w-]+)\.serv\.test\.club$;</span><br><span class=line>    location / {</span><br><span class=line>        proxy_set_header X-Real-IP $remote_addr;</span><br><span class=line>        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class=line>        proxy_set_header Host $http_host;</span><br><span class=line>        proxy_set_header X-NginX-Proxy true;</span><br><span class=line>        proxy_pass http://127.0.0.1:8080/$1$request_uri;</span><br><span class=line>    }</span><br><span class=line>}</span><br></pre></table></figure><h1 id=常见问题><a class=headerlink href=#常见问题 title=常见问题></a>常见问题</h1><h2 id=nginx-中怎么设置变量><a title="nginx 中怎么设置变量" class=headerlink href=#nginx-中怎么设置变量></a>nginx 中怎么设置变量</h2><p>或许你不知道，nginx 的配置文件使用的是一门微型的编程语言。既然是编程语言，一般也就少不了 “变量” 这种东西，但是在 nginx 配置中，变量只能存放一种类型的值，因为也只存在一种类型的值，那就是字符串。<p>例如我们在 nginx.conf 中有这样一行配置：<figure class="highlight plaintext"><table><tr><td class=code><pre><span class=line>set $name "chroot";</span><br></pre></table></figure><p>上面使用了 set 配置指令对变量 <code>$name</code>进行了赋值操作，把 "chroot" 赋值给了 <code>$name</code>。nginx 变量名前面有一个 <code>$</code> 符号，这是记法上的要求。所有的 Nginx 变量在 Nginx 配置文件中引用时都须带上 <code>$</code> 前缀。这种表示方法和 Perl、PHP 这些语言是相似的。<p>这种表示方法的用处在哪里呢，那就是可以直接把变量嵌入到字符串常量中以构造出新的字符串，例如你需要进行一个字符串拼接：<figure class="highlight plaintext"><table><tr><td class=code><pre><span class=line>server {</span><br><span class=line>  listen       80;</span><br><span class=line>  server_name  test.com;</span><br><span class=line></span><br><span class=line>  location / {</span><br><span class=line>     set $temp hello;</span><br><span class=line>     return "$temp world";</span><br><span class=line>  }</span><br><span class=line>}</span><br></pre></table></figure><p>以上当匹配成功的时候就会返回字符串 "hello world" 了。需要注意的是，当引用的变量名之后紧跟着变量名的构成字符时（比如后跟字母、数字以及下划线），我们就需要使用特别的记法来消除歧义，例如：<figure class="highlight plaintext"><table><tr><td class=code><pre><span class=line>server {</span><br><span class=line>  listen       80;</span><br><span class=line>  server_name  test.com;</span><br><span class=line></span><br><span class=line>  location / {</span><br><span class=line>     set $temp "hello ";</span><br><span class=line>     return "${temp}world";</span><br><span class=line>  }</span><br><span class=line>}</span><br></pre></table></figure><p>这里，我们在配置指令的参数值中引用变量 <code>$temp</code> 的时候，后面紧跟着 <code>world</code> 这个单词，所以如果直接写作 <code>"$tempworld"</code> 则 nginx 的计算引擎会将之识别为引用了变量 <code>$tempworld</code>. 为了解决这个问题，nginx 的字符串支持使用花括号在 <code>$</code> 之后把变量名围起来，比如这里的 <code>${temp}</code>，所以 上面这个例子返回的还是 "hello world"：<figure class="highlight plaintext"><table><tr><td class=code><pre><span class=line>$ curl 'http://test.com/'</span><br><span class=line>    hello world</span><br></pre></table></figure><p>还需要注意的是，若是想输出 <code>$</code> 符号本身，可以这样做：<figure class="highlight plaintext"><table><tr><td class=code><pre><span class=line>geo $dollar {</span><br><span class=line>    default "$";</span><br><span class=line>}</span><br><span class=line>server {</span><br><span class=line>    listen       80;</span><br><span class=line>    server_name  test.com;</span><br><span class=line></span><br><span class=line>    location / {</span><br><span class=line>        set $temp "hello ";</span><br><span class=line>        return "${temp}world: $dollar";</span><br><span class=line>    }</span><br><span class=line>}</span><br></pre></table></figure><p>上面用到了标准模块 ngx_geo 提供的配置指令 geo 来为变量 <code>$dollar</code> 赋予字符串 <code>"$"</code> ，这样，这里的返回值就是 "hello world: $" 了。<h1 id=附-nginx-内置预定义变量><a title="附 nginx 内置预定义变量" class=headerlink href=#附-nginx-内置预定义变量></a>附 nginx 内置预定义变量</h1><p>按字母顺序，变量名与对应定义：<ul><li><code>$arg_PARAMETER</code> #GET 请求中变量名 PARAMETER 参数的值<li><code>$args</code> #这个变量等于 GET 请求中的参数，例如，foo=123&bar=blahblah; 这个变量可以被修改<li><code>$binary_remote_addr</code> #二进制码形式的客户端地址<li><code>$body_bytes_sent</code> #传送页面的字节数<li><code>$content_length</code> #请求头中的 Content-length 字段<li><code>$content_type</code> #请求头中的 Content-Type 字段<li><code>$cookie_COOKIE</code> #cookie COOKIE 的值<li><code>$document_root</code> #当前请求在 root 指令中指定的值<li><code>$document_uri</code> #与 $uri 相同<li><code>$host</code> #请求中的主机头 (Host) 字段，如果请求中的主机头不可用或者空，则为处理请求的 server 名称(处理请求的 server 的 server_name 指令的值)。值为小写，不包含端口<li><code>$hostname</code> #机器名使用 gethostname 系统调用的值<li><code>$http_HEADER</code> #HTTP 请求头中的内容，HEADER 为 HTTP 请求中的内容转为小写，- 变为_(破折号变为下划线)，例如：$http_user_agent(Uaer-Agent 的值)<li><code>$sent_http_HEADER</code> #HTTP 响应头中的内容，HEADER 为 HTTP 响应中的内容转为小写，- 变为_(破折号变为下划线)，例如：<img data-src=https://www.zhihu.com/equation?tex=sent_http_cache_control%E3%80%81>sent_http_content_type…<li><code>$is_args</code> #如果 $args 设置，值为 "?"，否则为 ""<li><code>$limit_rate</code> #这个变量可以限制连接速率<li><code>$nginx_version</code> #当前运行的 nginx 版本号<li><code>$query_string</code> #与 $args 相同<li><code>$remote_addr</code> #客户端的 IP 地址<li><code>$remote_port</code> #客户端的端口<li><code>$remote_port</code> #已经经过 Auth Basic Module 验证的用户名<li><code>$request_filename</code> #当前连接请求的文件路径，由 root 或 alias 指令与 URI 请求生成<li><code>$request_body</code> #这个变量（0.7.58+）包含请求的主要信息。在使用 proxy_pass 或 fastcgi_pass 指令的 location 中比较有意义<li><code>$request_body_file</code> #客户端请求主体信息的临时文件名<li><code>$request_completion</code> #如果请求成功，设为 "OK"；如果请求未完成或者不是一系列请求中最后一部分则设为空<li><code>$request_method</code> #这个变量是客户端请求的动作，通常为 GET 或 POST。包括 0.8.20 及之前的版本中，这个变量总为 main request 中的动作，如果当前请求是一个子请求，并不使用这个当前请求的动作<li><code>$request_uri</code> #这个变量等于包含一些客户端请求参数的原始 URI，它无法修改，请查看 $uri 更改或重写 URI<li><code>$scheme</code> #所用的协议，例如 http 或者是 https，例如 <code>rewrite ^(.+)$$scheme://example.com$1 redirect</code><li><code>$server_addr</code> #服务器地址，在完成一次系统调用后可以确定这个值，如果要绕开系统调用，则必须在 listen 中指定地址并且使用 bind 参数<li><code>$server_name</code> #服务器名称<li><code>$server_port</code> #请求到达服务器的端口号<li><code>$server_protocol</code> #请求使用的协议，通常是 HTTP/1.0、HTTP/1.1 或 HTTP/2<li><code>$uri</code> #请求中的当前 URI(不带请求参数，参数位于 args) ， 不 同 于 浏 览 器 传 递 的 args)，不同于浏览器传递的 args)，不同于浏览器传递的 request_uri 的值，它可以通过内部重定向，或者使用 index 指令进行修改。不包括协议和主机名，例如 /foo/bar.html</ul><h1 id=附-nginx-模块><a title="附 nginx 模块" class=headerlink href=#附-nginx-模块></a>附 nginx 模块</h1><h1 id=nginx-模块分类><a title="nginx 模块分类" class=headerlink href=#nginx-模块分类></a>nginx 模块分类</h1><ul><li>核心模块：nginx 最基本最核心的服务，如进程管理、权限控制、日志记录；<li>标准 HTTP 模块：nginx 服务器的标准 HTTP 功能；<li>可选 HTTP 模块：处理特殊的 HTTP 请求<li>邮件服务模块：邮件服务<li>第三方模块：作为扩展，完成特殊功能</ul><h1 id=模块清单><a class=headerlink href=#模块清单 title=模块清单></a>模块清单</h1><p><strong>核心模块</strong>：<ul><li>ngx_core<li>ngx_errlog<li>ngx_conf<li>ngx_events<li>ngx_event_core<li>ngx_epll<li>ngx_regex</ul><p><strong>标准 HTTP 模块</strong>：<ul><li>ngx_http<li>ngx_http_core #配置端口，URI 分析，服务器相应错误处理，别名控制 (alias) 等<li>ngx_http_log #自定义 access 日志<li>ngx_http_upstream #定义一组服务器，可以接受来自 proxy, Fastcgi,Memcache 的重定向；主要用作负载均衡<li>ngx_http_static<li>ngx_http_autoindex #自动生成目录列表<li>ngx_http_index #处理以 / 结尾的请求，如果没有找到 index 页，则看是否开启了 random_index；如开启，则用之，否则用 autoindex<li>ngx_http_auth_basic #基于 http 的身份认证 (auth_basic)<li>ngx_http_access #基于 IP 地址的访问控制 (deny,allow)<li>ngx_http_limit_conn #限制来自客户端的连接的响应和处理速率<li>ngx_http_limit_req #限制来自客户端的请求的响应和处理速率<li>ngx_http_geo<li>ngx_http_map #创建任意的键值对变量<li>ngx_http_split_clients<li>ngx_http_referer #过滤 HTTP 头中 Referer 为空的对象<li>ngx_http_rewrite #通过正则表达式重定向请求<li>ngx_http_proxy<li>ngx_http_fastcgi #支持 fastcgi<li>ngx_http_uwsgi<li>ngx_http_scgi<li>ngx_http_memcached<li>ngx_http_empty_gif #从内存创建一个 1×1 的透明 gif 图片，可以快速调用<li>ngx_http_browser #解析 http 请求头部的 User-Agent 值<li>ngx_http_charset #指定网页编码<li>ngx_http_upstream_ip_hash<li>ngx_http_upstream_least_conn<li>ngx_http_upstream_keepalive<li>ngx_http_write_filter<li>ngx_http_header_filter<li>ngx_http_chunked_filter<li>ngx_http_range_header<li>ngx_http_gzip_filter<li>ngx_http_postpone_filter<li>ngx_http_ssi_filter<li>ngx_http_charset_filter<li>ngx_http_userid_filter<li>ngx_http_headers_filter #设置 http 响应头<li>ngx_http_copy_filter<li>ngx_http_range_body_filter<li>ngx_http_not_modified_filter</ul><p><strong>可选 HTTP 模块</strong>:<ul><li>ngx_http_addition #在响应请求的页面开始或者结尾添加文本信息<li>ngx_http_degradation #在低内存的情况下允许服务器返回 444 或者 204 错误<li>ngx_http_perl<li>ngx_http_flv #支持将 Flash 多媒体信息按照流文件传输，可以根据客户端指定的开始位置返回 Flash<li>ngx_http_geoip #支持解析基于 GeoIP 数据库的客户端请求<li>ngx_google_perftools<li>ngx_http_gzip #gzip 压缩请求的响应<li>ngx_http_gzip_static #搜索并使用预压缩的以. gz 为后缀的文件代替一般文件响应客户端请求<li>ngx_http_image_filter #支持改变 png，jpeg，gif 图片的尺寸和旋转方向<li>ngx_http_mp4 #支持. mp4,.m4v,.m4a 等多媒体信息按照流文件传输，常与 ngx_http_flv 一起使用<li>ngx_http_random_index #当收到 / 结尾的请求时，在指定目录下随机选择一个文件作为 index<li>ngx_http_secure_link #支持对请求链接的有效性检查<li>ngx_http_ssl #支持 https<li>ngx_http_stub_status<li>ngx_http_sub_module #使用指定的字符串替换响应中的信息<li>ngx_http_dav #支持 HTTP 和 WebDAV 协议中的 PUT/DELETE/MKCOL/COPY/MOVE 方法<li>ngx_http_xslt #将 XML 响应信息使用 XSLT 进行转换</ul><p><strong>邮件服务模块</strong>:<ul><li>ngx_mail_core<li>ngx_mail_pop3<li>ngx_mail_imap<li>ngx_mail_smtp<li>ngx_mail_auth_http<li>ngx_mail_proxy<li>ngx_mail_ssl</ul><p><strong>第三方模块</strong>：<ul><li>echo-nginx-module #支持在 nginx 配置文件中使用 echo/sleep/time/exec 等类 Shell 命令<li>memc-nginx-module<li>rds-json-nginx-module #使 nginx 支持 json 数据的处理<li>lua-nginx-module</ul><p>感谢阅读~</div><footer class=post-footer><div class=post-copyright><ul><li class=post-copyright-author><strong>本文作者： </strong>JiaHe<li class=post-copyright-link><strong>本文链接：</strong> <a href=http://xiaojianzheng.cn/archives/fe6b5ad8.html title=Nginx最全操作总结>http://xiaojianzheng.cn/archives/fe6b5ad8.html</a><li class=post-copyright-license><strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh rel=noopener target=_blank><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！</ul></div><div class=post-tags><a href=/tags/Nginx/ rel=tag># Nginx</a></div><div class=post-nav><div class=post-nav-item><a href=/archives/8a8fa792.html rel=prev title=TransactionUtil-java> <i class="fa fa-angle-left"></i> TransactionUtil-java </a></div><div class=post-nav-item><a href=/archives/c7845341.html rel=next title=git-global-config> git-global-config <i class="fa fa-angle-right"></i> </a></div></div></footer></article></div></div></main><footer class=footer><div class=footer-inner><div class=beian><a href=https://beian.miit.gov.cn/ rel=noopener target=_blank>湘ICP备19011756号-1 </a></div><div class=copyright>© 2021 – <span itemprop=copyrightYear>2024</span><span class=with-love> <i class="fa fa-heart"></i> </span><span class=author itemprop=copyrightHolder>JiaHe</span></div><div class=wordcount><span class=post-meta-item> <span class=post-meta-item-icon> <i class="fa fa-chart-line"></i> </span> <span title=站点总字数>332k</span> </span><span class=post-meta-item> <span class=post-meta-item-icon> <i class="fa fa-coffee"></i> </span> <span title=站点阅读时长>20:08</span> </span></div><div class=busuanzi-count><span class=post-meta-item id=busuanzi_container_site_uv> <span class=post-meta-item-icon> <i class="fa fa-user"></i> </span> <span class=site-uv title=总访客量> <span id=busuanzi_value_site_uv></span> </span> </span><span class=post-meta-item id=busuanzi_container_site_pv> <span class=post-meta-item-icon> <i class="fa fa-eye"></i> </span> <span class=site-pv title=总访问量> <span id=busuanzi_value_site_pv></span> </span> </span></div><div class=powered-by>由 <a href=https://hexo.io/ rel=noopener target=_blank>Hexo</a> & <a href=https://theme-next.js.org/ rel=noopener target=_blank>NexT.Gemini</a> 强力驱动</div></div></footer><div class="toggle sidebar-toggle" role=button><span class=toggle-line></span><span class=toggle-line></span><span class=toggle-line></span></div><div class=sidebar-dimmer></div><a class="book-mark-link book-mark-link-fixed" role=button></a><noscript><div class=noscript-warning>Theme NexT works best with JavaScript enabled</div></noscript><script alpha=0.6 size=300 src=https://use.sevencdn.com/ajax/libs/ribbon.js/1.0.2/ribbon.min.js zindex=-1></script><script crossorigin integrity=sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY= src=https://use.sevencdn.com/ajax/libs/animejs/3.2.1/anime.min.js></script><script crossorigin integrity=sha256-a+H7FYzJv6oU2hfsfDGM2Ohw/cR9v+hPfxHCLdmCrE8= src=https://use.sevencdn.com/ajax/libs/fancyapps-ui/5.0.31/fancybox/fancybox.umd.js></script><script crossorigin integrity=sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc= src=https://use.sevencdn.com/ajax/libs/lozad.js/1.16.0/lozad.min.js></script><script crossorigin integrity=sha256-j+yj56cdEY2CwkVtGyz18fNybFGpMGJ8JxG3GSyO2+I= src=https://use.sevencdn.com/ajax/libs/pangu/4.0.7/pangu.min.js></script><script src=https://use.sevencdn.com/ajax/libs/hexo-theme-next/8.21.1/comments.min.js></script><script src=https://use.sevencdn.com/ajax/libs/hexo-theme-next/8.21.1/utils.min.js></script><script src=https://use.sevencdn.com/ajax/libs/hexo-theme-next/8.21.1/sidebar.min.js></script><script src=https://use.sevencdn.com/ajax/libs/hexo-theme-next/8.21.1/next-boot.min.js></script><script src=https://use.sevencdn.com/ajax/libs/hexo-theme-next/8.21.1/bookmark.min.js></script><script crossorigin integrity=sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc= src=https://use.sevencdn.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js></script><script src=https://use.sevencdn.com/ajax/libs/hexo-theme-next/8.21.1/third-party/search/local-search.min.js></script><script class=next-config data-name=pdf type=application/json>{"object_url":{"url":"https://use.sevencdn.com/ajax/libs/pdfobject/2.3.0/pdfobject.min.js","integrity":"sha256-JJZNsid68vnh3/zyj0lY9BN5ynxVX/12XgOa1TlaYN0="},"url":"/lib/pdf/web/viewer.html"}</script><script src=https://use.sevencdn.com/ajax/libs/hexo-theme-next/8.21.1/third-party/tags/pdf.min.js></script><script src=https://use.sevencdn.com/ajax/libs/hexo-theme-next/8.21.1/third-party/fancybox.min.js></script><script async src=https://cn.vercount.one/js></script><script crossorigin integrity=sha256-yvJQOINiH9fWemHn0vCA5lsHWJaHs6/ZmO+1Ft04SvM= src=https://use.sevencdn.com/ajax/libs/quicklink/2.3.0/quicklink.umd.js></script><script class=next-config data-name=quicklink type=application/json>{"enable":true,"home":false,"archive":true,"delay":true,"timeout":3000,"priority":true,"ignores":null,"url":"http://xiaojianzheng.cn/archives/fe6b5ad8.html"}</script><script src=https://use.sevencdn.com/ajax/libs/hexo-theme-next/8.21.1/third-party/quicklink.min.js></script>