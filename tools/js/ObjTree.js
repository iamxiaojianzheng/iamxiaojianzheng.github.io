(XML="undefined"==typeof XML?function(){}:XML).ObjTree=function(){return this},XML.ObjTree.VERSION="0.24",XML.ObjTree.prototype.xmlDecl='<?xml version="1.0" encoding="UTF-8" ?>\n',XML.ObjTree.prototype.attr_prefix="-",XML.ObjTree.prototype.overrideMimeType="text/xml",XML.ObjTree.prototype.parseXML=function(e){if(window.DOMParser){var t=new DOMParser,r=t.parseFromString(e,"application/xml");if(!r)return;r=r.documentElement}else window.ActiveXObject&&((t=new ActiveXObject("Microsoft.XMLDOM")).async=!1,t.loadXML(e),r=t.documentElement);if(r)return this.parseDOM(r)},XML.ObjTree.prototype.parseHTTP=function(e,t,r){var o,n,s,a,i,p,l={};for(o in t)l[o]=t[o];return l.method||(l.method=void 0===l.postBody&&void 0===l.postbody&&void 0===l.parameters?"get":"post"),r?(l.asynchronous=!0,n=this,s=r,a=l.onComplete,l.onComplete=function(e){var t;e&&e.responseXML&&e.responseXML.documentElement?t=n.parseDOM(e.responseXML.documentElement):e&&e.responseText&&(t=n.parseXML(e.responseText)),s(t,e),a&&a(e)}):l.asynchronous=!1,"undefined"!=typeof HTTP&&HTTP.Request?(l.uri=e,(p=new HTTP.Request(l))&&(i=p.transport)):"undefined"!=typeof Ajax&&Ajax.Request&&(p=new Ajax.Request(e,l))&&(i=p.transport),r?i:i&&i.responseXML&&i.responseXML.documentElement?this.parseDOM(i.responseXML.documentElement):i&&i.responseText?this.parseXML(i.responseText):void 0},XML.ObjTree.prototype.parseDOM=function(e){if(e){if(this.__force_array={},this.force_array)for(var t=0;t<this.force_array.length;t++)this.__force_array[this.force_array[t]]=1;var r,o=this.parseElement(e);return this.__force_array[e.nodeName]&&(o=[o]),11!=e.nodeType&&((r={})[e.nodeName]=o,o=r),o}},XML.ObjTree.prototype.parseElement=function(e){if(7!=e.nodeType){if(3==e.nodeType||4==e.nodeType)return null==e.nodeValue.match(/[^\x00-\x20]/)?void 0:e.nodeValue;var t={};if(e.attributes&&e.attributes.length)for(var r={},o=0;o<e.attributes.length;o++)"string"==typeof(a=e.attributes[o].nodeName)&&(i=e.attributes[o].nodeValue)&&(void 0===t[a=this.attr_prefix+a]&&(t[a]=0),t[a]++,this.addNode(r,a,t[a],i));if(e.childNodes&&e.childNodes.length){var n=!0;r&&(n=!1);for(o=0;o<e.childNodes.length&&n;o++){var s=e.childNodes[o].nodeType;3!=s&&4!=s&&(n=!1)}if(n){r=r||"";for(o=0;o<e.childNodes.length;o++)r+=e.childNodes[o].nodeValue}else{r=r||{};for(var a,i,o=0;o<e.childNodes.length;o++)"string"==typeof(a=e.childNodes[o].nodeName)&&(i=this.parseElement(e.childNodes[o]))&&(void 0===t[a]&&(t[a]=0),t[a]++,this.addNode(r,a,t[a],i))}}return r}},XML.ObjTree.prototype.addNode=function(e,t,r,o){this.__force_array[t]?(1==r&&(e[t]=[]),e[t][e[t].length]=o):1==r?e[t]=o:2==r?e[t]=[e[t],o]:e[t][e[t].length]=o},XML.ObjTree.prototype.writeXML=function(e){e=this.hash_to_xml(null,e);return this.xmlDecl+e},XML.ObjTree.prototype.hash_to_xml=function(e,t){var r,o,n=[],s=[];for(r in t)t.hasOwnProperty(r)&&(o=t[r],r.charAt(0)!=this.attr_prefix?void 0===o||null==o?n[n.length]="<"+r+" />":"object"==typeof o&&o.constructor==Array?n[n.length]=this.array_to_xml(r,o):n[n.length]="object"==typeof o?this.hash_to_xml(r,o):this.scalar_to_xml(r,o):s[s.length]=" "+r.substring(1)+'="'+this.xml_escape(o)+'"');var a=s.join(""),i=n.join("");return i=void 0!==e&&null!=e?0<n.length?i.match(/\n/)?"<"+e+a+">\n"+i+"</"+e+">\n":"<"+e+a+">"+i+"</"+e+">\n":"<"+e+a+" />\n":i},XML.ObjTree.prototype.array_to_xml=function(e,t){for(var r=[],o=0;o<t.length;o++){var n=t[o];void 0===n||null==n?r[r.length]="<"+e+" />":"object"==typeof n&&n.constructor==Array?r[r.length]=this.array_to_xml(e,n):r[r.length]="object"==typeof n?this.hash_to_xml(e,n):this.scalar_to_xml(e,n)}return r.join("")},XML.ObjTree.prototype.scalar_to_xml=function(e,t){return"#text"==e?this.xml_escape(t):"<"+e+">"+this.xml_escape(t)+"</"+e+">\n"},XML.ObjTree.prototype.xml_escape=function(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")};