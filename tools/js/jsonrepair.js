function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf(e,t)}function _createSuper(r){var o=_isNativeReflectConstruct();return function(){var e,t=_getPrototypeOf(r);return _possibleConstructorReturn(this,o?(e=_getPrototypeOf(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments))}}function _possibleConstructorReturn(e,t){if(t&&("object"===_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _wrapNativeSuper(e){var r="function"==typeof Map?new Map:void 0;return(_wrapNativeSuper=function(e){if(null===e||!_isNativeFunction(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==r){if(r.has(e))return r.get(e);r.set(e,t)}function t(){return _construct(e,arguments,_getPrototypeOf(this).constructor)}return t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),_setPrototypeOf(t,e)})(e)}function _construct(e,t,r){return(_construct=_isNativeReflectConstruct()?Reflect.construct.bind():function(e,t,r){var o=[null];o.push.apply(o,t);t=new(Function.bind.apply(e,o));return r&&_setPrototypeOf(t,r.prototype),t}).apply(null,arguments)}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function _isNativeFunction(e){return-1!==Function.toString.call(e).indexOf("[native code]")}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var JSONRepairError=function(){_inherits(o,_wrapNativeSuper(Error));var r=_createSuper(o);function o(e,t){return _classCallCheck(this,o),(e=r.call(this,e+" at position "+t)).position=t,e}return _createClass(o)}(),codeBackslash=92,codeSlash=47,codeAsterisk=42,codeOpeningBrace=123,codeClosingBrace=125,codeOpeningBracket=91,codeClosingBracket=93,codeOpenParenthesis=40,codeCloseParenthesis=41,codeSpace=32,codeNewline=10,codeTab=9,codeReturn=13,codeBackspace=8,codeFormFeed=12,codeDoubleQuote=34,codePlus=43,codeMinus=45,codeQuote=39,codeZero=48,codeOne=49,codeNine=57,codeComma=44,codeDot=46,codeColon=58,codeSemicolon=59,codeUppercaseA=65,codeLowercaseA=97,codeUppercaseE=69,codeLowercaseE=101,codeUppercaseF=70,codeLowercaseF=102,codeNonBreakingSpace=160,codeEnQuad=8192,codeHairSpace=8202,codeNarrowNoBreakSpace=8239,codeMediumMathematicalSpace=8287,codeIdeographicSpace=12288,codeDoubleQuoteLeft=8220,codeDoubleQuoteRight=8221,codeQuoteLeft=8216,codeQuoteRight=8217,codeGraveAccent=96,codeAcuteAccent=180;function isHex(e){return codeZero<=e&&e<=codeNine||codeUppercaseA<=e&&e<=codeUppercaseF||codeLowercaseA<=e&&e<=codeLowercaseF}function isDigit(e){return codeZero<=e&&e<=codeNine}function isNonZeroDigit(e){return codeOne<=e&&e<=codeNine}function isValidStringCharacter(e){return 32<=e&&e<=1114111}function isDelimiter(e){return regexDelimiter.test(e)||e&&isQuote(e.charCodeAt(0))}var regexDelimiter=/^[,:[\]{}()\n]$/;function isStartOfValue(e){return regexStartOfValue.test(e)||e&&isQuote(e.charCodeAt(0))}var regexStartOfValue=/^[[{\w-]$/;function isControlCharacter(e){return e===codeNewline||e===codeReturn||e===codeTab||e===codeBackspace||e===codeFormFeed}function isWhitespace(e){return e===codeSpace||e===codeNewline||e===codeTab||e===codeReturn}function isSpecialWhitespace(e){return e===codeNonBreakingSpace||codeEnQuad<=e&&e<=codeHairSpace||e===codeNarrowNoBreakSpace||e===codeMediumMathematicalSpace||e===codeIdeographicSpace}function isQuote(e){return isDoubleQuote(e)||isSingleQuote(e)}function isDoubleQuote(e){return e===codeDoubleQuote||e===codeDoubleQuoteLeft||e===codeDoubleQuoteRight}function isSingleQuote(e){return e===codeQuote||e===codeQuoteLeft||e===codeQuoteRight||e===codeGraveAccent||e===codeAcuteAccent}function stripLastOccurrence(e,t){var r=2<arguments.length&&void 0!==arguments[2]&&arguments[2],o=e.lastIndexOf(t);return-1!==o?e.substring(0,o)+(r?"":e.substring(o+1)):e}function insertBeforeLastWhitespace(e,t){var r=e.length;if(!isWhitespace(e.charCodeAt(r-1)))return e+t;for(;isWhitespace(e.charCodeAt(r-1));)r--;return e.substring(0,r)+t+e.substring(r)}function removeAtIndex(e,t,r){return e.substring(0,t)+e.substring(t+r)}function endsWithCommaOrNewline(e){return/[,\n][ \t\r]*$/.test(e)}var controlCharacters={"\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t"},escapeCharacters={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"};function jsonrepair(i){var a=0,s="";if(!o())throw new JSONRepairError("Unexpected end of json string",i.length);var e=n(codeComma);if(e&&u(),isStartOfValue(i[a])&&endsWithCommaOrNewline(s)){e||(s=insertBeforeLastWhitespace(s,","));for(var t=!0,r=!0;r;)t?t=!1:n(codeComma)||(s=insertBeforeLastWhitespace(s,",")),r=o();r||(s=stripLastOccurrence(s,",")),s="[\n".concat(s,"\n]")}else e&&(s=stripLastOccurrence(s,","));if(a>=i.length)return s;throw new JSONRepairError("Unexpected character "+JSON.stringify(i[a]),a);function o(){u();var e=function(){if(i.charCodeAt(a)!==codeOpeningBrace)return!1;s+="{",a++,u();var e=!0;for(;a<i.length&&i.charCodeAt(a)!==codeClosingBrace;){if(e?e=!!0:(n(codeComma)||(s=insertBeforeLastWhitespace(s,",")),u()),!(f()||p())){i.charCodeAt(a)===codeClosingBrace||i.charCodeAt(a)===codeOpeningBrace||i.charCodeAt(a)===codeClosingBracket||i.charCodeAt(a)===codeOpeningBracket||void 0===i[a]?s=stripLastOccurrence(s,","):function(){throw new JSONRepairError("Object key expected",a)}();break}u();var t=n(codeColon);t||(isStartOfValue(i[a])?s=insertBeforeLastWhitespace(s,":"):C()),o()||(t?function(){throw new JSONRepairError("Object value expected",a)}:C)()}i.charCodeAt(a)===codeClosingBrace?(s+="}",a++):s=insertBeforeLastWhitespace(s,"}");return!0}()||function(){if(i.charCodeAt(a)!==codeOpeningBracket)return!1;s+="[",a++,u();var e=!0;for(;a<i.length&&i.charCodeAt(a)!==codeClosingBracket;)if(e?e=!1:n(codeComma)||(s=insertBeforeLastWhitespace(s,",")),!o()){s=stripLastOccurrence(s,",");break}i.charCodeAt(a)===codeClosingBracket?(s+="]",a++):s=insertBeforeLastWhitespace(s,"]");return!0}()||f()||function(){var e=a;i.charCodeAt(a)===codeMinus&&(a++,h(e));if(i.charCodeAt(a)===codeZero)a++;else if(isNonZeroDigit(i.charCodeAt(a)))for(a++;isDigit(i.charCodeAt(a));)a++;if(i.charCodeAt(a)===codeDot)for(a++,h(e);isDigit(i.charCodeAt(a));)a++;if(i.charCodeAt(a)===codeLowercaseE||i.charCodeAt(a)===codeUppercaseE)for(a++,i.charCodeAt(a)!==codeMinus&&i.charCodeAt(a)!==codePlus||a++,h(e);isDigit(i.charCodeAt(a));)a++;if(e<a)return s+=i.slice(e,a),!0;return!1}()||l("true","true")||l("false","false")||l("null","null")||l("True","true")||l("False","false")||l("None","null")||p();return u(),e}function u(){for(c();function(){if(i.charCodeAt(a)===codeSlash&&i.charCodeAt(a+1)===codeAsterisk){for(;a<i.length&&!atEndOfBlockComment(i,a);)a++;a+=2}else{if(i.charCodeAt(a)!==codeSlash||i.charCodeAt(a+1)!==codeSlash)return!1;for(;a<i.length&&i.charCodeAt(a)!==codeNewline;)a++}return!0}()&&c(););}function c(){for(var e,t="";(e=isWhitespace(i.charCodeAt(a)))||isSpecialWhitespace(i.charCodeAt(a));)t+=e?i[a]:" ",a++;return 0<t.length&&(s+=t,!0)}function n(e){return i.charCodeAt(a)===e&&(s+=i[a],a++,!0)}function d(){return e=codeBackslash,i.charCodeAt(a)===e&&(a++,!0);var e}function f(){var e=i.charCodeAt(a)===codeBackslash;if(e&&(a++,e=!0),isQuote(i.charCodeAt(a))){var t=isSingleQuote(i.charCodeAt(a))?isSingleQuote:isDoubleQuote;for(i.charCodeAt(a),s+='"',a++;a<i.length&&!t(i.charCodeAt(a));){if(i.charCodeAt(a)===codeBackslash){var r=i[a+1];if(void 0!==escapeCharacters[r])s+=i.slice(a,a+2),a+=2;else if("u"===r){if(!(isHex(i.charCodeAt(a+2))&&isHex(i.charCodeAt(a+3))&&isHex(i.charCodeAt(a+4))&&isHex(i.charCodeAt(a+5)))){c=o=void 0;for(var o=a,c=o+2;/\w/.test(i[c]);)c++;throw o=i.slice(o,c),new JSONRepairError('Invalid unicode character "'.concat(o,'"'),a)}s+=i.slice(a,a+6),a+=6}else s+=r,a+=2}else{o=i[a],r=i.charCodeAt(a);if(r===codeDoubleQuote&&i.charCodeAt(a-1)!==codeBackslash)s+="\\"+o;else if(isControlCharacter(r))s+=controlCharacters[o];else{if(!isValidStringCharacter(r))throw new JSONRepairError("Invalid character "+JSON.stringify(o),a);s+=o}a++}e&&d()}isQuote(i.charCodeAt(a))?(i.charCodeAt(a),s+='"',a++):s+='"';for(u();i.charCodeAt(a)===codePlus;){a++,u();var n=(s=stripLastOccurrence(s,'"',!0)).length;f(),s=removeAtIndex(s,n,1)}return!0}return!1}function l(e,t){return i.slice(a,a+e.length)===e&&(s+=t,a+=e.length,!0)}function p(){for(var e=a;a<i.length&&!isDelimiter(i[a]);)a++;if(e<a){if(i.charCodeAt(a)===codeOpenParenthesis)a++,o(),i.charCodeAt(a)===codeCloseParenthesis&&(a++,i.charCodeAt(a)===codeSemicolon)&&a++;else{for(;isWhitespace(i.charCodeAt(a-1))&&0<a;)a--;e=i.slice(e,a);s+=JSON.stringify(e)}return!0}}function h(e){if(!isDigit(i.charCodeAt(a)))throw e=i.slice(e,a),new JSONRepairError("Invalid number '".concat(e,"', expecting a digit ").concat(i[a]?"but got '".concat(i[a],"'"):"but reached end of input"),2)}function C(){throw new JSONRepairError("Colon expected",a)}}function atEndOfBlockComment(e,t){return"*"===e[t]&&"/"===e[t+1]}export{JSONRepairError,jsonrepair};