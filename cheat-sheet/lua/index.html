<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#222" media="(prefers-color-scheme: light)"><meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 5.4.0"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png"><link rel="mask-icon" href="/images/logo.svg" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous"><script class="next-config" data-name="main" type="application/json">{"hostname":"xiaojianzheng.cn","root":"/","images":"/images","scheme":"Gemini","darkmode":true,"version":"8.8.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":true,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":true,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.json","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":true}}</script><script src="/js/config.js"></script><meta name="description" content="数据类型   数据类型 描述    nil 这个最简单，只有值nil属于该类，表示一个无效值（在条件表达式中相当于false）。   boolean 包含两个值：false和true。   number 表示双精度类型的实浮点数   string 字符串由一对双引号或单引号来表示   function 由 C 或 Lua 编写的函数   userdata 表示任意存储在变量中的C数据结构   th"><meta property="og:type" content="website"><meta property="og:title" content="JIAHE"><meta property="og:url" content="http://xiaojianzheng.cn/cheat-sheet/lua/index.html"><meta property="og:site_name" content="JIAHE"><meta property="og:description" content="数据类型   数据类型 描述    nil 这个最简单，只有值nil属于该类，表示一个无效值（在条件表达式中相当于false）。   boolean 包含两个值：false和true。   number 表示双精度类型的实浮点数   string 字符串由一对双引号或单引号来表示   function 由 C 或 Lua 编写的函数   userdata 表示任意存储在变量中的C数据结构   th"><meta property="og:locale" content="zh_CN"><meta property="article:published_time" content="2022-09-07T10:10:18.945Z"><meta property="article:modified_time" content="2022-09-07T10:10:18.945Z"><meta property="article:author" content="JIAHE"><meta property="article:tag" content="JIAHE"><meta name="twitter:card" content="summary"><link rel="canonical" href="http://xiaojianzheng.cn/cheat-sheet/lua/"><script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":false,"lang":"zh-CN","comments":true,"permalink":"http://xiaojianzheng.cn/cheat-sheet/lua/index.html","path":"cheat-sheet/lua/index.html","title":""}</script><script class="next-config" data-name="calendar" type="application/json">""</script><title> | JIAHE</title><noscript><link rel="stylesheet" href="/css/noscript.css"></noscript></head><body itemscope itemtype="http://schema.org/WebPage"><div class="headband"></div><main class="main"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><i class="logo-line"></i><p class="site-title">JIAHE</p><i class="logo-line"></i></a></div><div class="site-nav-right"><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-导航"><a href="/navigation/" rel="section"><i class="fa fa-location-arrow fa-fw"></i>导航</a></li><li class="menu-item menu-item-文档"><a href="/docs/" rel="section"><i class="fa fa-book fa-fw fa-fw"></i>文档</a></li><li class="menu-item menu-item-应用下载"><a href="/app-download/" rel="section"><i class="fas fa-download fa-fw fa-fw"></i>应用下载</a></li><li class="menu-item menu-item-cheat-sheet"><a href="/cheat-sheet/" rel="section"><i class="fas fa-pen fa-fw"></i>Cheat Sheet</a></li><li class="menu-item menu-item-软件安装部署"><a href="/software-install-and-deploy/" rel="section"><i class="fab fa-windows fa-fw"></i>软件安装部署</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> 搜索</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocapitalize="off" maxlength="80" placeholder="搜索..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close" role="button"><i class="fa fa-times-circle"></i></span></div><div class="search-result-container no-result"><div class="search-result-icon"><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></div><div class="toggle sidebar-toggle" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="nav-number">1.</span> <span class="nav-text">数据类型</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%98%E9%87%8F"><span class="nav-number">2.</span> <span class="nav-text">变量</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BE%AA%E7%8E%AF"><span class="nav-number">3.</span> <span class="nav-text">循环</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#while"><span class="nav-number">3.1.</span> <span class="nav-text">while</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#for"><span class="nav-number">3.2.</span> <span class="nav-text">for</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#repeat-until"><span class="nav-number">3.3.</span> <span class="nav-text">repeat...until</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6"><span class="nav-number">4.</span> <span class="nav-text">流程控制</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%87%BD%E6%95%B0"><span class="nav-number">5.</span> <span class="nav-text">函数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="nav-number">6.</span> <span class="nav-text">运算符</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="nav-number">7.</span> <span class="nav-text">字符串</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%93%8D%E4%BD%9C"><span class="nav-number">7.1.</span> <span class="nav-text">字符串操作</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8C%B9%E9%85%8D%E6%A8%A1%E5%BC%8F"><span class="nav-number">7.2.</span> <span class="nav-text">匹配模式</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%95%B0%E7%BB%84"><span class="nav-number">8.</span> <span class="nav-text">数组</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#table"><span class="nav-number">9.</span> <span class="nav-text">table</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A1%A8%E7%9A%84%E6%9E%84%E9%80%A0"><span class="nav-number">9.1.</span> <span class="nav-text">表的构造</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A1%A8%E7%9A%84%E6%93%8D%E4%BD%9C"><span class="nav-number">9.2.</span> <span class="nav-text">表的操作</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%87%BD%E6%95%B0%E5%B0%8F%E6%8A%80%E5%B7%A7"><span class="nav-number">10.</span> <span class="nav-text">函数小技巧</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A8%A1%E5%9D%97%E4%B8%8E%E5%8C%85"><span class="nav-number">11.</span> <span class="nav-text">模块与包</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#require-%E5%87%BD%E6%95%B0"><span class="nav-number">11.1.</span> <span class="nav-text">require 函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8A%A0%E8%BD%BD%E6%9C%BA%E5%88%B6"><span class="nav-number">11.2.</span> <span class="nav-text">加载机制</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#C-%E5%8C%85"><span class="nav-number">11.3.</span> <span class="nav-text">C 包</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#I-O"><span class="nav-number">12.</span> <span class="nav-text">I&#x2F;O</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AE%80%E5%8D%95%E6%A8%A1%E5%BC%8F"><span class="nav-number">12.1.</span> <span class="nav-text">简单模式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%8C%E5%85%A8%E6%A8%A1%E5%BC%8F"><span class="nav-number">12.2.</span> <span class="nav-text">完全模式</span></a></li></ol></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="JIAHE" src="/images/avatar.jpg"><p class="site-author-name" itemprop="name">JIAHE</p><div class="site-description" itemprop="description">Collection & Reuse</div></div><div class="site-state-wrap site-overview-item animated"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">95</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">96</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-blogroll site-overview-item animated"><div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i> Links</div><ul class="links-of-blogroll-list"><li class="links-of-blogroll-item"> <a href="https://cook.aiurs.co/" title="https:&#x2F;&#x2F;cook.aiurs.co&#x2F;" rel="noopener" target="_blank">程序员做饭指南</a></li><li class="links-of-blogroll-item"> <a href="https://www.baidu.com/" title="https:&#x2F;&#x2F;www.baidu.com&#x2F;" rel="noopener" target="_blank">Baidu</a></li><li class="links-of-blogroll-item"> <a href="https://cn.bing.com/" title="https:&#x2F;&#x2F;cn.bing.com&#x2F;" rel="noopener" target="_blank">Bing</a></li><li class="links-of-blogroll-item"> <a href="https://www.google.com/" title="https:&#x2F;&#x2F;www.google.com&#x2F;" rel="noopener" target="_blank">Google</a></li><li class="links-of-blogroll-item"> <a href="https://zh.wikipedia.org/wiki/Wikipedia:%E9%A6%96%E9%A1%B5" title="https:&#x2F;&#x2F;zh.wikipedia.org&#x2F;wiki&#x2F;Wikipedia:%E9%A6%96%E9%A1%B5" rel="noopener" target="_blank">Wiki</a></li><li class="links-of-blogroll-item"> <a href="https://projectlombok.org/" title="https:&#x2F;&#x2F;projectlombok.org&#x2F;" rel="noopener" target="_blank">lombok</a></li><li class="links-of-blogroll-item"> <a href="https://logging.apache.org/log4j/2.x/" title="https:&#x2F;&#x2F;logging.apache.org&#x2F;log4j&#x2F;2.x&#x2F;" rel="noopener" target="_blank">log4j</a></li><li class="links-of-blogroll-item"> <a href="http://logback.qos.ch/" title="http:&#x2F;&#x2F;logback.qos.ch&#x2F;" rel="noopener" target="_blank">logback</a></li><li class="links-of-blogroll-item"> <a href="https://junit.org/junit5/" title="https:&#x2F;&#x2F;junit.org&#x2F;junit5&#x2F;" rel="noopener" target="_blank">junit</a></li><li class="links-of-blogroll-item"> <a href="https://element.eleme.cn/#/zh-CN" title="https:&#x2F;&#x2F;element.eleme.cn&#x2F;#&#x2F;zh-CN" rel="noopener" target="_blank">ElementUI</a></li><li class="links-of-blogroll-item"> <a href="https://zipkin.io/" title="https:&#x2F;&#x2F;zipkin.io&#x2F;" rel="noopener" target="_blank">Zipkin</a></li><li class="links-of-blogroll-item"> <a href="https://www.selenium.dev/zh-cn/" title="https:&#x2F;&#x2F;www.selenium.dev&#x2F;zh-cn&#x2F;" rel="noopener" target="_blank">Selenium</a></li><li class="links-of-blogroll-item"> <a href="https://nacos.io/zh-cn/docs/what-is-nacos.html" title="https:&#x2F;&#x2F;nacos.io&#x2F;zh-cn&#x2F;docs&#x2F;what-is-nacos.html" rel="noopener" target="_blank">Nacos</a></li><li class="links-of-blogroll-item"> <a href="https://dev.mysql.com/downloads/" title="https:&#x2F;&#x2F;dev.mysql.com&#x2F;downloads&#x2F;" rel="noopener" target="_blank">MySQL-Download</a></li><li class="links-of-blogroll-item"> <a href="https://redis.io/" title="https:&#x2F;&#x2F;redis.io&#x2F;" rel="noopener" target="_blank">Redis</a></li><li class="links-of-blogroll-item"> <a href="https://www.jetbrains.com/help/idea/discover-intellij-idea.html" title="https:&#x2F;&#x2F;www.jetbrains.com&#x2F;help&#x2F;idea&#x2F;discover-intellij-idea.html" rel="noopener" target="_blank">IDEA-Document</a></li><li class="links-of-blogroll-item"> <a href="https://jdk.java.net/" title="https:&#x2F;&#x2F;jdk.java.net&#x2F;" rel="noopener" target="_blank">JDK</a></li><li class="links-of-blogroll-item"> <a href="https://www.java.com/en/download/manual.jsp" title="https:&#x2F;&#x2F;www.java.com&#x2F;en&#x2F;download&#x2F;manual.jsp" rel="noopener" target="_blank">JDK8</a></li><li class="links-of-blogroll-item"> <a href="https://dev.java/" title="https:&#x2F;&#x2F;dev.java&#x2F;" rel="noopener" target="_blank">JAVA</a></li><li class="links-of-blogroll-item"> <a href="https://www.oracle.com/java/technologies/downloads/archive/" title="https:&#x2F;&#x2F;www.oracle.com&#x2F;java&#x2F;technologies&#x2F;downloads&#x2F;archive&#x2F;" rel="noopener" target="_blank">JDK-Oracle</a></li><li class="links-of-blogroll-item"> <a href="https://poi.apache.org/components/index.html" title="https:&#x2F;&#x2F;poi.apache.org&#x2F;components&#x2F;index.html" rel="noopener" target="_blank">POI</a></li><li class="links-of-blogroll-item"> <a href="https://assertj.github.io/doc/" title="https:&#x2F;&#x2F;assertj.github.io&#x2F;doc&#x2F;" rel="noopener" target="_blank">AssertJ</a></li><li class="links-of-blogroll-item"> <a href="https://docshome.gitbook.io/nginx-docs/" title="https:&#x2F;&#x2F;docshome.gitbook.io&#x2F;nginx-docs&#x2F;" rel="noopener" target="_blank">Nginx-CN</a></li><li class="links-of-blogroll-item"> <a href="https://github.com/cglib/cglib" title="https:&#x2F;&#x2F;github.com&#x2F;cglib&#x2F;cglib" rel="noopener" target="_blank">cglib</a></li><li class="links-of-blogroll-item"> <a href="https://docs.gitlab.com/ee/api/api_resources.html" title="https:&#x2F;&#x2F;docs.gitlab.com&#x2F;ee&#x2F;api&#x2F;api_resources.html" rel="noopener" target="_blank">Gitlab Api</a></li><li class="links-of-blogroll-item"> <a href="http://mockjs.com/examples.html" title="http:&#x2F;&#x2F;mockjs.com&#x2F;examples.html" rel="noopener" target="_blank">Mockjs Example</a></li></ul></div></div></div></div></aside><div class="sidebar-dimmer"></div></header><div class="back-to-top" role="button" aria-label="返回顶部"><i class="fa fa-arrow-up"></i> <span>0%</span></div><a role="button" class="book-mark-link book-mark-link-fixed"></a><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><div class="main-inner page posts-expand"><ul class="sub-menu menu"><li class="menu-item menu-item-docker"><a href="/cheat-sheet/docker" rel="section"><i class="fab fa-docker fa-fw"></i>Docker</a></li><li class="menu-item menu-item-mysql"><a href="/cheat-sheet/mysql/" rel="section"><i class="fas fa-database fa-fw"></i>MySQL</a></li><li class="menu-item menu-item-lua"><a href="/cheat-sheet/lua/" rel="section"><i class="fa fa-moon fa-fw"></i>Lua</a></li><li class="menu-item menu-item-vim"><a href="/cheat-sheet/vim/" rel="section"><i class="fab fa-vimeo fa-fw"></i>Vim</a></li><li class="menu-item menu-item-git"><a href="/cheat-sheet/git/" rel="section"><i class="fab fa-git-square fa-fw"></i>Git</a></li><li class="menu-item menu-item-bash"><a href="/cheat-sheet/bash/" rel="section"><i class="fab fa-vimeo fa-fw"></i>Bash</a></li><li class="menu-item menu-item-ffmpeg"><a href="/cheat-sheet/ffmpeg.html" rel="section"><i class="fas fa-random fa-fw"></i>ffmpeg</a></li><li class="menu-item menu-item-adb"><a href="/cheat-sheet/adb.html" rel="section"><i class="fas fa-terminal fa-fw"></i>adb</a></li></ul><ul class="sub-menu menu"></ul><div class="post-block" lang="zh-CN"><header class="post-header"><h1 class="post-title" itemprop="name headline"></h1><div class="post-meta-container"><ul class="breadcrumb"><li><a href="/cheat-sheet/">CHEAT-SHEET</a></li><li>LUA</li></ul></div></header><div class="post-body"><h2 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h2><table><thead><tr><th align="left">数据类型</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left">nil</td><td align="left">这个最简单，只有值nil属于该类，表示一个无效值（在条件表达式中相当于false）。</td></tr><tr><td align="left">boolean</td><td align="left">包含两个值：false和true。</td></tr><tr><td align="left">number</td><td align="left">表示双精度类型的实浮点数</td></tr><tr><td align="left">string</td><td align="left">字符串由一对双引号或单引号来表示</td></tr><tr><td align="left">function</td><td align="left">由 C 或 Lua 编写的函数</td></tr><tr><td align="left">userdata</td><td align="left">表示任意存储在变量中的C数据结构</td></tr><tr><td align="left">thread</td><td align="left">表示执行的独立线路，用于执行协同程序</td></tr><tr><td align="left">table</td><td align="left">Lua 中的表（table）其实是一个&quot;关联数组&quot;（associative arrays），数组的索引可以是数字、字符串或表类型。在 Lua 里，table 的创建是通过&quot;构造表达式&quot;来完成，最简单构造表达式是{}，用来创建一个空表。</td></tr></tbody></table><h2 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h2><p>Lua 变量有三种类型：全局变量（默认）、局部变量、表中的域。</p><p>局部变量的作用域为从声明位置开始到所在语句块结束。</p><p>变量的默认值均为 nil。</p><figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 赋值是改变一个变量的值和改变表域的最基本的方法。</span></span><br><span class="line">a = <span class="string">&quot;hello&quot;</span> .. <span class="string">&quot;world&quot;</span></span><br><span class="line">t.n = t.n + <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- Lua 可以对多个变量同时赋值，变量列表和值列表的各个元素用逗号分开，赋值语句右边的值会依次赋给左边的变量。</span></span><br><span class="line">a, b = <span class="number">10</span>, <span class="number">2</span>*x       &lt;<span class="comment">--&gt;       a=10; b=2*x</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 遇到赋值语句Lua会先计算右边所有的值然后再执行赋值操作，所以我们可以这样进行交换变量的值：</span></span><br><span class="line">x, y = y, x                     <span class="comment">-- swap &#x27;x&#x27; for &#x27;y&#x27;</span></span><br><span class="line">a[i], a[j] = a[j], a[i]         <span class="comment">-- swap &#x27;a[i]&#x27; for &#x27;a[j]&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--[[</span></span><br><span class="line"><span class="comment">当变量个数和值的个数不一致时，Lua会一直以变量个数为基础采取以下策略：</span></span><br><span class="line"><span class="comment">a. 变量个数 &gt; 值的个数             按变量个数补足nil</span></span><br><span class="line"><span class="comment">b. 变量个数 &lt; 值的个数             多余的值会被忽略</span></span><br><span class="line"><span class="comment">]]</span></span><br><span class="line"></span><br><span class="line">a, b, c = <span class="number">0</span>, <span class="number">1</span></span><br><span class="line"><span class="built_in">print</span>(a,b,c)             <span class="comment">--&gt; 0   1   nil</span></span><br><span class="line"></span><br><span class="line">a, b = a+<span class="number">1</span>, b+<span class="number">1</span>, b+<span class="number">2</span>     <span class="comment">-- value of b+2 is ignored</span></span><br><span class="line"><span class="built_in">print</span>(a,b)               <span class="comment">--&gt; 1   2</span></span><br><span class="line"></span><br><span class="line">a, b, c = <span class="number">0</span></span><br><span class="line"><span class="built_in">print</span>(a,b,c)             <span class="comment">--&gt; 0   nil   nil</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 多值赋值经常用来交换变量，或将函数调用返回给变量：</span></span><br><span class="line">a, b = f()</span><br><span class="line"></span><br><span class="line"><span class="comment">--[[</span></span><br><span class="line"><span class="comment">应该尽可能的使用局部变量，有两个好处：</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">1. 避免命名冲突。</span></span><br><span class="line"><span class="comment">2. 访问局部变量的速度比全局变量更快。</span></span><br><span class="line"><span class="comment">]]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 对 table 的索引使用方括号 []。Lua 也提供了 . 操作。</span></span><br><span class="line">t[i]</span><br><span class="line">t.i                 <span class="comment">-- 当索引为字符串类型时的一种简化写法</span></span><br><span class="line">gettable_event(t,i) <span class="comment">-- 采用索引访问本质上是一个类似这样的函数调用</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="循环"><a href="#循环" class="headerlink" title="循环"></a>循环</h2><h3 id="while"><a href="#while" class="headerlink" title="while"></a>while</h3><figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="comment">--[[</span></span><br><span class="line"><span class="comment">while循环</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">while(condition)</span></span><br><span class="line"><span class="comment">do</span></span><br><span class="line"><span class="comment">   statements</span></span><br><span class="line"><span class="comment">end</span></span><br><span class="line"><span class="comment">]]</span></span><br><span class="line"></span><br><span class="line">a=<span class="number">10</span></span><br><span class="line"><span class="keyword">while</span>( a &lt; <span class="number">20</span> )</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">   <span class="built_in">print</span>(<span class="string">&quot;a 的值为:&quot;</span>, a)</span><br><span class="line">   a = a+<span class="number">1</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><h3 id="for"><a href="#for" class="headerlink" title="for"></a>for</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">-- [[</span><br><span class="line">数值for循环</span><br><span class="line"></span><br><span class="line">var 从 exp1 变化到 exp2，每次变化以 exp3 为步长递增 var，并执行一次 &quot;执行体&quot;。exp3 是可选的，如果不指定，默认为1。</span><br><span class="line"></span><br><span class="line">for var&#x3D;exp1,exp2,exp3 do  </span><br><span class="line">    &lt;执行体&gt;  </span><br><span class="line">end</span><br><span class="line">]]</span><br><span class="line">-- </span><br><span class="line"></span><br><span class="line">for i&#x3D;1,f(x) do</span><br><span class="line">    print(i)</span><br><span class="line">end</span><br><span class="line"> </span><br><span class="line">for i&#x3D;10,1,-1 do</span><br><span class="line">    print(i)</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">-- [[</span><br><span class="line">泛型for循环</span><br><span class="line"></span><br><span class="line">泛型 for 循环通过一个迭代器函数来遍历所有值，类似 java 中的 foreach 语句。</span><br><span class="line">]]</span><br><span class="line"></span><br><span class="line">-- 打印数组a的所有值 </span><br><span class="line">-- i是数组索引值，v是对应索引的数组元素值。ipairs是Lua提供的一个迭代器函数，用来迭代数组。</span><br><span class="line">a &#x3D; &#123;&quot;one&quot;, &quot;two&quot;, &quot;three&quot;&#125;</span><br><span class="line">for i, v in ipairs(a) do</span><br><span class="line">    print(i, v)</span><br><span class="line">end</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="repeat-until"><a href="#repeat-until" class="headerlink" title="repeat...until"></a>repeat...until</h3><figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="comment">--[[</span></span><br><span class="line"><span class="comment">repeat...until循环</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">当condition为true时，结束statements</span></span><br><span class="line"><span class="comment">repeat</span></span><br><span class="line"><span class="comment">   statements</span></span><br><span class="line"><span class="comment">until( condition )</span></span><br><span class="line"><span class="comment">]]</span></span><br><span class="line"></span><br><span class="line">a = <span class="number">10</span></span><br><span class="line"><span class="keyword">repeat</span></span><br><span class="line">   <span class="built_in">print</span>(<span class="string">&quot;a的值为:&quot;</span>, a)</span><br><span class="line">   a = a + <span class="number">1</span></span><br><span class="line"><span class="keyword">until</span>( a &gt; <span class="number">15</span> )</span><br></pre></td></tr></table></figure><h2 id="流程控制"><a href="#流程控制" class="headerlink" title="流程控制"></a>流程控制</h2><figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="comment">--[[</span></span><br><span class="line"><span class="comment">if( 布尔表达式 1) then</span></span><br><span class="line"><span class="comment">   --[ 在布尔表达式 1 为 true 时执行该语句块 --]</span></span><br><span class="line"><span class="comment">   if(布尔表达式 2) then</span></span><br><span class="line"><span class="comment">      --[ 布尔表达式 2 为 true 时执行该语句块 --]</span></span><br><span class="line"><span class="comment">   end</span></span><br><span class="line"><span class="comment">elseif( 布尔表达式 2) then</span></span><br><span class="line"><span class="comment">   --[ 在布尔表达式 2 为 true 时执行该语句块 --]</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">elseif( 布尔表达式 3) then</span></span><br><span class="line"><span class="comment">   --[ 在布尔表达式 3 为 true 时执行该语句块 --]</span></span><br><span class="line"><span class="comment">else </span></span><br><span class="line"><span class="comment">   --[ 如果以上布尔表达式都不为 true 则执行该语句块 --]</span></span><br><span class="line"><span class="comment">end</span></span><br><span class="line"><span class="comment">]]</span></span><br></pre></td></tr></table></figure><h2 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h2><p>在Lua中，函数是对语句和表达式进行抽象的主要方法。既可以用来处理一些特殊的工作，也可以用来计算一些值。</p><p>Lua 提供了许多的内建函数，你可以很方便的在程序中调用它们，如print()函数可以将传入的参数打印在控制台上。</p><p>Lua 函数主要有两种用途：</p><p>1.完成指定的任务，这种情况下函数作为调用语句使用；<br>2.计算并返回值，这种情况下函数作为赋值语句的表达式使用。</p><figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="comment">--[[</span></span><br><span class="line"><span class="comment">optional_function_scope function function_name( argument1, argument2, argument3..., argumentn)</span></span><br><span class="line"><span class="comment">    function_body</span></span><br><span class="line"><span class="comment">    return result_params_comma_separated</span></span><br><span class="line"><span class="comment">end</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">* optional_function_scope: 该参数是可选的制定函数是全局函数还是局部函数，未设置该参数默认为全局函数，如果你需要设置函数为局部函数需要使用关键字 local。</span></span><br><span class="line"><span class="comment">* function_name: 指定函数名称。</span></span><br><span class="line"><span class="comment">* argument1, argument2, argument3..., argumentn: 函数参数，多个参数以逗号隔开，函数也可以不带参数。</span></span><br><span class="line"><span class="comment">* function_body: 函数体，函数中需要执行的代码语句块。</span></span><br><span class="line"><span class="comment">* result_params_comma_separated: 函数返回值，Lua语言函数可以返回多个值，每个值以逗号隔开。</span></span><br><span class="line"><span class="comment">]]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--[[</span></span><br><span class="line"><span class="comment">将函数作为参数传递给函数</span></span><br><span class="line"><span class="comment">]]</span></span><br><span class="line">myprint = <span class="function"><span class="keyword">function</span><span class="params">(param)</span></span></span><br><span class="line">   <span class="built_in">print</span>(<span class="string">&quot;这是打印函数 -   ##&quot;</span>,param,<span class="string">&quot;##&quot;</span>)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span><span class="params">(num1,num2,functionPrint)</span></span></span><br><span class="line">   result = num1 + num2</span><br><span class="line">   <span class="comment">-- 调用传递的函数参数</span></span><br><span class="line">   functionPrint(result)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">myprint(<span class="number">10</span>)</span><br><span class="line"><span class="comment">-- myprint 函数作为参数传递</span></span><br><span class="line">add(<span class="number">2</span>,<span class="number">5</span>,myprint)</span><br><span class="line"></span><br><span class="line"><span class="comment">--[[</span></span><br><span class="line"><span class="comment">多返回值</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Lua函数可以返回多个结果值，比如string.find，其返回匹配串&quot;开始和结束的下标&quot;（如果不存在匹配串返回nil）。</span></span><br><span class="line"><span class="comment">]]</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">maximum</span> <span class="params">(a)</span></span></span><br><span class="line">    <span class="keyword">local</span> mi = <span class="number">1</span>             <span class="comment">-- 最大值索引</span></span><br><span class="line">    <span class="keyword">local</span> m = a[mi]          <span class="comment">-- 最大值</span></span><br><span class="line">    <span class="keyword">for</span> i,val <span class="keyword">in</span> <span class="built_in">ipairs</span>(a) <span class="keyword">do</span></span><br><span class="line">       <span class="keyword">if</span> val &gt; m <span class="keyword">then</span></span><br><span class="line">           mi = i</span><br><span class="line">           m = val</span><br><span class="line">       <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">return</span> m, mi</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(maximum(&#123;<span class="number">8</span>,<span class="number">10</span>,<span class="number">23</span>,<span class="number">12</span>,<span class="number">5</span>&#125;))</span><br><span class="line"></span><br><span class="line"><span class="comment">--[[</span></span><br><span class="line"><span class="comment">可变参数</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Lua 函数可以接受可变数目的参数，和 C 语言类似，在函数参数列表中使用三点 ... 表示函数有可变的参数。</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">通常在遍历变长参数的时候只需要使用 &#123;…&#125;，然而变长参数可能会包含一些 nil，那么就可以用 select 函数来访问变长参数了：select(&#x27;#&#x27;, …) 或者 select(n, …)</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">* select(&#x27;#&#x27;, …) 返回可变参数的长度。</span></span><br><span class="line"><span class="comment">* select(n, …) 用于返回从起点 n 开始到结束位置的所有参数列表。</span></span><br><span class="line"><span class="comment">]]</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span><span class="params">(...)</span></span>  </span><br><span class="line"><span class="keyword">local</span> s = <span class="number">0</span>  </span><br><span class="line">  <span class="keyword">for</span> i, v <span class="keyword">in</span> <span class="built_in">ipairs</span>&#123;...&#125; <span class="keyword">do</span>   <span class="comment">--&gt; &#123;...&#125; 表示一个由所有变长参数构成的数组  </span></span><br><span class="line">    s = s + v  </span><br><span class="line">  <span class="keyword">end</span>  </span><br><span class="line">  <span class="keyword">return</span> s  </span><br><span class="line"><span class="keyword">end</span>  </span><br><span class="line"><span class="built_in">print</span>(add(<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>))  <span class="comment">---&gt;25</span></span><br></pre></td></tr></table></figure><h2 id="运算符"><a href="#运算符" class="headerlink" title="运算符"></a>运算符</h2><p>Lua提供了以下几种运算符类型：</p><ul><li><p>算术运算符</p><table><thead><tr><th align="left">操作符</th><th align="left">描述</th><th align="left">实例</th></tr></thead><tbody><tr><td align="left">+</td><td align="left">加法</td><td align="left">A + B 输出结果 30</td></tr><tr><td align="left">-</td><td align="left">减法</td><td align="left">A - B 输出结果 -10</td></tr><tr><td align="left">*</td><td align="left">乘法</td><td align="left">A * B 输出结果 200</td></tr><tr><td align="left">/</td><td align="left">除法</td><td align="left">B / A 输出结果 2</td></tr><tr><td align="left">%</td><td align="left">取余</td><td align="left">B % A 输出结果 0</td></tr><tr><td align="left">^</td><td align="left">乘幂</td><td align="left">A^2 输出结果 100</td></tr><tr><td align="left">-</td><td align="left">负号</td><td align="left">-A 输出结果 -10</td></tr><tr><td align="left">//</td><td align="left">整除运算符(&gt;=lua5.3)</td><td align="left"><strong>5//2</strong> 输出结果 2</td></tr></tbody></table></li><li><p>关系运算符</p><table><thead><tr><th align="left">操作符</th><th align="left">描述</th><th align="left">实例</th></tr></thead><tbody><tr><td align="left">==</td><td align="left">等于，检测两个值是否相等，相等返回 true，否则返回 false</td><td align="left">(A == B) 为 false。</td></tr><tr><td align="left">~=</td><td align="left">不等于，检测两个值是否相等，不相等返回 true，否则返回 false</td><td align="left">(A ~= B) 为 true。</td></tr><tr><td align="left">&gt;</td><td align="left">大于，如果左边的值大于右边的值，返回 true，否则返回 false</td><td align="left">(A &gt; B) 为 false。</td></tr><tr><td align="left">&lt;</td><td align="left">小于，如果左边的值大于右边的值，返回 false，否则返回 true</td><td align="left">(A &lt; B) 为 true。</td></tr><tr><td align="left">&gt;=</td><td align="left">大于等于，如果左边的值大于等于右边的值，返回 true，否则返回 false</td><td align="left">(A &gt;= B) 返回 false。</td></tr><tr><td align="left">&lt;=</td><td align="left">小于等于， 如果左边的值小于等于右边的值，返回 true，否则返回 false</td><td align="left">(A &lt;= B) 返回 true。</td></tr></tbody></table></li><li><p>逻辑运算符</p><table><thead><tr><th align="left">操作符</th><th align="left">描述</th><th align="left">实例</th></tr></thead><tbody><tr><td align="left">and</td><td align="left">逻辑与操作符。 若 A 为 false，则返回 A，否则返回 B。</td><td align="left">(A and B) 为 false。</td></tr><tr><td align="left">or</td><td align="left">逻辑或操作符。 若 A 为 true，则返回 A，否则返回 B。</td><td align="left">(A or B) 为 true。</td></tr><tr><td align="left">not</td><td align="left">逻辑非操作符。与逻辑运算结果相反，如果条件为 true，逻辑非为 false。</td><td align="left">not(A and B) 为 true。</td></tr></tbody></table></li><li><p>其他运算符</p><table><thead><tr><th align="left">操作符</th><th align="left">描述</th><th align="left">实例</th></tr></thead><tbody><tr><td align="left">..</td><td align="left">连接两个字符串</td><td align="left">a..b ，其中 a 为 &quot;Hello &quot; ， b 为 &quot;World&quot;, 输出结果为 &quot;Hello World&quot;。</td></tr><tr><td align="left">#</td><td align="left">一元运算符，返回字符串或表的长度。</td><td align="left">#&quot;Hello&quot; 返回 5</td></tr></tbody></table></li><li><p>运算符优先级</p><figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 除了 ^ 和 .. 外所有的二元运算符都是左连接的。</span></span><br><span class="line">^</span><br><span class="line"><span class="keyword">not</span>    - (unary)</span><br><span class="line">*      /       %</span><br><span class="line">+      -</span><br><span class="line">..</span><br><span class="line">&lt;      &gt;      &lt;=     &gt;=     ~=     ==</span><br><span class="line"><span class="keyword">and</span></span><br><span class="line"><span class="keyword">or</span></span><br></pre></td></tr></table></figure></li></ul><h2 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h2><p>Lua 语言中字符串可以使用以下三种方式来表示：</p><p>单引号间的一串字符。<br>双引号间的一串字符。<br>[[ 与 ]] 间的一串字符。</p><h3 id="字符串操作"><a href="#字符串操作" class="headerlink" title="字符串操作"></a>字符串操作</h3><figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 大小写转换</span></span><br><span class="line"><span class="built_in">string</span>.<span class="built_in">upper</span>(<span class="built_in">string</span></span><br><span class="line"><span class="built_in">string</span>.<span class="built_in">lower</span>(<span class="built_in">string</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 替换</span></span><br><span class="line"><span class="built_in">string</span>.<span class="built_in">gsub</span>(mainString,findString,replaceString,num)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查找</span></span><br><span class="line"><span class="built_in">string</span>.<span class="built_in">find</span>(<span class="built_in">string</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 反转</span></span><br><span class="line"><span class="built_in">string</span>.<span class="built_in">reverse</span>(<span class="built_in">string</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 格式化，类似java中的String.format</span></span><br><span class="line"><span class="built_in">string</span>.<span class="built_in">format</span>(templateString, params)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 整型与字符之间的转换</span></span><br><span class="line"><span class="built_in">string</span>.<span class="built_in">byte</span>(<span class="string">&quot;A&quot;</span>) <span class="comment">--&gt; 65</span></span><br><span class="line"><span class="built_in">string</span>.<span class="built_in">byte</span>(<span class="string">&quot;ABCD&quot;</span>, <span class="number">4</span>) <span class="comment">--&gt; 68</span></span><br><span class="line"><span class="built_in">string</span>.<span class="built_in">char</span>(<span class="number">65</span>, <span class="number">66</span>, <span class="number">67</span>, <span class="number">68</span>) <span class="comment">--&gt; &quot;ABCD&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 字符串长度</span></span><br><span class="line"><span class="built_in">string</span>.<span class="built_in">len</span>(<span class="string">&quot;123&quot;</span>) <span class="comment">-- 3</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 字符串拷贝</span></span><br><span class="line"><span class="built_in">string</span>.<span class="built_in">rep</span>(<span class="string">&quot;a&quot;</span>, <span class="number">2</span>) <span class="comment">--&gt; &quot;aa&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 连接多个字符串</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;123&quot;</span>..<span class="string">&quot;456&quot;</span>) <span class="comment">--&gt; &quot;123456&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--[[</span></span><br><span class="line"><span class="comment">返回一个迭代器函数，每一次调用这个函数，返回一个在字符串 str 找到的下一个符合 pattern 描述的子串。</span></span><br><span class="line"><span class="comment">如果参数 pattern 描述的字符串没有找到，迭代函数返回nil。</span></span><br><span class="line"><span class="comment">]]</span></span><br><span class="line"><span class="keyword">for</span> word <span class="keyword">in</span> <span class="built_in">string</span>.<span class="built_in">gmatch</span>(<span class="string">&quot;Hello Lua user&quot;</span>, <span class="string">&quot;%a+&quot;</span>) <span class="keyword">do</span> <span class="built_in">print</span>(word) <span class="keyword">end</span></span><br><span class="line"><span class="comment">--[[</span></span><br><span class="line"><span class="comment">Hello</span></span><br><span class="line"><span class="comment">Lua</span></span><br><span class="line"><span class="comment">user</span></span><br><span class="line"><span class="comment">]]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--[[</span></span><br><span class="line"><span class="comment">string.match()只寻找源字串str中的第一个配对. 参数init可选, 指定搜寻过程的起点, 默认为1。</span></span><br><span class="line"><span class="comment">在成功配对时, 函数将返回配对表达式中的所有捕获结果; </span></span><br><span class="line"><span class="comment">如果没有设置捕获标记, 则返回整个配对字符串. 当没有成功的配对时, 返回nil。</span></span><br><span class="line"><span class="comment">]]</span></span><br><span class="line"><span class="built_in">string</span>.<span class="built_in">match</span>(<span class="string">&quot;I have 2 questions for you.&quot;</span>, <span class="string">&quot;%d+ %a+&quot;</span>) <span class="comment">--&gt; 2 questions</span></span><br><span class="line"><span class="built_in">string</span>.<span class="built_in">format</span>(<span class="string">&quot;%d, %q&quot;</span>, <span class="built_in">string</span>.<span class="built_in">match</span>(<span class="string">&quot;I have 2 questions for you.&quot;</span>, <span class="string">&quot;(%d+) (%a+)&quot;</span>)) <span class="comment">--&gt; 2, &quot;questions&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--[[</span></span><br><span class="line"><span class="comment">字符串截取使用 sub() 方法。</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">用于截取字符串，原型为：</span></span><br><span class="line"><span class="comment">string.sub(s, i [, j])</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">s：要截取的字符串。</span></span><br><span class="line"><span class="comment">i：截取开始位置。</span></span><br><span class="line"><span class="comment">j：截取结束位置，默认为 -1，最后一个字符。</span></span><br><span class="line"><span class="comment">]]</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">string</span>.<span class="built_in">sub</span>(<span class="string">&quot;1234&quot;</span>, <span class="number">2</span>, <span class="number">3</span>) <span class="comment">--&gt; 23</span></span><br><span class="line"><span class="built_in">string</span>.<span class="built_in">sub</span>(<span class="string">&quot;1234&quot;</span>, <span class="number">2</span>, <span class="number">2</span>) <span class="comment">--&gt; 2</span></span><br><span class="line"><span class="built_in">string</span>.<span class="built_in">sub</span>(<span class="string">&quot;1234&quot;</span>, <span class="number">-2</span>) <span class="comment">--&gt; 34</span></span><br><span class="line"><span class="built_in">string</span>.<span class="built_in">sub</span>(<span class="string">&quot;1234&quot;</span>, <span class="number">-10</span>) <span class="comment">--&gt; 1234</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="匹配模式"><a href="#匹配模式" class="headerlink" title="匹配模式"></a>匹配模式</h3><p>Lua 中的匹配模式直接用常规的字符串来描述。 它用于模式匹配函数 <strong>string.find, string.gmatch, string.gsub, string.match</strong>。</p><p>你还可以在模式串中使用字符类。</p><p>字符类指可以匹配一个特定字符集合内任何字符的模式项。比如，字符类 <strong>%d</strong> 匹配任意数字。所以你可以使用模式串 <strong>%d%d/%d%d/%d%d%d%d</strong> 搜索 <strong>dd/mm/yyyy</strong> 格式的日期：</p><table><thead><tr><th>正则</th><th>描述</th></tr></thead><tbody><tr><td>.(点)</td><td>与任何字符配对</td></tr><tr><td>%a</td><td>与任何字母配对</td></tr><tr><td>%c</td><td>与任何控制符配对(例如 \n)</td></tr><tr><td>%d</td><td>与任何数字配对</td></tr><tr><td>%l</td><td>与任何小写字母配对</td></tr><tr><td>%p</td><td>与任何标点(punctuation)配对</td></tr><tr><td>%s</td><td>与空白字符配对</td></tr><tr><td>%u</td><td>与任何大写字母配对</td></tr><tr><td>%w</td><td>与任何字母/数字配对</td></tr><tr><td>%x</td><td>与任何十六进制数配对</td></tr><tr><td>%z</td><td>与任何代表 0 的字符配对</td></tr><tr><td>%x</td><td>(此处 x 是非字母非数字字符) 与字符 x 配对。主要用来处理表达式中有功能的字符 <code>(^$()%.[]*+-?)</code>的配对问题，例如 %% 与 % 配对</td></tr><tr><td>[数个字符类]</td><td>与任何 [] 中包含的字符类配对，例如 <code>[%w_]</code> 与任何字母 / 数字, 或下划线符号 (_) 配对</td></tr><tr><td>[^数个字符类]</td><td>与任何不包含在[]中的字符类配对. 例如<code>[^%s]</code>与任何非空白字符配对</td></tr></tbody></table><p>当上述的字符类用大写书写时, 表示与非此字符类的任何字符配对. 例如, %S表示与任何非空白字符配对.例如，&#39;%A&#39;非字母的字符:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt; print(string.gsub(&quot;hello, up-down!&quot;, &quot;%A&quot;, &quot;.&quot;))</span><br><span class="line">hello..up.down.    4</span><br></pre></td></tr></table></figure><p>数字4不是字符串结果的一部分，他是<code>gsub</code>返回的第二个结果，代表发生替换的次数。</p><p>在模式匹配中有一些特殊字符，他们有特殊的意义，Lua中的特殊字符如下：</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">( ) . % + - * ? [ ^ $</span><br></pre></td></tr></table></figure><p>&#39;%&#39; 用作特殊字符的转义字符，因此 &#39;%.&#39; 匹配点；&#39;%%&#39; 匹配字符 &#39;%&#39;。转义字符 &#39;%&#39;不仅可以用来转义特殊字符，还可以用于所有的非字母的字符。</p><p><strong>模式条目可以是</strong>：</p><ul><li>单个字符类匹配该类别中任意单个字符；</li><li>单个字符类跟一个 ‘<code>*</code>’， 将匹配零或多个该类的字符。 这个条目总是匹配尽可能长的串；</li><li>单个字符类跟一个 ‘<code>+</code>’， 将匹配一或更多个该类的字符。 这个条目总是匹配尽可能长的串；</li><li>单个字符类跟一个 ‘<code>-</code>’， 将匹配零或更多个该类的字符。 和 ‘<code>*</code>’ 不同， 这个条目总是匹配尽可能短的串；</li><li>单个字符类跟一个 ‘<code>?</code>’， 将匹配零或一个该类的字符。 只要有可能，它会匹配一个；</li><li><code>%*n*</code>， 这里的 <em>n</em> 可以从 1 到 9； 这个条目匹配一个等于 <em>n</em> 号捕获物（后面有描述）的子串。</li><li><code>%b*xy*</code>， 这里的 <em>x</em> 和 <em>y</em> 是两个明确的字符； 这个条目匹配以 <em>x</em> 开始 <em>y</em> 结束， 且其中 <em>x</em> 和 <em>y</em> 保持 <em>平衡</em> 的字符串。 意思是，如果从左到右读这个字符串，对每次读到一个 <em>x</em> 就 <em>+1</em> ，读到一个 <em>y</em> 就 <em>-1</em>， 最终结束处的那个 <em>y</em> 是第一个记数到 0 的 <em>y</em>。 举个例子，条目 <code>%b()</code> 可以匹配到括号平衡的表达式。</li><li><code>%f[*set*]</code>， 指边境模式； 这个条目会匹配到一个位于 <em>set</em> 内某个字符之前的一个空串， 且这个位置的前一个字符不属于 <em>set</em> 。 集合 <em>set</em> 的含义如前面所述。 匹配出的那个空串之开始和结束点的计算就看成该处有个字符 ‘<code>\0</code>’ 一样。</li></ul><p><strong>模式：</strong></p><p><em>模式</em> 指一个模式条目的序列。 在模式最前面加上符号 &#39;<code>^</code>&#39; 将锚定从字符串的开始处做匹配。 在模式最后面加上符号 &#39;<code>$</code>&#39; 将使匹配过程锚定到字符串的结尾。 如果 &#39;<code>^</code>&#39; 和 &#39;<code>$</code>&#39; 出现在其它位置，它们均没有特殊含义，只表示自身。</p><p><strong>捕获：</strong></p><p>模式可以在内部用小括号括起一个子模式； 这些子模式被称为 <em>捕获物</em>。 当匹配成功时，由 <em>捕获物</em> 匹配到的字符串中的子串被保存起来用于未来的用途。 捕获物以它们左括号的次序来编号。 例如，对于模式 <code>&quot;(a*(.)%w(%s*))&quot;</code> ， 字符串中匹配到 <code>&quot;a*(.)%w(%s*)&quot;</code> 的部分保存在第一个捕获物中 （因此是编号 1 ）； 由 &quot;<code>.</code>&quot; 匹配到的字符是 2 号捕获物， 匹配到 &quot;<code>%s*</code>&quot; 的那部分是 3 号。</p><p>作为一个特例，空的捕获 <code>()</code> 将捕获到当前字符串的位置（它是一个数字）。 例如，如果将模式 <code>&quot;()aa()&quot;</code> 作用到字符串 <code>&quot;flaaap&quot;</code> 上，将产生两个捕获物： 3 和 5 。</p><h2 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h2><p>Lua 数组的索引键值可以使用整数表示，数组的大小不是固定的。</p><figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 一维数组: 默认索引以1开始，可以为0和负数指定value</span></span><br><span class="line">array = &#123;<span class="string">&quot;Lua&quot;</span>, <span class="string">&quot;Tutorial&quot;</span>&#125;</span><br></pre></td></tr></table></figure><hr><figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 多维数组: 即数组中包含数组或一维数组的索引键对应一个数组。</span></span><br><span class="line">array = &#123;&#125;</span><br><span class="line"><span class="keyword">for</span> i=<span class="number">1</span>,<span class="number">3</span> <span class="keyword">do</span></span><br><span class="line">   array[i] = &#123;&#125;</span><br><span class="line">      <span class="keyword">for</span> j=<span class="number">1</span>,<span class="number">3</span> <span class="keyword">do</span></span><br><span class="line">         array[i][j] = i*j</span><br><span class="line">      <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><details><summary> 格式化输出array</summary><figure class="highlight"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    1 = &#123;</span><br><span class="line">      1 = 1</span><br><span class="line">      2 = 2</span><br><span class="line">      3 = 3</span><br><span class="line">    &#125;</span><br><span class="line">    2 = &#123;</span><br><span class="line">      1 = 2</span><br><span class="line">      2 = 4</span><br><span class="line">      3 = 6</span><br><span class="line">    &#125;</span><br><span class="line">    3 = &#123;</span><br><span class="line">      1 = 3</span><br><span class="line">      2 = 6</span><br><span class="line">      3 = 9</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></details><hr><figure class="highlight lua"><table><tr><td class="code"><pre><span class="line">array = &#123;&#125;</span><br><span class="line">maxRows = <span class="number">3</span></span><br><span class="line">maxColumns = <span class="number">3</span></span><br><span class="line"><span class="keyword">for</span> row=<span class="number">1</span>,maxRows <span class="keyword">do</span></span><br><span class="line">   <span class="keyword">for</span> col=<span class="number">1</span>,maxColumns <span class="keyword">do</span></span><br><span class="line">      array[row*maxColumns +col] = row*col</span><br><span class="line">   <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><details><summary>格式化输出array</summary><figure class="highlight"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    4 = 1</span><br><span class="line">    5 = 2</span><br><span class="line">    6 = 3</span><br><span class="line">    7 = 2</span><br><span class="line">    8 = 4</span><br><span class="line">    12 = 9</span><br><span class="line">    9 = 6</span><br><span class="line">    10 = 3</span><br><span class="line">    11 = 6</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></details><h2 id="table"><a href="#table" class="headerlink" title="table"></a>table</h2><blockquote><p>table作为function的参数时，传递的是对象地址，而不是值。</p></blockquote><h3 id="表的构造"><a href="#表的构造" class="headerlink" title="表的构造"></a>表的构造</h3><figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 初始化表</span></span><br><span class="line">mytable = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 指定值</span></span><br><span class="line">mytable[<span class="number">1</span>]= <span class="string">&quot;Lua&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 移除引用</span></span><br><span class="line">mytable = <span class="literal">nil</span></span><br><span class="line"><span class="comment">-- lua 垃圾回收会释放内存</span></span><br></pre></td></tr></table></figure><h3 id="表的操作"><a href="#表的操作" class="headerlink" title="表的操作"></a>表的操作</h3><p><strong>连接</strong></p><figure class="highlight lua"><table><tr><td class="code"><pre><span class="line">fruits = &#123;<span class="string">&quot;banana&quot;</span>,<span class="string">&quot;orange&quot;</span>,<span class="string">&quot;apple&quot;</span>&#125;</span><br><span class="line"><span class="comment">-- 返回 table 连接后的字符串</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;连接后的字符串 &quot;</span>,<span class="built_in">table</span>.<span class="built_in">concat</span>(fruits))</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 指定连接字符</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;连接后的字符串 &quot;</span>,<span class="built_in">table</span>.<span class="built_in">concat</span>(fruits,<span class="string">&quot;, &quot;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 指定索引来连接 table</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;连接后的字符串 &quot;</span>,<span class="built_in">table</span>.<span class="built_in">concat</span>(fruits,<span class="string">&quot;, &quot;</span>, <span class="number">2</span>,<span class="number">3</span>))</span><br></pre></td></tr></table></figure><p><strong>插入和移除</strong></p><figure class="highlight lua"><table><tr><td class="code"><pre><span class="line">fruits = &#123;<span class="string">&quot;banana&quot;</span>,<span class="string">&quot;orange&quot;</span>,<span class="string">&quot;apple&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 在末尾插入</span></span><br><span class="line"><span class="built_in">table</span>.<span class="built_in">insert</span>(fruits,<span class="string">&quot;mango&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;索引为 4 的元素为 &quot;</span>,fruits[<span class="number">4</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 在索引为 2 的键处插入</span></span><br><span class="line"><span class="built_in">table</span>.<span class="built_in">insert</span>(fruits,<span class="number">2</span>,<span class="string">&quot;grapes&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;索引为 2 的元素为 &quot;</span>,fruits[<span class="number">2</span>])</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;最后一个元素为 &quot;</span>,fruits[<span class="number">5</span>])</span><br><span class="line"><span class="built_in">table</span>.<span class="built_in">remove</span>(fruits)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;移除后最后一个元素为 &quot;</span>,fruits[<span class="number">5</span>])</span><br></pre></td></tr></table></figure><p><strong>排序</strong></p><figure class="highlight lua"><table><tr><td class="code"><pre><span class="line">fruits = &#123;<span class="string">&quot;banana&quot;</span>,<span class="string">&quot;orange&quot;</span>,<span class="string">&quot;apple&quot;</span>,<span class="string">&quot;grapes&quot;</span>&#125;</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;排序前&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> k,v <span class="keyword">in</span> <span class="built_in">ipairs</span>(fruits) <span class="keyword">do</span> <span class="built_in">print</span>(k,v) <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">table</span>.<span class="built_in">sort</span>(fruits)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;排序后&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> k,v <span class="keyword">in</span> <span class="built_in">ipairs</span>(fruits) <span class="keyword">do</span> <span class="built_in">print</span>(k,v) <span class="keyword">end</span></span><br></pre></td></tr></table></figure><h2 id="函数小技巧"><a href="#函数小技巧" class="headerlink" title="函数小技巧"></a>函数小技巧</h2><p>分割字符串</p><figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">split</span><span class="params">(s, delimiter)</span></span></span><br><span class="line">    result = &#123;&#125;;</span><br><span class="line">    <span class="keyword">for</span> <span class="built_in">match</span> <span class="keyword">in</span> (s..delimiter):<span class="built_in">gmatch</span>(<span class="string">&quot;(.-)&quot;</span>..delimiter) <span class="keyword">do</span></span><br><span class="line">        <span class="built_in">table</span>.<span class="built_in">insert</span>(result, <span class="built_in">match</span>);</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><h2 id="模块与包"><a href="#模块与包" class="headerlink" title="模块与包"></a>模块与包</h2><p>模块类似于一个封装库，从 Lua 5.1 开始，Lua 加入了标准的模块管理机制，可以把一些公用的代码放在一个文件里，以 API 接口的形式在其他地方调用，有利于代码的重用和降低代码耦合度。</p><p>Lua 的模块是由变量、函数等已知元素组成的 table，因此创建一个模块很简单，就是创建一个 table，然后把需要导出的常量、函数放入其中，最后返回这个 table 就行。以下为创建自定义模块 module.lua，文件代码格式如下：</p><figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 文件名为 module.lua</span></span><br><span class="line"><span class="comment">-- 定义一个名为 module 的模块</span></span><br><span class="line"><span class="built_in">module</span> = &#123;&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">-- 定义一个常量</span></span><br><span class="line"><span class="built_in">module</span>.constant = <span class="string">&quot;这是一个常量&quot;</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">-- 定义一个函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">module.func1</span><span class="params">()</span></span></span><br><span class="line">    <span class="built_in">io</span>.<span class="built_in">write</span>(<span class="string">&quot;这是一个公有函数！\n&quot;</span>)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">func2</span><span class="params">()</span></span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;这是一个私有函数！&quot;</span>)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">module.func3</span><span class="params">()</span></span></span><br><span class="line">    func2()</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">return</span> <span class="built_in">module</span></span><br></pre></td></tr></table></figure><p>由上可知，模块的结构就是一个 table 的结构，因此可以像操作调用 table 里的元素那样来操作调用模块里的常量或函数。</p><p>上面的 func2 声明为程序块的局部变量，即表示一个私有函数，因此是不能从外部访问模块里的这个私有函数，必须通过模块里的公有函数来调用.</p><h3 id="require-函数"><a href="#require-函数" class="headerlink" title="require 函数"></a>require 函数</h3><p>Lua提供了一个名为require的函数用来加载模块。要加载一个模块，只需要简单地调用就可以了。例如：</p><figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">&quot;&lt;模块名&gt;&quot;</span>)</span><br><span class="line"><span class="comment">-- OR</span></span><br><span class="line"><span class="built_in">require</span> <span class="string">&quot;&lt;模块名&gt;&quot;</span></span><br></pre></td></tr></table></figure><p>执行 require 后会返回一个由模块常量或函数组成的 table，并且还会定义一个包含该 table 的全局变量。</p><figure class="highlight lua"><figcaption><span>test_module.lua 文件</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="comment">-- test_module.lua 文件</span></span><br><span class="line"><span class="comment">-- module 模块为上文提到到 module.lua</span></span><br><span class="line"><span class="built_in">require</span>(<span class="string">&quot;module&quot;</span>)</span><br><span class="line"> </span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">module</span>.constant) <span class="comment">--&gt; 这是一个常量</span></span><br><span class="line"><span class="built_in">module</span>.func3() <span class="comment">--&gt; 这是一个私有函数！</span></span><br></pre></td></tr></table></figure><p>或者给加载的模块定义一个别名变量，方便调用：</p><figure class="highlight lua"><figcaption><span>test_module2.lua 文件</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="comment">-- test_module2.lua 文件</span></span><br><span class="line"><span class="comment">-- module 模块为上文提到到 module.lua</span></span><br><span class="line"><span class="comment">-- 别名变量 m</span></span><br><span class="line"><span class="keyword">local</span> m = <span class="built_in">require</span>(<span class="string">&quot;module&quot;</span>)</span><br><span class="line"> </span><br><span class="line"><span class="built_in">print</span>(m.constant) <span class="comment">--&gt; 这是一个常量</span></span><br><span class="line">m.func3() <span class="comment">--&gt; 这是一个私有函数！</span></span><br></pre></td></tr></table></figure><h3 id="加载机制"><a href="#加载机制" class="headerlink" title="加载机制"></a>加载机制</h3><p>对于自定义的模块，模块文件不是放在哪个文件目录都行，函数 require 有它自己的文件路径加载策略，它会尝试从 Lua 文件或 C 程序库中加载模块。</p><p>require 用于搜索 Lua 文件的路径是存放在全局变量 package.path 中，当 Lua 启动后，会以环境变量 LUA_PATH 的值来初始这个环境变量。如果没有找到该环境变量，则使用一个编译时定义的默认路径来初始化。</p><p>当然，如果没有 LUA_PATH 这个环境变量，也可以自定义设置，在当前用户根目录下打开 .profile 文件（没有则创建，打开 .bashrc 文件也可以），例如把 &quot;~/lua/&quot; 路径加入 LUA_PATH 环境变量里：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#LUA_PATH</span></span><br><span class="line"><span class="built_in">export</span> LUA_PATH=<span class="string">&quot;~/lua/?.lua;;&quot;</span></span><br></pre></td></tr></table></figure><p>文件路径以 &quot;;&quot; 号分隔，最后的 2 个 &quot;;;&quot; 表示新加的路径后面加上原来的默认路径。</p><p>接着，更新环境变量参数，使之立即生效。</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">source</span> ~/.profile</span><br></pre></td></tr></table></figure><p>这时假设 package.path 的值是：</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;Users&#x2F;dengjoe&#x2F;lua&#x2F;?.lua;.&#x2F;?.lua;&#x2F;usr&#x2F;local&#x2F;share&#x2F;lua&#x2F;5.1&#x2F;?.lua;&#x2F;usr&#x2F;local&#x2F;share&#x2F;lua&#x2F;5.1&#x2F;?&#x2F;init.lua;&#x2F;usr&#x2F;local&#x2F;lib&#x2F;lua&#x2F;5.1&#x2F;?.lua;&#x2F;usr&#x2F;local&#x2F;lib&#x2F;lua&#x2F;5.1&#x2F;?&#x2F;init.lua</span><br></pre></td></tr></table></figure><p>那么调用 require(&quot;module&quot;) 时就会尝试打开以下文件目录去搜索目标。</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;Users&#x2F;dengjoe&#x2F;lua&#x2F;module.lua;</span><br><span class="line">.&#x2F;module.lua</span><br><span class="line">&#x2F;usr&#x2F;local&#x2F;share&#x2F;lua&#x2F;5.1&#x2F;module.lua</span><br><span class="line">&#x2F;usr&#x2F;local&#x2F;share&#x2F;lua&#x2F;5.1&#x2F;module&#x2F;init.lua</span><br><span class="line">&#x2F;usr&#x2F;local&#x2F;lib&#x2F;lua&#x2F;5.1&#x2F;module.lua</span><br><span class="line">&#x2F;usr&#x2F;local&#x2F;lib&#x2F;lua&#x2F;5.1&#x2F;module&#x2F;init.lua</span><br></pre></td></tr></table></figure><p>如果找过目标文件，则会调用 package.loadfile 来加载模块。否则，就会去找 C 程序库。</p><p>搜索的文件路径是从全局变量 package.cpath 获取，而这个变量则是通过环境变量 LUA_CPATH 来初始。</p><p>搜索的策略跟上面的一样，只不过现在换成搜索的是 so 或 dll 类型的文件。如果找得到，那么 require 就会通过 package.loadlib 来加载它。</p><h3 id="C-包"><a href="#C-包" class="headerlink" title="C 包"></a>C 包</h3><p>Lua和C是很容易结合的，使用 C 为 Lua 写包。</p><p>与Lua中写包不同，C包在使用以前必须首先加载并连接，在大多数系统中最容易的实现方式是通过动态连接库机制。</p><p>Lua在一个叫loadlib的函数内提供了所有的动态连接的功能。这个函数有两个参数:库的绝对路径和初始化函数。所以典型的调用的例子如下:</p><figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="keyword">local</span> <span class="built_in">path</span> = <span class="string">&quot;/usr/local/lua/lib/libluasocket.so&quot;</span></span><br><span class="line"><span class="keyword">local</span> f = <span class="built_in">loadlib</span>(<span class="built_in">path</span>, <span class="string">&quot;luaopen_socket&quot;</span>)</span><br></pre></td></tr></table></figure><p>loadlib 函数加载指定的库并且连接到 Lua，然而它并不打开库（也就是说没有调用初始化函数），反之他返回初始化函数作为 Lua 的一个函数，这样我们就可以直接在Lua中调用他。</p><p>如果加载动态库或者查找初始化函数时出错，loadlib 将返回 nil 和错误信息。我们可以修改前面一段代码，使其检测错误然后调用初始化函数：</p><figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="keyword">local</span> <span class="built_in">path</span> = <span class="string">&quot;/usr/local/lua/lib/libluasocket.so&quot;</span></span><br><span class="line"><span class="comment">-- 或者 path = &quot;C:\\windows\\luasocket.dll&quot;，这是 Window 平台下</span></span><br><span class="line"><span class="keyword">local</span> f = <span class="built_in">assert</span>(<span class="built_in">loadlib</span>(<span class="built_in">path</span>, <span class="string">&quot;luaopen_socket&quot;</span>))</span><br><span class="line">f()  <span class="comment">-- 真正打开库</span></span><br></pre></td></tr></table></figure><p>一般情况下我们期望二进制的发布库包含一个与前面代码段相似的 stub 文件，安装二进制库的时候可以随便放在某个目录，只需要修改 stub 文件对应二进制库的实际路径即可。</p><p>将 stub 文件所在的目录加入到 LUA_PATH，这样设定后就可以使用 require 函数加载 C 库了。</p><h2 id="I-O"><a href="#I-O" class="headerlink" title="I/O"></a>I/O</h2><p>Lua I/O 库用于读取和处理文件。分为简单模式（和C一样）、完全模式。</p><ul><li>简单模式（simple model）拥有一个当前输入文件和一个当前输出文件，并且提供针对这些文件相关的操作。</li><li>完全模式（complete model） 使用外部的文件句柄来实现。它以一种面对对象的形式，将所有的文件操作定义为文件句柄的方法</li></ul><p>简单模式在做一些简单的文件操作时较为合适。但是在进行一些高级的文件操作的时候，简单模式就显得力不从心。例如同时读取多个文件这样的操作，使用完全模式则较为合适。</p><p>打开文件操作语句如下：</p><figure class="highlight lua"><table><tr><td class="code"><pre><span class="line">file = <span class="built_in">io</span>.<span class="built_in">open</span> (filename [, mode])</span><br></pre></td></tr></table></figure><p>mode 的值有：</p><table><thead><tr><th align="left">模式</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left">r</td><td align="left">以只读方式打开文件，该文件必须存在。</td></tr><tr><td align="left">w</td><td align="left">打开只写文件，若文件存在则文件长度清为0，即该文件内容会消失。若文件不存在则建立该文件。</td></tr><tr><td align="left">a</td><td align="left">以附加的方式打开只写文件。若文件不存在，则会建立该文件，如果文件存在，写入的数据会被加到文件尾，即文件原先的内容会被保留。（EOF符保留）</td></tr><tr><td align="left">r+</td><td align="left">以可读写方式打开文件，该文件必须存在。</td></tr><tr><td align="left">w+</td><td align="left">打开可读写文件，若文件存在则文件长度清为零，即该文件内容会消失。若文件不存在则建立该文件。</td></tr><tr><td align="left">a+</td><td align="left">与a类似，但此文件可读可写</td></tr><tr><td align="left">b</td><td align="left">二进制模式，如果文件是二进制文件，可以加上b</td></tr><tr><td align="left">+</td><td align="left">号表示对文件既可以读也可以写</td></tr></tbody></table><hr><h3 id="简单模式"><a href="#简单模式" class="headerlink" title="简单模式"></a>简单模式</h3><p>简单模式使用标准的 I/O 或使用一个当前输入文件和一个当前输出文件。</p><p>以下为 file.lua 文件代码，操作的文件为test.lua(如果没有你需要创建该文件)，代码如下：</p><figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 以只读方式打开文件*</span></span><br><span class="line">file = <span class="built_in">io</span>.<span class="built_in">open</span>(<span class="string">&quot;test.lua&quot;</span>, <span class="string">&quot;r&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 设置默认输入文件为 test.lua*</span></span><br><span class="line"><span class="built_in">io</span>.<span class="built_in">input</span>(file)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 输出文件第一行*</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">io</span>.<span class="built_in">read</span>())</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 关闭打开的文件*</span></span><br><span class="line"><span class="built_in">io</span>.<span class="built_in">close</span>(file)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 以附加的方式打开只写文件*</span></span><br><span class="line">file = <span class="built_in">io</span>.<span class="built_in">open</span>(<span class="string">&quot;test.lua&quot;</span>, <span class="string">&quot;a&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 设置默认输出文件为 test.lua*</span></span><br><span class="line"><span class="built_in">io</span>.<span class="built_in">output</span>(file)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 在文件最后一行添加 Lua 注释*</span></span><br><span class="line"><span class="built_in">io</span>.<span class="built_in">write</span>(<span class="string">&quot;--  test.lua 文件末尾注释&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 关闭打开的文件*</span></span><br><span class="line"><span class="built_in">io</span>.<span class="built_in">close</span>(file)</span><br></pre></td></tr></table></figure><p>执行以上代码，你会发现，输出了 test.lua 文件的第一行信息，并在该文件最后一行添加了 lua 的注释。如我这边输出的是：</p><figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- test.lua 文件</span></span><br></pre></td></tr></table></figure><p>在以上实例中我们使用了 io.&quot;x&quot; 方法，其中 io.read() 中我们没有带参数，参数可以是下表中的一个：</p><table><thead><tr><th align="left">模式</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left">&quot;*n&quot;</td><td align="left">读取一个数字并返回它。例：file.read(&quot;*n&quot;)</td></tr><tr><td align="left">&quot;*a&quot;</td><td align="left">从当前位置读取整个文件。例：file.read(&quot;*a&quot;)</td></tr><tr><td align="left">&quot;*l&quot;（默认）</td><td align="left">读取下一行，在文件尾 (EOF) 处返回 nil。例：file.read(&quot;*l&quot;)</td></tr><tr><td align="left">number</td><td align="left">返回一个指定字符个数的字符串，或在 EOF 时返回 nil。例：file.read(5)</td></tr></tbody></table><p>其他的 io 方法有：</p><ul><li>**io.tmpfile():**返回一个临时文件句柄，该文件以更新模式打开，程序结束时自动删除</li><li><strong>io.type(file):</strong> 检测obj是否一个可用的文件句柄</li><li><strong>io.flush():</strong> 向文件写入缓冲中的所有数据</li><li><strong>io.lines(optional file name):</strong> 返回一个迭代函数,每次调用将获得文件中的一行内容,当到文件尾时，将返回nil,但不关闭文件</li></ul><h3 id="完全模式"><a href="#完全模式" class="headerlink" title="完全模式"></a>完全模式</h3><p>通常我们需要在同一时间处理多个文件。我们需要使用 file:function_name 来代替 io.function_name 方法。以下实例演示了如何同时处理同一个文件:</p><figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 以只读方式打开文件*</span></span><br><span class="line">file = <span class="built_in">io</span>.<span class="built_in">open</span>(<span class="string">&quot;test.lua&quot;</span>, <span class="string">&quot;r&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 输出文件第一行*</span></span><br><span class="line"><span class="built_in">print</span>(file:<span class="built_in">read</span>())</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 关闭打开的文件*</span></span><br><span class="line">file:<span class="built_in">close</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 以附加的方式打开只写文件*</span></span><br><span class="line">file = <span class="built_in">io</span>.<span class="built_in">open</span>(<span class="string">&quot;test.lua&quot;</span>, <span class="string">&quot;a&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 在文件最后一行添加 Lua 注释*</span></span><br><span class="line">file:<span class="built_in">write</span>(<span class="string">&quot;--test&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 关闭打开的文件*</span></span><br><span class="line">file:<span class="built_in">close</span>()</span><br></pre></td></tr></table></figure><p>执行以上代码，你会发现，输出了 test.lua 文件的第一行信息，并在该文件最后一行添加了 lua 的注释。如我这边输出的是：</p><figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- test.lua 文件</span></span><br></pre></td></tr></table></figure><p>read 的参数与简单模式一致。</p><p>其他方法:</p><ul><li><p><strong>file:seek(optional whence, optional offset):</strong> 设置和获取当前文件位置,成功则返回最终的文件位置(按字节),失败则返回nil加错误信息。参数 whence 值可以是:</p><ul><li>&quot;set&quot;: 从文件头开始</li><li>&quot;cur&quot;: 从当前位置开始[默认]</li><li>&quot;end&quot;: 从文件尾开始</li><li>offset:默认为0</li></ul><p>不带参数file:seek()则返回当前位置,file:seek(&quot;set&quot;)则定位到文件头,file:seek(&quot;end&quot;)则定位到文件尾并返回文件大小</p></li><li><p><strong>file:flush():</strong> 向文件写入缓冲中的所有数据</p></li><li><p><strong>io.lines(optional file name):</strong> 打开指定的文件filename为读模式并返回一个迭代函数,每次调用将获得文件中的一行内容,当到文件尾时，将返回nil,并自动关闭文件。<br>若不带参数时io.lines() &lt;=&gt; io.input():lines(); 读取默认输入设备的内容，但结束时不关闭文件,如：</p><figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> <span class="built_in">io</span>.<span class="built_in">lines</span>(<span class="string">&quot;main.lua&quot;</span>) <span class="keyword">do</span></span><br><span class="line">　　<span class="built_in">print</span>(line)</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure></li></ul><p>以下实例使用了 seek 方法，定位到文件倒数第 25 个位置并使用 read 方法的 *a 参数，即从当前位置(倒数第 25 个位置)读取整个文件。</p><figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 以只读方式打开文件*</span></span><br><span class="line">file = <span class="built_in">io</span>.<span class="built_in">open</span>(<span class="string">&quot;test.lua&quot;</span>, <span class="string">&quot;r&quot;</span>)</span><br><span class="line"></span><br><span class="line">file:seek(<span class="string">&quot;end&quot;</span>,<span class="number">-25</span>)</span><br><span class="line"><span class="built_in">print</span>(file:<span class="built_in">read</span>(<span class="string">&quot;*a&quot;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 关闭打开的文件*</span></span><br><span class="line">file:<span class="built_in">close</span>()</span><br></pre></td></tr></table></figure><p>我这边输出的结果是：</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">st.lua 文件末尾--test</span><br></pre></td></tr></table></figure></div></div><ul class="breadcrumb"><li><a href="/cheat-sheet/">CHEAT-SHEET</a></li><li>LUA</li></ul></div></main><footer class="footer"><div class="footer-inner"><div class="beian"><a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">湘ICP备19011756号-1</a></div><div class="copyright"> &copy; 2021 – <span itemprop="copyrightYear">2022</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">JIAHE</span></div><div class="busuanzi-count"><span class="post-meta-item" id="busuanzi_container_site_uv"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span><span class="post-meta-item" id="busuanzi_container_site_pv"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div><div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动</div></div></footer><script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/lozad@1.16.0/dist/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/pangu@4.0.7/dist/browser/pangu.min.js" integrity="sha256-j+yj56cdEY2CwkVtGyz18fNybFGpMGJ8JxG3GSyO2+I=" crossorigin="anonymous"></script><script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/next-boot.js"></script><script src="/js/bookmark.js"></script><script src="https://cdn.jsdelivr.net/npm/hexo-generator-searchdb@1.4.0/dist/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script><script src="/js/third-party/search/local-search.js"></script><script class="next-config" data-name="pdf" type="application/json">{"object_url":{"url":"https://cdn.jsdelivr.net/npm/pdfobject@2.2.7/pdfobject.min.js","integrity":"sha256-ph3Dk89VmuTVXG6x/RDzk53SU9LPdAh1tpv0UvnDZ2I="},"url":"/lib/pdf/web/viewer.html"}</script><script src="/js/third-party/tags/pdf.js"></script><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/quicklink@2.2.0/dist/quicklink.umd.js" integrity="sha256-4kQf9z5ntdQrzsBC3YSHnEz02Z9C1UeW/E9OgnvlzSY=" crossorigin="anonymous"></script><script class="next-config" data-name="quicklink" type="application/json">{"enable":true,"home":true,"archive":true,"delay":true,"timeout":3000,"priority":true,"ignores":null,"url":"http://xiaojianzheng.cn/cheat-sheet/lua/"}</script><script src="/js/third-party/quicklink.js"></script></body></html>