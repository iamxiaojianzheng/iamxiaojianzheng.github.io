<!doctypehtml><html lang=zh-CN><meta charset=UTF-8><meta content=width=device-width name=viewport><meta content=#222 name=theme-color><meta content="Hexo 7.3.0" name=generator><link href=/images/apple-touch-icon-next.png rel=apple-touch-icon sizes=180x180><link href=/images/favicon-32x32-next.png rel=icon sizes=32x32 type=image/png><link href=/images/favicon-16x16-next.png rel=icon sizes=16x16 type=image/png><link color=#222 href=/images/logo.svg rel=mask-icon><style>:root{--body-bg-color:#eee;--content-bg-color:rgba(255,255,255,0.9);--card-bg-color:#f5f5f5;--text-color:#555;--selection-bg:#262a30;--selection-color:#eee;--blockquote-color:#666;--link-color:#555;--link-hover-color:#222;--brand-color:#fff;--brand-hover-color:#fff;--table-row-odd-bg-color:#f9f9f9;--table-row-hover-bg-color:#f5f5f5;--menu-item-bg-color:#f5f5f5;--theme-color:#222;--btn-default-bg:#fff;--btn-default-color:#555;--btn-default-border-color:#555;--btn-default-hover-bg:#222;--btn-default-hover-color:#fff;--btn-default-hover-border-color:#222;--highlight-background:#0d1117;--highlight-foreground:#c9d1d9;--highlight-gutter-background:#1f242a;--highlight-gutter-foreground:#b6bdc5;color-scheme:light}html{line-height:1.15;-webkit-text-size-adjust:100%}details,main{display:block}pre{font-size:1em;overflow:auto;padding:10px}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,samp{font-family:monospace,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:ButtonText dotted 1px}fieldset{padding:.35em .75em .625em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{vertical-align:baseline}.table-container,textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}summary{display:list-item}[hidden],template{display:none}::selection{background:var(--selection-bg);color:var(--selection-color)}body,html{height:100%}body{margin:0;background:var(--body-bg-color);box-sizing:border-box;color:var(--text-color);font-family:Noto Serif SC,PingFang SC,Microsoft YaHei,sans-serif,Lato,"Noto Serif SC","PingFang SC","Microsoft YaHei",sans-serif;font-size:1.1em;line-height:2;min-height:100%;position:relative;transition:padding .2s ease-in-out}h1,h2,h3,h4,h5,h6{font-family:Noto Serif SC,PingFang SC,Microsoft YaHei,sans-serif,Lato,'PingFang SC','Microsoft YaHei',sans-serif;font-weight:700;line-height:1.5;margin:30px 0 15px}p{margin:0 0 20px}a{background:0 0;border-bottom:1px solid #999;color:var(--link-color);cursor:pointer;outline:0;text-decoration:none;overflow-wrap:break-word}a:hover{border-bottom-color:var(--link-hover-color);color:var(--link-hover-color)}embed,iframe,img,video{display:block;margin-left:auto;margin-right:auto;max-width:100%}hr{box-sizing:content-box;overflow:visible;background-image:repeating-linear-gradient(-45deg,#ddd,#ddd 4px,transparent 4px,transparent 8px);border:0;height:3px;margin:40px 0}blockquote{border-left:4px solid #ddd;color:var(--blockquote-color);margin:0;padding:0 15px}blockquote cite::before{content:'-';padding:0 5px}dt{font-weight:700}dd{margin:0;padding:0}table{border-collapse:collapse;border-spacing:0;font-size:.875em;margin:0 0 20px;width:100%}tbody tr:nth-of-type(odd){background:var(--table-row-odd-bg-color)}tbody tr:hover{background:var(--table-row-hover-bg-color)}caption,td,th{padding:8px}td,th{border:1px solid #ddd;border-bottom:3px solid #ddd}th{font-weight:700;padding-bottom:10px}td{border-bottom-width:1px}.btn{background:var(--btn-default-bg);border:2px solid var(--btn-default-border-color);border-radius:2px;color:var(--btn-default-color);display:inline-block;font-size:.875em;line-height:2;padding:0 20px;transition:background-color .2s ease-in-out}.btn:hover{background:var(--btn-default-hover-bg);border-color:var(--btn-default-hover-border-color);color:var(--btn-default-hover-color)}.btn+.btn{margin:0 0 8px 8px}.btn .fa-fw{text-align:left;width:1.285714285714286em}.toggle{line-height:0}.toggle .toggle-line{background:#fff;display:block;height:2px;left:0;position:relative;top:0;transition:left .4s,opacity .4s,top .4s,transform .4s,width .4s;width:100%}.toggle .toggle-line:first-child{margin-top:1px}.toggle .toggle-line:not(:first-child){margin-top:4px}.toggle.toggle-arrow :first-child{left:50%;top:2px;transform:rotate(45deg);width:50%}.toggle.toggle-arrow :last-child{left:50%;top:-2px;transform:rotate(-45deg);width:50%}.toggle.toggle-close :nth-child(2){opacity:0}.toggle.toggle-close :first-child{top:6px;transform:rotate(45deg)}.toggle.toggle-close :last-child{top:-6px;transform:rotate(-45deg)}pre code.hljs{display:block;overflow-x:auto;padding:1em}code.hljs{padding:3px 5px}/*!
  Theme: GitHub Dark
  Description: Dark theme as seen on github.com
  Author: github.com
  Maintainer: @Hirse
  Updated: 2021-05-15

  Outdated base version: https://github.com/primer/github-syntax-dark
  Current colors taken from GitHub's CSS
*/.hljs{color:#c9d1d9;background:#0d1117}.hljs-doctag,.hljs-keyword,.hljs-meta .hljs-keyword,.hljs-template-tag,.hljs-template-variable,.hljs-type,.hljs-variable.language_{color:#ff7b72}.hljs-title,.hljs-title.class_,.hljs-title.class_.inherited__,.hljs-title.function_{color:#d2a8ff}.hljs-attr,.hljs-attribute,.hljs-literal,.hljs-meta,.hljs-number,.hljs-operator,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-id,.hljs-variable{color:#79c0ff}.hljs-meta .hljs-string,.hljs-regexp,.hljs-string{color:#a5d6ff}.hljs-built_in,.hljs-symbol{color:#ffa657}.hljs-code,.hljs-comment,.hljs-formula{color:#8b949e}.hljs-name,.hljs-quote,.hljs-selector-pseudo,.hljs-selector-tag{color:#7ee787}.hljs-subst{color:#c9d1d9}.hljs-section{color:#1f6feb;font-weight:700}.hljs-bullet{color:#f2cc60}.hljs-emphasis{color:#c9d1d9;font-style:italic}.hljs-strong{color:#c9d1d9;font-weight:700}.hljs-addition{color:#aff5b4;background-color:#033a16}.hljs-deletion{color:#ffdcd7;background-color:#67060c}.code-container:hover .copy-btn,.highlight:hover .copy-btn{opacity:1}.code-container{position:relative}.copy-btn{color:#333;cursor:pointer;line-height:1.6;opacity:0;padding:2px 6px;position:absolute;transition:opacity .2s ease-in-out;color:var(--highlight-foreground);font-size:14px;right:0;top:2px}figure.highlight{border-radius:5px;box-shadow:0 10px 30px 0 rgba(0,0,0,.4);padding-top:30px;overflow:auto;position:relative}figure.highlight .table-container{border-radius:0 0 5px 5px}figure.highlight::before{background:#fc625d;box-shadow:20px 0 #fdbc40,40px 0 #35cd4b;left:12px;margin-top:-20px;position:absolute;border-radius:50%;content:' ';height:12px;width:12px}.expand-btn{bottom:0;color:var(--highlight-foreground);cursor:pointer;display:none;left:0;right:0;position:absolute;text-align:center}.fold-cover{background-image:linear-gradient(to top,var(--highlight-background) 0,rgba(0,0,0,0) 100%);bottom:0;display:none;height:50px;left:0;right:0;position:absolute}.highlight-fold{max-height:500px;overflow-y:hidden!important}.highlight-fold .expand-btn,.highlight-fold .fold-cover{display:block}code,figure.highlight,kbd,pre{background:var(--highlight-background);color:var(--highlight-foreground)}figure.highlight,pre{line-height:1.6;margin:0 auto 20px}figure.highlight figcaption,pre .caption,pre figcaption{background:var(--highlight-gutter-background);color:var(--highlight-foreground);display:flow-root;font-size:.875em;line-height:1.2;padding:.5em}figure.highlight figcaption a,pre .caption a,pre figcaption a{color:var(--highlight-foreground);float:right}figure.highlight figcaption a:hover,pre .caption a:hover,pre figcaption a:hover{border-bottom-color:var(--highlight-foreground)}code,pre{font-family:Roboto Mono,consolas,Menlo,monospace,'PingFang SC','Microsoft YaHei'}code{border-radius:3px;font-size:.875em;padding:2px 4px;overflow-wrap:break-word;background:#f1f2f6;color:#e74c3c}kbd{border:2px solid #ccc;border-radius:.2em;box-shadow:.1em .1em .2em rgba(0,0,0,.1);font-family:inherit;padding:.1em .3em;white-space:nowrap}figure.highlight pre{border:0;margin:0;padding:10px 0}figure.highlight table{border:0;margin:0;width:auto}figure.highlight td{border:0;padding:0}figure.highlight .gutter{-moz-user-select:none;-ms-user-select:none;-webkit-user-select:none;user-select:none}figure.highlight .gutter pre{background:var(--highlight-gutter-background);color:var(--highlight-gutter-foreground);padding-left:10px;padding-right:10px;text-align:right}figure.highlight .code pre{padding-left:10px;width:100%}figure.highlight .marked{background:rgba(0,0,0,.3)}pre .caption,pre figcaption{margin-bottom:10px}.gist table{width:auto}.gist table td{border:0}pre code{background:0 0;padding:0;text-shadow:none}.blockquote-center{border-left:0;margin:40px 0;padding:0;position:relative;text-align:center}.blockquote-center::after,.blockquote-center::before{left:0;line-height:1;opacity:.6;position:absolute;width:100%}.blockquote-center::before{border-top:1px solid #ccc;text-align:left;top:-20px;content:'\f10d';font-family:'Font Awesome 6 Free';font-weight:900}.blockquote-center::after{border-bottom:1px solid #ccc;bottom:-20px;text-align:right;content:'\f10e';font-family:'Font Awesome 6 Free';font-weight:900}.blockquote-center div,.blockquote-center p{text-align:center}.group-picture{margin-bottom:20px}.group-picture .group-picture-row{display:flex;gap:3px;margin-bottom:3px}.group-picture .group-picture-column{flex:1}.group-picture .group-picture-column img{height:100%;margin:0;object-fit:cover;width:100%}.post-body .label{color:#555;padding:0 2px}.post-body .label.default{background:#f0f0f0}.post-body .label.primary{background:#efe6f7}.post-body .label.info{background:#e5f2f8}.post-body .label.success{background:#e7f4e9}.post-body .label.warning{background:#fcf6e1}.post-body .label.danger{background:#fae8eb}.post-body .link-grid{display:grid;grid-gap:1.5rem;gap:1.5rem;grid-template-columns:1fr 1fr;margin-bottom:20px;padding:1rem}.post-body .link-grid .link-grid-container{border:solid #ddd;box-shadow:1rem 1rem .5rem rgba(0,0,0,.5);min-height:5rem;min-width:0;padding:.5rem;position:relative;transition:background .3s}.post-body .link-grid .link-grid-container:hover{animation:.5s next-shake;background:var(--card-bg-color)}.post-body .link-grid .link-grid-container:active{box-shadow:.5rem .5rem .25rem rgba(0,0,0,.5);transform:translate(.2rem,.2rem)}.post-body .link-grid .link-grid-container .link-grid-image{border:1px solid #ddd;border-radius:50%;box-sizing:border-box;height:5rem;padding:3px;position:absolute;width:5rem}.post-body .link-grid .link-grid-container p{margin:0 1rem 0 6rem}.post-body .link-grid .link-grid-container p:first-of-type{font-size:1.2em}.post-body .link-grid .link-grid-container p:last-of-type{font-size:.8em;line-height:1.3rem;opacity:.7}.post-body .link-grid .link-grid-container a{border:0;height:100%;left:0;position:absolute;top:0;width:100%}@keyframes next-shake{0%{transform:translate(1pt,1pt) rotate(0)}10%{transform:translate(-1pt,-2pt) rotate(-1deg)}20%{transform:translate(-3pt,0) rotate(1deg)}30%{transform:translate(3pt,2pt) rotate(0)}40%{transform:translate(1pt,-1pt) rotate(1deg)}50%{transform:translate(-1pt,2pt) rotate(-1deg)}60%{transform:translate(-3pt,1pt) rotate(0)}70%{transform:translate(3pt,1pt) rotate(-1deg)}80%{transform:translate(-1pt,-1pt) rotate(1deg)}90%{transform:translate(1pt,2pt) rotate(0)}100%{transform:translate(1pt,-2pt) rotate(-1deg)}}.post-body .note{border-radius:3px;margin-bottom:20px;padding:1em;position:relative;border:1px solid #eee;border-left-width:5px}.post-body .note summary{cursor:pointer;outline:0}.post-body .note summary p{display:inline}.post-body .note h2,.post-body .note h3,.post-body .note h4,.post-body .note h5,.post-body .note h6{border-bottom:initial;margin:0;padding-top:0}.post-body .note :first-child{margin-top:0}.post-body .note :last-child{margin-bottom:0}.post-body .note.default{border-left-color:#777}.post-body .note.default h2,.post-body .note.default h3,.post-body .note.default h4,.post-body .note.default h5,.post-body .note.default h6{color:#777}.post-body .note.primary{border-left-color:#6f42c1}.post-body .note.primary h2,.post-body .note.primary h3,.post-body .note.primary h4,.post-body .note.primary h5,.post-body .note.primary h6{color:#6f42c1}.post-body .note.info{border-left-color:#428bca}.post-body .note.info h2,.post-body .note.info h3,.post-body .note.info h4,.post-body .note.info h5,.post-body .note.info h6{color:#428bca}.post-body .note.success{border-left-color:#5cb85c}.post-body .note.success h2,.post-body .note.success h3,.post-body .note.success h4,.post-body .note.success h5,.post-body .note.success h6{color:#5cb85c}.post-body .note.warning{border-left-color:#f0ad4e}.post-body .note.warning h2,.post-body .note.warning h3,.post-body .note.warning h4,.post-body .note.warning h5,.post-body .note.warning h6{color:#f0ad4e}.post-body .note.danger{border-left-color:#d9534f}.post-body .note.danger h2,.post-body .note.danger h3,.post-body .note.danger h4,.post-body .note.danger h5,.post-body .note.danger h6{color:#d9534f}.pdfobject-container embed,.pdfobject-container iframe{height:800px;width:100%}.post-body .tabs{margin-bottom:20px}.post-body .tabs,.tabs-comment{padding-top:10px}.post-body .tabs ul.nav-tabs,.tabs-comment ul.nav-tabs{background:var(--content-bg-color);display:flex;display:flex;flex-wrap:wrap;justify-content:center;margin:0;padding:0;position:-webkit-sticky;position:sticky;top:0;z-index:5}.post-body .tabs ul.nav-tabs li.tab,.tabs-comment ul.nav-tabs li.tab{border-bottom:1px solid #ddd;border-left:1px solid transparent;border-right:1px solid transparent;border-radius:0;border-top:3px solid transparent;flex-grow:1;list-style-type:none}@media (max-width:413px){.post-body .tabs ul.nav-tabs,.tabs-comment ul.nav-tabs{display:block;margin-bottom:5px}.post-body .tabs ul.nav-tabs li.tab,.tabs-comment ul.nav-tabs li.tab{border-bottom:1px solid transparent;border-left:3px solid transparent;border-right:1px solid transparent;border-top:1px solid transparent;border-radius:0}}.post-body .tabs ul.nav-tabs li.tab a,.tabs-comment ul.nav-tabs li.tab a{border-bottom:initial;display:block;line-height:1.8;padding:.25em .75em;text-align:center;transition:.2s ease-out}.post-body .tabs ul.nav-tabs li.tab a i[class^=fa],.tabs-comment ul.nav-tabs li.tab a i[class^=fa]{width:1.285714285714286em}.post-body .tabs ul.nav-tabs li.tab.active,.tabs-comment ul.nav-tabs li.tab.active{border-color:#fc6423 #ddd transparent}@media (max-width:413px){.post-body .tabs ul.nav-tabs li.tab.active,.tabs-comment ul.nav-tabs li.tab.active{border-color:#ddd #ddd #ddd #fc6423}}.post-body .tabs ul.nav-tabs li.tab.active a,.tabs-comment ul.nav-tabs li.tab.active a{cursor:default}.post-body .tabs .tab-content,.tabs-comment .tab-content{border:1px solid #ddd;border-radius:0;border-top-color:transparent}@media (max-width:413px){.post-body .tabs .tab-content,.tabs-comment .tab-content{border-radius:0;border-top-color:#ddd}}.post-body .tabs .tab-content .tab-pane,.tabs-comment .tab-content .tab-pane{padding:20px 20px 0}.post-body .tabs .tab-content .tab-pane:not(.active),.tabs-comment .tab-content .tab-pane:not(.active){display:none}.pagination .next,.pagination .page-number,.pagination .prev,.pagination .space{display:inline-block;margin:-1px 10px 0;padding:0 10px}.pagination .page-number.current{background:#ccc;border-color:#ccc;color:var(--content-bg-color)}.pagination{border-top:1px solid #eee;margin:120px 0 0;text-align:center}.pagination .next,.pagination .page-number,.pagination .prev{border-bottom:0;border-top:1px solid #eee;transition:border-color .2s ease-in-out}.pagination .next:hover,.pagination .page-number:hover,.pagination .prev:hover{border-top-color:var(--link-hover-color)}@media (max-width:767px){.post-body .link-grid{grid-template-columns:1fr}.pagination .next,.pagination .page-number,.pagination .prev,.pagination .space{margin:0 5px}.pagination{border-top:0}.pagination .next,.pagination .page-number,.pagination .prev{border-bottom:1px solid #eee;border-top:0}.pagination .next:hover,.pagination .page-number:hover,.pagination .prev:hover{border-bottom-color:var(--link-hover-color)}.site-meta{text-align:center}}.pagination .space{margin:0;padding:0}.comments{margin-top:60px;overflow:hidden}.comment-button-group{display:flex;display:flex;flex-wrap:wrap;justify-content:center;justify-content:center;margin:1em 0}.comment-button-group .comment-button{margin:.1em .2em}.comment-button-group .comment-button.active{background:var(--btn-default-hover-bg);border-color:var(--btn-default-hover-border-color);color:var(--btn-default-hover-color)}.comment-position{display:none}.comment-position.active{display:block}.tabs-comment{margin-top:4em;padding-top:0}.tabs-comment .comments{margin-top:0;padding-top:0}.headband{background:var(--theme-color);height:3px}@media (max-width:991px){.headband{display:none}}.site-brand-container{display:flex;flex-shrink:0;padding:0 10px}.use-motion .column,.use-motion .site-brand-container .toggle{opacity:0}.site-meta{flex-grow:1;text-align:center}.custom-logo-image{margin-top:20px}@media (max-width:991px){.custom-logo-image{display:none}}.brand{border-bottom:0;color:var(--brand-color);display:inline-block;padding:0}.brand:hover{color:var(--brand-hover-color)}.site-title{font-family:Noto Serif SC,PingFang SC,Microsoft YaHei,sans-serif,Lato,'PingFang SC','Microsoft YaHei',sans-serif;font-size:1.375em;font-weight:400;line-height:1.5;margin:0}.site-subtitle{color:#ddd;margin:10px 10px 0}.use-motion .custom-logo-image,.use-motion .site-subtitle,.use-motion .site-title{opacity:0;position:relative;top:-10px}.site-nav-right,.site-nav-toggle{display:none}.site-nav-right .toggle,.site-nav-toggle .toggle{color:var(--text-color);padding:10px;width:22px}.site-nav-right .toggle .toggle-line,.site-nav-toggle .toggle .toggle-line{background:var(--text-color);border-radius:1px}@media (max-width:767px){.site-nav-right,.site-nav-toggle{display:flex;flex-direction:column;justify-content:center}.site-nav{--scroll-height:0;height:0;overflow:hidden;transition:height .2s ease-in-out,visibility .2s ease-in-out;visibility:hidden}body:not(.site-nav-on) .site-nav .animated{animation:none}body.site-nav-on .site-nav{height:var(--scroll-height);visibility:unset}}.menu{margin:0;padding:1em 0;text-align:center}.menu-item{display:inline-block;list-style:none;margin:0 10px}@media (max-width:767px){.menu-item{display:block;margin-top:10px}.menu-item.menu-item-search{display:none}}.menu-item a{border-bottom:0;display:block;font-size:.8125em;transition:border-color .2s ease-in-out}.menu-item a.menu-item-active,.menu-item a:hover{background:var(--menu-item-bg-color)}.menu-item i[class^=fa]{margin-right:8px}.menu-item .badge{background:#ccc;border-radius:10px;color:var(--content-bg-color);font-weight:700;line-height:1;margin-left:.35em;padding:2px 5px;text-shadow:1px 1px 0 rgba(0,0,0,.1)}.use-motion .menu-item{visibility:hidden}.book-mark-link{border-bottom:0;position:fixed;top:-10px;transition:top .3s;right:30px}.book-mark-link::before{color:#222;font-size:32px;line-height:1;content:'\f02e';font-family:'Font Awesome 6 Free';font-weight:900}.book-mark-link-fixed,.book-mark-link:hover{top:-2px}@media (max-width:991px){.book-mark-link{right:20px;display:none}.sidebar{left:-320px;background:#222;bottom:0;max-height:100vh;overflow-y:auto;position:fixed;top:0;transition:left .2s ease-out,right .2s ease-out;width:320px;z-index:20}.sidebar-active .sidebar{left:0}.sidebar a{border-bottom-color:#555;color:#999}.sidebar a:hover{border-bottom-color:#eee;color:#eee}.links-of-author:not(:first-child){margin-top:15px}.links-of-author a{border-bottom-color:#555;display:inline-block;margin-bottom:10px;margin-right:10px;vertical-align:middle}.links-of-author a::before{background:#57ffff;display:inline-block;margin-right:3px;transform:translateY(-2px);border-radius:50%;content:' ';height:4px;width:4px}.links-of-blogroll-item{display:inline-block;padding:2px 10px}.links-of-blogroll-item a{box-sizing:border-box;display:inline-block;max-width:280px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.popular-posts .popular-posts-item .popular-posts-link:hover{background:0 0}.sidebar-dimmer{background:#000;height:100%;left:0;opacity:0;position:fixed;top:0;transition:visibility .4s,opacity .4s;visibility:hidden;width:100%;z-index:10}.sidebar-active .sidebar-dimmer{opacity:.7;visibility:visible}}.sidebar-inner{color:#999;padding:18px 10px;text-align:center;display:flex;flex-direction:column;justify-content:center}.cc-license .cc-opacity{border-bottom:0;opacity:.7}.cc-license .cc-opacity:hover{opacity:.9}.cc-license img{display:inline-block}.site-author-image{border:1px solid #eee;max-width:120px;padding:2px;border-radius:50%}.site-author-name{color:var(--text-color);font-weight:600;margin:0}.site-description{color:#999;font-size:.8125em;margin-top:0}.links-of-author a{font-size:.8125em}.links-of-author i[class^=fa]{margin-right:2px}.sidebar .sidebar-button:not(:first-child){margin-top:15px}.sidebar .sidebar-button button{background:0 0;color:#fc6423;cursor:pointer;line-height:2;padding:0 15px;border:1px solid #fc6423;border-radius:4px}.sidebar .sidebar-button button:hover{background:#fc6423;color:#fff}.sidebar .sidebar-button button i[class^=fa]{margin-right:5px}.links-of-blogroll{font-size:.8125em}.links-of-blogroll-title{font-size:.875em;font-weight:600}.links-of-blogroll-list{list-style:none;margin:0;padding:0}.sidebar-nav{font-size:.875em;height:0;margin:0;overflow:hidden;padding-left:0;pointer-events:none;transition:height .2s ease-in-out,visibility .2s ease-in-out;visibility:hidden}.sidebar-nav-active .sidebar-nav{height:calc(2em + 1px);pointer-events:unset;visibility:unset}.sidebar-nav li{border-bottom:1px solid transparent;color:var(--text-color);cursor:pointer;display:inline-block;transition:border-bottom-color .2s ease-in-out,color .2s ease-in-out}.sidebar-nav li.sidebar-nav-overview{margin-left:10px}.sidebar-nav li:hover{color:#fc6423}.sidebar-overview-active .sidebar-nav-overview,.sidebar-toc-active .sidebar-nav-toc{border-bottom-color:#fc6423;color:#fc6423;transition-delay:0.2s}.sidebar-overview-active .sidebar-nav-overview:hover,.sidebar-toc-active .sidebar-nav-toc:hover{color:#fc6423}.sidebar-panel-container{align-items:start;display:grid;flex:1;overflow-x:hidden;overflow-y:auto;padding-top:0;transition:padding-top .2s ease-in-out}.sidebar-nav-active .sidebar-panel-container{padding-top:20px}.sidebar-panel{animation:.2s ease-in-out deactivate-sidebar-panel;grid-area:1/1;height:0;opacity:0;overflow:hidden;pointer-events:none;transform:translateY(0);transition:.2s ease-in-out;transition-property:opacity,transform,visibility;visibility:hidden}.sidebar-nav-active .sidebar-panel,.sidebar-overview-active .sidebar-panel.post-toc-wrap{transform:translateY(-20px)}.sidebar-overview-active:not(.sidebar-nav-active) .sidebar-panel.post-toc-wrap{transition-delay:0s,0.2s,0s}.sidebar-overview-active .sidebar-panel.site-overview-wrap,.sidebar-toc-active .sidebar-panel.post-toc-wrap{animation-name:activate-sidebar-panel;height:auto;opacity:1;pointer-events:unset;transform:translateY(0);transition-delay:0.2s,0.2s,0s;visibility:unset}.sidebar-panel.site-overview-wrap{display:flex;flex-direction:column;justify-content:center;gap:10px;justify-content:flex-start}@keyframes deactivate-sidebar-panel{from{height:var(--inactive-panel-height,0)}to{height:var(--active-panel-height,0)}}@keyframes activate-sidebar-panel{from{height:var(--inactive-panel-height,auto)}to{height:var(--active-panel-height,auto)}}.sidebar-toggle{bottom:61px;height:16px;padding:5px;width:16px;background:#222;cursor:pointer;opacity:.6;position:fixed;z-index:30;left:30px}.sidebar-toggle:hover{opacity:.8}@media (max-width:991px){.sidebar-toggle{left:20px;opacity:.8}}.sidebar-toggle:hover .toggle-line{background:#fc6423}@media (any-hover:hover){body:not(.sidebar-active) .sidebar-toggle:hover :first-child{left:50%;top:2px;transform:rotate(45deg);width:50%}body:not(.sidebar-active) .sidebar-toggle:hover :last-child{left:50%;top:-2px;transform:rotate(-45deg);width:50%}}.sidebar-active .sidebar-toggle :nth-child(2){opacity:0}.sidebar-active .sidebar-toggle :first-child{top:6px;transform:rotate(45deg)}.sidebar-active .sidebar-toggle :last-child{top:-6px;transform:rotate(-45deg)}.post-toc{font-size:.875em}.post-toc ol{list-style:none;margin:0;padding:0 2px 0 10px;text-align:left}.post-toc ol>:last-child{margin-bottom:5px}.post-toc ol>ol{padding-left:0}.post-toc ol a{transition:.2s ease-in-out}.post-toc .nav-item{line-height:1.8;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.post-toc .nav .nav-child{--height:0;height:0;opacity:0;overflow:hidden;transition:.2s ease-in-out;visibility:hidden}.post-toc .nav .active>.nav-child{height:var(--height,auto);opacity:1;visibility:unset}.post-toc .nav .active>a{border-bottom-color:#fc6423;color:#fc6423}.post-toc .nav .active-current>a,.post-toc .nav .active-current>a:hover{color:#fc6423}.site-state{display:flex;flex-wrap:wrap;justify-content:center;line-height:1.4}.site-state-item{padding:0 15px}.site-state-item a{border-bottom:0;display:block}.site-state-item-count{display:block;font-size:1em;font-weight:600}.site-state-item-name{color:#999;font-size:.8125em}.footer{color:#999;font-size:.875em;padding:20px 0;transition:left .2s ease-in-out,right .2s ease-in-out}.footer.footer-fixed{bottom:0;left:0;position:absolute;right:0}.footer-inner{box-sizing:border-box;text-align:center;display:flex;flex-direction:column;justify-content:center;margin:0 auto;width:calc(100% - 20px)}@media (max-width:767px){.footer-inner{width:auto}}@media (min-width:1200px){.footer-inner{width:1160px}}@media (min-width:1600px){.footer-inner{width:73%}}.use-motion .footer{opacity:0}.languages{display:inline-block;font-size:1.125em;position:relative}.languages .lang-select-label span{margin:0 .5em}.languages .lang-select{height:100%;left:0;opacity:0;position:absolute;top:0;width:100%}.with-love{color:red;display:inline-block;margin:0 5px}.busuanzi-count #busuanzi_container_site_pv,.busuanzi-count #busuanzi_container_site_uv{display:none}@keyframes icon-animate{0%,100%{transform:scale(1)}10%,30%{transform:scale(.9)}20%,40%,50%,60%,70%,80%{transform:scale(1.1)}}@media (max-width:567px){.main-inner{padding:initial!important}.posts-expand .post-header{margin-bottom:10px!important}.post-block{margin-top:initial!important;padding:8px 18px!important}.post-body h1,.post-body h2,.post-body h3,.post-body h4,.post-body h5,.post-body h6{margin:20px 0 8px}.post-body .note h1,.post-body .note h2,.post-body .note h3,.post-body .note h4,.post-body .note h5,.post-body .note h6,.post-body .tabs .tab-content .tab-pane h1,.post-body .tabs .tab-content .tab-pane h2,.post-body .tabs .tab-content .tab-pane h3,.post-body .tabs .tab-content .tab-pane h4,.post-body .tabs .tab-content .tab-pane h5,.post-body .tabs .tab-content .tab-pane h6{margin:0 5px}.post-body>p{margin:0 0 10px}.post-body .note>p,.post-body .tabs .tab-content .tab-pane>p{padding:0 5px}.post-body img,.post-body video{margin-bottom:10px!important}.post-body .fancybox+figcaption,.post-body img+figcaption{margin:-5px auto 15px!important}.post-body .note{margin-bottom:10px!important;padding:10px!important}.post-body .tabs .tab-content .tab-pane{padding:10px 10px 0!important}.post-eof{margin:40px auto 20px!important}.pagination{margin-top:40px}}.back-to-top{font-size:12px;margin:8px -10px -20px;opacity:0;transition:opacity .2s ease-in-out}.back-to-top span{margin-right:8px}.back-to-top .fa{text-align:center;width:26px}.back-to-top.back-to-top-on{cursor:pointer;opacity:.6}.back-to-top.back-to-top-on:hover{opacity:.8}.rtl.post-body a,.rtl.post-body h1,.rtl.post-body h2,.rtl.post-body h3,.rtl.post-body h4,.rtl.post-body h5,.rtl.post-body h6,.rtl.post-body li,.rtl.post-body ol,.rtl.post-body p,.rtl.post-body ul{direction:rtl;font-family:UKIJ Ekran}.rtl.post-title{font-family:UKIJ Ekran}.post-button{margin-top:40px;text-align:center}.use-motion .collection-header,.use-motion .comments,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{visibility:hidden}.posts-collapse .post-content{margin-bottom:35px;margin-left:35px;position:relative}@media (max-width:767px){.posts-collapse .post-content{margin-left:0;margin-right:0}}.posts-collapse .post-content .collection-title{font-size:1.125em;position:relative}.posts-collapse .post-content .collection-title::before{background:#999;border:1px solid #fff;margin-left:-6px;margin-top:-4px;position:absolute;top:50%;border-radius:50%;content:' ';height:10px;width:10px}.posts-collapse .post-content .collection-year{font-size:1.5em;font-weight:700;margin:60px 0;position:relative}.posts-collapse .post-content .collection-year .collection-year-count{font-size:.75em;background:#ccc;border-radius:10px;color:var(--content-bg-color);font-weight:700;line-height:1;margin-left:.35em;padding:2px 5px;text-shadow:1px 1px 0 rgba(0,0,0,.1)}.posts-collapse .post-content .collection-year::before{background:#bbb;margin-left:-4px;margin-top:-4px;position:absolute;top:50%;border-radius:50%;content:' ';height:8px;width:8px}.posts-collapse .post-content .collection-header{display:block;margin-left:20px}.posts-collapse .post-content .collection-header small{color:#bbb;margin-left:5px}.posts-collapse .post-content .post-header{border-bottom:1px dashed #ccc;margin:30px 2px 0;padding-left:15px;position:relative;transition:border .2s ease-in-out}.posts-collapse .post-content .post-header::before{background:#bbb;border:1px solid #fff;left:-6px;position:absolute;top:.75em;transition:background .2s ease-in-out;border-radius:50%;content:' ';height:6px;width:6px}.posts-collapse .post-content .post-header:hover{border-bottom-color:#666}.posts-collapse .post-content .post-header:hover::before{background:#222}.posts-collapse .post-content .post-meta-container{display:inline;font-size:.75em;margin-right:10px}.posts-collapse .post-content .post-title{display:inline}.posts-collapse .post-content .post-title a{border-bottom:0;color:var(--link-color)}.posts-collapse .post-content .post-title .fa{font-size:.875em;margin-left:5px}.posts-collapse .post-content::before{background:#f5f5f5;content:' ';height:100%;margin-left:-2px;position:absolute;top:1.25em;width:4px}.post-body{overflow-wrap:break-word}@media (min-width:1200px){.post-body{font-size:1.125em}}@media (min-width:992px){.post-body{text-align:left}}.post-body h1 .header-anchor,.post-body h1 .headerlink,.post-body h2 .header-anchor,.post-body h2 .headerlink,.post-body h3 .header-anchor,.post-body h3 .headerlink,.post-body h4 .header-anchor,.post-body h4 .headerlink,.post-body h5 .header-anchor,.post-body h5 .headerlink,.post-body h6 .header-anchor,.post-body h6 .headerlink{border-bottom-style:none;color:inherit;float:right;font-size:.875em;margin-left:10px;opacity:0}.post-body h1 .header-anchor::before,.post-body h1 .headerlink::before,.post-body h2 .header-anchor::before,.post-body h2 .headerlink::before,.post-body h3 .header-anchor::before,.post-body h3 .headerlink::before,.post-body h4 .header-anchor::before,.post-body h4 .headerlink::before,.post-body h5 .header-anchor::before,.post-body h5 .headerlink::before,.post-body h6 .header-anchor::before,.post-body h6 .headerlink::before{content:'\f0c1';font-family:'Font Awesome 6 Free';font-weight:900}.post-body h1:hover .header-anchor,.post-body h1:hover .headerlink,.post-body h2:hover .header-anchor,.post-body h2:hover .headerlink,.post-body h3:hover .header-anchor,.post-body h3:hover .headerlink,.post-body h4:hover .header-anchor,.post-body h4:hover .headerlink,.post-body h5:hover .header-anchor,.post-body h5:hover .headerlink,.post-body h6:hover .header-anchor,.post-body h6:hover .headerlink{opacity:.5}.post-body h1:hover .header-anchor:hover,.post-body h1:hover .headerlink:hover,.post-body h2:hover .header-anchor:hover,.post-body h2:hover .headerlink:hover,.post-body h3:hover .header-anchor:hover,.post-body h3:hover .headerlink:hover,.post-body h4:hover .header-anchor:hover,.post-body h4:hover .headerlink:hover,.post-body h5:hover .header-anchor:hover,.post-body h5:hover .headerlink:hover,.post-body h6:hover .header-anchor:hover,.post-body h6:hover .headerlink:hover{opacity:1}.post-body .exturl .fa{font-size:.875em;margin-left:4px}.post-body .fancybox+figcaption,.post-body img+figcaption{color:#999;font-size:.875em;font-weight:700;line-height:1;margin:-15px auto 15px;text-align:center}.post-body embed,.post-body iframe,.post-body img,.post-body video{margin-bottom:20px}.post-body .video-container{height:0;margin-bottom:20px;overflow:hidden;padding-top:75%;position:relative;width:100%}.post-body .video-container embed,.post-body .video-container iframe,.post-body .video-container object{height:100%;left:0;margin:0;position:absolute;top:0;width:100%}.post-gallery{display:flex;min-height:200px}.post-gallery .post-gallery-image{flex:1}.post-gallery .post-gallery-image:not(:first-child){clip-path:polygon(40px 0,100% 0,100% 100%,0 100%);margin-left:-20px}.post-gallery .post-gallery-image:not(:last-child){margin-right:-20px}.post-gallery .post-gallery-image img{height:100%;object-fit:cover;opacity:1;width:100%}.posts-expand .post-gallery{margin-bottom:60px}.posts-collapse .post-gallery{margin:15px 0}.posts-expand .post-header{font-size:1.125em;margin-bottom:60px;text-align:center}.posts-expand .post-title{font-size:1.5em;font-weight:400;margin:initial;overflow-wrap:break-word}.posts-expand .post-title-link{border-bottom:0;color:var(--link-color);display:inline-block;position:relative}.posts-expand .post-title-link::before{background:var(--link-color);bottom:0;content:'';height:2px;left:0;position:absolute;transform:scaleX(0);transition:transform .2s ease-in-out;width:100%}.posts-expand .post-title-link:hover::before{transform:scaleX(1)}.posts-expand .post-title-link .fa{font-size:.875em;margin-left:5px}.post-sticky-flag{display:inline-block;margin-right:8px;transform:rotate(30deg)}.posts-expand .post-meta-container{color:#999;font-family:Noto Serif SC,PingFang SC,Microsoft YaHei,sans-serif,Lato,'PingFang SC','Microsoft YaHei',sans-serif;font-size:.75em;margin-top:3px}.posts-expand .post-meta-container .post-description{font-size:.875em;margin-top:2px}.posts-expand .post-meta-container time{border-bottom:1px dashed #999}.post-meta{display:flex;flex-wrap:wrap;justify-content:center}:not(.post-meta-break)+.post-meta-item::before{content:'|';margin:0 .5em}.post-meta-item-icon{margin-right:3px}@media (max-width:991px){.post-body{text-align:justify}.post-meta-item-text{display:none}}.post-meta-break{flex-basis:100%;height:0}#busuanzi_container_page_pv{display:none}.post-nav{border-top:1px solid #eee;display:flex;gap:30px;justify-content:space-between;margin-top:1em;padding:10px 5px 0}.post-nav-item{flex:1}.post-nav-item a{border-bottom:0;display:block;font-size:.875em;line-height:1.6}.post-nav-item a:active{top:2px}.post-nav-item .fa{font-size:.75em}.post-nav-item:first-child .fa{margin-right:5px}.post-nav-item:last-child{text-align:right}.post-nav-item:last-child .fa{margin-left:5px}.post-footer{display:flex;flex-direction:column;justify-content:center}.post-eof{background:#ccc;height:1px;margin:80px auto 60px;width:8%}.post-block:last-of-type .post-eof{display:none}.post-copyright ul{list-style:none;overflow:hidden;padding:.5em 1em;position:relative;background:var(--card-bg-color);border-left:3px solid #ff2a2a;margin:1em 0 0}.post-copyright ul::after{content:'\f25e';font-family:'Font Awesome 6 Brands';font-size:200px;opacity:.1;position:absolute;right:-50px;top:-150px}.post-tags{margin-top:40px;text-align:center}.post-tags a{display:inline-block;font-size:.8125em}.post-tags a:not(:last-child){margin-right:10px}.social-like{border-top:1px solid #eee;font-size:.875em;margin-top:1em;padding-top:1em;display:flex;flex-wrap:wrap;justify-content:center}.social-like a{border-bottom:none}.reward-container{margin:1em 0 0;padding:1em 0;text-align:center}.reward-container button{background:0 0;color:#fc6423;cursor:pointer;line-height:2;padding:0 15px;border:2px solid #fc6423;border-radius:2px;outline:0;vertical-align:text-top}.reward-container button:hover{background:#fc6423;color:#fff}.post-reward{display:none;padding-top:20px}.post-reward.active{display:block}.post-reward div{display:inline-block}.post-reward div span{display:block}.post-reward img{display:inline-block;margin:.8em 2em 0;max-width:100%;width:180px}@keyframes next-roll{from{transform:rotateZ(30deg)}to{transform:rotateZ(-30deg)}}.category-all-page .category-all-title{text-align:center}.category-all-page .category-all{margin-top:20px}.category-all-page .category-list{list-style:none;margin:0;padding:0}.category-all-page .category-list-item{margin:5px 10px}.category-all-page .category-list-count{font-size:.75em;background:#ccc;border-radius:10px;color:var(--content-bg-color);font-weight:700;line-height:1;margin-left:.35em;padding:2px 5px;text-shadow:1px 1px 0 rgba(0,0,0,.1)}.category-all-page .category-list-child{padding-left:10px}.event-list hr{background:#222;margin:20px 0 45px}.event-list hr::after{background:#222;color:#fff;content:'NOW';display:inline-block;font-weight:700;padding:0 5px}.event-list .event{--event-background:#222;--event-foreground:#bbb;--event-title:#fff;background:var(--event-background);padding:15px}.event-list .event .event-summary{border-bottom:0;color:var(--event-title);margin:0;padding:0 0 0 35px;position:relative}.event-list .event .event-summary::before{animation:1s ease-in-out infinite alternate dot-flash;background:var(--event-title);left:0;margin-top:-6px;position:absolute;top:50%;border-radius:50%;content:' ';height:12px;width:12px}.event-list .event:nth-of-type(odd) .event-summary::before{animation-delay:.5s}.event-list .event:not(:last-child){margin-bottom:20px}.event-list .event .event-relative-time{color:var(--event-foreground);display:inline-block;font-size:12px;font-weight:400;padding-left:12px}.event-list .event .event-details{color:var(--event-foreground);display:block;line-height:18px;padding:6px 0 6px 35px}.event-list .event .event-details::before{color:var(--event-foreground);display:inline-block;margin-right:9px;width:14px;font-family:'Font Awesome 6 Free';font-weight:900}.event-list .event .event-details.event-location::before{content:'\f041'}.event-list .event .event-details.event-duration::before{content:'\f017'}.event-list .event .event-details.event-description::before{content:'\f024'}.event-list .event-past{--event-background:#f5f5f5;--event-foreground:#999;--event-title:#222}@keyframes dot-flash{from{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(.8)}}ul.breadcrumb{font-size:.75em;list-style:none;margin:1em 0;padding:0 2em;text-align:center}ul.breadcrumb li{display:inline}ul.breadcrumb li:not(:first-child)::before{content:'/\00a0';font-weight:400;padding:.5em}ul.breadcrumb li:last-child{font-weight:700}.tag-cloud{text-align:center}.tag-cloud a{display:inline-block;margin:10px}.tag-cloud-0{border-bottom-color:#aaa;color:#aaa}.tag-cloud-1{border-bottom-color:#9a9a9a;color:#9a9a9a}.tag-cloud-2{border-bottom-color:#8b8b8b;color:#8b8b8b}.tag-cloud-3{border-bottom-color:#7c7c7c;color:#7c7c7c}.tag-cloud-4{border-bottom-color:#6c6c6c;color:#6c6c6c}.tag-cloud-5{border-bottom-color:#5d5d5d;color:#5d5d5d}.tag-cloud-6{border-bottom-color:#4e4e4e;color:#4e4e4e}.tag-cloud-7{border-bottom-color:#3e3e3e;color:#3e3e3e}.tag-cloud-8{border-bottom-color:#2f2f2f;color:#2f2f2f}.tag-cloud-9{border-bottom-color:#202020;color:#202020}.tag-cloud-10{border-bottom-color:#111;color:#111}.search-active{overflow:hidden}.search-pop-overlay{background:rgba(0,0,0,0);display:flex;height:100%;left:0;position:fixed;top:0;transition:visibility .4s,background .4s;visibility:hidden;width:100%;z-index:40}.search-active .search-pop-overlay{background:rgba(0,0,0,.3);visibility:visible}.search-popup{background:var(--card-bg-color);border-radius:5px;height:80%;margin:auto;transform:scale(0);transition:transform .4s;width:700px}.search-active .search-popup{transform:scale(1)}@media (max-width:767px){.search-popup{border-radius:0;height:100%;width:100%}}.search-popup .popup-btn-close,.search-popup .search-icon{color:#999;font-size:18px;padding:0 10px}.search-popup .popup-btn-close{cursor:pointer}.search-popup .popup-btn-close:hover .fa{color:#222}.search-popup .search-header{background:#eee;border-top-left-radius:5px;border-top-right-radius:5px;display:flex;padding:5px}.search-popup input.search-input{background:0 0;border:0;outline:0;width:100%}.search-popup input.search-input::-webkit-search-cancel-button{display:none}.search-popup .search-result-container{display:flex;flex-direction:column;height:calc(100% - 55px);overflow:auto;padding:5px 25px}.search-popup .search-result-container hr{flex-shrink:0;margin:5px 0 10px}.search-popup .search-result-container hr:first-child{display:none}.search-popup .search-result-list{margin:0 5px;padding:0}.search-popup a.search-result-title{font-weight:700}.search-popup p.search-result{border-bottom:1px dashed #ccc;padding:5px 0}.search-popup .search-input-container{flex-grow:1;padding:2px}.search-popup .search-result-icon{color:#ccc;margin:auto}mark.search-keyword{background:0 0;border-bottom:1px dashed #ff2a2a;color:#ff2a2a;font-weight:700}.use-motion .animated{animation-fill-mode:none;visibility:inherit}.use-motion .sidebar .animated{animation-fill-mode:both}header.header{background:var(--content-bg-color);border-radius:20px;box-shadow:0 2px 2px 0 rgba(0,0,0,.12),0 3px 1px -2px rgba(0,0,0,.06),0 1px 5px 0 rgba(0,0,0,.12)}.main{align-items:stretch;display:flex;justify-content:space-between;margin:0 auto;width:calc(100% - 20px)}@media (max-width:767px){.main{width:auto}}@media (min-width:1200px){.main{width:1160px}}@media (min-width:1600px){.main{width:73%}}@media (max-width:991px){header.header{border-radius:initial}.main{display:block;width:auto}}.main-inner{border-radius:20px;box-sizing:border-box;width:calc(100% - 252px)}.footer-inner{padding-left:252px}@media (max-width:991px){.main-inner{border-radius:initial;width:100%}.footer-inner{padding-left:0;padding-right:0;width:auto}}.column{width:240px}.site-brand-container{background:var(--theme-color)}.site-meta{padding:20px 0}.site-nav-right .toggle,.site-nav-toggle .toggle{color:#fff}.site-nav-right .toggle .toggle-line,.site-nav-toggle .toggle .toggle-line{background:#fff}@media (min-width:768px) and (max-width:991px){.site-nav-right,.site-nav-toggle{display:flex;flex-direction:column;justify-content:center}.site-nav{--scroll-height:0;height:0;overflow:hidden;transition:height .2s ease-in-out,visibility .2s ease-in-out;visibility:hidden}body:not(.site-nav-on) .site-nav .animated{animation:none}body.site-nav-on .site-nav{height:var(--scroll-height);visibility:unset}}.menu .menu-item{display:block;margin:0}.menu .menu-item a{padding:5px 20px;position:relative;transition-property:background-color;display:flex;align-items:center}.menu .menu-item a .badge{margin-left:auto}.menu .menu-item a.menu-item-active::after{background:#bbb;border-radius:50%;content:' ';height:6px;margin-top:-3px;position:absolute;right:15px;top:50%;width:6px}@media (max-width:991px){.column{width:auto}.site-nav-on .site-brand-container{box-shadow:0 0 16px rgba(0,0,0,.5)}.menu .menu-item.menu-item-search{display:none}}.sub-menu{margin:0;padding:6px 0}.sub-menu .menu-item{display:inline-block}.sub-menu .menu-item a{background:0 0;margin:5px 10px;padding:initial}.sub-menu .menu-item a:hover{background:0 0;color:#fc6423}.sub-menu .menu-item-active{border-bottom-color:#fc6423;color:#fc6423}.sub-menu .menu-item-active:hover{border-bottom-color:#fc6423}@media (min-width:992px){.sidebar{position:-webkit-sticky;position:sticky;top:12px}.sidebar-toggle{display:none}.sidebar-inner{background:var(--content-bg-color);border-radius:20px;box-shadow:0 2px 2px 0 rgba(0,0,0,.12),0 3px 1px -2px rgba(0,0,0,.06),0 1px 5px 0 rgba(0,0,0,.12),0 -1px .5px 0 rgba(0,0,0,.09);box-sizing:border-box;color:var(--text-color);margin-top:12px;max-height:calc(100vh - 24px)}.site-state-item{padding:0 10px}.sidebar .sidebar-button{border-bottom:1px dotted #ccc;border-top:1px dotted #ccc}.sidebar .sidebar-button button{border:0;color:#fc6423;display:block;width:100%}.sidebar .sidebar-button button:hover{background:0 0;border:0;color:#e34603}.links-of-author{display:flex;flex-wrap:wrap;justify-content:center}.links-of-author-item{margin:5px 0 0;width:50%}.links-of-author-item a{box-sizing:border-box;max-width:100%;overflow:hidden;padding:0 5px;text-overflow:ellipsis;white-space:nowrap;border-bottom:0;border-radius:4px;display:block}.links-of-author-item a:hover{background:var(--body-bg-color)}.links-of-blogroll-item{display:inline-block;max-width:100%;margin:5px 0 0}.links-of-blogroll-item a{box-sizing:border-box;display:inline-block;max-width:100%;overflow:hidden;padding:0 5px;text-overflow:ellipsis;white-space:nowrap}.back-to-top{background:var(--body-bg-color);margin:-4px -10px -18px;transition-property:bottom,margin-top}.back-to-top.back-to-top-on{margin-top:16px}}.main-inner .comment-position .comments,.main-inner .pagination,.main-inner .post-block,.main-inner .sub-menu,.main-inner .tabs-comment,.main-inner>.comments{background:var(--content-bg-color);border-radius:20px;box-shadow:0 2px 2px 0 rgba(0,0,0,.12),0 3px 1px -2px rgba(0,0,0,.06),0 1px 5px 0 rgba(0,0,0,.12)}.main-inner .post-block:not(:first-child):not(:first-child){border-radius:20px;box-shadow:0 2px 2px 0 rgba(0,0,0,.12),0 3px 1px -2px rgba(0,0,0,.06),0 1px 5px 0 rgba(0,0,0,.12),0 -1px .5px 0 rgba(0,0,0,.09);margin-top:12px}@media (min-width:768px) and (max-width:991px){.main-inner .post-block:not(:first-child):not(:first-child){margin-top:10px}}@media (max-width:767px){.main-inner .post-block:not(:first-child):not(:first-child){margin-top:8px}}.main-inner .comment-position .comments,.main-inner .pagination,.main-inner .tabs-comment,.main-inner>.comments{border-radius:20px;box-shadow:0 2px 2px 0 rgba(0,0,0,.12),0 3px 1px -2px rgba(0,0,0,.06),0 1px 5px 0 rgba(0,0,0,.12),0 -1px .5px 0 rgba(0,0,0,.09);margin-top:12px}@media (min-width:768px) and (max-width:991px){.main-inner .comment-position .comments,.main-inner .pagination,.main-inner .tabs-comment,.main-inner>.comments{margin-top:10px}}@media (max-width:767px){.main-inner .comment-position .comments,.main-inner .pagination,.main-inner .tabs-comment,.main-inner>.comments{margin-top:8px}}.comments,.post-block{padding:40px}.post-eof{display:none}.pagination{border-top:initial;padding:10px 0}.post-body h1,.post-body h2{border-bottom:1px solid #eee}.post-body h3{border-bottom:1px dotted #eee}@media (min-width:768px) and (max-width:991px){.main-inner{padding:10px}.posts-expand .post-button{margin-top:20px}.post-block{padding:20px}.comments{padding:10px 20px}}@media (min-width:992px) and (max-width:991px){.sidebar{display:none}}.post-block{margin-top:12px!important}.main-inner .post-block:not(:first-child):not(:first-child)+mobile (),.post-block+mobile (){border-radius:0!important}ul.sub-menu{margin-top:12px}.site-title{opacity:0}.site-subtitle{font-family:"华文行楷";font-size:1em}.back-to-top{border-radius:0 0 100px}@media (max-width:767px){.main-inner{padding:8px}.posts-expand .post-button{margin:12px 0}.post-block{padding:12px}.comments{padding:10px 12px}ul.sub-menu{margin-top:8px;border-radius:0!important}.back-to-top,.back-to-top-on{bottom:61px;position:absolute;right:20px;color:#fff;font-size:1em;height:26px;line-height:26px;margin:0}.followme{display:none}}.btn{background:rgba(255,255,255,.5)}.site-brand-container{background:url("/images/avatar.jpg") 50% 50%/cover}.post-body{font-family:'Noto Serif SC','Microsoft YaHei';text-align:start;color:#000}.menu .menu-item a,.posts-expand .post-title,.posts-expand .post-title-link{font-family:'Noto Serif SC','Microsoft YaHei';color:#000}.site-description{font-family:'Noto Serif SC','Microsoft YaHei'}.post-copyright ul{font-family:'Noto Serif SC','Microsoft YaHei';color:#000}.sidebar-inner{font-family:'Noto Serif SC','Microsoft YaHei'}@media (max-width:767px){.sidebar-blogroll{display:none;bottom:90px;position:absolute}}.search-popup .search-input-container,.search-popup .search-result-container{font-family:'Noto Serif SC','Microsoft YaHei'}h1{font-size:1.5em}h2{font-size:1.375em}h3{font-size:1.25em}h4{font-size:1.125em}h5{font-size:1em}h6{font-size:.875em}</style><link href=https://use.sevencdn.com/css?family=Noto+Serif+SC:300,300italic,400,400italic,700,700italic%7CPingFang+SC:300,300italic,400,400italic,700,700italic%7CMicrosoft+YaHei:300,300italic,400,400italic,700,700italic%7Csans-serif:300,300italic,400,400italic,700,700italic%7CLato:300,300italic,400,400italic,700,700italic%7CRoboto+Mono:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext rel=stylesheet><link crossorigin href=https://use.sevencdn.com/ajax/libs/font-awesome/6.6.0/css/all.min.css integrity=sha256-5eIC48iZUHmSlSUz9XtjRyK2mzQkHScZY1WdMaoz74E= rel=stylesheet><link crossorigin href=https://use.sevencdn.com/ajax/libs/fancyapps-ui/5.0.31/fancybox/fancybox.css integrity=sha256-gkQVf8UKZgQ0HyuxL/VnacadJ+D2Kox2TCEBuNQg5+w= rel=stylesheet><script class=next-config data-name=main type=application/json>{"hostname":"xiaojianzheng.cn","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.21.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":true,"style":"mac"},"fold":{"enable":true,"height":500},"bookmark":{"enable":true,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":true,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":false,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.json","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":true,"trigger":"auto"}}</script><script src=https://use.sevencdn.com/ajax/libs/hexo-theme-next/8.21.0/config.min.js></script><meta content="Kotlin, Groovy, Dynamic Languages." name=description><meta content=website property=og:type><meta content="Language Support" property=og:title><meta content=http://xiaojianzheng.cn/docs/spring-framework/languages.html property=og:url><meta content=JiaHe property=og:site_name><meta content="Kotlin, Groovy, Dynamic Languages." property=og:description><meta content=zh_CN property=og:locale><meta content=2024-11-02T13:04:31.925Z property=article:published_time><meta content=2024-11-02T13:04:31.925Z property=article:modified_time><meta content=JiaHe property=article:author><meta content="jiahe JiaHe JIAHE" property=article:tag><meta content=summary name=twitter:card><link href=http://xiaojianzheng.cn/docs/spring-framework/languages.html rel=canonical><script class=next-config data-name=page type=application/json>{"sidebar":"","isHome":false,"isPost":false,"lang":"zh-CN","comments":true,"permalink":"http://xiaojianzheng.cn/docs/spring-framework/languages.html","path":"docs/spring-framework/languages.html","title":"Language Support"}</script><script class=next-config data-name=calendar type=application/json>""</script><title>Language Support | JiaHe
</title><noscript><link href=/css/noscript.css rel=stylesheet></noscript><link href=/atom.xml rel=alternate title=JiaHe type=application/atom+xml><body itemscope itemtype=http://schema.org/WebPage><div class=headband></div><main class=main><div class=column><header class=header itemscope itemtype=http://schema.org/WPHeader><div class=site-brand-container><div class=site-nav-toggle><div aria-label=切换导航栏 class=toggle role=button><span class=toggle-line></span><span class=toggle-line></span><span class=toggle-line></span></div></div><div class=site-meta><a class=brand href=/ rel=start> <i class=logo-line></i> <p class=site-title>JiaHe</p> <i class=logo-line></i> </a><p class=site-subtitle itemprop=description>相遇即是缘</div><div class=site-nav-right><div class="toggle popup-trigger" aria-label=搜索 role=button><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class=site-nav><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href=/ rel=section><i class="fa fa-home fa-fw"></i>首页</a><li class="menu-item menu-item-归档"><a href=/archives/ rel=section><i class="fa fa-archive fa-fw"></i>归档</a><li class="menu-item menu-item-导航"><a href=/navigation/ rel=section><i class="fa fa-location-arrow fa-fw"></i>导航</a><li class="menu-item menu-item-文档"><a href=/docs/ rel=section><i class="fa fa-book fa-fw fa-fw"></i>文档</a><li class="menu-item menu-item-应用下载"><a href=/app-download/ rel=section><i class="fas fa-download fa-fw fa-fw"></i>应用下载</a><li class="menu-item menu-item-gpt提示词"><a href=/chatgpt-prompt/ rel=section><i class="fas fa-message fa-fw"></i>GPT提示词</a><li class="menu-item menu-item-小贴士"><a href=/cheat-sheet/ rel=section><i class="fas fa-pen fa-fw"></i>小贴士</a><li class="menu-item menu-item-在线工具"><a href=https://tool.xiaojianzheng.cn/ rel=section target=_blank><i class="fas fa-regular fa-screwdriver-wrench fa-fw"></i>在线工具</a><li class="menu-item menu-item-在线转换"><a href=/online-convert/ rel=section><i class="fas fa-arrow-right-arrow-left fa-fw"></i>在线转换</a><li class="menu-item menu-item-软件安装部署"><a href=/software-install-and-deploy/ rel=section><i class="fab fa-windows fa-fw"></i>软件安装部署</a><li class="menu-item menu-item-linux命令"><a href=https://wangchujiang.com/linux-command/ rel=section target=_blank><i class="fab fa-linux fa-fw"></i>Linux命令</a><li class="menu-item menu-item-search"><a class=popup-trigger role=button><i class="fa fa-search fa-fw"></i>搜索 </a></ul></nav><div class=search-pop-overlay><div class="popup search-popup"><div class=search-header><span class=search-icon> <i class="fa fa-search"></i> </span><div class=search-input-container><input autocapitalize=off autocomplete=off class=search-input maxlength=80 placeholder=搜索... spellcheck=false type=search></div><span class=popup-btn-close role=button> <i class="fa fa-times-circle"></i> </span></div><div class=search-result-container><div class=search-result-icon><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></header><aside class=sidebar><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class=sidebar-nav><li class=sidebar-nav-toc>文章目录<li class=sidebar-nav-overview>站点概览</ul><div class=sidebar-panel-container><!--noindex--><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class=nav><li class="nav-item nav-level-2"><a class=nav-link href=#1-Kotlin><span class=nav-number>1.</span> <span class=nav-text>1. Kotlin</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#1-1-Requirements><span class=nav-number>1.1.</span> <span class=nav-text>1.1. Requirements</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#1-2-Extensions><span class=nav-number>1.2.</span> <span class=nav-text>1.2. Extensions</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#1-3-Null-safety><span class=nav-number>1.3.</span> <span class=nav-text>1.3. Null-safety</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#1-4-Classes-and-Interfaces><span class=nav-number>1.4.</span> <span class=nav-text>1.4. Classes and Interfaces</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#1-5-Annotations><span class=nav-number>1.5.</span> <span class=nav-text>1.5. Annotations</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#1-6-Bean-Definition-DSL><span class=nav-number>1.6.</span> <span class=nav-text>1.6. Bean Definition DSL</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#1-7-Web><span class=nav-number>1.7.</span> <span class=nav-text>1.7. Web</span></a><ol class=nav-child><li class="nav-item nav-level-4"><a class=nav-link href=#1-7-1-Router-DSL><span class=nav-number>1.7.1.</span> <span class=nav-text>1.7.1. Router DSL</span></a><li class="nav-item nav-level-4"><a class=nav-link href=#1-7-2-MockMvc-DSL><span class=nav-number>1.7.2.</span> <span class=nav-text>1.7.2. MockMvc DSL</span></a><li class="nav-item nav-level-4"><a class=nav-link href=#1-7-3-Kotlin-Script-Templates><span class=nav-number>1.7.3.</span> <span class=nav-text>1.7.3. Kotlin Script Templates</span></a><li class="nav-item nav-level-4"><a class=nav-link href=#1-7-4-Kotlin-multiplatform-serialization><span class=nav-number>1.7.4.</span> <span class=nav-text>1.7.4. Kotlin multiplatform serialization</span></a></ol><li class="nav-item nav-level-3"><a class=nav-link href=#1-8-Coroutines><span class=nav-number>1.8.</span> <span class=nav-text>1.8. Coroutines</span></a><ol class=nav-child><li class="nav-item nav-level-4"><a class=nav-link href=#1-8-1-Dependencies><span class=nav-number>1.8.1.</span> <span class=nav-text>1.8.1. Dependencies</span></a><li class="nav-item nav-level-4"><a class=nav-link href=#1-8-2-How-Reactive-translates-to-Coroutines><span class=nav-number>1.8.2.</span> <span class=nav-text>1.8.2. How Reactive translates to Coroutines?</span></a><li class="nav-item nav-level-4"><a class=nav-link href=#1-8-3-Controllers><span class=nav-number>1.8.3.</span> <span class=nav-text>1.8.3. Controllers</span></a><li class="nav-item nav-level-4"><a class=nav-link href=#1-8-4-WebFlux-fn><span class=nav-number>1.8.4.</span> <span class=nav-text>1.8.4. WebFlux.fn</span></a><li class="nav-item nav-level-4"><a class=nav-link href=#1-8-5-Transactions><span class=nav-number>1.8.5.</span> <span class=nav-text>1.8.5. Transactions</span></a></ol><li class="nav-item nav-level-3"><a class=nav-link href=#1-9-Spring-Projects-in-Kotlin><span class=nav-number>1.9.</span> <span class=nav-text>1.9. Spring Projects in Kotlin</span></a><ol class=nav-child><li class="nav-item nav-level-4"><a class=nav-link href=#1-9-1-Final-by-Default><span class=nav-number>1.9.1.</span> <span class=nav-text>1.9.1. Final by Default</span></a><li class="nav-item nav-level-4"><a class=nav-link href=#1-9-2-Using-Immutable-Class-Instances-for-Persistence><span class=nav-number>1.9.2.</span> <span class=nav-text>1.9.2. Using Immutable Class Instances for Persistence</span></a><li class="nav-item nav-level-4"><a class=nav-link href=#1-9-3-Injecting-Dependencies><span class=nav-number>1.9.3.</span> <span class=nav-text>1.9.3. Injecting Dependencies</span></a><li class="nav-item nav-level-4"><a class=nav-link href=#1-9-4-Injecting-Configuration-Properties><span class=nav-number>1.9.4.</span> <span class=nav-text>1.9.4. Injecting Configuration Properties</span></a><li class="nav-item nav-level-4"><a class=nav-link href=#1-9-5-Checked-Exceptions><span class=nav-number>1.9.5.</span> <span class=nav-text>1.9.5. Checked Exceptions</span></a><li class="nav-item nav-level-4"><a class=nav-link href=#1-9-6-Annotation-Array-Attributes><span class=nav-number>1.9.6.</span> <span class=nav-text>1.9.6. Annotation Array Attributes</span></a><li class="nav-item nav-level-4"><a class=nav-link href=#1-9-7-Testing><span class=nav-number>1.9.7.</span> <span class=nav-text>1.9.7. Testing</span></a><ol class=nav-child><li class="nav-item nav-level-5"><a class=nav-link href=#Constructor-injection><span class=nav-number>1.9.7.1.</span> <span class=nav-text>Constructor injection</span></a><li class="nav-item nav-level-5"><a class=nav-link href=#PER-CLASS-Lifecycle><span class=nav-number>1.9.7.2.</span> <span class=nav-text>PER_CLASS Lifecycle</span></a><li class="nav-item nav-level-5"><a class=nav-link href=#Specification-like-Tests><span class=nav-number>1.9.7.3.</span> <span class=nav-text>Specification-like Tests</span></a><li class="nav-item nav-level-5"><a class=nav-link href=#WebTestClient-Type-Inference-Issue-in-Kotlin><span class=nav-number>1.9.7.4.</span> <span class=nav-text>WebTestClient Type Inference Issue in Kotlin</span></a></ol></ol><li class="nav-item nav-level-3"><a class=nav-link href=#1-10-Getting-Started><span class=nav-number>1.10.</span> <span class=nav-text>1.10. Getting Started</span></a><ol class=nav-child><li class="nav-item nav-level-4"><a class=nav-link href=#1-10-1-start-spring-io><span class=nav-number>1.10.1.</span> <span class=nav-text>1.10.1. start.spring.io</span></a><li class="nav-item nav-level-4"><a class=nav-link href=#1-10-2-Choosing-the-Web-Flavor><span class=nav-number>1.10.2.</span> <span class=nav-text>1.10.2. Choosing the Web Flavor</span></a></ol><li class="nav-item nav-level-3"><a class=nav-link href=#1-11-Resources><span class=nav-number>1.11.</span> <span class=nav-text>1.11. Resources</span></a><ol class=nav-child><li class="nav-item nav-level-4"><a class=nav-link href=#1-11-1-Examples><span class=nav-number>1.11.1.</span> <span class=nav-text>1.11.1. Examples</span></a><li class="nav-item nav-level-4"><a class=nav-link href=#1-11-2-Issues><span class=nav-number>1.11.2.</span> <span class=nav-text>1.11.2. Issues</span></a></ol></ol><li class="nav-item nav-level-2"><a class=nav-link href=#2-Apache-Groovy><span class=nav-number>2.</span> <span class=nav-text>2. Apache Groovy</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#3-Dynamic-Language-Support><span class=nav-number>3.</span> <span class=nav-text>3. Dynamic Language Support</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#3-1-A-First-Example><span class=nav-number>3.1.</span> <span class=nav-text>3.1. A First Example</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#3-2-Defining-Beans-that-Are-Backed-by-Dynamic-Languages><span class=nav-number>3.2.</span> <span class=nav-text>3.2. Defining Beans that Are Backed by Dynamic Languages</span></a><ol class=nav-child><li class="nav-item nav-level-4"><a class=nav-link href=#3-2-1-Common-Concepts><span class=nav-number>3.2.1.</span> <span class=nav-text>3.2.1. Common Concepts</span></a><ol class=nav-child><li class="nav-item nav-level-5"><a class=nav-link href=#The-lang-language-element><span class=nav-number>3.2.1.1.</span> <span class=nav-text>The lang:language/ element</span></a><li class="nav-item nav-level-5"><a class=nav-link href=#Refreshable-Beans><span class=nav-number>3.2.1.2.</span> <span class=nav-text>Refreshable Beans</span></a><li class="nav-item nav-level-5"><a class=nav-link href=#Inline-Dynamic-Language-Source-Files><span class=nav-number>3.2.1.3.</span> <span class=nav-text>Inline Dynamic Language Source Files</span></a><li class="nav-item nav-level-5"><a class=nav-link href=#Understanding-Constructor-Injection-in-the-Context-of-Dynamic-language-backed-Beans><span class=nav-number>3.2.1.4.</span> <span class=nav-text>Understanding Constructor Injection in the Context of Dynamic-language-backed Beans</span></a></ol><li class="nav-item nav-level-4"><a class=nav-link href=#3-2-2-Groovy-Beans><span class=nav-number>3.2.2.</span> <span class=nav-text>3.2.2. Groovy Beans</span></a><ol class=nav-child><li class="nav-item nav-level-5"><a class=nav-link href=#Customizing-Groovy-Objects-by-Using-a-Callback><span class=nav-number>3.2.2.1.</span> <span class=nav-text>Customizing Groovy Objects by Using a Callback</span></a></ol><li class="nav-item nav-level-4"><a class=nav-link href=#3-2-3-BeanShell-Beans><span class=nav-number>3.2.3.</span> <span class=nav-text>3.2.3. BeanShell Beans</span></a></ol><li class="nav-item nav-level-3"><a class=nav-link href=#3-3-Scenarios><span class=nav-number>3.3.</span> <span class=nav-text>3.3. Scenarios</span></a><ol class=nav-child><li class="nav-item nav-level-4"><a class=nav-link href=#3-3-1-Scripted-Spring-MVC-Controllers><span class=nav-number>3.3.1.</span> <span class=nav-text>3.3.1. Scripted Spring MVC Controllers</span></a><li class="nav-item nav-level-4"><a class=nav-link href=#3-3-2-Scripted-Validators><span class=nav-number>3.3.2.</span> <span class=nav-text>3.3.2. Scripted Validators</span></a></ol><li class="nav-item nav-level-3"><a class=nav-link href=#3-4-Additional-Details><span class=nav-number>3.4.</span> <span class=nav-text>3.4. Additional Details</span></a><ol class=nav-child><li class="nav-item nav-level-4"><a class=nav-link href=#3-4-1-AOP-%E2%80%94-Advising-Scripted-Beans><span class=nav-number>3.4.1.</span> <span class=nav-text>3.4.1. AOP — Advising Scripted Beans</span></a><li class="nav-item nav-level-4"><a class=nav-link href=#3-4-2-Scoping><span class=nav-number>3.4.2.</span> <span class=nav-text>3.4.2. Scoping</span></a><li class="nav-item nav-level-4"><a class=nav-link href=#3-4-3-The-lang-XML-schema><span class=nav-number>3.4.3.</span> <span class=nav-text>3.4.3. The lang XML schema</span></a></ol><li class="nav-item nav-level-3"><a class=nav-link href=#3-5-Further-Resources><span class=nav-number>3.5.</span> <span class=nav-text>3.5. Further Resources</span></a></ol></ol></div></div><!--/noindex--><div class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop=author itemscope itemtype=http://schema.org/Person><img alt=JiaHe class=site-author-image itemprop=image src=/images/avatar.jpg><p class=site-author-name itemprop=name>JiaHe<div class=site-description itemprop=description>无缘等有缘</div></div><div class="site-state-wrap animated"><nav class=site-state><div class="site-state-item site-state-posts"><a href=/archives/> <span class=site-state-item-count>159</span> <span class=site-state-item-name>日志</span> </a></div><div class="site-state-item site-state-categories"><a href=/categories/> <span class=site-state-item-count>23</span> <span class=site-state-item-name>分类</span></a></div><div class="site-state-item site-state-tags"><a href=/tags/> <span class=site-state-item-count>120</span> <span class=site-state-item-name>标签</span></a></div></nav></div><div class="links-of-author animated"><span class=links-of-author-item> <a rel="noopener me" title="RSS → /atom.xml" href=/atom.xml><i class="fa fa-rss fa-fw"></i>RSS</a> </span></div><div style="margin-top: 10px" class=digit-canvas><canvas id=canvas style=width:58%;></canvas></div><script>(function(){

   var digit=
    [
        [
            [0,0,1,1,1,0,0],
            [0,1,1,0,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,0,1,1,0],
            [0,0,1,1,1,0,0]
        ],//0
        [
            [0,0,0,1,1,0,0],
            [0,1,1,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [1,1,1,1,1,1,1]
        ],//1
        [
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,0,1,1,0,0,0],
            [0,1,1,0,0,0,0],
            [1,1,0,0,0,0,0],
            [1,1,0,0,0,1,1],
            [1,1,1,1,1,1,1]
        ],//2
        [
            [1,1,1,1,1,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,0,0,1,1,0],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//3
        [
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,1,0],
            [0,0,1,1,1,1,0],
            [0,1,1,0,1,1,0],
            [1,1,0,0,1,1,0],
            [1,1,1,1,1,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,0,1,1,0],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,1,1]
        ],//4
        [
            [1,1,1,1,1,1,1],
            [1,1,0,0,0,0,0],
            [1,1,0,0,0,0,0],
            [1,1,1,1,1,1,0],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//5
        [
            [0,0,0,0,1,1,0],
            [0,0,1,1,0,0,0],
            [0,1,1,0,0,0,0],
            [1,1,0,0,0,0,0],
            [1,1,0,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//6
        [
            [1,1,1,1,1,1,1],
            [1,1,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,1,1,0,0,0],
            [0,0,1,1,0,0,0],
            [0,0,1,1,0,0,0],
            [0,0,1,1,0,0,0]
        ],//7
        [
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//8
        [
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,1,1,0,0,0,0]
        ],//9
        [
            [0,0,0,0,0,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,0,0,0,0,0]
        ]//:
    ];

var canvas = document.getElementById('canvas');

//定义一个函数判断是手机端还是pc端
function isMobile(){
    if(window.navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i)) {
      document.querySelector('.digit-canvas').style.display = 'none'
      return true; // 移动端
    }else{
      return false; // PC端
    }
}

if(!isMobile() && canvas.getContext){
    var cxt = canvas.getContext('2d');
    //声明canvas的宽高
    var H = 100,W = 700;
    canvas.height = H;
    canvas.width = W;
    cxt.fillStyle = '#f00';
    cxt.fillRect(10,10,50,50);

    //存储时间数据
    var data = [];
    //存储运动的小球
    var balls = [];
    //设置粒子半径
    var R = canvas.height/20-1;
    (function(){
        var temp = /(\d)(\d):(\d)(\d):(\d)(\d)/.exec(new Date());
        //存储时间数字，由十位小时、个位小时、冒号、十位分钟、个位分钟、冒号、十位秒钟、个位秒钟这7个数字组成
        data.push(temp[1],temp[2],10,temp[3],temp[4],10,temp[5],temp[6]);
    })();

    /*生成点阵数字*/
    function renderDigit(index,num){
        for(var i = 0; i < digit[num].length; i++){
            for(var j = 0; j < digit[num][i].length; j++){
                if(digit[num][i][j] == 1){
                    cxt.beginPath();
                    cxt.arc(14*(R+2)*index + j*2*(R+1)+(R+1),i*2*(R+1)+(R+1),R,0,2*Math.PI);
                    cxt.closePath();
                    cxt.fill();
                }
            }
        }
    }

    /*更新时钟*/
    function updateDigitTime(){
        var changeNumArray = [];
        var temp = /(\d)(\d):(\d)(\d):(\d)(\d)/.exec(new Date());
        var NewData = [];
        NewData.push(temp[1],temp[2],10,temp[3],temp[4],10,temp[5],temp[6]);
        for(var i = data.length-1; i >=0 ; i--){
            //时间发生变化
            if(NewData[i] !== data[i]){
                //将变化的数字值和在data数组中的索引存储在changeNumArray数组中
                changeNumArray.push(i+'_'+(Number(data[i])+1)%10);
            }
        }
        //增加小球
        for(var i = 0; i< changeNumArray.length; i++){
            addBalls.apply(this,changeNumArray[i].split('_'));
        }
        data = NewData.concat();
    }

    /*更新小球状态*/
    function updateBalls(){
        for(var i = 0; i < balls.length; i++){
            balls[i].stepY += balls[i].disY;
            balls[i].x += balls[i].stepX;
            balls[i].y += balls[i].stepY;
            if(balls[i].x > W + R || balls[i].y > H + R){
                balls.splice(i,1);
                i--;
            }
        }
    }

    /*增加要运动的小球*/
    function addBalls(index,num){
        var numArray = [1,2,3];
        var colorArray =  ["#3BE","#09C","#A6C","#93C","#9C0","#690","#FB3","#F80","#F44","#C00"];
        for(var i = 0; i < digit[num].length; i++){
            for(var j = 0; j < digit[num][i].length; j++){
                if(digit[num][i][j] == 1){
                    var ball = {
                        x:14*(R+2)*index + j*2*(R+1)+(R+1),
                        y:i*2*(R+1)+(R+1),
                        stepX:Math.floor(Math.random() * 4 -2),
                        stepY:-2*numArray[Math.floor(Math.random()*numArray.length)],
                        color:colorArray[Math.floor(Math.random()*colorArray.length)],
                        disY:1
                    };
                    balls.push(ball);
                }
            }
        }
    }

    /*渲染*/
    function render(){
        //重置画布宽度，达到清空画布的效果
        canvas.height = 100;
        //渲染时钟
        for(var i = 0; i < data.length; i++){
            renderDigit(i,data[i]);
        }
        //渲染小球
        for(var i = 0; i < balls.length; i++){
            cxt.beginPath();
            cxt.arc(balls[i].x,balls[i].y,R,0,2*Math.PI);
            cxt.fillStyle = balls[i].color;
            cxt.closePath();
            cxt.fill();
        }
    }

    clearInterval(oTimer);
    var oTimer = setInterval(function(){
        //更新时钟
        updateDigitTime();
        //更新小球状态
        updateBalls();
        //渲染
        render();
    },50);
}

})();</script><div class="site-overview-wrap sidebar-panel sidebar-panel-active"><div class=site-overview></div></div></div></div><div class="back-to-top animated" aria-label=返回顶部 role=button><i class="fa fa-arrow-up"></i><span>0%</span></div></div><div class="sidebar-inner sidebar-blogroll"><div class="links-of-blogroll animated"><div class=links-of-blogroll-title><i class="fa fa-globe fa-fw"></i> 链接</div><ul class=links-of-blogroll-list><li class=links-of-blogroll-item><a href=https://cn.bing.com/ rel=noopener target=_blank title=https://cn.bing.com/>Bing</a><li class=links-of-blogroll-item><a href=https://www.google.com/ rel=noopener target=_blank title=https://www.google.com/>Google</a><li class=links-of-blogroll-item><a href=https://zh.wikipedia.org/wiki/Wikipedia:%E9%A6%96%E9%A1%B5 rel=noopener target=_blank title=https://zh.wikipedia.org/wiki/Wikipedia:%E9%A6%96%E9%A1%B5>Wiki</a><li class=links-of-blogroll-item><a href=https://projectlombok.org/ rel=noopener target=_blank title=https://projectlombok.org/>lombok</a><li class=links-of-blogroll-item><a href=https://logging.apache.org/log4j/2.x/ rel=noopener target=_blank title=https://logging.apache.org/log4j/2.x/>log4j</a><li class=links-of-blogroll-item><a href=http://logback.qos.ch/ rel=noopener target=_blank title=http://logback.qos.ch/>logback</a><li class=links-of-blogroll-item><a href=https://junit.org/junit5/ rel=noopener target=_blank title=https://junit.org/junit5/>junit</a><li class=links-of-blogroll-item><a href=https://element.eleme.cn/#/zh-CN rel=noopener target=_blank title=https://element.eleme.cn/#/zh-CN>ElementUI</a><li class=links-of-blogroll-item><a href=https://zipkin.io/ rel=noopener target=_blank title=https://zipkin.io/>Zipkin</a><li class=links-of-blogroll-item><a href=https://www.selenium.dev/zh-cn/ rel=noopener target=_blank title=https://www.selenium.dev/zh-cn/>Selenium</a><li class=links-of-blogroll-item><a href=https://nacos.io/zh-cn/docs/what-is-nacos.html rel=noopener target=_blank title=https://nacos.io/zh-cn/docs/what-is-nacos.html>Nacos</a><li class=links-of-blogroll-item><a href=https://redis.io/ rel=noopener target=_blank title=https://redis.io/>Redis</a><li class=links-of-blogroll-item><a href=https://www.jetbrains.com/help/idea/discover-intellij-idea.html rel=noopener target=_blank title=https://www.jetbrains.com/help/idea/discover-intellij-idea.html>IDEA-Document</a><li class=links-of-blogroll-item><a href=https://jdk.java.net/ rel=noopener target=_blank title=https://jdk.java.net/>JDK</a><li class=links-of-blogroll-item><a href=https://www.java.com/en/download/manual.jsp rel=noopener target=_blank title=https://www.java.com/en/download/manual.jsp>JDK8</a><li class=links-of-blogroll-item><a href=https://dev.java/ rel=noopener target=_blank title=https://dev.java/>JAVA</a><li class=links-of-blogroll-item><a href=https://poi.apache.org/components/index.html rel=noopener target=_blank title=https://poi.apache.org/components/index.html>POI</a><li class=links-of-blogroll-item><a href=https://assertj.github.io/doc/ rel=noopener target=_blank title=https://assertj.github.io/doc/>AssertJ</a><li class=links-of-blogroll-item><a href=https://docshome.gitbook.io/nginx-docs/ rel=noopener target=_blank title=https://docshome.gitbook.io/nginx-docs/>Nginx-CN</a><li class=links-of-blogroll-item><a href=https://github.com/cglib/cglib rel=noopener target=_blank title=https://github.com/cglib/cglib>cglib</a><li class=links-of-blogroll-item><a href=https://docs.gitlab.com/ee/api/api_resources.html rel=noopener target=_blank title=https://docs.gitlab.com/ee/api/api_resources.html>Gitlab Api</a><li class=links-of-blogroll-item><a href=http://mockjs.com/examples.html rel=noopener target=_blank title=http://mockjs.com/examples.html>Mockjs</a><li class=links-of-blogroll-item><a href=https://cook.aiurs.co/ rel=noopener target=_blank title=https://cook.aiurs.co/>程序员做饭指南</a><li class=links-of-blogroll-item><a href=https://wangdoc.com/ rel=noopener target=_blank title=https://wangdoc.com/>网道</a><li class=links-of-blogroll-item><a href=https://docs.k3s.io/zh/ rel=noopener target=_blank title=https://docs.k3s.io/zh/>K3S</a><li class=links-of-blogroll-item><a href=https://lazyvim-github-io.vercel.app/ rel=noopener target=_blank title=https://lazyvim-github-io.vercel.app/>LazyVim</a></ul></div></div></aside></div><div class="main-inner page posts-expand"><div class=post-block lang=zh-CN><header class=post-header><h1 itemprop="name headline" class=post-title>Language Support</h1><div class=post-meta-container><div class=post-description>Kotlin, Groovy, Dynamic Languages.</div><ul class=breadcrumb><li><a href=/docs/>文档</a><li><a href=/docs/spring-framework/>SPRING</a><li>LANGUAGES</ul></div></header><div class=post-body><blockquote><p>Version 5.3.10</blockquote><h2 id=1-Kotlin><a title="1. Kotlin" class=headerlink href=#1-Kotlin></a>1. Kotlin</h2><p><a href=https://kotlinlang.org/ rel=noopener target=_blank>Kotlin</a> is a statically typed language that targets the JVM (and other platforms) which allows writing concise and elegant code while providing very good <a href=https://kotlinlang.org/docs/reference/java-interop.html rel=noopener target=_blank>interoperability</a> with existing libraries written in Java.<p>The Spring Framework provides first-class support for Kotlin and lets developers write Kotlin applications almost as if the Spring Framework was a native Kotlin framework. Most of the code samples of the reference documentation are provided in Kotlin in addition to Java.<p>The easiest way to build a Spring application with Kotlin is to leverage Spring Boot and its <a href=https://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-kotlin.html rel=noopener target=_blank>dedicated Kotlin support</a>. <a href=https://spring.io/guides/tutorials/spring-boot-kotlin/ rel=noopener target=_blank>This comprehensive tutorial</a> will teach you how to build Spring Boot applications with Kotlin using <a href=https://start.spring.io/#!language=kotlin&type=gradle-project rel=noopener target=_blank>start.spring.io</a>.<p>Feel free to join the #spring channel of <a href=https://slack.kotlinlang.org/ rel=noopener target=_blank>Kotlin Slack</a> or ask a question with <code>spring</code> and <code>kotlin</code> as tags on <a href=https://stackoverflow.com/questions/tagged/spring+kotlin rel=noopener target=_blank>Stackoverflow</a> if you need support.<h3 id=1-1-Requirements><a title="1.1. Requirements" class=headerlink href=#1-1-Requirements></a>1.1. Requirements</h3><p>Spring Framework supports Kotlin 1.3+ and requires <a href=https://search.maven.org/artifact/org.jetbrains.kotlin/kotlin-stdlib rel=noopener target=_blank><code>kotlin-stdlib</code></a> (or one of its variants, such as <a href=https://search.maven.org/artifact/org.jetbrains.kotlin/kotlin-stdlib-jdk8 rel=noopener target=_blank><code>kotlin-stdlib-jdk8</code></a>) and <a href=https://search.maven.org/artifact/org.jetbrains.kotlin/kotlin-reflect rel=noopener target=_blank><code>kotlin-reflect</code></a> to be present on the classpath. They are provided by default if you bootstrap a Kotlin project on <a href=https://start.spring.io/#!language=kotlin&type=gradle-project rel=noopener target=_blank>start.spring.io</a>.<table><thead><tr><th><th>The <a href=https://github.com/FasterXML/jackson-module-kotlin rel=noopener target=_blank>Jackson Kotlin module</a> is required for serializing or deserializing JSON data for Kotlin classes with Jackson, so make sure to add the <code>com.fasterxml.jackson.module:jackson-module-kotlin</code> dependency to your project if you have such need. It is automatically registered when found in the classpath.<tbody><tr><td><td></table><h3 id=1-2-Extensions><a title="1.2. Extensions" class=headerlink href=#1-2-Extensions></a>1.2. Extensions</h3><p>Kotlin <a href=https://kotlinlang.org/docs/reference/extensions.html rel=noopener target=_blank>extensions</a> provide the ability to extend existing classes with additional functionality. The Spring Framework Kotlin APIs use these extensions to add new Kotlin-specific conveniences to existing Spring APIs.<p>The <a href=https://docs.spring.io/spring-framework/docs/5.3.10/kdoc-api/spring-framework/ rel=noopener target=_blank>Spring Framework KDoc API</a> lists and documents all available Kotlin extensions and DSLs.<table><thead><tr><th><th>Keep in mind that Kotlin extensions need to be imported to be used. This means, for example, that the <code>GenericApplicationContext.registerBean</code> Kotlin extension is available only if <code>org.springframework.context.support.registerBean</code> is imported. That said, similar to static imports, an IDE should automatically suggest the import in most cases.<tbody><tr><td><td></table><p>For example, <a href=https://kotlinlang.org/docs/reference/inline-functions.html#reified-type-parameters rel=noopener target=_blank>Kotlin reified type parameters</a> provide a workaround for JVM <a href=https://docs.oracle.com/javase/tutorial/java/generics/erasure.html rel=noopener target=_blank>generics type erasure</a>, and the Spring Framework provides some extensions to take advantage of this feature. This allows for a better Kotlin API <code>RestTemplate</code>, for the new <code>WebClient</code> from Spring WebFlux, and for various other APIs.<table><thead><tr><th><th>Other libraries, such as Reactor and Spring Data, also provide Kotlin extensions for their APIs, thus giving a better Kotlin development experience overall.<tbody><tr><td><td></table><p>To retrieve a list of <code>User</code> objects in Java, you would normally write the following:<figure class="highlight java"><table><tr><td class=code><pre><span class=line>Flux&LTUser> users  = client.get().retrieve().bodyToFlux(User.class)</span><br></pre></table></figure><p>With Kotlin and the Spring Framework extensions, you can instead write the following:<figure class="highlight kotlin"><table><tr><td class=code><pre><span class=line><span class=keyword>val</span> users = client.<span class=keyword>get</span>().retrieve().bodyToFlux&LTUser>()</span><br><span class=line><span class=comment>// or (both are equivalent)</span></span><br><span class=line><span class=keyword>val</span> users : Flux&LTUser> = client.<span class=keyword>get</span>().retrieve().bodyToFlux()</span><br></pre></table></figure><p>As in Java, <code>users</code> in Kotlin is strongly typed, but Kotlin’s clever type inference allows for shorter syntax.<h3 id=1-3-Null-safety><a title="1.3. Null-safety" class=headerlink href=#1-3-Null-safety></a>1.3. Null-safety</h3><p>One of Kotlin’s key features is <a href=https://kotlinlang.org/docs/reference/null-safety.html rel=noopener target=_blank>null-safety</a>, which cleanly deals with <code>null</code> values at compile time rather than bumping into the famous <code>NullPointerException</code> at runtime. This makes applications safer through nullability declarations and expressing “value or no value” semantics without paying the cost of wrappers, such as <code>Optional</code>. (Kotlin allows using functional constructs with nullable values. See this <a href=https://www.baeldung.com/kotlin-null-safety rel=noopener target=_blank>comprehensive guide to Kotlin null-safety</a>.)<p>Although Java does not let you express null-safety in its type-system, the Spring Framework provides <a href=https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#null-safety rel=noopener target=_blank>null-safety of the whole Spring Framework API</a> via tooling-friendly annotations declared in the <code>org.springframework.lang</code> package. By default, types from Java APIs used in Kotlin are recognized as <a href=https://kotlinlang.org/docs/reference/java-interop.html#null-safety-and-platform-types rel=noopener target=_blank>platform types</a>, for which null-checks are relaxed. <a href=https://kotlinlang.org/docs/reference/java-interop.html#jsr-305-support rel=noopener target=_blank>Kotlin support for JSR-305 annotations</a> and Spring nullability annotations provide null-safety for the whole Spring Framework API to Kotlin developers, with the advantage of dealing with <code>null</code>-related issues at compile time.<table><thead><tr><th><th>Libraries such as Reactor or Spring Data provide null-safe APIs to leverage this feature.<tbody><tr><td><td></table><p>You can configure JSR-305 checks by adding the <code>-Xjsr305</code> compiler flag with the following options: <code>-Xjsr305={strict|warn|ignore}</code>.<p>For kotlin versions 1.1+, the default behavior is the same as <code>-Xjsr305=warn</code>. The <code>strict</code> value is required to have Spring Framework API null-safety taken into account in Kotlin types inferred from Spring API but should be used with the knowledge that Spring API nullability declaration could evolve even between minor releases and that more checks may be added in the future.<table><thead><tr><th><th>Generic type arguments, varargs, and array elements nullability are not supported yet, but should be in an upcoming release. See <a href=https://github.com/Kotlin/KEEP/issues/79 rel=noopener target=_blank>this discussion</a> for up-to-date information.<tbody><tr><td><td></table><h3 id=1-4-Classes-and-Interfaces><a title="1.4. Classes and Interfaces" class=headerlink href=#1-4-Classes-and-Interfaces></a>1.4. Classes and Interfaces</h3><p>The Spring Framework supports various Kotlin constructs, such as instantiating Kotlin classes through primary constructors, immutable classes data binding, and function optional parameters with default values.<p>Kotlin parameter names are recognized through a dedicated <code>KotlinReflectionParameterNameDiscoverer</code>, which allows finding interface method parameter names without requiring the Java 8 <code>-parameters</code> compiler flag to be enabled during compilation.<p>You can declare configuration classes as <a href=https://kotlinlang.org/docs/reference/nested-classes.html rel=noopener target=_blank>top level or nested but not inner</a>, since the later requires a reference to the outer class.<h3 id=1-5-Annotations><a title="1.5. Annotations" class=headerlink href=#1-5-Annotations></a>1.5. Annotations</h3><p>The Spring Framework also takes advantage of <a href=https://kotlinlang.org/docs/reference/null-safety.html rel=noopener target=_blank>Kotlin null-safety</a> to determine if an HTTP parameter is required without having to explicitly define the <code>required</code> attribute. That means <code>@RequestParam name: String?</code> is treated as not required and, conversely, <code>@RequestParam name: String</code> is treated as being required. This feature is also supported on the Spring Messaging <code>@Header</code> annotation.<p>In a similar fashion, Spring bean injection with <code>@Autowired</code>, <code>@Bean</code>, or <code>@Inject</code> uses this information to determine if a bean is required or not.<p>For example, <code>@Autowired lateinit var thing: Thing</code> implies that a bean of type <code>Thing</code> must be registered in the application context, while <code>@Autowired lateinit var thing: Thing?</code> does not raise an error if such a bean does not exist.<p>Following the same principle, <code>@Bean fun play(toy: Toy, car: Car?) = Baz(toy, Car)</code> implies that a bean of type <code>Toy</code> must be registered in the application context, while a bean of type <code>Car</code> may or may not exist. The same behavior applies to autowired constructor parameters.<table><thead><tr><th><th>If you use bean validation on classes with properties or a primary constructor parameters, you may need to use <a href=https://kotlinlang.org/docs/reference/annotations.html#annotation-use-site-targets rel=noopener target=_blank>annotation use-site targets</a>, such as <code>@field:NotNull</code> or <code>@get:Size(min=5, max=15)</code>, as described in <a href=https://stackoverflow.com/a/35853200/1092077 rel=noopener target=_blank>this Stack Overflow response</a>.<tbody><tr><td><td></table><h3 id=1-6-Bean-Definition-DSL><a title="1.6. Bean Definition DSL" class=headerlink href=#1-6-Bean-Definition-DSL></a>1.6. Bean Definition DSL</h3><p>Spring Framework supports registering beans in a functional way by using lambdas as an alternative to XML or Java configuration (<code>@Configuration</code> and <code>@Bean</code>). In a nutshell, it lets you register beans with a lambda that acts as a <code>FactoryBean</code>. This mechanism is very efficient, as it does not require any reflection or CGLIB proxies.<p>In Java, you can, for example, write the following:<figure class="highlight java"><table><tr><td class=code><pre><span class=line><span class=keyword>class</span> <span class="title class_">Foo</span> {}</span><br><span class=line></span><br><span class=line><span class=keyword>class</span> <span class="title class_">Bar</span> {</span><br><span class=line>    <span class=keyword>private</span> <span class=keyword>final</span> Foo foo;</span><br><span class=line>    <span class=keyword>public</span> <span class="title function_">Bar</span><span class=params>(Foo foo)</span> {</span><br><span class=line>        <span class=built_in>this</span>.foo = foo;</span><br><span class=line>    }</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=type>GenericApplicationContext</span> <span class=variable>context</span> <span class=operator>=</span> <span class=keyword>new</span> <span class="title class_">GenericApplicationContext</span>();</span><br><span class=line>context.registerBean(Foo.class);</span><br><span class=line>context.registerBean(Bar.class, () -> <span class=keyword>new</span> <span class="title class_">Bar</span>(context.getBean(Foo.class)));</span><br></pre></table></figure><p>In Kotlin, with reified type parameters and <code>GenericApplicationContext</code> Kotlin extensions, you can instead write the following:<figure class="highlight kotlin"><table><tr><td class=code><pre><span class=line><span class=keyword>class</span> <span class="title class_">Foo</span></span><br><span class=line></span><br><span class=line><span class=keyword>class</span> <span class="title class_">Bar</span>(<span class=keyword>private</span> <span class=keyword>val</span> foo: Foo)</span><br><span class=line></span><br><span class=line><span class=keyword>val</span> context = GenericApplicationContext().apply {</span><br><span class=line>    registerBean&LTFoo>()</span><br><span class=line>    registerBean { Bar(it.getBean()) }</span><br><span class=line>}</span><br></pre></table></figure><p>When the class <code>Bar</code> has a single constructor, you can even just specify the bean class, the constructor parameters will be autowired by type:<figure class="highlight kotlin"><table><tr><td class=code><pre><span class=line><span class=keyword>val</span> context = GenericApplicationContext().apply {</span><br><span class=line>    registerBean&LTFoo>()</span><br><span class=line>    registerBean&LTBar>()</span><br><span class=line>}</span><br></pre></table></figure><p>In order to allow a more declarative approach and cleaner syntax, Spring Framework provides a <a href=https://docs.spring.io/spring-framework/docs/5.3.10/kdoc-api/spring-framework/org.springframework.context.support/-bean-definition-dsl/ rel=noopener target=_blank>Kotlin bean definition DSL</a> It declares an <code>ApplicationContextInitializer</code> through a clean declarative API, which lets you deal with profiles and <code>Environment</code> for customizing how beans are registered.<p>In the following example notice that:<ul><li>Type inference usually allows to avoid specifying the type for bean references like <code>ref("bazBean")</code><li>It is possible to use Kotlin top level functions to declare beans using callable references like <code>bean(::myRouter)</code> in this example<li>When specifying <code>bean&LTBar>()</code> or <code>bean(::myRouter)</code>, parameters are autowired by type<li>The <code>FooBar</code> bean will be registered only if the <code>foobar</code> profile is active</ul><figure class="highlight kotlin"><table><tr><td class=code><pre><span class=line><span class=keyword>class</span> <span class="title class_">Foo</span></span><br><span class=line><span class=keyword>class</span> <span class="title class_">Bar</span>(<span class=keyword>private</span> <span class=keyword>val</span> foo: Foo)</span><br><span class=line><span class=keyword>class</span> <span class="title class_">Baz</span>(<span class=keyword>var</span> message: String = <span class=string>""</span>)</span><br><span class=line><span class=keyword>class</span> <span class="title class_">FooBar</span>(<span class=keyword>private</span> <span class=keyword>val</span> baz: Baz)</span><br><span class=line></span><br><span class=line><span class=keyword>val</span> myBeans = beans {</span><br><span class=line>    bean&LTFoo>()</span><br><span class=line>    bean&LTBar>()</span><br><span class=line>    bean(<span class=string>"bazBean"</span>) {</span><br><span class=line>        Baz().apply {</span><br><span class=line>            message = <span class=string>"Hello world"</span></span><br><span class=line>        }</span><br><span class=line>    }</span><br><span class=line>    profile(<span class=string>"foobar"</span>) {</span><br><span class=line>        bean { FooBar(ref(<span class=string>"bazBean"</span>)) }</span><br><span class=line>    }</span><br><span class=line>    bean(::myRouter)</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=function><span class=keyword>fun</span> <span class=title>myRouter</span><span class=params>(foo: <span class=type>Foo</span>, bar: <span class=type>Bar</span>, baz: <span class=type>Baz</span>)</span></span> = router {</span><br><span class=line>    <span class=comment>// ...</span></span><br><span class=line>}</span><br></pre></table></figure><table><thead><tr><th><th>This DSL is programmatic, meaning it allows custom registration logic of beans through an <code>if</code> expression, a <code>for</code> loop, or any other Kotlin constructs.<tbody><tr><td><td></table><p>You can then use this <code>beans()</code> function to register beans on the application context, as the following example shows:<figure class="highlight kotlin"><table><tr><td class=code><pre><span class=line><span class=keyword>val</span> context = GenericApplicationContext().apply {</span><br><span class=line>    myBeans.initialize(<span class=keyword>this</span>)</span><br><span class=line>    refresh()</span><br><span class=line>}</span><br></pre></table></figure><table><thead><tr><th><th>Spring Boot is based on JavaConfig and <a href=https://github.com/spring-projects/spring-boot/issues/8115 rel=noopener target=_blank>does not yet provide specific support for functional bean definition</a>, but you can experimentally use functional bean definitions through Spring Boot’s <code>ApplicationContextInitializer</code> support. See <a href=https://stackoverflow.com/questions/45935931/how-to-use-functional-bean-definition-kotlin-dsl-with-spring-boot-and-spring-w/46033685#46033685 rel=noopener target=_blank>this Stack Overflow answer</a> for more details and up-to-date information. See also the experimental Kofu DSL developed in <a href=https://github.com/spring-projects/spring-fu rel=noopener target=_blank>Spring Fu incubator</a>.<tbody><tr><td><td></table><h3 id=1-7-Web><a title="1.7. Web" class=headerlink href=#1-7-Web></a>1.7. Web</h3><h4 id=1-7-1-Router-DSL><a title="1.7.1. Router DSL" class=headerlink href=#1-7-1-Router-DSL></a>1.7.1. Router DSL</h4><p>Spring Framework comes with a Kotlin router DSL available in 3 flavors:<ul><li>WebMvc.fn DSL with <a href=https://docs.spring.io/spring-framework/docs/5.3.10/kdoc-api/spring-framework/org.springframework.web.servlet.function/router.html rel=noopener target=_blank>router { }</a><li>WebFlux.fn <a href=https://docs.spring.io/spring-framework/docs/current/reference/html/web-reactive.html#webflux-fn rel=noopener target=_blank>Reactive</a> DSL with <a href=https://docs.spring.io/spring-framework/docs/5.3.10/kdoc-api/spring-framework/org.springframework.web.reactive.function.server/router.html rel=noopener target=_blank>router { }</a><li>WebFlux.fn <a href=https://docs.spring.io/spring-framework/docs/current/reference/html/languages.html#coroutines rel=noopener target=_blank>Coroutines</a> DSL with <a href=https://docs.spring.io/spring-framework/docs/5.3.10/kdoc-api/spring-framework/org.springframework.web.reactive.function.server/co-router.html rel=noopener target=_blank>coRouter { }</a></ul><p>These DSL let you write clean and idiomatic Kotlin code to build a <code>RouterFunction</code> instance as the following example shows:<figure class="highlight kotlin"><table><tr><td class=code><pre><span class=line><span class=meta>@Configuration</span></span><br><span class=line><span class=keyword>class</span> <span class="title class_">RouterRouterConfiguration</span> {</span><br><span class=line></span><br><span class=line>    <span class=meta>@Bean</span></span><br><span class=line>    <span class=function><span class=keyword>fun</span> <span class=title>mainRouter</span><span class=params>(userHandler: <span class=type>UserHandler</span>)</span></span> = router {</span><br><span class=line>        accept(TEXT_HTML).nest {</span><br><span class=line>            GET(<span class=string>"/"</span>) { ok().render(<span class=string>"index"</span>) }</span><br><span class=line>            GET(<span class=string>"/sse"</span>) { ok().render(<span class=string>"sse"</span>) }</span><br><span class=line>            GET(<span class=string>"/users"</span>, userHandler::findAllView)</span><br><span class=line>        }</span><br><span class=line>        <span class=string>"/api"</span>.nest {</span><br><span class=line>            accept(APPLICATION_JSON).nest {</span><br><span class=line>                GET(<span class=string>"/users"</span>, userHandler::findAll)</span><br><span class=line>            }</span><br><span class=line>            accept(TEXT_EVENT_STREAM).nest {</span><br><span class=line>                GET(<span class=string>"/users"</span>, userHandler::stream)</span><br><span class=line>            }</span><br><span class=line>        }</span><br><span class=line>        resources(<span class=string>"/**"</span>, ClassPathResource(<span class=string>"static/"</span>))</span><br><span class=line>    }</span><br><span class=line>}</span><br></pre></table></figure><table><thead><tr><th><th>This DSL is programmatic, meaning that it allows custom registration logic of beans through an <code>if</code> expression, a <code>for</code> loop, or any other Kotlin constructs. That can be useful when you need to register routes depending on dynamic data (for example, from a database).<tbody><tr><td><td></table><p>See <a href=https://github.com/mixitconf/mixit/ rel=noopener target=_blank>MiXiT project</a> for a concrete example.<h4 id=1-7-2-MockMvc-DSL><a title="1.7.2. MockMvc DSL" class=headerlink href=#1-7-2-MockMvc-DSL></a>1.7.2. MockMvc DSL</h4><p>A Kotlin DSL is provided via <code>MockMvc</code> Kotlin extensions in order to provide a more idiomatic Kotlin API and to allow better discoverability (no usage of static methods).<figure class="highlight kotlin"><table><tr><td class=code><pre><span class=line><span class=keyword>val</span> mockMvc: MockMvc = ...</span><br><span class=line>mockMvc.<span class=keyword>get</span>(<span class=string>"/person/{name}"</span>, <span class=string>"Lee"</span>) {</span><br><span class=line>    secure = <span class=literal>true</span></span><br><span class=line>    accept = APPLICATION_JSON</span><br><span class=line>    headers {</span><br><span class=line>        contentLanguage = Locale.FRANCE</span><br><span class=line>    }</span><br><span class=line>    principal = Principal { <span class=string>"foo"</span> }</span><br><span class=line>}.andExpect {</span><br><span class=line>    status { isOk }</span><br><span class=line>    content { contentType(APPLICATION_JSON) }</span><br><span class=line>    jsonPath(<span class=string>"$.name"</span>) { value(<span class=string>"Lee"</span>) }</span><br><span class=line>    content { json(<span class=string>"""{"someBoolean": false}"""</span>, <span class=literal>false</span>) }</span><br><span class=line>}.andDo {</span><br><span class=line>    print()</span><br><span class=line>}</span><br></pre></table></figure><h4 id=1-7-3-Kotlin-Script-Templates><a title="1.7.3. Kotlin Script Templates" class=headerlink href=#1-7-3-Kotlin-Script-Templates></a>1.7.3. Kotlin Script Templates</h4><p>Spring Framework provides a <a href=https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/servlet/view/script/ScriptTemplateView.html rel=noopener target=_blank><code>ScriptTemplateView</code></a> which supports <a href=https://www.jcp.org/en/jsr/detail?id=223 rel=noopener target=_blank>JSR-223</a> to render templates by using script engines.<p>By leveraging <code>scripting-jsr223</code> dependencies, it is possible to use such feature to render Kotlin-based templates with <a href=https://github.com/Kotlin/kotlinx.html rel=noopener target=_blank>kotlinx.html</a> DSL or Kotlin multiline interpolated <code>String</code>.<figure class="highlight plaintext"><table><tr><td class=code><pre><span class=line>build.gradle.kts</span><br><span class=line>dependencies {</span><br><span class=line>        runtime("org.jetbrains.kotlin:kotlin-scripting-jsr223:${kotlinVersion}")</span><br><span class=line>}</span><br></pre></table></figure><p>Configuration is usually done with <code>ScriptTemplateConfigurer</code> and <code>ScriptTemplateViewResolver</code> beans.<figure class="highlight plaintext"><table><tr><td class=code><pre><span class=line>KotlinScriptConfiguration.kt</span><br><span class=line>@Configuration</span><br><span class=line>class KotlinScriptConfiguration {</span><br><span class=line></span><br><span class=line>    @Bean</span><br><span class=line>    fun kotlinScriptConfigurer() = ScriptTemplateConfigurer().apply {</span><br><span class=line>        engineName = "kotlin"</span><br><span class=line>        setScripts("scripts/render.kts")</span><br><span class=line>        renderFunction = "render"</span><br><span class=line>        isSharedEngine = false</span><br><span class=line>    }</span><br><span class=line></span><br><span class=line>    @Bean</span><br><span class=line>    fun kotlinScriptViewResolver() = ScriptTemplateViewResolver().apply {</span><br><span class=line>        setPrefix("templates/")</span><br><span class=line>        setSuffix(".kts")</span><br><span class=line>    }</span><br><span class=line>}</span><br></pre></table></figure><p>See the <a href=https://github.com/sdeleuze/kotlin-script-templating rel=noopener target=_blank>kotlin-script-templating</a> example project for more details.<h4 id=1-7-4-Kotlin-multiplatform-serialization><a title="1.7.4. Kotlin multiplatform serialization" class=headerlink href=#1-7-4-Kotlin-multiplatform-serialization></a>1.7.4. Kotlin multiplatform serialization</h4><p>As of Spring Framework 5.3, <a href=https://github.com/Kotlin/kotlinx.serialization rel=noopener target=_blank>Kotlin multiplatform serialization</a> is supported in Spring MVC, Spring WebFlux and Spring Messaging (RSocket). The builtin support currently only targets JSON format.<p>To enable it, follow <a href=https://github.com/Kotlin/kotlinx.serialization#setup rel=noopener target=_blank>those instructions</a> to add the related dependency and plugin. With Spring MVC and WebFlux, both Kotlin serialization and Jackson will be configured by default if they are in the classpath since Kotlin serialization is designed to serialize only Kotlin classes annotated with <code>@Serializable</code>. With Spring Messaging (RSocket), make sure that neither Jackson, GSON or JSONB are in the classpath if you want automatic configuration, if Jackson is needed configure <code>KotlinSerializationJsonMessageConverter</code> manually.<h3 id=1-8-Coroutines><a title="1.8. Coroutines" class=headerlink href=#1-8-Coroutines></a>1.8. Coroutines</h3><p>Kotlin <a href=https://kotlinlang.org/docs/reference/coroutines-overview.html rel=noopener target=_blank>Coroutines</a> are Kotlin lightweight threads allowing to write non-blocking code in an imperative way. On language side, suspending functions provides an abstraction for asynchronous operations while on library side <a href=https://github.com/Kotlin/kotlinx.coroutines rel=noopener target=_blank>kotlinx.coroutines</a> provides functions like <a href=https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines/async.html rel=noopener target=_blank><code>async { }</code></a> and types like <a href=https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/-flow/index.html rel=noopener target=_blank><code>Flow</code></a>.<p>Spring Framework provides support for Coroutines on the following scope:<ul><li><a href=https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines/-deferred/index.html rel=noopener target=_blank>Deferred</a> and <a href=https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/-flow/index.html rel=noopener target=_blank>Flow</a> return values support in Spring MVC and WebFlux annotated <code>@Controller</code><li>Suspending function support in Spring MVC and WebFlux annotated <code>@Controller</code><li>Extensions for WebFlux <a href=https://docs.spring.io/spring-framework/docs/5.3.10/kdoc-api/spring-framework/org.springframework.web.reactive.function.client/index.html rel=noopener target=_blank>client</a> and <a href=https://docs.spring.io/spring-framework/docs/5.3.10/kdoc-api/spring-framework/org.springframework.web.reactive.function.server/index.html rel=noopener target=_blank>server</a> functional API.<li>WebFlux.fn <a href=https://docs.spring.io/spring-framework/docs/5.3.10/kdoc-api/spring-framework/org.springframework.web.reactive.function.server/co-router.html rel=noopener target=_blank>coRouter { }</a> DSL<li>Suspending function and <code>Flow</code> support in RSocket <code>@MessageMapping</code> annotated methods<li>Extensions for <a href=https://docs.spring.io/spring-framework/docs/5.3.10/kdoc-api/spring-framework/org.springframework.messaging.rsocket/index.html rel=noopener target=_blank><code>RSocketRequester</code></a></ul><h4 id=1-8-1-Dependencies><a title="1.8.1. Dependencies" class=headerlink href=#1-8-1-Dependencies></a>1.8.1. Dependencies</h4><p>Coroutines support is enabled when <code>kotlinx-coroutines-core</code> and <code>kotlinx-coroutines-reactor</code> dependencies are in the classpath:<figure class="highlight plaintext"><table><tr><td class=code><pre><span class=line>build.gradle.kts</span><br><span class=line>dependencies {</span><br><span class=line></span><br><span class=line>    implementation("org.jetbrains.kotlinx:kotlinx-coroutines-core:${coroutinesVersion}")</span><br><span class=line>    implementation("org.jetbrains.kotlinx:kotlinx-coroutines-reactor:${coroutinesVersion}")</span><br><span class=line>}</span><br></pre></table></figure><p>Version <code>1.4.0</code> and above are supported.<h4 id=1-8-2-How-Reactive-translates-to-Coroutines><a title="1.8.2. How Reactive translates to Coroutines?" class=headerlink href=#1-8-2-How-Reactive-translates-to-Coroutines></a>1.8.2. How Reactive translates to Coroutines?</h4><p>For return values, the translation from Reactive to Coroutines APIs is the following:<ul><li><code>fun handler(): Mono&LTVoid></code> becomes <code>suspend fun handler()</code><li><code>fun handler(): Mono&LTT></code> becomes <code>suspend fun handler(): T</code> or <code>suspend fun handler(): T?</code> depending on if the <code>Mono</code> can be empty or not (with the advantage of being more statically typed)<li><code>fun handler(): Flux&LTT></code> becomes <code>fun handler(): Flow&LTT></code></ul><p>For input parameters:<ul><li>If laziness is not needed, <code>fun handler(mono: Mono&LTT>)</code> becomes <code>fun handler(value: T)</code> since a suspending functions can be invoked to get the value parameter.<li>If laziness is needed, <code>fun handler(mono: Mono&LTT>)</code> becomes <code>fun handler(supplier: suspend () → T)</code> or <code>fun handler(supplier: suspend () → T?)</code></ul><p><a href=https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/-flow/index.html rel=noopener target=_blank><code>Flow</code></a> is <code>Flux</code> equivalent in Coroutines world, suitable for hot or cold stream, finite or infinite streams, with the following main differences:<ul><li><code>Flow</code> is push-based while <code>Flux</code> is push-pull hybrid<li>Backpressure is implemented via suspending functions<li><code>Flow</code> has only a <a href=https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/-flow/collect.html rel=noopener target=_blank>single suspending <code>collect</code> method</a> and operators are implemented as <a href=https://kotlinlang.org/docs/reference/extensions.html rel=noopener target=_blank>extensions</a><li><a href=https://github.com/Kotlin/kotlinx.coroutines/tree/master/kotlinx-coroutines-core/common/src/flow/operators rel=noopener target=_blank>Operators are easy to implement</a> thanks to Coroutines<li>Extensions allow to add custom operators to <code>Flow</code><li>Collect operations are suspending functions<li><a href=https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/map.html rel=noopener target=_blank><code>map</code> operator</a> supports asynchronous operation (no need for <code>flatMap</code>) since it takes a suspending function parameter</ul><p>Read this blog post about <a href=https://spring.io/blog/2019/04/12/going-reactive-with-spring-coroutines-and-kotlin-flow rel=noopener target=_blank>Going Reactive with Spring, Coroutines and Kotlin Flow</a> for more details, including how to run code concurrently with Coroutines.<h4 id=1-8-3-Controllers><a title="1.8.3. Controllers" class=headerlink href=#1-8-3-Controllers></a>1.8.3. Controllers</h4><p>Here is an example of a Coroutines <code>@RestController</code>.<figure class="highlight kotlin"><table><tr><td class=code><pre><span class=line><span class=meta>@RestController</span></span><br><span class=line><span class=keyword>class</span> <span class="title class_">CoroutinesRestController</span>(client: WebClient, banner: Banner) {</span><br><span class=line></span><br><span class=line>    <span class=meta>@GetMapping(<span class=string>"/suspend"</span>)</span></span><br><span class=line>    <span class=keyword>suspend</span> <span class=function><span class=keyword>fun</span> <span class=title>suspendingEndpoint</span><span class=params>()</span></span>: Banner {</span><br><span class=line>        delay(<span class=number>10</span>)</span><br><span class=line>        <span class=keyword>return</span> banner</span><br><span class=line>    }</span><br><span class=line></span><br><span class=line>    <span class=meta>@GetMapping(<span class=string>"/flow"</span>)</span></span><br><span class=line>    <span class=function><span class=keyword>fun</span> <span class=title>flowEndpoint</span><span class=params>()</span></span> = flow {</span><br><span class=line>        delay(<span class=number>10</span>)</span><br><span class=line>        emit(banner)</span><br><span class=line>        delay(<span class=number>10</span>)</span><br><span class=line>        emit(banner)</span><br><span class=line>    }</span><br><span class=line></span><br><span class=line>    <span class=meta>@GetMapping(<span class=string>"/deferred"</span>)</span></span><br><span class=line>    <span class=function><span class=keyword>fun</span> <span class=title>deferredEndpoint</span><span class=params>()</span></span> = GlobalScope.async {</span><br><span class=line>        delay(<span class=number>10</span>)</span><br><span class=line>        banner</span><br><span class=line>    }</span><br><span class=line></span><br><span class=line>    <span class=meta>@GetMapping(<span class=string>"/sequential"</span>)</span></span><br><span class=line>    <span class=keyword>suspend</span> <span class=function><span class=keyword>fun</span> <span class=title>sequential</span><span class=params>()</span></span>: List&LTBanner> {</span><br><span class=line>        <span class=keyword>val</span> banner1 = client</span><br><span class=line>                .<span class=keyword>get</span>()</span><br><span class=line>                .uri(<span class=string>"/suspend"</span>)</span><br><span class=line>                .accept(MediaType.APPLICATION_JSON)</span><br><span class=line>                .awaitExchange()</span><br><span class=line>                .awaitBody&LTBanner>()</span><br><span class=line>        <span class=keyword>val</span> banner2 = client</span><br><span class=line>                .<span class=keyword>get</span>()</span><br><span class=line>                .uri(<span class=string>"/suspend"</span>)</span><br><span class=line>                .accept(MediaType.APPLICATION_JSON)</span><br><span class=line>                .awaitExchange()</span><br><span class=line>                .awaitBody&LTBanner>()</span><br><span class=line>        <span class=keyword>return</span> listOf(banner1, banner2)</span><br><span class=line>    }</span><br><span class=line></span><br><span class=line>    <span class=meta>@GetMapping(<span class=string>"/parallel"</span>)</span></span><br><span class=line>    <span class=keyword>suspend</span> <span class=function><span class=keyword>fun</span> <span class=title>parallel</span><span class=params>()</span></span>: List&LTBanner> = coroutineScope {</span><br><span class=line>        <span class=keyword>val</span> deferredBanner1: Deferred&LTBanner> = async {</span><br><span class=line>            client</span><br><span class=line>                    .<span class=keyword>get</span>()</span><br><span class=line>                    .uri(<span class=string>"/suspend"</span>)</span><br><span class=line>                    .accept(MediaType.APPLICATION_JSON)</span><br><span class=line>                    .awaitExchange()</span><br><span class=line>                    .awaitBody&LTBanner>()</span><br><span class=line>        }</span><br><span class=line>        <span class=keyword>val</span> deferredBanner2: Deferred&LTBanner> = async {</span><br><span class=line>            client</span><br><span class=line>                    .<span class=keyword>get</span>()</span><br><span class=line>                    .uri(<span class=string>"/suspend"</span>)</span><br><span class=line>                    .accept(MediaType.APPLICATION_JSON)</span><br><span class=line>                    .awaitExchange()</span><br><span class=line>                    .awaitBody&LTBanner>()</span><br><span class=line>        }</span><br><span class=line>        listOf(deferredBanner1.await(), deferredBanner2.await())</span><br><span class=line>    }</span><br><span class=line></span><br><span class=line>    <span class=meta>@GetMapping(<span class=string>"/error"</span>)</span></span><br><span class=line>    <span class=keyword>suspend</span> <span class=function><span class=keyword>fun</span> <span class=title>error</span><span class=params>()</span></span> {</span><br><span class=line>        <span class=keyword>throw</span> IllegalStateException()</span><br><span class=line>    }</span><br><span class=line></span><br><span class=line>    <span class=meta>@GetMapping(<span class=string>"/cancel"</span>)</span></span><br><span class=line>    <span class=keyword>suspend</span> <span class=function><span class=keyword>fun</span> <span class=title>cancel</span><span class=params>()</span></span> {</span><br><span class=line>        <span class=keyword>throw</span> CancellationException()</span><br><span class=line>    }</span><br><span class=line></span><br><span class=line>}</span><br></pre></table></figure><p>View rendering with a <code>@Controller</code> is also supported.<figure class="highlight kotlin"><table><tr><td class=code><pre><span class=line><span class=meta>@Controller</span></span><br><span class=line><span class=keyword>class</span> <span class="title class_">CoroutinesViewController</span>(banner: Banner) {</span><br><span class=line></span><br><span class=line>    <span class=meta>@GetMapping(<span class=string>"/"</span>)</span></span><br><span class=line>    <span class=keyword>suspend</span> <span class=function><span class=keyword>fun</span> <span class=title>render</span><span class=params>(model: <span class=type>Model</span>)</span></span>: String {</span><br><span class=line>        delay(<span class=number>10</span>)</span><br><span class=line>        model[<span class=string>"banner"</span>] = banner</span><br><span class=line>        <span class=keyword>return</span> <span class=string>"index"</span></span><br><span class=line>    }</span><br><span class=line>}</span><br></pre></table></figure><h4 id=1-8-4-WebFlux-fn><a title="1.8.4. WebFlux.fn" class=headerlink href=#1-8-4-WebFlux-fn></a>1.8.4. WebFlux.fn</h4><p>Here is an example of Coroutines router defined via the <a href=https://docs.spring.io/spring-framework/docs/5.3.10/kdoc-api/spring-framework/org.springframework.web.reactive.function.server/co-router.html rel=noopener target=_blank>coRouter { }</a> DSL and related handlers.<figure class="highlight kotlin"><table><tr><td class=code><pre><span class=line><span class=meta>@Configuration</span></span><br><span class=line><span class=keyword>class</span> <span class="title class_">RouterConfiguration</span> {</span><br><span class=line></span><br><span class=line>    <span class=meta>@Bean</span></span><br><span class=line>    <span class=function><span class=keyword>fun</span> <span class=title>mainRouter</span><span class=params>(userHandler: <span class=type>UserHandler</span>)</span></span> = coRouter {</span><br><span class=line>        GET(<span class=string>"/"</span>, userHandler::listView)</span><br><span class=line>        GET(<span class=string>"/api/user"</span>, userHandler::listApi)</span><br><span class=line>    }</span><br><span class=line>}</span><br><span class=line><span class=keyword>class</span> <span class="title class_">UserHandler</span>(builder: WebClient.Builder) {</span><br><span class=line></span><br><span class=line>    <span class=keyword>private</span> <span class=keyword>val</span> client = builder.baseUrl(<span class=string>"..."</span>).build()</span><br><span class=line></span><br><span class=line>    <span class=keyword>suspend</span> <span class=function><span class=keyword>fun</span> <span class=title>listView</span><span class=params>(request: <span class=type>ServerRequest</span>)</span></span>: ServerResponse =</span><br><span class=line>            ServerResponse.ok().renderAndAwait(<span class=string>"users"</span>, mapOf(<span class=string>"users"</span> to</span><br><span class=line>            client.<span class=keyword>get</span>().uri(<span class=string>"..."</span>).awaitExchange().awaitBody&LTUser>()))</span><br><span class=line></span><br><span class=line>    <span class=keyword>suspend</span> <span class=function><span class=keyword>fun</span> <span class=title>listApi</span><span class=params>(request: <span class=type>ServerRequest</span>)</span></span>: ServerResponse =</span><br><span class=line>                ServerResponse.ok().contentType(MediaType.APPLICATION_JSON).bodyAndAwait(</span><br><span class=line>                client.<span class=keyword>get</span>().uri(<span class=string>"..."</span>).awaitExchange().awaitBody&LTUser>())</span><br><span class=line>}</span><br></pre></table></figure><h4 id=1-8-5-Transactions><a title="1.8.5. Transactions" class=headerlink href=#1-8-5-Transactions></a>1.8.5. Transactions</h4><p>Transactions on Coroutines are supported via the programmatic variant of the Reactive transaction management provided as of Spring Framework 5.2.<p>For suspending functions, a <code>TransactionalOperator.executeAndAwait</code> extension is provided.<figure class="highlight kotlin"><table><tr><td class=code><pre><span class=line><span class=keyword>import</span> org.springframework.transaction.reactive.executeAndAwait</span><br><span class=line></span><br><span class=line><span class=keyword>class</span> <span class="title class_">PersonRepository</span>(<span class=keyword>private</span> <span class=keyword>val</span> <span class=keyword>operator</span>: TransactionalOperator) {</span><br><span class=line></span><br><span class=line>    <span class=keyword>suspend</span> <span class=function><span class=keyword>fun</span> <span class=title>initDatabase</span><span class=params>()</span></span> = <span class=keyword>operator</span>.executeAndAwait {</span><br><span class=line>        insertPerson1()</span><br><span class=line>        insertPerson2()</span><br><span class=line>    }</span><br><span class=line></span><br><span class=line>    <span class=keyword>private</span> <span class=keyword>suspend</span> <span class=function><span class=keyword>fun</span> <span class=title>insertPerson1</span><span class=params>()</span></span> {</span><br><span class=line>        <span class=comment>// INSERT SQL statement</span></span><br><span class=line>    }</span><br><span class=line></span><br><span class=line>    <span class=keyword>private</span> <span class=keyword>suspend</span> <span class=function><span class=keyword>fun</span> <span class=title>insertPerson2</span><span class=params>()</span></span> {</span><br><span class=line>        <span class=comment>// INSERT SQL statement</span></span><br><span class=line>    }</span><br><span class=line>}</span><br></pre></table></figure><p>For Kotlin <code>Flow</code>, a <code>Flow&LTT>.transactional</code> extension is provided.<figure class="highlight kotlin"><table><tr><td class=code><pre><span class=line><span class=keyword>import</span> org.springframework.transaction.reactive.transactional</span><br><span class=line></span><br><span class=line><span class=keyword>class</span> <span class="title class_">PersonRepository</span>(<span class=keyword>private</span> <span class=keyword>val</span> <span class=keyword>operator</span>: TransactionalOperator) {</span><br><span class=line></span><br><span class=line>    <span class=function><span class=keyword>fun</span> <span class=title>updatePeople</span><span class=params>()</span></span> = findPeople().map(::updatePerson).transactional(<span class=keyword>operator</span>)</span><br><span class=line></span><br><span class=line>    <span class=keyword>private</span> <span class=function><span class=keyword>fun</span> <span class=title>findPeople</span><span class=params>()</span></span>: Flow&LTPerson> {</span><br><span class=line>        <span class=comment>// SELECT SQL statement</span></span><br><span class=line>    }</span><br><span class=line></span><br><span class=line>    <span class=keyword>private</span> <span class=keyword>suspend</span> <span class=function><span class=keyword>fun</span> <span class=title>updatePerson</span><span class=params>(person: <span class=type>Person</span>)</span></span>: Person {</span><br><span class=line>        <span class=comment>// UPDATE SQL statement</span></span><br><span class=line>    }</span><br><span class=line>}</span><br></pre></table></figure><h3 id=1-9-Spring-Projects-in-Kotlin><a title="1.9. Spring Projects in Kotlin" class=headerlink href=#1-9-Spring-Projects-in-Kotlin></a>1.9. Spring Projects in Kotlin</h3><p>This section provides some specific hints and recommendations worth for developing Spring projects in Kotlin.<h4 id=1-9-1-Final-by-Default><a title="1.9.1. Final by Default" class=headerlink href=#1-9-1-Final-by-Default></a>1.9.1. Final by Default</h4><p>By default, <a href=https://discuss.kotlinlang.org/t/classes-final-by-default/166 rel=noopener target=_blank>all classes in Kotlin are <code>final</code></a>. The <code>open</code> modifier on a class is the opposite of Java’s <code>final</code>: It allows others to inherit from this class. This also applies to member functions, in that they need to be marked as <code>open</code> to be overridden.<p>While Kotlin’s JVM-friendly design is generally frictionless with Spring, this specific Kotlin feature can prevent the application from starting, if this fact is not taken into consideration. This is because Spring beans (such as <code>@Configuration</code> annotated classes which by default need to be extended at runtime for technical reasons) are normally proxied by CGLIB. The workaround is to add an <code>open</code> keyword on each class and member function of Spring beans that are proxied by CGLIB, which can quickly become painful and is against the Kotlin principle of keeping code concise and predictable.<table><thead><tr><th><th>It is also possible to avoid CGLIB proxies for configuration classes by using <code>@Configuration(proxyBeanMethods = false)</code>. See <a href=https://docs.spring.io/spring-framework/docs/5.3.10/javadoc-api/org/springframework/context/annotation/Configuration.html#proxyBeanMethods-- rel=noopener target=_blank><code>proxyBeanMethods</code> Javadoc</a> for more details.<tbody><tr><td><td></table><p>Fortunately, Kotlin provides a <a href=https://kotlinlang.org/docs/reference/compiler-plugins.html#kotlin-spring-compiler-plugin rel=noopener target=_blank><code>kotlin-spring</code></a> plugin (a preconfigured version of the <code>kotlin-allopen</code> plugin) that automatically opens classes and their member functions for types that are annotated or meta-annotated with one of the following annotations:<ul><li><code>@Component</code><li><code>@Async</code><li><code>@Transactional</code><li><code>@Cacheable</code></ul><p>Meta-annotation support means that types annotated with <code>@Configuration</code>, <code>@Controller</code>, <code>@RestController</code>, <code>@Service</code>, or <code>@Repository</code> are automatically opened since these annotations are meta-annotated with <code>@Component</code>.<p><a href=https://start.spring.io/#!language=kotlin&type=gradle-project rel=noopener target=_blank>start.spring.io</a> enables the <code>kotlin-spring</code> plugin by default. So, in practice, you can write your Kotlin beans without any additional <code>open</code> keyword, as in Java.<table><thead><tr><th><th>The Kotlin code samples in Spring Framework documentation do not explicitly specify <code>open</code> on the classes and their member functions. The samples are written for projects using the <code>kotlin-allopen</code> plugin, since this is the most commonly used setup.<tbody><tr><td><td></table><h4 id=1-9-2-Using-Immutable-Class-Instances-for-Persistence><a title="1.9.2. Using Immutable Class Instances for Persistence" class=headerlink href=#1-9-2-Using-Immutable-Class-Instances-for-Persistence></a>1.9.2. Using Immutable Class Instances for Persistence</h4><p>In Kotlin, it is convenient and considered to be a best practice to declare read-only properties within the primary constructor, as in the following example:<figure class="highlight kotlin"><table><tr><td class=code><pre><span class=line><span class=keyword>class</span> <span class="title class_">Person</span>(<span class=keyword>val</span> name: String, <span class=keyword>val</span> age: <span class=built_in>Int</span>)</span><br></pre></table></figure><p>You can optionally add <a href=https://kotlinlang.org/docs/reference/data-classes.html rel=noopener target=_blank>the <code>data</code> keyword</a> to make the compiler automatically derive the following members from all properties declared in the primary constructor:<ul><li><code>equals()</code> and <code>hashCode()</code><li><code>toString()</code> of the form <code>"User(name=John, age=42)"</code><li><code>componentN()</code> functions that correspond to the properties in their order of declaration<li><code>copy()</code> function</ul><p>As the following example shows, this allows for easy changes to individual properties, even if <code>Person</code> properties are read-only:<figure class="highlight kotlin"><table><tr><td class=code><pre><span class=line><span class=keyword>data</span> <span class=keyword>class</span> <span class="title class_">Person</span>(<span class=keyword>val</span> name: String, <span class=keyword>val</span> age: <span class=built_in>Int</span>)</span><br><span class=line></span><br><span class=line><span class=keyword>val</span> jack = Person(name = <span class=string>"Jack"</span>, age = <span class=number>1</span>)</span><br><span class=line><span class=keyword>val</span> olderJack = jack.copy(age = <span class=number>2</span>)</span><br></pre></table></figure><p>Common persistence technologies (such as JPA) require a default constructor, preventing this kind of design. Fortunately, there is a workaround for this <a href=https://stackoverflow.com/questions/32038177/kotlin-with-jpa-default-constructor-hell rel=noopener target=_blank>“default constructor hell”</a>, since Kotlin provides a <a href=https://kotlinlang.org/docs/reference/compiler-plugins.html#kotlin-jpa-compiler-plugin rel=noopener target=_blank><code>kotlin-jpa</code></a> plugin that generates synthetic no-arg constructor for classes annotated with JPA annotations.<p>If you need to leverage this kind of mechanism for other persistence technologies, you can configure the <a href=https://kotlinlang.org/docs/reference/compiler-plugins.html#how-to-use-no-arg-plugin rel=noopener target=_blank><code>kotlin-noarg</code></a> plugin.<table><thead><tr><th><th>As of the Kay release train, Spring Data supports Kotlin immutable class instances and does not require the <code>kotlin-noarg</code> plugin if the module uses Spring Data object mappings (such as MongoDB, Redis, Cassandra, and others).<tbody><tr><td><td></table><h4 id=1-9-3-Injecting-Dependencies><a title="1.9.3. Injecting Dependencies" class=headerlink href=#1-9-3-Injecting-Dependencies></a>1.9.3. Injecting Dependencies</h4><p>Our recommendation is to try to favor constructor injection with <code>val</code> read-only (and non-nullable when possible) <a href=https://kotlinlang.org/docs/reference/properties.html rel=noopener target=_blank>properties</a>, as the following example shows:<figure class="highlight kotlin"><table><tr><td class=code><pre><span class=line><span class=meta>@Component</span></span><br><span class=line><span class=keyword>class</span> <span class="title class_">YourBean</span>(</span><br><span class=line>    <span class=keyword>private</span> <span class=keyword>val</span> mongoTemplate: MongoTemplate,</span><br><span class=line>    <span class=keyword>private</span> <span class=keyword>val</span> solrClient: SolrClient</span><br><span class=line>)</span><br></pre></table></figure><table><thead><tr><th><th>Classes with a single constructor have their parameters automatically autowired. That’s why there is no need for an explicit <code>@Autowired constructor</code> in the example shown above.<tbody><tr><td><td></table><p>If you really need to use field injection, you can use the <code>lateinit var</code> construct, as the following example shows:<figure class="highlight kotlin"><table><tr><td class=code><pre><span class=line><span class=meta>@Component</span></span><br><span class=line><span class=keyword>class</span> <span class="title class_">YourBean</span> {</span><br><span class=line></span><br><span class=line>    <span class=meta>@Autowired</span></span><br><span class=line>    <span class=keyword>lateinit</span> <span class=keyword>var</span> mongoTemplate: MongoTemplate</span><br><span class=line></span><br><span class=line>    <span class=meta>@Autowired</span></span><br><span class=line>    <span class=keyword>lateinit</span> <span class=keyword>var</span> solrClient: SolrClient</span><br><span class=line>}</span><br></pre></table></figure><h4 id=1-9-4-Injecting-Configuration-Properties><a title="1.9.4. Injecting Configuration Properties" class=headerlink href=#1-9-4-Injecting-Configuration-Properties></a>1.9.4. Injecting Configuration Properties</h4><p>In Java, you can inject configuration properties by using annotations (such as <code>@Value("${property}")</code>). However, in Kotlin, <code>$</code> is a reserved character that is used for <a href=https://kotlinlang.org/docs/reference/idioms.html#string-interpolation rel=noopener target=_blank>string interpolation</a>.<p>Therefore, if you wish to use the <code>@Value</code> annotation in Kotlin, you need to escape the <code>$</code> character by writing <code>@Value("\${property}")</code>.<table><thead><tr><th><th>If you use Spring Boot, you should probably use <a href=https://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-external-config.html#boot-features-external-config-typesafe-configuration-properties rel=noopener target=_blank><code>@ConfigurationProperties</code></a> instead of <code>@Value</code> annotations.<tbody><tr><td><td></table><p>As an alternative, you can customize the property placeholder prefix by declaring the following configuration beans:<figure class="highlight kotlin"><table><tr><td class=code><pre><span class=line><span class=meta>@Bean</span></span><br><span class=line><span class=function><span class=keyword>fun</span> <span class=title>propertyConfigurer</span><span class=params>()</span></span> = PropertySourcesPlaceholderConfigurer().apply {</span><br><span class=line>    setPlaceholderPrefix(<span class=string>"%{"</span>)</span><br><span class=line>}</span><br></pre></table></figure><p>You can customize existing code (such as Spring Boot actuators or <code>@LocalServerPort</code>) that uses the <code>${…}</code> syntax, with configuration beans, as the following example shows:<figure class="highlight kotlin"><table><tr><td class=code><pre><span class=line><span class=meta>@Bean</span></span><br><span class=line><span class=function><span class=keyword>fun</span> <span class=title>kotlinPropertyConfigurer</span><span class=params>()</span></span> = PropertySourcesPlaceholderConfigurer().apply {</span><br><span class=line>    setPlaceholderPrefix(<span class=string>"%{"</span>)</span><br><span class=line>    setIgnoreUnresolvablePlaceholders(<span class=literal>true</span>)</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=meta>@Bean</span></span><br><span class=line><span class=function><span class=keyword>fun</span> <span class=title>defaultPropertyConfigurer</span><span class=params>()</span></span> = PropertySourcesPlaceholderConfigurer()</span><br></pre></table></figure><h4 id=1-9-5-Checked-Exceptions><a title="1.9.5. Checked Exceptions" class=headerlink href=#1-9-5-Checked-Exceptions></a>1.9.5. Checked Exceptions</h4><p>Java and <a href=https://kotlinlang.org/docs/reference/exceptions.html rel=noopener target=_blank>Kotlin exception handling</a> are pretty close, with the main difference being that Kotlin treats all exceptions as unchecked exceptions. However, when using proxied objects (for example classes or methods annotated with <code>@Transactional</code>), checked exceptions thrown will be wrapped by default in an <code>UndeclaredThrowableException</code>.<p>To get the original exception thrown like in Java, methods should be annotated with <a href=https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.jvm/-throws/index.html rel=noopener target=_blank><code>@Throws</code></a> to specify explicitly the checked exceptions thrown (for example <code>@Throws(IOException::class)</code>).<h4 id=1-9-6-Annotation-Array-Attributes><a title="1.9.6. Annotation Array Attributes" class=headerlink href=#1-9-6-Annotation-Array-Attributes></a>1.9.6. Annotation Array Attributes</h4><p>Kotlin annotations are mostly similar to Java annotations, but array attributes (which are extensively used in Spring) behave differently. As explained in the <a href=https://kotlinlang.org/docs/reference/annotations.html rel=noopener target=_blank>Kotlin documentation</a> you can omit the <code>value</code> attribute name, unlike other attributes, and specify it as a <code>vararg</code> parameter.<p>To understand what that means, consider <code>@RequestMapping</code> (which is one of the most widely used Spring annotations) as an example. This Java annotation is declared as follows:<figure class="highlight java"><table><tr><td class=code><pre><span class=line><span class=keyword>public</span> <span class=meta>@interface</span> RequestMapping {</span><br><span class=line></span><br><span class=line>    <span class=meta>@AliasFor("path")</span></span><br><span class=line>    String[] value() <span class=keyword>default</span> {};</span><br><span class=line></span><br><span class=line>    <span class=meta>@AliasFor("value")</span></span><br><span class=line>    String[] path() <span class=keyword>default</span> {};</span><br><span class=line></span><br><span class=line>    RequestMethod[] method() <span class=keyword>default</span> {};</span><br><span class=line></span><br><span class=line>    <span class=comment>// ...</span></span><br><span class=line>}</span><br></pre></table></figure><p>The typical use case for <code>@RequestMapping</code> is to map a handler method to a specific path and method. In Java, you can specify a single value for the annotation array attribute, and it is automatically converted to an array.<p>That is why one can write <code>@RequestMapping(value = "/toys", method = RequestMethod.GET)</code> or <code>@RequestMapping(path = "/toys", method = RequestMethod.GET)</code>.<p>However, in Kotlin, you must write <code>@RequestMapping("/toys", method = [RequestMethod.GET])</code> or <code>@RequestMapping(path = ["/toys"], method = [RequestMethod.GET])</code> (square brackets need to be specified with named array attributes).<p>An alternative for this specific <code>method</code> attribute (the most common one) is to use a shortcut annotation, such as <code>@GetMapping</code>, <code>@PostMapping</code>, and others.<table><thead><tr><th><th>If the <code>@RequestMapping</code> <code>method</code> attribute is not specified, all HTTP methods will be matched, not only the <code>GET</code> method.<tbody><tr><td><td></table><h4 id=1-9-7-Testing><a title="1.9.7. Testing" class=headerlink href=#1-9-7-Testing></a>1.9.7. Testing</h4><p>This section addresses testing with the combination of Kotlin and Spring Framework. The recommended testing framework is <a href=https://junit.org/junit5/ rel=noopener target=_blank>JUnit 5</a> along with <a href=https://mockk.io/ rel=noopener target=_blank>Mockk</a> for mocking.<table><thead><tr><th><th>If you are using Spring Boot, see <a href=https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#boot-features-kotlin-testing rel=noopener target=_blank>this related documentation</a>.<tbody><tr><td><td></table><h5 id=Constructor-injection><a title="Constructor injection" class=headerlink href=#Constructor-injection></a>Constructor injection</h5><p>As described in the <a href=https://docs.spring.io/spring-framework/docs/current/reference/html/testing.html#testcontext-junit-jupiter-di#spring-web-reactive rel=noopener target=_blank>dedicated section</a>, JUnit 5 allows constructor injection of beans which is pretty useful with Kotlin in order to use <code>val</code> instead of <code>lateinit var</code>. You can use <a href=https://docs.spring.io/spring-framework/docs/5.3.10/javadoc-api/org/springframework/test/context/TestConstructor.html rel=noopener target=_blank><code>@TestConstructor(autowireMode = AutowireMode.ALL)</code></a> to enable autowiring for all parameters.<figure class="highlight kotlin"><table><tr><td class=code><pre><span class=line><span class=meta>@SpringJUnitConfig(TestConfig::class)</span></span><br><span class=line><span class=meta>@TestConstructor(autowireMode = AutowireMode.ALL)</span></span><br><span class=line><span class=keyword>class</span> <span class="title class_">OrderServiceIntegrationTests</span>(<span class=keyword>val</span> orderService: OrderService,</span><br><span class=line>                                   <span class=keyword>val</span> customerService: CustomerService) {</span><br><span class=line></span><br><span class=line>    <span class=comment>// tests that use the injected OrderService and CustomerService</span></span><br><span class=line>}</span><br></pre></table></figure><h5 id=PER-CLASS-Lifecycle><a title="PER_CLASS Lifecycle" class=headerlink href=#PER-CLASS-Lifecycle></a><code>PER_CLASS</code> Lifecycle</h5><p>Kotlin lets you specify meaningful test function names between backticks (```). As of JUnit 5, Kotlin test classes can use the <code>@TestInstance(TestInstance.Lifecycle.PER_CLASS)</code> annotation to enable single instantiation of test classes, which allows the use of <code>@BeforeAll</code> and <code>@AfterAll</code> annotations on non-static methods, which is a good fit for Kotlin.<p>You can also change the default behavior to <code>PER_CLASS</code> thanks to a <code>junit-platform.properties</code> file with a <code>junit.jupiter.testinstance.lifecycle.default = per_class</code> property.<p>The following example demonstrates <code>@BeforeAll</code> and <code>@AfterAll</code> annotations on non-static methods:<figure class="highlight kotlin"><table><tr><td class=code><pre><span class=line><span class=meta>@TestInstance(TestInstance.Lifecycle.PER_CLASS)</span></span><br><span class=line><span class=keyword>class</span> <span class="title class_">IntegrationTests</span> {</span><br><span class=line></span><br><span class=line>  <span class=keyword>val</span> application = Application(<span class=number>8181</span>)</span><br><span class=line>  <span class=keyword>val</span> client = WebClient.create(<span class=string>"http://localhost:8181"</span>)</span><br><span class=line></span><br><span class=line>  <span class=meta>@BeforeAll</span></span><br><span class=line>  <span class=function><span class=keyword>fun</span> <span class=title>beforeAll</span><span class=params>()</span></span> {</span><br><span class=line>    application.start()</span><br><span class=line>  }</span><br><span class=line></span><br><span class=line>  <span class=meta>@Test</span></span><br><span class=line>  <span class=function><span class=keyword>fun</span> `Find all users on HTML page`<span class=params>()</span></span> {</span><br><span class=line>    client.<span class=keyword>get</span>().uri(<span class=string>"/users"</span>)</span><br><span class=line>        .accept(TEXT_HTML)</span><br><span class=line>        .retrieve()</span><br><span class=line>        .bodyToMono&LTString>()</span><br><span class=line>        .test()</span><br><span class=line>        .expectNextMatches { it.contains(<span class=string>"Foo"</span>) }</span><br><span class=line>        .verifyComplete()</span><br><span class=line>  }</span><br><span class=line></span><br><span class=line>  <span class=meta>@AfterAll</span></span><br><span class=line>  <span class=function><span class=keyword>fun</span> <span class=title>afterAll</span><span class=params>()</span></span> {</span><br><span class=line>    application.stop()</span><br><span class=line>  }</span><br><span class=line>}</span><br></pre></table></figure><h5 id=Specification-like-Tests><a title="Specification-like Tests" class=headerlink href=#Specification-like-Tests></a>Specification-like Tests</h5><p>You can create specification-like tests with JUnit 5 and Kotlin. The following example shows how to do so:<figure class="highlight kotlin"><table><tr><td class=code><pre><span class=line><span class=keyword>class</span> <span class="title class_">SpecificationLikeTests</span> {</span><br><span class=line></span><br><span class=line>  <span class=meta>@Nested</span></span><br><span class=line>  <span class=meta>@DisplayName(<span class=string>"a calculator"</span>)</span></span><br><span class=line>  <span class=keyword>inner</span> <span class=keyword>class</span> <span class="title class_">Calculator</span> {</span><br><span class=line>     <span class=keyword>val</span> calculator = SampleCalculator()</span><br><span class=line></span><br><span class=line>     <span class=meta>@Test</span></span><br><span class=line>     <span class=function><span class=keyword>fun</span> `should return the result of adding the first number to the second number`<span class=params>()</span></span> {</span><br><span class=line>        <span class=keyword>val</span> sum = calculator.sum(<span class=number>2</span>, <span class=number>4</span>)</span><br><span class=line>        assertEquals(<span class=number>6</span>, sum)</span><br><span class=line>     }</span><br><span class=line></span><br><span class=line>     <span class=meta>@Test</span></span><br><span class=line>     <span class=function><span class=keyword>fun</span> `should return the result of subtracting the second number from the first number`<span class=params>()</span></span> {</span><br><span class=line>        <span class=keyword>val</span> subtract = calculator.subtract(<span class=number>4</span>, <span class=number>2</span>)</span><br><span class=line>        assertEquals(<span class=number>2</span>, subtract)</span><br><span class=line>     }</span><br><span class=line>  }</span><br><span class=line>}</span><br></pre></table></figure><h5 id=WebTestClient-Type-Inference-Issue-in-Kotlin><a title="WebTestClient Type Inference Issue in Kotlin" class=headerlink href=#WebTestClient-Type-Inference-Issue-in-Kotlin></a><code>WebTestClient</code> Type Inference Issue in Kotlin</h5><p>Due to a <a href=https://youtrack.jetbrains.com/issue/KT-5464 rel=noopener target=_blank>type inference issue</a>, you must use the Kotlin <code>expectBody</code> extension (such as <code>.expectBody&LTString>().isEqualTo("toys")</code>), since it provides a workaround for the Kotlin issue with the Java API.<p>See also the related <a href=https://jira.spring.io/browse/SPR-16057 rel=noopener target=_blank>SPR-16057</a> issue.<h3 id=1-10-Getting-Started><a title="1.10. Getting Started" class=headerlink href=#1-10-Getting-Started></a>1.10. Getting Started</h3><p>The easiest way to learn how to build a Spring application with Kotlin is to follow <a href=https://spring.io/guides/tutorials/spring-boot-kotlin/ rel=noopener target=_blank>the dedicated tutorial</a>.<h4 id=1-10-1-start-spring-io><a title="1.10.1. start.spring.io" class=headerlink href=#1-10-1-start-spring-io></a>1.10.1. <code>start.spring.io</code></h4><p>The easiest way to start a new Spring Framework project in Kotlin is to create a new Spring Boot 2 project on <a href=https://start.spring.io/#!language=kotlin&type=gradle-project rel=noopener target=_blank>start.spring.io</a>.<h4 id=1-10-2-Choosing-the-Web-Flavor><a title="1.10.2. Choosing the Web Flavor" class=headerlink href=#1-10-2-Choosing-the-Web-Flavor></a>1.10.2. Choosing the Web Flavor</h4><p>Spring Framework now comes with two different web stacks: <a href=https://docs.spring.io/spring-framework/docs/current/reference/html/web.html#mvc rel=noopener target=_blank>Spring MVC</a> and <a href=https://docs.spring.io/spring-framework/docs/current/reference/html/web-reactive.html#spring-web-reactive rel=noopener target=_blank>Spring WebFlux</a>.<p>Spring WebFlux is recommended if you want to create applications that will deal with latency, long-lived connections, streaming scenarios or if you want to use the web functional Kotlin DSL.<p>For other use cases, especially if you are using blocking technologies such as JPA, Spring MVC and its annotation-based programming model is the recommended choice.<h3 id=1-11-Resources><a title="1.11. Resources" class=headerlink href=#1-11-Resources></a>1.11. Resources</h3><p>We recommend the following resources for people learning how to build applications with Kotlin and the Spring Framework:<ul><li><a href=https://kotlinlang.org/docs/reference/ rel=noopener target=_blank>Kotlin language reference</a><li><a href=https://slack.kotlinlang.org/ rel=noopener target=_blank>Kotlin Slack</a> (with a dedicated #spring channel)<li><a href=https://stackoverflow.com/questions/tagged/spring+kotlin rel=noopener target=_blank>Stackoverflow, with <code>spring</code> and <code>kotlin</code> tags</a><li><a href=https://play.kotlinlang.org/ rel=noopener target=_blank>Try Kotlin in your browser</a><li><a href=https://blog.jetbrains.com/kotlin/ rel=noopener target=_blank>Kotlin blog</a><li><a href=https://kotlin.link/ rel=noopener target=_blank>Awesome Kotlin</a></ul><h4 id=1-11-1-Examples><a title="1.11.1. Examples" class=headerlink href=#1-11-1-Examples></a>1.11.1. Examples</h4><p>The following Github projects offer examples that you can learn from and possibly even extend:<ul><li><a href=https://github.com/sdeleuze/spring-boot-kotlin-demo rel=noopener target=_blank>spring-boot-kotlin-demo</a>: Regular Spring Boot and Spring Data JPA project<li><a href=https://github.com/mixitconf/mixit rel=noopener target=_blank>mixit</a>: Spring Boot 2, WebFlux, and Reactive Spring Data MongoDB<li><a href=https://github.com/sdeleuze/spring-kotlin-functional rel=noopener target=_blank>spring-kotlin-functional</a>: Standalone WebFlux and functional bean definition DSL<li><a href=https://github.com/sdeleuze/spring-kotlin-fullstack rel=noopener target=_blank>spring-kotlin-fullstack</a>: WebFlux Kotlin fullstack example with Kotlin2js for frontend instead of JavaScript or TypeScript<li><a href=https://github.com/spring-petclinic/spring-petclinic-kotlin rel=noopener target=_blank>spring-petclinic-kotlin</a>: Kotlin version of the Spring PetClinic Sample Application<li><a href=https://github.com/sdeleuze/spring-kotlin-deepdive rel=noopener target=_blank>spring-kotlin-deepdive</a>: A step-by-step migration guide for Boot 1.0 and Java to Boot 2.0 and Kotlin<li><a href=https://github.com/spring-cloud/spring-cloud-gcp/tree/master/spring-cloud-gcp-kotlin-samples/spring-cloud-gcp-kotlin-app-sample rel=noopener target=_blank>spring-cloud-gcp-kotlin-app-sample</a>: Spring Boot with Google Cloud Platform Integrations</ul><h4 id=1-11-2-Issues><a title="1.11.2. Issues" class=headerlink href=#1-11-2-Issues></a>1.11.2. Issues</h4><p>The following list categorizes the pending issues related to Spring and Kotlin support:<ul><li>Spring Framework<ul><li><a href=https://github.com/spring-projects/spring-framework/issues/20606 rel=noopener target=_blank>Unable to use WebTestClient with mock server in Kotlin</a><li><a href=https://github.com/spring-projects/spring-framework/issues/20496 rel=noopener target=_blank>Support null-safety at generics, varargs and array elements level</a></ul><li>Kotlin<ul><li><a href=https://youtrack.jetbrains.com/issue/KT-6380 rel=noopener target=_blank>Parent issue for Spring Framework support</a><li><a href=https://youtrack.jetbrains.com/issue/KT-5464 rel=noopener target=_blank>Kotlin requires type inference where Java doesn’t</a><li><a href=https://youtrack.jetbrains.com/issue/KT-20283 rel=noopener target=_blank>Smart cast regression with open classes</a><li><a href=https://youtrack.jetbrains.com/issue/KT-14984 rel=noopener target=_blank>Impossible to pass not all SAM argument as function</a><li><a href=https://youtrack.jetbrains.com/issue/KT-15125 rel=noopener target=_blank>Support JSR 223 bindings directly via script variables</a><li><a href=https://youtrack.jetbrains.com/issue/KT-6653 rel=noopener target=_blank>Kotlin properties do not override Java-style getters and setters</a></ul></ul><h2 id=2-Apache-Groovy><a title="2. Apache Groovy" class=headerlink href=#2-Apache-Groovy></a>2. Apache Groovy</h2><p>Groovy is a powerful, optionally typed, and dynamic language, with static-typing and static compilation capabilities. It offers a concise syntax and integrates smoothly with any existing Java application.<p>The Spring Framework provides a dedicated <code>ApplicationContext</code> that supports a Groovy-based Bean Definition DSL. For more details, see <a href=https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#groovy-bean-definition-dsl rel=noopener target=_blank>The Groovy Bean Definition DSL</a>.<p>Further support for Groovy, including beans written in Groovy, refreshable script beans, and more is available in <a href=https://docs.spring.io/spring-framework/docs/current/reference/html/languages.html#dynamic-language rel=noopener target=_blank>Dynamic Language Support</a>.<h2 id=3-Dynamic-Language-Support><a title="3. Dynamic Language Support" class=headerlink href=#3-Dynamic-Language-Support></a>3. Dynamic Language Support</h2><p>Spring provides comprehensive support for using classes and objects that have been defined by using a dynamic language (such as Groovy) with Spring. This support lets you write any number of classes in a supported dynamic language and have the Spring container transparently instantiate, configure, and dependency inject the resulting objects.<p>Spring’s scripting support primarily targets Groovy and BeanShell. Beyond those specifically supported languages, the JSR-223 scripting mechanism is supported for integration with any JSR-223 capable language provider (as of Spring 4.2), e.g. JRuby.<p>You can find fully working examples of where this dynamic language support can be immediately useful in <a href=https://docs.spring.io/spring-framework/docs/current/reference/html/languages.html#dynamic-language-scenarios rel=noopener target=_blank>Scenarios</a>.<h3 id=3-1-A-First-Example><a title="3.1. A First Example" class=headerlink href=#3-1-A-First-Example></a>3.1. A First Example</h3><p>The bulk of this chapter is concerned with describing the dynamic language support in detail. Before diving into all of the ins and outs of the dynamic language support, we look at a quick example of a bean defined in a dynamic language. The dynamic language for this first bean is Groovy. (The basis of this example was taken from the Spring test suite. If you want to see equivalent examples in any of the other supported languages, take a look at the source code).<p>The next example shows the <code>Messenger</code> interface, which the Groovy bean is going to implement. Note that this interface is defined in plain Java. Dependent objects that are injected with a reference to the <code>Messenger</code> do not know that the underlying implementation is a Groovy script. The following listing shows the <code>Messenger</code> interface:<figure class="highlight java"><table><tr><td class=code><pre><span class=line><span class=keyword>package</span> org.springframework.scripting;</span><br><span class=line></span><br><span class=line><span class=keyword>public</span> <span class=keyword>interface</span> <span class="title class_">Messenger</span> {</span><br><span class=line></span><br><span class=line>    String <span class="title function_">getMessage</span><span class=params>()</span>;</span><br><span class=line>}</span><br></pre></table></figure><p>The following example defines a class that has a dependency on the <code>Messenger</code> interface:<figure class="highlight java"><table><tr><td class=code><pre><span class=line><span class=keyword>package</span> org.springframework.scripting;</span><br><span class=line></span><br><span class=line><span class=keyword>public</span> <span class=keyword>class</span> <span class="title class_">DefaultBookingService</span> <span class=keyword>implements</span> <span class="title class_">BookingService</span> {</span><br><span class=line></span><br><span class=line>    <span class=keyword>private</span> Messenger messenger;</span><br><span class=line></span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">setMessenger</span><span class=params>(Messenger messenger)</span> {</span><br><span class=line>        <span class=built_in>this</span>.messenger = messenger;</span><br><span class=line>    }</span><br><span class=line></span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">processBooking</span><span class=params>()</span> {</span><br><span class=line>        <span class=comment>// use the injected Messenger object...</span></span><br><span class=line>    }</span><br><span class=line>}</span><br></pre></table></figure><p>The following example implements the <code>Messenger</code> interface in Groovy:<figure class="highlight groovy"><table><tr><td class=code><pre><span class=line><span class=comment>// from the file 'Messenger.groovy'</span></span><br><span class=line><span class=keyword>package</span> org.springframework.scripting.groovy;</span><br><span class=line></span><br><span class=line><span class=comment>// import the Messenger interface (written in Java) that is to be implemented</span></span><br><span class=line><span class=keyword>import</span> org.springframework.scripting.Messenger</span><br><span class=line></span><br><span class=line><span class=comment>// define the implementation in Groovy</span></span><br><span class=line><span class=keyword>class</span> <span class="title class_">GroovyMessenger</span> <span class=keyword>implements</span> <span class="title class_">Messenger</span> {</span><br><span class=line></span><br><span class=line>    String message</span><br><span class=line>}</span><br></pre></table></figure><table><thead><tr><th><th>To use the custom dynamic language tags to define dynamic-language-backed beans, you need to have the XML Schema preamble at the top of your Spring XML configuration file. You also need to use a Spring <code>ApplicationContext</code> implementation as your IoC container. Using the dynamic-language-backed beans with a plain <code>BeanFactory</code> implementation is supported, but you have to manage the plumbing of the Spring internals to do so.For more information on schema-based configuration, see <a href=https://docs.spring.io/spring-framework/docs/current/reference/html/languages.html#xsd-schemas-lang rel=noopener target=_blank>XML Schema-based Configuration</a>.<tbody><tr><td><td></table><p>Finally, the following example shows the bean definitions that effect the injection of the Groovy-defined <code>Messenger</code> implementation into an instance of the <code>DefaultBookingService</code> class:<figure class="highlight xml"><table><tr><td class=code><pre><span class=line><span class=meta>&LT?xml version=<span class=string>"1.0"</span> encoding=<span class=string>"UTF-8"</span>?></span></span><br><span class=line><span class=tag><<span class=name>beans</span> <span class=attr>xmlns</span>=<span class=string>"http://www.springframework.org/schema/beans"</span> <span class=attr>xmlns:xsi</span>=<span class=string>"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class=line><span class=tag>    <span class=attr>xmlns:lang</span>=<span class=string>"http://www.springframework.org/schema/lang"</span></span></span><br><span class=line><span class=tag>    <span class=attr>xsi:schemaLocation</span>=<span class=string>"</span></span></span><br><span class=line><span class=string><span class=tag>        http://www.springframework.org/schema/beans https://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class=line><span class=string><span class=tag>        http://www.springframework.org/schema/lang https://www.springframework.org/schema/lang/spring-lang.xsd"</span>></span></span><br><span class=line></span><br><span class=line>    <span class=comment>&LT!-- this is the bean definition for the Groovy-backed Messenger implementation --></span></span><br><span class=line>    <span class=tag><<span class=name>lang:groovy</span> <span class=attr>id</span>=<span class=string>"messenger"</span> <span class=attr>script-source</span>=<span class=string>"classpath:Messenger.groovy"</span>></span></span><br><span class=line>        <span class=tag><<span class=name>lang:property</span> <span class=attr>name</span>=<span class=string>"message"</span> <span class=attr>value</span>=<span class=string>"I Can Do The Frug"</span> /></span></span><br><span class=line>    <span class=tag>&LT/<span class=name>lang:groovy</span>></span></span><br><span class=line></span><br><span class=line>    <span class=comment>&LT!-- an otherwise normal bean that will be injected by the Groovy-backed Messenger --></span></span><br><span class=line>    <span class=tag><<span class=name>bean</span> <span class=attr>id</span>=<span class=string>"bookingService"</span> <span class=attr>class</span>=<span class=string>"x.y.DefaultBookingService"</span>></span></span><br><span class=line>        <span class=tag><<span class=name>property</span> <span class=attr>name</span>=<span class=string>"messenger"</span> <span class=attr>ref</span>=<span class=string>"messenger"</span> /></span></span><br><span class=line>    <span class=tag>&LT/<span class=name>bean</span>></span></span><br><span class=line></span><br><span class=line><span class=tag>&LT/<span class=name>beans</span>></span></span><br></pre></table></figure><p>The <code>bookingService</code> bean (a <code>DefaultBookingService</code>) can now use its private <code>messenger</code> member variable as normal, because the <code>Messenger</code> instance that was injected into it is a <code>Messenger</code> instance. There is nothing special going on here — just plain Java and plain Groovy.<p>Hopefully, the preceding XML snippet is self-explanatory, but do not worry unduly if it is not. Keep reading for the in-depth detail on the whys and wherefores of the preceding configuration.<h3 id=3-2-Defining-Beans-that-Are-Backed-by-Dynamic-Languages><a title="3.2. Defining Beans that Are Backed by Dynamic Languages" class=headerlink href=#3-2-Defining-Beans-that-Are-Backed-by-Dynamic-Languages></a>3.2. Defining Beans that Are Backed by Dynamic Languages</h3><p>This section describes exactly how you define Spring-managed beans in any of the supported dynamic languages.<p>Note that this chapter does not attempt to explain the syntax and idioms of the supported dynamic languages. For example, if you want to use Groovy to write certain of the classes in your application, we assume that you already know Groovy. If you need further details about the dynamic languages themselves, see <a href=https://docs.spring.io/spring-framework/docs/current/reference/html/languages.html#dynamic-language-resources rel=noopener target=_blank>Further Resources</a> at the end of this chapter.<h4 id=3-2-1-Common-Concepts><a title="3.2.1. Common Concepts" class=headerlink href=#3-2-1-Common-Concepts></a>3.2.1. Common Concepts</h4><p>The steps involved in using dynamic-language-backed beans are as follows:<ol><li>Write the test for the dynamic language source code (naturally).<li>Then write the dynamic language source code itself.<li>Define your dynamic-language-backed beans by using the appropriate <code>&LTlang:language/></code> element in the XML configuration (you can define such beans programmatically by using the Spring API, although you will have to consult the source code for directions on how to do this, as this chapter does not cover this type of advanced configuration). Note that this is an iterative step. You need at least one bean definition for each dynamic language source file (although multiple bean definitions can reference the same source file).</ol><p>The first two steps (testing and writing your dynamic language source files) are beyond the scope of this chapter. See the language specification and reference manual for your chosen dynamic language and crack on with developing your dynamic language source files. You first want to read the rest of this chapter, though, as Spring’s dynamic language support does make some (small) assumptions about the contents of your dynamic language source files.<h5 id=The-lang-language-element><a title="The lang:language/ element" class=headerlink href=#The-lang-language-element></a>The <a href=lang:language/>lang:language/</a> element</h5><p>The final step in the list in the <a href=https://docs.spring.io/spring-framework/docs/current/reference/html/languages.html#dynamic-language-beans-concepts rel=noopener target=_blank>preceding section</a> involves defining dynamic-language-backed bean definitions, one for each bean that you want to configure (this is no different from normal JavaBean configuration). However, instead of specifying the fully qualified class name of the class that is to be instantiated and configured by the container, you can use the <code>&LTlang:language/></code> element to define the dynamic language-backed bean.<p>Each of the supported languages has a corresponding <code>&LTlang:language/></code> element:<ul><li><code>&LTlang:groovy/></code> (Groovy)<li><code>&LTlang:bsh/></code> (BeanShell)<li><code>&LTlang:std/></code> (JSR-223, e.g. with JRuby)</ul><p>The exact attributes and child elements that are available for configuration depends on exactly which language the bean has been defined in (the language-specific sections later in this chapter detail this).<h5 id=Refreshable-Beans><a title="Refreshable Beans" class=headerlink href=#Refreshable-Beans></a>Refreshable Beans</h5><p>One of the (and perhaps the single) most compelling value adds of the dynamic language support in Spring is the “refreshable bean” feature.<p>A refreshable bean is a dynamic-language-backed bean. With a small amount of configuration, a dynamic-language-backed bean can monitor changes in its underlying source file resource and then reload itself when the dynamic language source file is changed (for example, when you edit and save changes to the file on the file system).<p>This lets you deploy any number of dynamic language source files as part of an application, configure the Spring container to create beans backed by dynamic language source files (using the mechanisms described in this chapter), and (later, as requirements change or some other external factor comes into play) edit a dynamic language source file and have any change they make be reflected in the bean that is backed by the changed dynamic language source file. There is no need to shut down a running application (or redeploy in the case of a web application). The dynamic-language-backed bean so amended picks up the new state and logic from the changed dynamic language source file.<table><thead><tr><th><th>This feature is off by default.<tbody><tr><td><td></table><p>Now we can take a look at an example to see how easy it is to start using refreshable beans. To turn on the refreshable beans feature, you have to specify exactly one additional attribute on the <code>&LTlang:language/></code> element of your bean definition. So, if we stick with <a href=https://docs.spring.io/spring-framework/docs/current/reference/html/languages.html#dynamic-language-a-first-example rel=noopener target=_blank>the example</a> from earlier in this chapter, the following example shows what we would change in the Spring XML configuration to effect refreshable beans:<figure class="highlight xml"><table><tr><td class=code><pre><span class=line><span class=tag><<span class=name>beans</span>></span></span><br><span class=line></span><br><span class=line>    <span class=comment>&LT!-- this bean is now 'refreshable' due to the presence of the 'refresh-check-delay' attribute --></span></span><br><span class=line>    <span class=tag><<span class=name>lang:groovy</span> <span class=attr>id</span>=<span class=string>"messenger"</span></span></span><br><span class=line><span class=tag>            <span class=attr>refresh-check-delay</span>=<span class=string>"5000"</span> &LT!<span class=attr>--</span> <span class=attr>switches</span> <span class=attr>refreshing</span> <span class=attr>on</span> <span class=attr>with</span> <span class=attr>5</span> <span class=attr>seconds</span> <span class=attr>between</span> <span class=attr>checks</span> <span class=attr>--</span>></span></span><br><span class=line>            script-source="classpath:Messenger.groovy"></span><br><span class=line>        <span class=tag><<span class=name>lang:property</span> <span class=attr>name</span>=<span class=string>"message"</span> <span class=attr>value</span>=<span class=string>"I Can Do The Frug"</span> /></span></span><br><span class=line>    <span class=tag>&LT/<span class=name>lang:groovy</span>></span></span><br><span class=line></span><br><span class=line>    <span class=tag><<span class=name>bean</span> <span class=attr>id</span>=<span class=string>"bookingService"</span> <span class=attr>class</span>=<span class=string>"x.y.DefaultBookingService"</span>></span></span><br><span class=line>        <span class=tag><<span class=name>property</span> <span class=attr>name</span>=<span class=string>"messenger"</span> <span class=attr>ref</span>=<span class=string>"messenger"</span> /></span></span><br><span class=line>    <span class=tag>&LT/<span class=name>bean</span>></span></span><br><span class=line></span><br><span class=line><span class=tag>&LT/<span class=name>beans</span>></span></span><br></pre></table></figure><p>That really is all you have to do. The <code>refresh-check-delay</code> attribute defined on the <code>messenger</code> bean definition is the number of milliseconds after which the bean is refreshed with any changes made to the underlying dynamic language source file. You can turn off the refresh behavior by assigning a negative value to the <code>refresh-check-delay</code> attribute. Remember that, by default, the refresh behavior is disabled. If you do not want the refresh behavior, do not define the attribute.<p>If we then run the following application, we can exercise the refreshable feature. (Please excuse the “jumping-through-hoops-to-pause-the-execution” shenanigans in this next slice of code.) The <code>System.in.read()</code> call is only there so that the execution of the program pauses while you (the developer in this scenario) go off and edit the underlying dynamic language source file so that the refresh triggers on the dynamic-language-backed bean when the program resumes execution.<p>The following listing shows this sample application:<figure class="highlight java"><table><tr><td class=code><pre><span class=line><span class=keyword>import</span> org.springframework.context.ApplicationContext;</span><br><span class=line><span class=keyword>import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class=line><span class=keyword>import</span> org.springframework.scripting.Messenger;</span><br><span class=line></span><br><span class=line><span class=keyword>public</span> <span class=keyword>final</span> <span class=keyword>class</span> <span class="title class_">Boot</span> {</span><br><span class=line></span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>static</span> <span class=keyword>void</span> <span class="title function_">main</span><span class=params>(<span class=keyword>final</span> String[] args)</span> <span class=keyword>throws</span> Exception {</span><br><span class=line>        <span class=type>ApplicationContext</span> <span class=variable>ctx</span> <span class=operator>=</span> <span class=keyword>new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class=string>"beans.xml"</span>);</span><br><span class=line>        <span class=type>Messenger</span> <span class=variable>messenger</span> <span class=operator>=</span> (Messenger) ctx.getBean(<span class=string>"messenger"</span>);</span><br><span class=line>        System.out.println(messenger.getMessage());</span><br><span class=line>        <span class=comment>// pause execution while I go off and make changes to the source file...</span></span><br><span class=line>        System.in.read();</span><br><span class=line>        System.out.println(messenger.getMessage());</span><br><span class=line>    }</span><br><span class=line>}</span><br></pre></table></figure><p>Assume then, for the purposes of this example, that all calls to the <code>getMessage()</code> method of <code>Messenger</code> implementations have to be changed such that the message is surrounded by quotation marks. The following listing shows the changes that you (the developer) should make to the <code>Messenger.groovy</code> source file when the execution of the program is paused:<figure class="highlight groovy"><table><tr><td class=code><pre><span class=line><span class=keyword>package</span> org.springframework.scripting</span><br><span class=line></span><br><span class=line><span class=keyword>class</span> <span class="title class_">GroovyMessenger</span> <span class=keyword>implements</span> <span class="title class_">Messenger</span> {</span><br><span class=line></span><br><span class=line>    <span class=keyword>private</span> String message = <span class=string>"Bingo"</span></span><br><span class=line></span><br><span class=line>    <span class=keyword>public</span> String getMessage() {</span><br><span class=line>        <span class=comment>// change the implementation to surround the message in quotes</span></span><br><span class=line>        <span class=keyword>return</span> <span class=string>"'"</span> + <span class="variable language_">this</span>.message + <span class=string>"'"</span></span><br><span class=line>    }</span><br><span class=line></span><br><span class=line>    <span class=keyword>public</span> <span class=type>void</span> setMessage(String message) {</span><br><span class=line>        <span class="variable language_">this</span>.message = message</span><br><span class=line>    }</span><br><span class=line>}</span><br></pre></table></figure><p>When the program runs, the output before the input pause will be <code>I Can Do The Frug</code>. After the change to the source file is made and saved and the program resumes execution, the result of calling the <code>getMessage()</code> method on the dynamic-language-backed <code>Messenger</code> implementation is <code>'I Can Do The Frug'</code> (notice the inclusion of the additional quotation marks).<p>Changes to a script do not trigger a refresh if the changes occur within the window of the <code>refresh-check-delay</code> value. Changes to the script are not actually picked up until a method is called on the dynamic-language-backed bean. It is only when a method is called on a dynamic-language-backed bean that it checks to see if its underlying script source has changed. Any exceptions that relate to refreshing the script (such as encountering a compilation error or finding that the script file has been deleted) results in a fatal exception being propagated to the calling code.<p>The refreshable bean behavior described earlier does not apply to dynamic language source files defined with the <code>&LTlang:inline-script/></code> element notation (see <a href=https://docs.spring.io/spring-framework/docs/current/reference/html/languages.html#dynamic-language-beans-inline rel=noopener target=_blank>Inline Dynamic Language Source Files</a>). Additionally, it applies only to beans where changes to the underlying source file can actually be detected (for example, by code that checks the last modified date of a dynamic language source file that exists on the file system).<h5 id=Inline-Dynamic-Language-Source-Files><a title="Inline Dynamic Language Source Files" class=headerlink href=#Inline-Dynamic-Language-Source-Files></a>Inline Dynamic Language Source Files</h5><p>The dynamic language support can also cater to dynamic language source files that are embedded directly in Spring bean definitions. More specifically, the <code>&LTlang:inline-script/></code> element lets you define dynamic language source immediately inside a Spring configuration file. An example might clarify how the inline script feature works:<figure class="highlight xml"><table><tr><td class=code><pre><span class=line><span class=tag><<span class=name>lang:groovy</span> <span class=attr>id</span>=<span class=string>"messenger"</span>></span></span><br><span class=line>    <span class=tag><<span class=name>lang:inline-script</span>></span></span><br><span class=line></span><br><span class=line>package org.springframework.scripting.groovy;</span><br><span class=line></span><br><span class=line>import org.springframework.scripting.Messenger</span><br><span class=line></span><br><span class=line>class GroovyMessenger implements Messenger {</span><br><span class=line>    String message</span><br><span class=line>}</span><br><span class=line></span><br><span class=line>    <span class=tag>&LT/<span class=name>lang:inline-script</span>></span></span><br><span class=line>    <span class=tag><<span class=name>lang:property</span> <span class=attr>name</span>=<span class=string>"message"</span> <span class=attr>value</span>=<span class=string>"I Can Do The Frug"</span> /></span></span><br><span class=line><span class=tag>&LT/<span class=name>lang:groovy</span>></span></span><br></pre></table></figure><p>If we put to one side the issues surrounding whether it is good practice to define dynamic language source inside a Spring configuration file, the <code>&LTlang:inline-script/></code> element can be useful in some scenarios. For instance, we might want to quickly add a Spring <code>Validator</code> implementation to a Spring MVC <code>Controller</code>. This is but a moment’s work using inline source. (See <a href=https://docs.spring.io/spring-framework/docs/current/reference/html/languages.html#dynamic-language-scenarios-validators rel=noopener target=_blank>Scripted Validators</a> for such an example.)<h5 id=Understanding-Constructor-Injection-in-the-Context-of-Dynamic-language-backed-Beans><a title="Understanding Constructor Injection in the Context of Dynamic-language-backed Beans" class=headerlink href=#Understanding-Constructor-Injection-in-the-Context-of-Dynamic-language-backed-Beans></a>Understanding Constructor Injection in the Context of Dynamic-language-backed Beans</h5><p>There is one very important thing to be aware of with regard to Spring’s dynamic language support. Namely, you can not (currently) supply constructor arguments to dynamic-language-backed beans (and, hence, constructor-injection is not available for dynamic-language-backed beans). In the interests of making this special handling of constructors and properties 100% clear, the following mixture of code and configuration does not work:<p>An approach that cannot work<figure class="highlight groovy"><table><tr><td class=code><pre><span class=line><span class=comment>// from the file 'Messenger.groovy'</span></span><br><span class=line><span class=keyword>package</span> org.springframework.scripting.groovy;</span><br><span class=line></span><br><span class=line><span class=keyword>import</span> org.springframework.scripting.Messenger</span><br><span class=line></span><br><span class=line><span class=keyword>class</span> <span class="title class_">GroovyMessenger</span> <span class=keyword>implements</span> <span class="title class_">Messenger</span> {</span><br><span class=line></span><br><span class=line>    GroovyMessenger() {}</span><br><span class=line></span><br><span class=line>    <span class=comment>// this constructor is not available for Constructor Injection</span></span><br><span class=line>    GroovyMessenger(String message) {</span><br><span class=line>        <span class="variable language_">this</span>.message = message;</span><br><span class=line>    }</span><br><span class=line></span><br><span class=line>    String message</span><br><span class=line></span><br><span class=line>    String anotherMessage</span><br><span class=line>}</span><br><span class=line><<span class=attr>lang:</span>groovy id=<span class=string>"badMessenger"</span></span><br><span class=line>    script-source=<span class=string>"classpath:Messenger.groovy"</span>></span><br><span class=line>    &LT!-- <span class="variable language_">this</span> next constructor argument will not be injected into the GroovyMessenger --></span><br><span class=line>    &LT!-- <span class=keyword>in</span> fact, <span class="variable language_">this</span> isn<span class=string>'t even allowed according to the schema --></span></span><br><span class=line><span class=string>    &LTconstructor-arg value="This will not work" /></span></span><br><span class=line><span class=string></span></span><br><span class=line><span class=string>    &LT!-- only property values are injected into the dynamic-language-backed object --></span></span><br><span class=line><span class=string>    &LTlang:property name="anotherMessage" value="Passed straight through to the dynamic-language-backed object" /></span></span><br><span class=line><span class=string></span></span><br><span class=line><span class=string>&LT/lang></span></span><br></pre></table></figure><p>In practice this limitation is not as significant as it first appears, since setter injection is the injection style favored by the overwhelming majority of developers (we leave the discussion as to whether that is a good thing to another day).<h4 id=3-2-2-Groovy-Beans><a title="3.2.2. Groovy Beans" class=headerlink href=#3-2-2-Groovy-Beans></a>3.2.2. Groovy Beans</h4><p>This section describes how to use beans defined in Groovy in Spring.<p>The Groovy homepage includes the following description:<p>“Groovy is an agile dynamic language for the Java 2 Platform that has many of the features that people like so much in languages like Python, Ruby and Smalltalk, making them available to Java developers using a Java-like syntax.”<p>If you have read this chapter straight from the top, you have already <a href=https://docs.spring.io/spring-framework/docs/current/reference/html/languages.html#dynamic-language-a-first-example rel=noopener target=_blank>seen an example</a> of a Groovy-dynamic-language-backed bean. Now consider another example (again using an example from the Spring test suite):<figure class="highlight java"><table><tr><td class=code><pre><span class=line><span class=keyword>package</span> org.springframework.scripting;</span><br><span class=line></span><br><span class=line><span class=keyword>public</span> <span class=keyword>interface</span> <span class="title class_">Calculator</span> {</span><br><span class=line></span><br><span class=line>    <span class=type>int</span> <span class="title function_">add</span><span class=params>(<span class=type>int</span> x, <span class=type>int</span> y)</span>;</span><br><span class=line>}</span><br></pre></table></figure><p>The following example implements the <code>Calculator</code> interface in Groovy:<figure class="highlight groovy"><table><tr><td class=code><pre><span class=line><span class=comment>// from the file 'calculator.groovy'</span></span><br><span class=line><span class=keyword>package</span> org.springframework.scripting.groovy</span><br><span class=line></span><br><span class=line><span class=keyword>class</span> <span class="title class_">GroovyCalculator</span> <span class=keyword>implements</span> <span class="title class_">Calculator</span> {</span><br><span class=line></span><br><span class=line>    <span class=type>int</span> add(<span class=type>int</span> x, <span class=type>int</span> y) {</span><br><span class=line>        x + y</span><br><span class=line>    }</span><br><span class=line>}</span><br></pre></table></figure><p>The following bean definition uses the calculator defined in Groovy:<figure class="highlight xml"><table><tr><td class=code><pre><span class=line><span class=comment>&LT!-- from the file 'beans.xml' --></span></span><br><span class=line><span class=tag><<span class=name>beans</span>></span></span><br><span class=line>    <span class=tag><<span class=name>lang:groovy</span> <span class=attr>id</span>=<span class=string>"calculator"</span> <span class=attr>script-source</span>=<span class=string>"classpath:calculator.groovy"</span>/></span></span><br><span class=line><span class=tag>&LT/<span class=name>beans</span>></span></span><br></pre></table></figure><p>Finally, the following small application exercises the preceding configuration:<figure class="highlight java"><table><tr><td class=code><pre><span class=line><span class=keyword>package</span> org.springframework.scripting;</span><br><span class=line></span><br><span class=line><span class=keyword>import</span> org.springframework.context.ApplicationContext;</span><br><span class=line><span class=keyword>import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class=line></span><br><span class=line><span class=keyword>public</span> <span class=keyword>class</span> <span class="title class_">Main</span> {</span><br><span class=line></span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>static</span> <span class=keyword>void</span> <span class="title function_">main</span><span class=params>(String[] args)</span> {</span><br><span class=line>        <span class=type>ApplicationContext</span> <span class=variable>ctx</span> <span class=operator>=</span> <span class=keyword>new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class=string>"beans.xml"</span>);</span><br><span class=line>        <span class=type>Calculator</span> <span class=variable>calc</span> <span class=operator>=</span> ctx.getBean(<span class=string>"calculator"</span>, Calculator.class);</span><br><span class=line>        System.out.println(calc.add(<span class=number>2</span>, <span class=number>8</span>));</span><br><span class=line>    }</span><br><span class=line>}</span><br></pre></table></figure><p>The resulting output from running the above program is (unsurprisingly) <code>10</code>. (For more interesting examples, see the dynamic language showcase project for a more complex example or see the examples <a href=https://docs.spring.io/spring-framework/docs/current/reference/html/languages.html#dynamic-language-scenarios rel=noopener target=_blank>Scenarios</a> later in this chapter).<p>You must not define more than one class per Groovy source file. While this is perfectly legal in Groovy, it is (arguably) a bad practice. In the interests of a consistent approach, you should (in the opinion of the Spring team) respect the standard Java conventions of one (public) class per source file.<h5 id=Customizing-Groovy-Objects-by-Using-a-Callback><a title="Customizing Groovy Objects by Using a Callback" class=headerlink href=#Customizing-Groovy-Objects-by-Using-a-Callback></a>Customizing Groovy Objects by Using a Callback</h5><p>The <code>GroovyObjectCustomizer</code> interface is a callback that lets you hook additional creation logic into the process of creating a Groovy-backed bean. For example, implementations of this interface could invoke any required initialization methods, set some default property values, or specify a custom <code>MetaClass</code>. The following listing shows the <code>GroovyObjectCustomizer</code> interface definition:<figure class="highlight java"><table><tr><td class=code><pre><span class=line><span class=keyword>public</span> <span class=keyword>interface</span> <span class="title class_">GroovyObjectCustomizer</span> {</span><br><span class=line></span><br><span class=line>    <span class=keyword>void</span> <span class="title function_">customize</span><span class=params>(GroovyObject goo)</span>;</span><br><span class=line>}</span><br></pre></table></figure><p>The Spring Framework instantiates an instance of your Groovy-backed bean and then passes the created <code>GroovyObject</code> to the specified <code>GroovyObjectCustomizer</code> (if one has been defined). You can do whatever you like with the supplied <code>GroovyObject</code> reference. We expect that most people want to set a custom <code>MetaClass</code> with this callback, and the following example shows how to do so:<figure class="highlight java"><table><tr><td class=code><pre><span class=line><span class=keyword>public</span> <span class=keyword>final</span> <span class=keyword>class</span> <span class="title class_">SimpleMethodTracingCustomizer</span> <span class=keyword>implements</span> <span class="title class_">GroovyObjectCustomizer</span> {</span><br><span class=line></span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>void</span> <span class="title function_">customize</span><span class=params>(GroovyObject goo)</span> {</span><br><span class=line>        <span class=type>DelegatingMetaClass</span> <span class=variable>metaClass</span> <span class=operator>=</span> <span class=keyword>new</span> <span class="title class_">DelegatingMetaClass</span>(goo.getMetaClass()) {</span><br><span class=line></span><br><span class=line>            <span class=keyword>public</span> Object <span class="title function_">invokeMethod</span><span class=params>(Object object, String methodName, Object[] arguments)</span> {</span><br><span class=line>                System.out.println(<span class=string>"Invoking '"</span> + methodName + <span class=string>"'."</span>);</span><br><span class=line>                <span class=keyword>return</span> <span class=built_in>super</span>.invokeMethod(object, methodName, arguments);</span><br><span class=line>            }</span><br><span class=line>        };</span><br><span class=line>        metaClass.initialize();</span><br><span class=line>        goo.setMetaClass(metaClass);</span><br><span class=line>    }</span><br><span class=line></span><br><span class=line>}</span><br></pre></table></figure><p>A full discussion of meta-programming in Groovy is beyond the scope of the Spring reference manual. See the relevant section of the Groovy reference manual or do a search online. Plenty of articles address this topic. Actually, making use of a <code>GroovyObjectCustomizer</code> is easy if you use the Spring namespace support, as the following example shows:<figure class="highlight xml"><table><tr><td class=code><pre><span class=line><span class=comment>&LT!-- define the GroovyObjectCustomizer just like any other bean --></span></span><br><span class=line><span class=tag><<span class=name>bean</span> <span class=attr>id</span>=<span class=string>"tracingCustomizer"</span> <span class=attr>class</span>=<span class=string>"example.SimpleMethodTracingCustomizer"</span>/></span></span><br><span class=line></span><br><span class=line>    <span class=comment>&LT!-- ... and plug it into the desired Groovy bean via the 'customizer-ref' attribute --></span></span><br><span class=line>    <span class=tag><<span class=name>lang:groovy</span> <span class=attr>id</span>=<span class=string>"calculator"</span></span></span><br><span class=line><span class=tag>        <span class=attr>script-source</span>=<span class=string>"classpath:org/springframework/scripting/groovy/Calculator.groovy"</span></span></span><br><span class=line><span class=tag>        <span class=attr>customizer-ref</span>=<span class=string>"tracingCustomizer"</span>/></span></span><br></pre></table></figure><p>If you do not use the Spring namespace support, you can still use the <code>GroovyObjectCustomizer</code> functionality, as the following example shows:<figure class="highlight xml"><table><tr><td class=code><pre><span class=line><span class=tag><<span class=name>bean</span> <span class=attr>id</span>=<span class=string>"calculator"</span> <span class=attr>class</span>=<span class=string>"org.springframework.scripting.groovy.GroovyScriptFactory"</span>></span></span><br><span class=line>    <span class=tag><<span class=name>constructor-arg</span> <span class=attr>value</span>=<span class=string>"classpath:org/springframework/scripting/groovy/Calculator.groovy"</span>/></span></span><br><span class=line>    <span class=comment>&LT!-- define the GroovyObjectCustomizer (as an inner bean) --></span></span><br><span class=line>    <span class=tag><<span class=name>constructor-arg</span>></span></span><br><span class=line>        <span class=tag><<span class=name>bean</span> <span class=attr>id</span>=<span class=string>"tracingCustomizer"</span> <span class=attr>class</span>=<span class=string>"example.SimpleMethodTracingCustomizer"</span>/></span></span><br><span class=line>    <span class=tag>&LT/<span class=name>constructor-arg</span>></span></span><br><span class=line><span class=tag>&LT/<span class=name>bean</span>></span></span><br><span class=line></span><br><span class=line><span class=tag><<span class=name>bean</span> <span class=attr>class</span>=<span class=string>"org.springframework.scripting.support.ScriptFactoryPostProcessor"</span>/></span></span><br></pre></table></figure><table><thead><tr><th><th>You may also specify a Groovy <code>CompilationCustomizer</code> (such as an <code>ImportCustomizer</code>) or even a full Groovy <code>CompilerConfiguration</code> object in the same place as Spring’s <code>GroovyObjectCustomizer</code>. Furthermore, you may set a common <code>GroovyClassLoader</code> with custom configuration for your beans at the <code>ConfigurableApplicationContext.setClassLoader</code> level; this also leads to shared <code>GroovyClassLoader</code> usage and is therefore recommendable in case of a large number of scripted beans (avoiding an isolated <code>GroovyClassLoader</code> instance per bean).<tbody><tr><td><td></table><h4 id=3-2-3-BeanShell-Beans><a title="3.2.3. BeanShell Beans" class=headerlink href=#3-2-3-BeanShell-Beans></a>3.2.3. BeanShell Beans</h4><p>This section describes how to use BeanShell beans in Spring.<p>The <a href=https://beanshell.github.io/intro.html rel=noopener target=_blank>BeanShell homepage</a> includes the following description:<figure class="highlight plaintext"><table><tr><td class=code><pre><span class=line>BeanShell is a small, free, embeddable Java source interpreter with dynamic language</span><br><span class=line>features, written in Java. BeanShell dynamically runs standard Java syntax and</span><br><span class=line>extends it with common scripting conveniences such as loose types, commands, and method</span><br><span class=line>closures like those in Perl and JavaScript.</span><br></pre></table></figure><p>In contrast to Groovy, BeanShell-backed bean definitions require some (small) additional configuration. The implementation of the BeanShell dynamic language support in Spring is interesting, because Spring creates a JDK dynamic proxy that implements all of the interfaces that are specified in the <code>script-interfaces</code> attribute value of the <code>&LTlang:bsh></code> element (this is why you must supply at least one interface in the value of the attribute, and, consequently, program to interfaces when you use BeanShell-backed beans). This means that every method call on a BeanShell-backed object goes through the JDK dynamic proxy invocation mechanism.<p>Now we can show a fully working example of using a BeanShell-based bean that implements the <code>Messenger</code> interface that was defined earlier in this chapter. We again show the definition of the <code>Messenger</code> interface:<figure class="highlight java"><table><tr><td class=code><pre><span class=line><span class=keyword>package</span> org.springframework.scripting;</span><br><span class=line></span><br><span class=line><span class=keyword>public</span> <span class=keyword>interface</span> <span class="title class_">Messenger</span> {</span><br><span class=line></span><br><span class=line>    String <span class="title function_">getMessage</span><span class=params>()</span>;</span><br><span class=line>}</span><br></pre></table></figure><p>The following example shows the BeanShell “implementation” (we use the term loosely here) of the <code>Messenger</code> interface:<figure class="highlight java"><table><tr><td class=code><pre><span class=line>String message;</span><br><span class=line></span><br><span class=line>String <span class="title function_">getMessage</span><span class=params>()</span> {</span><br><span class=line>    <span class=keyword>return</span> message;</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=keyword>void</span> <span class="title function_">setMessage</span><span class=params>(String aMessage)</span> {</span><br><span class=line>    message = aMessage;</span><br><span class=line>}</span><br></pre></table></figure><p>The following example shows the Spring XML that defines an “instance” of the above “class” (again, we use these terms very loosely here):<figure class="highlight xml"><table><tr><td class=code><pre><span class=line><span class=tag><<span class=name>lang:bsh</span> <span class=attr>id</span>=<span class=string>"messageService"</span> <span class=attr>script-source</span>=<span class=string>"classpath:BshMessenger.bsh"</span></span></span><br><span class=line><span class=tag>    <span class=attr>script-interfaces</span>=<span class=string>"org.springframework.scripting.Messenger"</span>></span></span><br><span class=line></span><br><span class=line>    <span class=tag><<span class=name>lang:property</span> <span class=attr>name</span>=<span class=string>"message"</span> <span class=attr>value</span>=<span class=string>"Hello World!"</span> /></span></span><br><span class=line><span class=tag>&LT/<span class=name>lang:bsh</span>></span></span><br></pre></table></figure><p>See <a href=https://docs.spring.io/spring-framework/docs/current/reference/html/languages.html#dynamic-language-scenarios rel=noopener target=_blank>Scenarios</a> for some scenarios where you might want to use BeanShell-based beans.<h3 id=3-3-Scenarios><a title="3.3. Scenarios" class=headerlink href=#3-3-Scenarios></a>3.3. Scenarios</h3><p>The possible scenarios where defining Spring managed beans in a scripting language would be beneficial are many and varied. This section describes two possible use cases for the dynamic language support in Spring.<h4 id=3-3-1-Scripted-Spring-MVC-Controllers><a title="3.3.1. Scripted Spring MVC Controllers" class=headerlink href=#3-3-1-Scripted-Spring-MVC-Controllers></a>3.3.1. Scripted Spring MVC Controllers</h4><p>One group of classes that can benefit from using dynamic-language-backed beans is that of Spring MVC controllers. In pure Spring MVC applications, the navigational flow through a web application is, to a large extent, determined by code encapsulated within your Spring MVC controllers. As the navigational flow and other presentation layer logic of a web application needs to be updated to respond to support issues or changing business requirements, it may well be easier to effect any such required changes by editing one or more dynamic language source files and seeing those changes being immediately reflected in the state of a running application.<p>Remember that, in the lightweight architectural model espoused by projects such as Spring, you typically aim to have a really thin presentation layer, with all the meaty business logic of an application being contained in the domain and service layer classes. Developing Spring MVC controllers as dynamic-language-backed beans lets you change presentation layer logic by editing and saving text files. Any changes to such dynamic language source files is (depending on the configuration) automatically reflected in the beans that are backed by dynamic language source files.<table><thead><tr><th><th>To effect this automatic “pickup” of any changes to dynamic-language-backed beans, you have to enable the “refreshable beans” functionality. See <a href=https://docs.spring.io/spring-framework/docs/current/reference/html/languages.html#dynamic-language-refreshable-beans rel=noopener target=_blank>Refreshable Beans</a> for a full treatment of this feature.<tbody><tr><td><td></table><p>The following example shows an <code>org.springframework.web.servlet.mvc.Controller</code> implemented by using the Groovy dynamic language:<figure class="highlight groovy"><table><tr><td class=code><pre><span class=line><span class=comment>// from the file '/WEB-INF/groovy/FortuneController.groovy'</span></span><br><span class=line><span class=keyword>package</span> org.springframework.showcase.fortune.web</span><br><span class=line></span><br><span class=line><span class=keyword>import</span> org.springframework.showcase.fortune.service.FortuneService</span><br><span class=line><span class=keyword>import</span> org.springframework.showcase.fortune.domain.Fortune</span><br><span class=line><span class=keyword>import</span> org.springframework.web.servlet.ModelAndView</span><br><span class=line><span class=keyword>import</span> org.springframework.web.servlet.mvc.Controller</span><br><span class=line></span><br><span class=line><span class=keyword>import</span> javax.servlet.http.HttpServletRequest</span><br><span class=line><span class=keyword>import</span> javax.servlet.http.HttpServletResponse</span><br><span class=line></span><br><span class=line><span class=keyword>class</span> <span class="title class_">FortuneController</span> <span class=keyword>implements</span> <span class="title class_">Controller</span> {</span><br><span class=line></span><br><span class=line>    <span class=meta>@Property</span> FortuneService fortuneService</span><br><span class=line></span><br><span class=line>    ModelAndView handleRequest(HttpServletRequest request,</span><br><span class=line>            HttpServletResponse httpServletResponse) {</span><br><span class=line>        <span class=keyword>return</span> <span class=keyword>new</span> ModelAndView(<span class=string>"tell"</span>, <span class=string>"fortune"</span>, <span class="variable language_">this</span>.fortuneService.tellFortune())</span><br><span class=line>    }</span><br><span class=line>}</span><br><span class=line><<span class=attr>lang:</span>groovy id=<span class=string>"fortune"</span></span><br><span class=line>        refresh-check-delay=<span class=string>"3000"</span></span><br><span class=line>        script-source=<span class=string>"/WEB-INF/groovy/FortuneController.groovy"</span>></span><br><span class=line>    <<span class=attr>lang:</span>property name=<span class=string>"fortuneService"</span> ref=<span class=string>"fortuneService"</span>/></span><br><span class=line>&LT/<span class=attr>lang:</span>groovy></span><br></pre></table></figure><h4 id=3-3-2-Scripted-Validators><a title="3.3.2. Scripted Validators" class=headerlink href=#3-3-2-Scripted-Validators></a>3.3.2. Scripted Validators</h4><p>Another area of application development with Spring that may benefit from the flexibility afforded by dynamic-language-backed beans is that of validation. It can be easier to express complex validation logic by using a loosely typed dynamic language (that may also have support for inline regular expressions) as opposed to regular Java.<p>Again, developing validators as dynamic-language-backed beans lets you change validation logic by editing and saving a simple text file. Any such changes is (depending on the configuration) automatically reflected in the execution of a running application and would not require the restart of an application.<table><thead><tr><th><th>To effect the automatic “pickup” of any changes to dynamic-language-backed beans, you have to enable the 'refreshable beans' feature. See <a href=https://docs.spring.io/spring-framework/docs/current/reference/html/languages.html#dynamic-language-refreshable-beans rel=noopener target=_blank>Refreshable Beans</a> for a full and detailed treatment of this feature.<tbody><tr><td><td></table><p>The following example shows a Spring <code>org.springframework.validation.Validator</code> implemented by using the Groovy dynamic language (see <a href=https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#validator rel=noopener target=_blank>Validation using Spring’s Validator interface</a> for a discussion of the <code>Validator</code> interface):<figure class="highlight groovy"><table><tr><td class=code><pre><span class=line><span class=keyword>import</span> org.springframework.validation.Validator</span><br><span class=line><span class=keyword>import</span> org.springframework.validation.Errors</span><br><span class=line><span class=keyword>import</span> org.springframework.beans.TestBean</span><br><span class=line></span><br><span class=line><span class=keyword>class</span> <span class="title class_">TestBeanValidator</span> <span class=keyword>implements</span> <span class="title class_">Validator</span> {</span><br><span class=line></span><br><span class=line>    <span class=type>boolean</span> supports(Class clazz) {</span><br><span class=line>        <span class=keyword>return</span> TestBean.<span class=keyword>class</span>.isAssignableFrom(clazz)</span><br><span class=line>    }</span><br><span class=line></span><br><span class=line>    <span class=type>void</span> validate(Object bean, Errors errors) {</span><br><span class=line>        <span class=keyword>if</span>(bean.name?.trim()?.size() > <span class=number>0</span>) {</span><br><span class=line>            return</span><br><span class=line>        }</span><br><span class=line>        errors.reject(<span class=string>"whitespace"</span>, <span class=string>"Cannot be composed wholly of whitespace."</span>)</span><br><span class=line>    }</span><br><span class=line>}</span><br></pre></table></figure><h3 id=3-4-Additional-Details><a title="3.4. Additional Details" class=headerlink href=#3-4-Additional-Details></a>3.4. Additional Details</h3><p>This last section contains some additional details related to the dynamic language support.<h4 id=3-4-1-AOP-—-Advising-Scripted-Beans><a title="3.4.1. AOP — Advising Scripted Beans" class=headerlink href=#3-4-1-AOP-—-Advising-Scripted-Beans></a>3.4.1. AOP — Advising Scripted Beans</h4><p>You can use the Spring AOP framework to advise scripted beans. The Spring AOP framework actually is unaware that a bean that is being advised might be a scripted bean, so all of the AOP use cases and functionality that you use (or aim to use) work with scripted beans. When you advise scripted beans, you cannot use class-based proxies. You must use <a href=https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#aop-proxying rel=noopener target=_blank>interface-based proxies</a>.<p>You are not limited to advising scripted beans. You can also write aspects themselves in a supported dynamic language and use such beans to advise other Spring beans. This really would be an advanced use of the dynamic language support though.<h4 id=3-4-2-Scoping><a title="3.4.2. Scoping" class=headerlink href=#3-4-2-Scoping></a>3.4.2. Scoping</h4><p>In case it is not immediately obvious, scripted beans can be scoped in the same way as any other bean. The <code>scope</code> attribute on the various <code>&LTlang:language/></code> elements lets you control the scope of the underlying scripted bean, as it does with a regular bean. (The default scope is <a href=https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-factory-scopes-singleton rel=noopener target=_blank>singleton</a>, as it is with “regular” beans.)<p>The following example uses the <code>scope</code> attribute to define a Groovy bean scoped as a <a href=https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-factory-scopes-prototype rel=noopener target=_blank>prototype</a>:<figure class="highlight xml"><table><tr><td class=code><pre><span class=line><span class=meta>&LT?xml version=<span class=string>"1.0"</span> encoding=<span class=string>"UTF-8"</span>?></span></span><br><span class=line><span class=tag><<span class=name>beans</span> <span class=attr>xmlns</span>=<span class=string>"http://www.springframework.org/schema/beans"</span> <span class=attr>xmlns:xsi</span>=<span class=string>"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class=line><span class=tag>    <span class=attr>xmlns:lang</span>=<span class=string>"http://www.springframework.org/schema/lang"</span></span></span><br><span class=line><span class=tag>    <span class=attr>xsi:schemaLocation</span>=<span class=string>"</span></span></span><br><span class=line><span class=string><span class=tag>        http://www.springframework.org/schema/beans https://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class=line><span class=string><span class=tag>        http://www.springframework.org/schema/lang https://www.springframework.org/schema/lang/spring-lang.xsd"</span>></span></span><br><span class=line></span><br><span class=line>    <span class=tag><<span class=name>lang:groovy</span> <span class=attr>id</span>=<span class=string>"messenger"</span> <span class=attr>script-source</span>=<span class=string>"classpath:Messenger.groovy"</span> <span class=attr>scope</span>=<span class=string>"prototype"</span>></span></span><br><span class=line>        <span class=tag><<span class=name>lang:property</span> <span class=attr>name</span>=<span class=string>"message"</span> <span class=attr>value</span>=<span class=string>"I Can Do The RoboCop"</span> /></span></span><br><span class=line>    <span class=tag>&LT/<span class=name>lang:groovy</span>></span></span><br><span class=line></span><br><span class=line>    <span class=tag><<span class=name>bean</span> <span class=attr>id</span>=<span class=string>"bookingService"</span> <span class=attr>class</span>=<span class=string>"x.y.DefaultBookingService"</span>></span></span><br><span class=line>        <span class=tag><<span class=name>property</span> <span class=attr>name</span>=<span class=string>"messenger"</span> <span class=attr>ref</span>=<span class=string>"messenger"</span> /></span></span><br><span class=line>    <span class=tag>&LT/<span class=name>bean</span>></span></span><br><span class=line></span><br><span class=line><span class=tag>&LT/<span class=name>beans</span>></span></span><br></pre></table></figure><p>See <a href=https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-factory-scopes rel=noopener target=_blank>Bean Scopes</a> in <a href=https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans rel=noopener target=_blank>The IoC Container</a> for a full discussion of the scoping support in the Spring Framework.<h4 id=3-4-3-The-lang-XML-schema><a title="3.4.3. The lang XML schema" class=headerlink href=#3-4-3-The-lang-XML-schema></a>3.4.3. The <code>lang</code> XML schema</h4><p>The <code>lang</code> elements in Spring XML configuration deal with exposing objects that have been written in a dynamic language (such as Groovy or BeanShell) as beans in the Spring container.<p>These elements (and the dynamic language support) are comprehensively covered in <a href=https://docs.spring.io/spring-framework/docs/current/reference/html/languages.html#dynamic-language rel=noopener target=_blank>Dynamic Language Support</a>. See that section for full details on this support and the <code>lang</code> elements.<p>To use the elements in the <code>lang</code> schema, you need to have the following preamble at the top of your Spring XML configuration file. The text in the following snippet references the correct schema so that the tags in the <code>lang</code> namespace are available to you:<figure class="highlight xml"><table><tr><td class=code><pre><span class=line><span class=meta>&LT?xml version=<span class=string>"1.0"</span> encoding=<span class=string>"UTF-8"</span>?></span></span><br><span class=line><span class=tag><<span class=name>beans</span> <span class=attr>xmlns</span>=<span class=string>"http://www.springframework.org/schema/beans"</span></span></span><br><span class=line><span class=tag>    <span class=attr>xmlns:xsi</span>=<span class=string>"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class=line><span class=tag>    <span class=attr>xmlns:lang</span>=<span class=string>"http://www.springframework.org/schema/lang"</span></span></span><br><span class=line><span class=tag>    <span class=attr>xsi:schemaLocation</span>=<span class=string>"</span></span></span><br><span class=line><span class=string><span class=tag>        http://www.springframework.org/schema/beans https://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class=line><span class=string><span class=tag>        http://www.springframework.org/schema/lang https://www.springframework.org/schema/lang/spring-lang.xsd"</span>></span></span><br><span class=line></span><br><span class=line>    <span class=comment>&LT!-- bean definitions here --></span></span><br><span class=line></span><br><span class=line><span class=tag>&LT/<span class=name>beans</span>></span></span><br></pre></table></figure><h3 id=3-5-Further-Resources><a title="3.5. Further Resources" class=headerlink href=#3-5-Further-Resources></a>3.5. Further Resources</h3><p>The following links go to further resources about the various dynamic languages referenced in this chapter:<ul><li>The <a href=https://www.groovy-lang.org/ rel=noopener target=_blank>Groovy</a> homepage<li>The <a href=https://beanshell.github.io/intro.html rel=noopener target=_blank>BeanShell</a> homepage<li>The <a href=https://www.jruby.org/ rel=noopener target=_blank>JRuby</a> homepage</ul><p>Version 5.3.10<br>Last updated 2021-09-15 06:13:27 UTC</div></div><ul class=breadcrumb><li><a href=/docs/>文档</a><li><a href=/docs/spring-framework/>SPRING</a><li>LANGUAGES</ul></div></main><footer class=footer><div class=footer-inner><div class=beian><a href=https://beian.miit.gov.cn/ rel=noopener target=_blank>湘ICP备19011756号-1 </a></div><div class=copyright>© 2021 – <span itemprop=copyrightYear>2024</span><span class=with-love> <i class="fa fa-heart"></i> </span><span class=author itemprop=copyrightHolder>JiaHe</span></div><div class=wordcount><span class=post-meta-item> <span class=post-meta-item-icon> <i class="fa fa-chart-line"></i> </span> <span title=站点总字数>330k</span> </span><span class=post-meta-item> <span class=post-meta-item-icon> <i class="fa fa-coffee"></i> </span> <span title=站点阅读时长>20:01</span> </span></div><div class=busuanzi-count><span class=post-meta-item id=busuanzi_container_site_uv> <span class=post-meta-item-icon> <i class="fa fa-user"></i> </span> <span class=site-uv title=总访客量> <span id=busuanzi_value_site_uv></span> </span> </span><span class=post-meta-item id=busuanzi_container_site_pv> <span class=post-meta-item-icon> <i class="fa fa-eye"></i> </span> <span class=site-pv title=总访问量> <span id=busuanzi_value_site_pv></span> </span> </span></div><div class=powered-by>由 <a href=https://hexo.io/ rel=noopener target=_blank>Hexo</a> & <a href=https://theme-next.js.org/ rel=noopener target=_blank>NexT.Gemini</a> 强力驱动</div></div></footer><div class="toggle sidebar-toggle" role=button><span class=toggle-line></span><span class=toggle-line></span><span class=toggle-line></span></div><div class=sidebar-dimmer></div><a class="book-mark-link book-mark-link-fixed" role=button></a><noscript><div class=noscript-warning>Theme NexT works best with JavaScript enabled</div></noscript><script alpha=0.6 size=300 src=https://use.sevencdn.com/ajax/libs/ribbon.js/1.0.2/ribbon.min.js zindex=-1></script><script crossorigin integrity=sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY= src=https://use.sevencdn.com/ajax/libs/animejs/3.2.1/anime.min.js></script><script crossorigin integrity=sha256-a+H7FYzJv6oU2hfsfDGM2Ohw/cR9v+hPfxHCLdmCrE8= src=https://use.sevencdn.com/ajax/libs/fancyapps-ui/5.0.31/fancybox/fancybox.umd.js></script><script crossorigin integrity=sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc= src=https://use.sevencdn.com/ajax/libs/lozad.js/1.16.0/lozad.min.js></script><script crossorigin integrity=sha256-j+yj56cdEY2CwkVtGyz18fNybFGpMGJ8JxG3GSyO2+I= src=https://use.sevencdn.com/ajax/libs/pangu/4.0.7/pangu.min.js></script><script src=https://use.sevencdn.com/ajax/libs/hexo-theme-next/8.21.0/comments.min.js></script><script src=https://use.sevencdn.com/ajax/libs/hexo-theme-next/8.21.0/utils.min.js></script><script src=https://use.sevencdn.com/ajax/libs/hexo-theme-next/8.21.0/sidebar.min.js></script><script src=https://use.sevencdn.com/ajax/libs/hexo-theme-next/8.21.0/next-boot.min.js></script><script src=https://use.sevencdn.com/ajax/libs/hexo-theme-next/8.21.0/bookmark.min.js></script><script crossorigin integrity=sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc= src=https://use.sevencdn.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js></script><script src=https://use.sevencdn.com/ajax/libs/hexo-theme-next/8.21.0/third-party/search/local-search.min.js></script><script class=next-config data-name=pdf type=application/json>{"object_url":{"url":"https://use.sevencdn.com/ajax/libs/pdfobject/2.3.0/pdfobject.min.js","integrity":"sha256-JJZNsid68vnh3/zyj0lY9BN5ynxVX/12XgOa1TlaYN0="},"url":"/lib/pdf/web/viewer.html"}</script><script src=https://use.sevencdn.com/ajax/libs/hexo-theme-next/8.21.0/third-party/tags/pdf.min.js></script><script src=https://use.sevencdn.com/ajax/libs/hexo-theme-next/8.21.0/third-party/fancybox.min.js></script><script async src=https://cn.vercount.one/js></script><script crossorigin integrity=sha256-yvJQOINiH9fWemHn0vCA5lsHWJaHs6/ZmO+1Ft04SvM= src=https://use.sevencdn.com/ajax/libs/quicklink/2.3.0/quicklink.umd.js></script><script class=next-config data-name=quicklink type=application/json>{"enable":true,"home":false,"archive":true,"delay":true,"timeout":3000,"priority":true,"ignores":null,"url":"http://xiaojianzheng.cn/docs/spring-framework/languages.html"}</script><script src=https://use.sevencdn.com/ajax/libs/hexo-theme-next/8.21.0/third-party/quicklink.min.js></script>