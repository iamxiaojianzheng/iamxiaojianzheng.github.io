<!doctypehtml><html lang=zh-CN><meta charset=UTF-8><meta content=width=device-width name=viewport><meta content=#222 name=theme-color><meta content="Hexo 7.3.0" name=generator><link href=/images/apple-touch-icon-next.png rel=apple-touch-icon sizes=180x180><link href=/images/favicon-32x32-next.png rel=icon sizes=32x32 type=image/png><link href=/images/favicon-16x16-next.png rel=icon sizes=16x16 type=image/png><link color=#222 href=/images/logo.svg rel=mask-icon><style>:root{--body-bg-color:#eee;--content-bg-color:rgba(255,255,255,0.9);--card-bg-color:#f5f5f5;--text-color:#555;--selection-bg:#262a30;--selection-color:#eee;--blockquote-color:#666;--link-color:#555;--link-hover-color:#222;--brand-color:#fff;--brand-hover-color:#fff;--table-row-odd-bg-color:#f9f9f9;--table-row-hover-bg-color:#f5f5f5;--menu-item-bg-color:#f5f5f5;--theme-color:#222;--btn-default-bg:#fff;--btn-default-color:#555;--btn-default-border-color:#555;--btn-default-hover-bg:#222;--btn-default-hover-color:#fff;--btn-default-hover-border-color:#222;--highlight-background:#0d1117;--highlight-foreground:#c9d1d9;--highlight-gutter-background:#1f242a;--highlight-gutter-foreground:#b6bdc5;color-scheme:light}html{line-height:1.15;-webkit-text-size-adjust:100%}details,main{display:block}pre{font-size:1em;overflow:auto;padding:10px}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,samp{font-family:monospace,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:ButtonText dotted 1px}fieldset{padding:.35em .75em .625em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{vertical-align:baseline}.table-container,textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}summary{display:list-item}[hidden],template{display:none}::selection{background:var(--selection-bg);color:var(--selection-color)}body,html{height:100%}body{margin:0;background:var(--body-bg-color);box-sizing:border-box;color:var(--text-color);font-family:Noto Serif SC,PingFang SC,Microsoft YaHei,sans-serif,Lato,"Noto Serif SC","PingFang SC","Microsoft YaHei",sans-serif;font-size:1.1em;line-height:2;min-height:100%;position:relative;transition:padding .2s ease-in-out}h1,h2,h3,h4,h5,h6{font-family:Noto Serif SC,PingFang SC,Microsoft YaHei,sans-serif,Lato,'PingFang SC','Microsoft YaHei',sans-serif;font-weight:700;line-height:1.5;margin:30px 0 15px}p{margin:0 0 20px}a{background:0 0;border-bottom:1px solid #999;color:var(--link-color);cursor:pointer;outline:0;text-decoration:none;overflow-wrap:break-word}a:hover{border-bottom-color:var(--link-hover-color);color:var(--link-hover-color)}embed,iframe,img,video{display:block;margin-left:auto;margin-right:auto;max-width:100%}hr{box-sizing:content-box;overflow:visible;background-image:repeating-linear-gradient(-45deg,#ddd,#ddd 4px,transparent 4px,transparent 8px);border:0;height:3px;margin:40px 0}blockquote{border-left:4px solid #ddd;color:var(--blockquote-color);margin:0;padding:0 15px}blockquote cite::before{content:'-';padding:0 5px}dt{font-weight:700}dd{margin:0;padding:0}table{border-collapse:collapse;border-spacing:0;font-size:.875em;margin:0 0 20px;width:100%}tbody tr:nth-of-type(odd){background:var(--table-row-odd-bg-color)}tbody tr:hover{background:var(--table-row-hover-bg-color)}caption,td,th{padding:8px}td,th{border:1px solid #ddd;border-bottom:3px solid #ddd}th{font-weight:700;padding-bottom:10px}td{border-bottom-width:1px}.btn{background:var(--btn-default-bg);border:2px solid var(--btn-default-border-color);border-radius:2px;color:var(--btn-default-color);display:inline-block;font-size:.875em;line-height:2;padding:0 20px;transition:background-color .2s ease-in-out}.btn:hover{background:var(--btn-default-hover-bg);border-color:var(--btn-default-hover-border-color);color:var(--btn-default-hover-color)}.btn+.btn{margin:0 0 8px 8px}.btn .fa-fw{text-align:left;width:1.285714285714286em}.toggle{line-height:0}.toggle .toggle-line{background:#fff;display:block;height:2px;left:0;position:relative;top:0;transition:left .4s,opacity .4s,top .4s,transform .4s,width .4s;width:100%}.toggle .toggle-line:first-child{margin-top:1px}.toggle .toggle-line:not(:first-child){margin-top:4px}.toggle.toggle-arrow :first-child{left:50%;top:2px;transform:rotate(45deg);width:50%}.toggle.toggle-arrow :last-child{left:50%;top:-2px;transform:rotate(-45deg);width:50%}.toggle.toggle-close :nth-child(2){opacity:0}.toggle.toggle-close :first-child{top:6px;transform:rotate(45deg)}.toggle.toggle-close :last-child{top:-6px;transform:rotate(-45deg)}pre code.hljs{display:block;overflow-x:auto;padding:1em}code.hljs{padding:3px 5px}/*!
  Theme: GitHub Dark
  Description: Dark theme as seen on github.com
  Author: github.com
  Maintainer: @Hirse
  Updated: 2021-05-15

  Outdated base version: https://github.com/primer/github-syntax-dark
  Current colors taken from GitHub's CSS
*/.hljs{color:#c9d1d9;background:#0d1117}.hljs-doctag,.hljs-keyword,.hljs-meta .hljs-keyword,.hljs-template-tag,.hljs-template-variable,.hljs-type,.hljs-variable.language_{color:#ff7b72}.hljs-title,.hljs-title.class_,.hljs-title.class_.inherited__,.hljs-title.function_{color:#d2a8ff}.hljs-attr,.hljs-attribute,.hljs-literal,.hljs-meta,.hljs-number,.hljs-operator,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-id,.hljs-variable{color:#79c0ff}.hljs-meta .hljs-string,.hljs-regexp,.hljs-string{color:#a5d6ff}.hljs-built_in,.hljs-symbol{color:#ffa657}.hljs-code,.hljs-comment,.hljs-formula{color:#8b949e}.hljs-name,.hljs-quote,.hljs-selector-pseudo,.hljs-selector-tag{color:#7ee787}.hljs-subst{color:#c9d1d9}.hljs-section{color:#1f6feb;font-weight:700}.hljs-bullet{color:#f2cc60}.hljs-emphasis{color:#c9d1d9;font-style:italic}.hljs-strong{color:#c9d1d9;font-weight:700}.hljs-addition{color:#aff5b4;background-color:#033a16}.hljs-deletion{color:#ffdcd7;background-color:#67060c}.code-container:hover .copy-btn,.highlight:hover .copy-btn{opacity:1}.code-container{position:relative}.copy-btn{color:#333;cursor:pointer;line-height:1.6;opacity:0;padding:2px 6px;position:absolute;transition:opacity .2s ease-in-out;color:var(--highlight-foreground);font-size:14px;right:0;top:2px}figure.highlight{border-radius:5px;box-shadow:0 10px 30px 0 rgba(0,0,0,.4);padding-top:30px;overflow:auto;position:relative}figure.highlight .table-container{border-radius:0 0 5px 5px}figure.highlight::before{background:#fc625d;box-shadow:20px 0 #fdbc40,40px 0 #35cd4b;left:12px;margin-top:-20px;position:absolute;border-radius:50%;content:' ';height:12px;width:12px}.expand-btn{bottom:0;color:var(--highlight-foreground);cursor:pointer;display:none;left:0;right:0;position:absolute;text-align:center}.fold-cover{background-image:linear-gradient(to top,var(--highlight-background) 0,rgba(0,0,0,0) 100%);bottom:0;display:none;height:50px;left:0;right:0;position:absolute}.highlight-fold{max-height:500px;overflow-y:hidden!important}.highlight-fold .expand-btn,.highlight-fold .fold-cover{display:block}code,figure.highlight,kbd,pre{background:var(--highlight-background);color:var(--highlight-foreground)}figure.highlight,pre{line-height:1.6;margin:0 auto 20px}figure.highlight figcaption,pre .caption{background:var(--highlight-gutter-background);color:var(--highlight-foreground);display:flow-root;font-size:.875em;line-height:1.2;padding:.5em}figure.highlight figcaption a,pre .caption a{color:var(--highlight-foreground);float:right}figure.highlight figcaption a:hover,pre .caption a:hover{border-bottom-color:var(--highlight-foreground)}code,pre{font-family:Roboto Mono,consolas,Menlo,monospace,'PingFang SC','Microsoft YaHei'}code{border-radius:3px;font-size:.875em;padding:2px 4px;overflow-wrap:break-word;background:#f1f2f6;color:#e74c3c}kbd{border:2px solid #ccc;border-radius:.2em;box-shadow:.1em .1em .2em rgba(0,0,0,.1);font-family:inherit;padding:.1em .3em;white-space:nowrap}figure.highlight pre{border:0;margin:0;padding:10px 0}figure.highlight table{border:0;margin:0;width:auto}figure.highlight td{border:0;padding:0}figure.highlight .gutter{-webkit-user-select:none;user-select:none}figure.highlight .gutter pre{background:var(--highlight-gutter-background);color:var(--highlight-gutter-foreground);padding-left:10px;padding-right:10px;text-align:right}figure.highlight .code pre{padding-left:10px;width:100%}figure.highlight .marked{background:rgba(0,0,0,.3)}pre .caption{margin-bottom:10px}.gist table{width:auto}.gist table td{border:0}pre code{background:0 0;padding:0;text-shadow:none}.blockquote-center{border-left:0;margin:40px 0;padding:0;position:relative;text-align:center}.blockquote-center::after,.blockquote-center::before{left:0;line-height:1;opacity:.6;position:absolute;width:100%}.blockquote-center::before{border-top:1px solid #ccc;text-align:left;top:-20px;content:'\f10d';font-family:'Font Awesome 6 Free';font-weight:900}.blockquote-center::after{border-bottom:1px solid #ccc;bottom:-20px;text-align:right;content:'\f10e';font-family:'Font Awesome 6 Free';font-weight:900}.blockquote-center div,.blockquote-center p{text-align:center}.group-picture{margin-bottom:20px}.group-picture .group-picture-row{display:flex;gap:3px;margin-bottom:3px}.group-picture .group-picture-column{flex:1}.group-picture .group-picture-column img{height:100%;margin:0;object-fit:cover;width:100%}.post-body .label{color:#555;padding:0 2px}.post-body .label.default{background:#f0f0f0}.post-body .label.primary{background:#efe6f7}.post-body .label.info{background:#e5f2f8}.post-body .label.success{background:#e7f4e9}.post-body .label.warning{background:#fcf6e1}.post-body .label.danger{background:#fae8eb}.post-body .link-grid{display:grid;grid-gap:1.5rem;gap:1.5rem;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));margin-bottom:20px;padding:1rem}.post-body .link-grid .link-grid-container{border:solid #ddd;box-shadow:1rem 1rem .5rem rgba(0,0,0,.5);min-height:5rem;min-width:0;padding:.5rem;position:relative;transition:background .3s}.post-body .link-grid .link-grid-container:hover{animation:.5s next-shake;background:var(--card-bg-color)}.post-body .link-grid .link-grid-container:active{box-shadow:.5rem .5rem .25rem rgba(0,0,0,.5);transform:translate(.2rem,.2rem)}.post-body .link-grid .link-grid-container .link-grid-image{border:1px solid #ddd;border-radius:50%;box-sizing:border-box;height:5rem;padding:3px;position:absolute;width:5rem}.post-body .link-grid .link-grid-container p{margin:0 1rem 0 6rem}.post-body .link-grid .link-grid-container p:first-of-type{font-size:1.2em}.post-body .link-grid .link-grid-container p:last-of-type{font-size:.8em;line-height:1.3rem;opacity:.7}.post-body .link-grid .link-grid-container a{border:0;height:100%;left:0;position:absolute;top:0;width:100%}@keyframes next-shake{0%{transform:translate(1pt,1pt) rotate(0)}10%{transform:translate(-1pt,-2pt) rotate(-1deg)}20%{transform:translate(-3pt,0) rotate(1deg)}30%{transform:translate(3pt,2pt) rotate(0)}40%{transform:translate(1pt,-1pt) rotate(1deg)}50%{transform:translate(-1pt,2pt) rotate(-1deg)}60%{transform:translate(-3pt,1pt) rotate(0)}70%{transform:translate(3pt,1pt) rotate(-1deg)}80%{transform:translate(-1pt,-1pt) rotate(1deg)}90%{transform:translate(1pt,2pt) rotate(0)}100%{transform:translate(1pt,-2pt) rotate(-1deg)}}.post-body .note{border-radius:3px;margin-bottom:20px;padding:1em;position:relative;border:1px solid #eee;border-left-width:5px}.post-body .note summary{cursor:pointer;outline:0}.post-body .note summary p{display:inline}.post-body .note h2,.post-body .note h3,.post-body .note h4,.post-body .note h5,.post-body .note h6{border-bottom:initial;margin:0;padding-top:0}.post-body .note :first-child{margin-top:0}.post-body .note :last-child{margin-bottom:0}.post-body .note.default{border-left-color:#777}.post-body .note.default h2,.post-body .note.default h3,.post-body .note.default h4,.post-body .note.default h5,.post-body .note.default h6{color:#777}.post-body .note.primary{border-left-color:#6f42c1}.post-body .note.primary h2,.post-body .note.primary h3,.post-body .note.primary h4,.post-body .note.primary h5,.post-body .note.primary h6{color:#6f42c1}.post-body .note.info{border-left-color:#428bca}.post-body .note.info h2,.post-body .note.info h3,.post-body .note.info h4,.post-body .note.info h5,.post-body .note.info h6{color:#428bca}.post-body .note.success{border-left-color:#5cb85c}.post-body .note.success h2,.post-body .note.success h3,.post-body .note.success h4,.post-body .note.success h5,.post-body .note.success h6{color:#5cb85c}.post-body .note.warning{border-left-color:#f0ad4e}.post-body .note.warning h2,.post-body .note.warning h3,.post-body .note.warning h4,.post-body .note.warning h5,.post-body .note.warning h6{color:#f0ad4e}.post-body .note.danger{border-left-color:#d9534f}.post-body .note.danger h2,.post-body .note.danger h3,.post-body .note.danger h4,.post-body .note.danger h5,.post-body .note.danger h6{color:#d9534f}.pdfobject-container embed,.pdfobject-container iframe{height:800px;width:100%}.post-body .tabs{margin-bottom:20px}.post-body .tabs,.tabs-comment{padding-top:10px}.post-body .tabs ul.nav-tabs,.tabs-comment ul.nav-tabs{background:var(--content-bg-color);display:flex;display:flex;flex-wrap:wrap;justify-content:center;margin:0;padding:0;position:sticky;top:0;z-index:5}.post-body .tabs ul.nav-tabs li.tab,.tabs-comment ul.nav-tabs li.tab{border-bottom:1px solid #ddd;border-left:1px solid transparent;border-right:1px solid transparent;border-radius:0;border-top:3px solid transparent;flex-grow:1;list-style-type:none}@media (max-width:413px){.post-body .tabs ul.nav-tabs,.tabs-comment ul.nav-tabs{display:block;margin-bottom:5px}.post-body .tabs ul.nav-tabs li.tab,.tabs-comment ul.nav-tabs li.tab{border-bottom:1px solid transparent;border-left:3px solid transparent;border-right:1px solid transparent;border-top:1px solid transparent;border-radius:0}}.post-body .tabs ul.nav-tabs li.tab a,.tabs-comment ul.nav-tabs li.tab a{border-bottom:initial;display:block;line-height:1.8;padding:.25em .75em;text-align:center;transition:.2s ease-out}.post-body .tabs ul.nav-tabs li.tab a i[class^=fa],.tabs-comment ul.nav-tabs li.tab a i[class^=fa]{width:1.285714285714286em}.post-body .tabs ul.nav-tabs li.tab.active,.tabs-comment ul.nav-tabs li.tab.active{border-color:#fc6423 #ddd transparent}@media (max-width:413px){.post-body .tabs ul.nav-tabs li.tab.active,.tabs-comment ul.nav-tabs li.tab.active{border-color:#ddd #ddd #ddd #fc6423}}.post-body .tabs ul.nav-tabs li.tab.active a,.tabs-comment ul.nav-tabs li.tab.active a{cursor:default}.post-body .tabs .tab-content,.tabs-comment .tab-content{border:1px solid #ddd;border-radius:0;border-top-color:transparent}@media (max-width:413px){.post-body .tabs .tab-content,.tabs-comment .tab-content{border-radius:0;border-top-color:#ddd}}.post-body .tabs .tab-content .tab-pane,.tabs-comment .tab-content .tab-pane{padding:20px 20px 0}.post-body .tabs .tab-content .tab-pane:not(.active),.tabs-comment .tab-content .tab-pane:not(.active){display:none}.pagination .next,.pagination .page-number,.pagination .prev,.pagination .space{display:inline-block;margin:-1px 10px 0;padding:0 10px}.pagination .page-number.current{background:#ccc;border-color:#ccc;color:var(--content-bg-color)}.pagination{border-top:1px solid #eee;margin:120px 0 0;text-align:center}.pagination .next,.pagination .page-number,.pagination .prev{border-bottom:0;border-top:1px solid #eee;transition:border-color .2s ease-in-out}.pagination .next:hover,.pagination .page-number:hover,.pagination .prev:hover{border-top-color:var(--link-hover-color)}@media (max-width:767px){.pagination .next,.pagination .page-number,.pagination .prev,.pagination .space{margin:0 5px}.pagination{border-top:0}.pagination .next,.pagination .page-number,.pagination .prev{border-bottom:1px solid #eee;border-top:0}.pagination .next:hover,.pagination .page-number:hover,.pagination .prev:hover{border-bottom-color:var(--link-hover-color)}.site-meta{text-align:center}}.pagination .space{margin:0;padding:0}.comments{margin-top:60px;overflow:hidden}.comment-button-group{display:flex;display:flex;flex-wrap:wrap;justify-content:center;justify-content:center;margin:1em 0}.comment-button-group .comment-button{margin:.1em .2em}.comment-button-group .comment-button.active{background:var(--btn-default-hover-bg);border-color:var(--btn-default-hover-border-color);color:var(--btn-default-hover-color)}.comment-position{display:none}.comment-position.active{display:block}.tabs-comment{margin-top:4em;padding-top:0}.tabs-comment .comments{margin-top:0;padding-top:0}.headband{background:var(--theme-color);height:3px}@media (max-width:991px){.headband{display:none}}.site-brand-container{display:flex;flex-shrink:0;padding:0 10px}.use-motion .column,.use-motion .site-brand-container .toggle{opacity:0}.site-meta{flex-grow:1;text-align:center}.custom-logo-image{margin-top:20px}@media (max-width:991px){.custom-logo-image{display:none}}.brand{border-bottom:0;color:var(--brand-color);display:inline-block;padding:0}.brand:hover{color:var(--brand-hover-color)}.site-title{font-family:Noto Serif SC,PingFang SC,Microsoft YaHei,sans-serif,Lato,'PingFang SC','Microsoft YaHei',sans-serif;font-size:1.375em;font-weight:400;line-height:1.5;margin:0}.site-subtitle{color:#ddd;margin:10px 10px 0}.use-motion .custom-logo-image,.use-motion .site-subtitle,.use-motion .site-title{opacity:0;position:relative;top:-10px}.site-nav-right,.site-nav-toggle{display:none}.site-nav-right .toggle,.site-nav-toggle .toggle{color:var(--text-color);padding:10px;width:22px}.site-nav-right .toggle .toggle-line,.site-nav-toggle .toggle .toggle-line{background:var(--text-color);border-radius:1px}@media (max-width:767px){.site-nav-right,.site-nav-toggle{display:flex;flex-direction:column;justify-content:center}.site-nav{--scroll-height:0;height:0;overflow:hidden;transition:height .2s ease-in-out,visibility .2s ease-in-out;visibility:hidden}body:not(.site-nav-on) .site-nav .animated{animation:none}body.site-nav-on .site-nav{height:var(--scroll-height);visibility:unset}}.menu{margin:0;padding:1em 0;text-align:center}.menu-item{display:inline-block;list-style:none;margin:0 10px}@media (max-width:767px){.menu-item{display:block;margin-top:10px}.menu-item.menu-item-search{display:none}}.menu-item a{border-bottom:0;display:block;font-size:.8125em;transition:border-color .2s ease-in-out}.menu-item a.menu-item-active,.menu-item a:hover{background:var(--menu-item-bg-color)}.menu-item i[class^=fa]{margin-right:8px}.menu-item .badge{background:#ccc;border-radius:10px;color:var(--content-bg-color);font-weight:700;line-height:1;margin-left:.35em;padding:2px 5px;text-shadow:1px 1px 0 rgba(0,0,0,.1)}.use-motion .menu-item{visibility:hidden}.book-mark-link{border-bottom:0;position:fixed;top:-10px;transition:top .3s;right:30px}.book-mark-link::before{color:#222;font-size:32px;line-height:1;content:'\f02e';font-family:'Font Awesome 6 Free';font-weight:900}.book-mark-link-fixed,.book-mark-link:hover{top:-2px}@media (max-width:991px){.book-mark-link{right:20px;display:none}.sidebar{left:-320px;background:#222;bottom:0;max-height:100vh;overflow-y:auto;position:fixed;top:0;transition:left .2s ease-out,right .2s ease-out;width:320px;z-index:20}.sidebar-active .sidebar{left:0}.sidebar a{border-bottom-color:#555;color:#999}.sidebar a:hover{border-bottom-color:#eee;color:#eee}.links-of-author:not(:first-child){margin-top:15px}.links-of-author a{border-bottom-color:#555;display:inline-block;margin-bottom:10px;margin-right:10px;vertical-align:middle}.links-of-author a::before{background:#461ff7;display:inline-block;margin-right:3px;transform:translateY(-2px);border-radius:50%;content:' ';height:4px;width:4px}.links-of-blogroll-item{padding:0 5px}.popular-posts .popular-posts-item .popular-posts-link:hover{background:0 0}.sidebar-dimmer{background:#000;height:100%;left:0;opacity:0;position:fixed;top:0;transition:visibility .4s,opacity .4s;visibility:hidden;width:100%;z-index:10}.sidebar-active .sidebar-dimmer{opacity:.7;visibility:visible}}.sidebar-inner{color:#999;padding:18px 10px;text-align:center;display:flex;flex-direction:column;justify-content:center}.sidebar-toggle{bottom:61px;height:16px;padding:5px;width:16px;background:#222;cursor:pointer;opacity:.6;position:fixed;z-index:30;left:30px}.sidebar-toggle:hover{opacity:.8}@media (max-width:991px){.sidebar-toggle{left:20px;opacity:.8}}.sidebar-toggle:hover .toggle-line{background:#fc6423}@media (any-hover:hover){body:not(.sidebar-active) .sidebar-toggle:hover :first-child{left:50%;top:2px;transform:rotate(45deg);width:50%}body:not(.sidebar-active) .sidebar-toggle:hover :last-child{left:50%;top:-2px;transform:rotate(-45deg);width:50%}}.sidebar-active .sidebar-toggle :nth-child(2){opacity:0}.sidebar-active .sidebar-toggle :first-child{top:6px;transform:rotate(45deg)}.sidebar-active .sidebar-toggle :last-child{top:-6px;transform:rotate(-45deg)}.sidebar-nav{font-size:.875em;height:0;margin:0;overflow:hidden;padding-left:0;pointer-events:none;transition:height .2s ease-in-out,visibility .2s ease-in-out;visibility:hidden}.sidebar-nav-active .sidebar-nav{height:calc(2em + 1px);pointer-events:unset;visibility:unset}.sidebar-nav li{border-bottom:1px solid transparent;color:var(--text-color);cursor:pointer;display:inline-block;transition:border-bottom-color .2s ease-in-out,color .2s ease-in-out}.sidebar-nav li.sidebar-nav-overview{margin-left:10px}.sidebar-nav li:hover{color:#fc6423}.sidebar-overview-active .sidebar-nav-overview,.sidebar-toc-active .sidebar-nav-toc{border-bottom-color:#fc6423;color:#fc6423;transition-delay:0.2s}.sidebar-overview-active .sidebar-nav-overview:hover,.sidebar-toc-active .sidebar-nav-toc:hover{color:#fc6423}.sidebar-panel-container{align-items:start;display:grid;flex:1;overflow-x:hidden;overflow-y:auto;padding-top:0;transition:padding-top .2s ease-in-out}.sidebar-nav-active .sidebar-panel-container{padding-top:20px}.sidebar-panel{animation:.2s ease-in-out deactivate-sidebar-panel;grid-area:1/1;height:0;opacity:0;overflow:hidden;pointer-events:none;transform:translateY(0);transition:.2s ease-in-out;transition-property:opacity,transform,visibility;visibility:hidden}.sidebar-nav-active .sidebar-panel,.sidebar-overview-active .sidebar-panel.post-toc-wrap{transform:translateY(-20px)}.sidebar-overview-active:not(.sidebar-nav-active) .sidebar-panel.post-toc-wrap{transition-delay:0s,0.2s,0s}.sidebar-overview-active .sidebar-panel.site-overview-wrap,.sidebar-toc-active .sidebar-panel.post-toc-wrap{animation-name:activate-sidebar-panel;height:auto;opacity:1;pointer-events:unset;transform:translateY(0);transition-delay:0.2s,0.2s,0s;visibility:unset}.sidebar-panel.site-overview-wrap{display:flex;flex-direction:column;justify-content:center;gap:10px;justify-content:flex-start}@keyframes deactivate-sidebar-panel{from{height:var(--inactive-panel-height,0)}to{height:var(--active-panel-height,0)}}@keyframes activate-sidebar-panel{from{height:var(--inactive-panel-height,auto)}to{height:var(--active-panel-height,auto)}}.post-toc{font-size:.875em}.post-toc ol{list-style:none;margin:0;padding:0 2px 0 10px;text-align:left}.post-toc ol>:last-child{margin-bottom:5px}.post-toc ol>ol{padding-left:0}.post-toc ol a{transition:.2s ease-in-out}.post-toc .nav-item{line-height:1.8;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.post-toc .nav .nav-child{--height:0;height:0;opacity:0;overflow:hidden;transition:.2s ease-in-out;visibility:hidden}.post-toc .nav .active>.nav-child{height:var(--height,auto);opacity:1;visibility:unset}.post-toc .nav .active>a{border-bottom-color:#fc6423;color:#fc6423}.post-toc .nav .active-current>a,.post-toc .nav .active-current>a:hover{color:#fc6423}.site-author-image{border:1px solid #eee;max-width:120px;padding:2px;border-radius:50%}.site-author-name{color:var(--text-color);font-weight:600;margin:0}.site-description{color:#999;font-size:.8125em;margin-top:0}.site-state{display:flex;flex-wrap:wrap;justify-content:center;line-height:1.4}.site-state-item{padding:0 15px}.site-state-item a{border-bottom:0;display:block}.site-state-item-count{display:block;font-size:1em;font-weight:600}.site-state-item-name{color:#999;font-size:.8125em}.sidebar .sidebar-button:not(:first-child){margin-top:15px}.sidebar .sidebar-button button{background:0 0;color:#fc6423;cursor:pointer;line-height:2;padding:0 15px;border:1px solid #fc6423;border-radius:4px}.sidebar .sidebar-button button:hover{background:#fc6423;color:#fff}.sidebar .sidebar-button button i[class^=fa]{margin-right:5px}.links-of-author a{font-size:.8125em}.links-of-author i[class^=fa]{margin-right:2px}.cc-license .cc-opacity{border-bottom:0;opacity:.7}.cc-license .cc-opacity:hover{opacity:.9}.cc-license img{display:inline-block}.links-of-blogroll{font-size:.8125em}.links-of-blogroll-title{font-size:.875em;font-weight:600}.links-of-blogroll-list{list-style:none;gap:5px;margin:5px 0 0;padding:0;display:flex;flex-wrap:wrap;justify-content:center}.links-of-blogroll-item{max-width:calc(100% - 20px)}.links-of-blogroll-item a{box-sizing:border-box;display:inline-block;max-width:100%;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.footer{color:#999;font-size:.875em;padding:20px 0;transition:left .2s ease-in-out,right .2s ease-in-out}.footer.footer-fixed{bottom:0;left:0;position:absolute;right:0}.footer-inner{box-sizing:border-box;text-align:center;display:flex;flex-direction:column;justify-content:center;margin:0 auto;width:calc(100% - 20px)}@media (max-width:767px){.footer-inner{width:auto}}@media (min-width:1200px){.footer-inner{width:1160px}}@media (min-width:1600px){.footer-inner{width:73%}}.use-motion .footer{opacity:0}.languages{display:inline-block;font-size:1.125em;position:relative}.languages .lang-select-label span{margin:0 .5em}.languages .lang-select{height:100%;left:0;opacity:0;position:absolute;top:0;width:100%}.with-love{color:red;display:inline-block;margin:0 5px}.beian img{display:inline-block;margin:0 3px;vertical-align:middle}.busuanzi-count #busuanzi_container_site_pv,.busuanzi-count #busuanzi_container_site_uv{display:none}@keyframes icon-animate{0%,100%{transform:scale(1)}10%,30%{transform:scale(.9)}20%,40%,50%,60%,70%,80%{transform:scale(1.1)}}@media (max-width:567px){.main-inner{padding:initial!important}.posts-expand .post-header{margin-bottom:10px!important}.post-block{margin-top:initial!important;padding:8px 18px!important}.post-body h1,.post-body h2,.post-body h3,.post-body h4,.post-body h5,.post-body h6{margin:20px 0 8px}.post-body .note h1,.post-body .note h2,.post-body .note h3,.post-body .note h4,.post-body .note h5,.post-body .note h6,.post-body .tabs .tab-content .tab-pane h1,.post-body .tabs .tab-content .tab-pane h2,.post-body .tabs .tab-content .tab-pane h3,.post-body .tabs .tab-content .tab-pane h4,.post-body .tabs .tab-content .tab-pane h5,.post-body .tabs .tab-content .tab-pane h6{margin:0 5px}.post-body>p{margin:0 0 10px}.post-body .note>p,.post-body .tabs .tab-content .tab-pane>p{padding:0 5px}.post-body img,.post-body video{margin-bottom:10px!important}.post-body figure:not(.highlight) figcaption{margin:-5px auto 15px!important}.post-body .note{margin-bottom:10px!important;padding:10px!important}.post-body .tabs .tab-content .tab-pane{padding:10px 10px 0!important}.post-eof{margin:40px auto 20px!important}.pagination{margin-top:40px}}.back-to-top{font-size:12px;margin:8px -10px -20px;opacity:0;transition:opacity .2s ease-in-out}.back-to-top span{margin-right:8px}.back-to-top .fa{text-align:center;width:26px}.back-to-top.back-to-top-on{cursor:pointer;opacity:.6}.back-to-top.back-to-top-on:hover{opacity:.8}.rtl.post-body a,.rtl.post-body h1,.rtl.post-body h2,.rtl.post-body h3,.rtl.post-body h4,.rtl.post-body h5,.rtl.post-body h6,.rtl.post-body li,.rtl.post-body ol,.rtl.post-body p,.rtl.post-body ul{direction:rtl;font-family:UKIJ Ekran}.rtl.post-title{font-family:UKIJ Ekran}.post-button{margin-top:40px;text-align:center}.use-motion .collection-header,.use-motion .comments,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{visibility:hidden}.posts-collapse .post-content{margin-bottom:35px;margin-left:35px;position:relative}@media (max-width:767px){.posts-collapse .post-content{margin-left:0;margin-right:0}}.posts-collapse .post-content .collection-title{font-size:1.125em;position:relative}.posts-collapse .post-content .collection-title::before{background:#999;border:1px solid #fff;margin-left:-6px;margin-top:-4px;position:absolute;top:50%;border-radius:50%;content:' ';height:10px;width:10px}.posts-collapse .post-content .collection-year{font-size:1.5em;font-weight:700;margin:60px 0;position:relative}.posts-collapse .post-content .collection-year .collection-year-count{font-size:.75em;background:#ccc;border-radius:10px;color:var(--content-bg-color);font-weight:700;line-height:1;margin-left:.35em;padding:2px 5px;text-shadow:1px 1px 0 rgba(0,0,0,.1)}.posts-collapse .post-content .collection-year::before{background:#bbb;margin-left:-4px;margin-top:-4px;position:absolute;top:50%;border-radius:50%;content:' ';height:8px;width:8px}.posts-collapse .post-content .collection-header{display:block;margin-left:20px}.posts-collapse .post-content .collection-header small{color:#bbb;margin-left:5px}.posts-collapse .post-content .post-header{border-bottom:1px dashed #ccc;margin:30px 2px 0;padding-left:15px;position:relative;transition:border .2s ease-in-out}.posts-collapse .post-content .post-header::before{background:#bbb;border:1px solid #fff;left:-6px;position:absolute;top:.75em;transition:background .2s ease-in-out;border-radius:50%;content:' ';height:6px;width:6px}.posts-collapse .post-content .post-header:hover{border-bottom-color:#666}.posts-collapse .post-content .post-header:hover::before{background:#222}.posts-collapse .post-content .post-meta-container{display:inline;font-size:.75em;margin-right:10px}.posts-collapse .post-content .post-title{display:inline}.posts-collapse .post-content .post-title a{border-bottom:0;color:var(--link-color)}.posts-collapse .post-content .post-title .fa{font-size:.875em;margin-left:5px}.posts-collapse .post-content::before{background:#f5f5f5;content:' ';height:100%;margin-left:-2px;position:absolute;top:1.25em;width:4px}.post-body{overflow-wrap:break-word}@media (min-width:1200px){.post-body{font-size:1.125em}}@media (min-width:992px){.post-body{text-align:left}}.post-body h1 .header-anchor,.post-body h1 .headerlink,.post-body h2 .header-anchor,.post-body h2 .headerlink,.post-body h3 .header-anchor,.post-body h3 .headerlink,.post-body h4 .header-anchor,.post-body h4 .headerlink,.post-body h5 .header-anchor,.post-body h5 .headerlink,.post-body h6 .header-anchor,.post-body h6 .headerlink{border-bottom-style:none;color:inherit;float:right;font-size:.875em;margin-left:10px;opacity:0}.post-body h1 .header-anchor::before,.post-body h1 .headerlink::before,.post-body h2 .header-anchor::before,.post-body h2 .headerlink::before,.post-body h3 .header-anchor::before,.post-body h3 .headerlink::before,.post-body h4 .header-anchor::before,.post-body h4 .headerlink::before,.post-body h5 .header-anchor::before,.post-body h5 .headerlink::before,.post-body h6 .header-anchor::before,.post-body h6 .headerlink::before{content:'\f0c1';font-family:'Font Awesome 6 Free';font-weight:900}.post-body h1:hover .header-anchor,.post-body h1:hover .headerlink,.post-body h2:hover .header-anchor,.post-body h2:hover .headerlink,.post-body h3:hover .header-anchor,.post-body h3:hover .headerlink,.post-body h4:hover .header-anchor,.post-body h4:hover .headerlink,.post-body h5:hover .header-anchor,.post-body h5:hover .headerlink,.post-body h6:hover .header-anchor,.post-body h6:hover .headerlink{opacity:.5}.post-body h1:hover .header-anchor:hover,.post-body h1:hover .headerlink:hover,.post-body h2:hover .header-anchor:hover,.post-body h2:hover .headerlink:hover,.post-body h3:hover .header-anchor:hover,.post-body h3:hover .headerlink:hover,.post-body h4:hover .header-anchor:hover,.post-body h4:hover .headerlink:hover,.post-body h5:hover .header-anchor:hover,.post-body h5:hover .headerlink:hover,.post-body h6:hover .header-anchor:hover,.post-body h6:hover .headerlink:hover{opacity:1}.post-body .exturl .fa{font-size:.875em;margin-left:4px}.post-body figure:not(.highlight) figcaption{color:#999;font-size:.875em;font-weight:700;line-height:1;margin:-15px auto 15px;text-align:center}.post-body embed,.post-body iframe,.post-body img,.post-body video{margin-bottom:20px}.post-body .video-container{height:0;margin-bottom:20px;overflow:hidden;padding-top:75%;position:relative;width:100%}.post-body .video-container embed,.post-body .video-container iframe,.post-body .video-container object{height:100%;left:0;margin:0;position:absolute;top:0;width:100%}.post-gallery{display:flex;min-height:200px}.post-gallery .post-gallery-image{flex:1}.post-gallery .post-gallery-image:not(:first-child){clip-path:polygon(40px 0,100% 0,100% 100%,0 100%);margin-left:-20px}.post-gallery .post-gallery-image:not(:last-child){margin-right:-20px}.post-gallery .post-gallery-image img{height:100%;object-fit:cover;opacity:1;width:100%}.posts-expand .post-gallery{margin-bottom:60px}.posts-collapse .post-gallery{margin:15px 0}.posts-expand .post-header{font-size:1.125em;margin-bottom:60px;text-align:center}.posts-expand .post-title{font-size:1.5em;font-weight:400;margin:initial;overflow-wrap:break-word}.posts-expand .post-title-link{border-bottom:0;color:var(--link-color);display:inline-block;position:relative}.posts-expand .post-title-link::before{background:var(--link-color);bottom:0;content:'';height:2px;left:0;position:absolute;transform:scaleX(0);transition:transform .2s ease-in-out;width:100%}.posts-expand .post-title-link:hover::before{transform:scaleX(1)}.posts-expand .post-title-link .fa{font-size:.875em;margin-left:5px}.post-sticky-flag{display:inline-block;margin-right:8px;transform:rotate(30deg)}.posts-expand .post-meta-container{color:#999;font-family:Noto Serif SC,PingFang SC,Microsoft YaHei,sans-serif,Lato,'PingFang SC','Microsoft YaHei',sans-serif;font-size:.75em;margin-top:3px}.posts-expand .post-meta-container .post-description{font-size:.875em;margin-top:2px}.posts-expand .post-meta-container time{border-bottom:1px dashed #999}.post-meta{display:flex;flex-wrap:wrap;justify-content:center}:not(.post-meta-break)+.post-meta-item::before{content:'|';margin:0 .5em}.post-meta-item-icon{margin-right:3px}@media (max-width:991px){.post-body{text-align:justify}.post-meta-item-text{display:none}}.post-meta-break{flex-basis:100%;height:0}#busuanzi_container_page_pv{display:none}.post-nav{border-top:1px solid #eee;display:flex;gap:30px;justify-content:space-between;margin-top:1em;padding:10px 5px 0}.post-nav-item{flex:1}.post-nav-item a{border-bottom:0;display:block;font-size:.875em;line-height:1.6}.post-nav-item a:active{top:2px}.post-nav-item .fa{font-size:.75em}.post-nav-item:first-child .fa{margin-right:5px}.post-nav-item:last-child{text-align:right}.post-nav-item:last-child .fa{margin-left:5px}.post-footer{display:flex;flex-direction:column;justify-content:center}.post-eof{background:#ccc;height:1px;margin:80px auto 60px;width:8%}.post-block:last-of-type .post-eof{display:none}.post-copyright ul{list-style:none;overflow:hidden;padding:.5em 1em;position:relative;background:var(--card-bg-color);border-left:3px solid #ff2a2a;margin:1em 0 0}.post-copyright ul::after{content:'\f25e';font-family:'Font Awesome 6 Brands';font-size:200px;opacity:.1;position:absolute;right:-50px;top:-150px}.post-tags{margin-top:40px;text-align:center}.post-tags a{display:inline-block;font-size:.8125em}.post-tags a:not(:last-child){margin-right:10px}.social-like{border-top:1px solid #eee;font-size:.875em;margin-top:1em;padding-top:1em;display:flex;flex-wrap:wrap;justify-content:center}.social-like a{border-bottom:none}.reward-container{margin:1em 0 0;padding:1em 0;text-align:center}.reward-container button{background:0 0;color:#fc6423;cursor:pointer;line-height:2;padding:0 15px;border:2px solid #fc6423;border-radius:2px;outline:0;vertical-align:text-top}.reward-container button:hover{background:#fc6423;color:#fff}.post-reward{display:none;padding-top:20px}.post-reward.active{display:block}.post-reward div{display:inline-block}.post-reward div span{display:block}.post-reward img{display:inline-block;margin:.8em 2em 0;max-width:100%;width:180px}@keyframes next-roll{from{transform:rotateZ(30deg)}to{transform:rotateZ(-30deg)}}.category-all-page .category-all-title{text-align:center}.category-all-page .category-all{margin-top:20px}.category-all-page .category-list{list-style:none;margin:0;padding:0}.category-all-page .category-list-item{margin:5px 10px}.category-all-page .category-list-count{font-size:.75em;background:#ccc;border-radius:10px;color:var(--content-bg-color);font-weight:700;line-height:1;margin-left:.35em;padding:2px 5px;text-shadow:1px 1px 0 rgba(0,0,0,.1)}.category-all-page .category-list-child{padding-left:10px}.event-list hr{background:#222;margin:20px 0 45px}.event-list hr::after{background:#222;color:#fff;content:'NOW';display:inline-block;font-weight:700;padding:0 5px}.event-list .event{--event-background:#222;--event-foreground:#bbb;--event-title:#fff;background:var(--event-background);padding:15px}.event-list .event .event-summary{border-bottom:0;color:var(--event-title);margin:0;padding:0 0 0 35px;position:relative}.event-list .event .event-summary::before{animation:1s ease-in-out infinite alternate dot-flash;background:var(--event-title);left:0;margin-top:-6px;position:absolute;top:50%;border-radius:50%;content:' ';height:12px;width:12px}.event-list .event:nth-of-type(odd) .event-summary::before{animation-delay:.5s}.event-list .event:not(:last-child){margin-bottom:20px}.event-list .event .event-relative-time{color:var(--event-foreground);display:inline-block;font-size:12px;font-weight:400;padding-left:12px}.event-list .event .event-details{color:var(--event-foreground);display:block;line-height:18px;padding:6px 0 6px 35px}.event-list .event .event-details::before{color:var(--event-foreground);display:inline-block;margin-right:9px;width:14px;font-family:'Font Awesome 6 Free';font-weight:900}.event-list .event .event-details.event-location::before{content:'\f041'}.event-list .event .event-details.event-duration::before{content:'\f017'}.event-list .event .event-details.event-description::before{content:'\f024'}.event-list .event-past{--event-background:#f5f5f5;--event-foreground:#999;--event-title:#222}@keyframes dot-flash{from{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(.8)}}ul.breadcrumb{font-size:.75em;list-style:none;margin:1em 0;padding:0 2em;text-align:center}ul.breadcrumb li{display:inline}ul.breadcrumb li:not(:first-child)::before{content:'/\00a0';font-weight:400;padding:.5em}ul.breadcrumb li:last-child{font-weight:700}.tag-cloud{text-align:center}.tag-cloud a{display:inline-block;margin:10px}.tag-cloud-0{border-bottom-color:#aaa;color:#aaa}.tag-cloud-1{border-bottom-color:#9a9a9a;color:#9a9a9a}.tag-cloud-2{border-bottom-color:#8b8b8b;color:#8b8b8b}.tag-cloud-3{border-bottom-color:#7c7c7c;color:#7c7c7c}.tag-cloud-4{border-bottom-color:#6c6c6c;color:#6c6c6c}.tag-cloud-5{border-bottom-color:#5d5d5d;color:#5d5d5d}.tag-cloud-6{border-bottom-color:#4e4e4e;color:#4e4e4e}.tag-cloud-7{border-bottom-color:#3e3e3e;color:#3e3e3e}.tag-cloud-8{border-bottom-color:#2f2f2f;color:#2f2f2f}.tag-cloud-9{border-bottom-color:#202020;color:#202020}.tag-cloud-10{border-bottom-color:#111;color:#111}.search-active{overflow:hidden}.search-pop-overlay{background:rgba(0,0,0,0);display:flex;height:100%;left:0;position:fixed;top:0;transition:visibility .4s,background .4s;visibility:hidden;width:100%;z-index:40}.search-active .search-pop-overlay{background:rgba(0,0,0,.3);visibility:visible}.search-popup{background:var(--card-bg-color);border-radius:5px;height:80%;margin:auto;transform:scale(0);transition:transform .4s;width:700px}.search-active .search-popup{transform:scale(1)}@media (max-width:767px){.search-popup{border-radius:0;height:100%;width:100%}}.search-popup .popup-btn-close,.search-popup .search-icon{color:#999;font-size:18px;padding:0 10px}.search-popup .popup-btn-close{cursor:pointer}.search-popup .popup-btn-close:hover .fa{color:#222}.search-popup .search-header{background:#eee;border-top-left-radius:5px;border-top-right-radius:5px;display:flex;padding:5px}.search-popup input.search-input{background:0 0;border:0;outline:0;width:100%}.search-popup input.search-input::-webkit-search-cancel-button{display:none}.search-popup .search-result-container{display:flex;flex-direction:column;height:calc(100% - 55px);overflow:auto;padding:5px 25px}.search-popup .search-result-container hr{flex-shrink:0;margin:5px 0 10px}.search-popup .search-result-container hr:first-child{display:none}.search-popup .search-result-list{margin:0 5px;padding:0}.search-popup a.search-result-title{font-weight:700}.search-popup p.search-result{border-bottom:1px dashed #ccc;padding:5px 0}.search-popup .search-input-container{flex-grow:1;padding:2px}.search-popup .search-result-icon{color:#ccc;margin:auto}mark.search-keyword{background:0 0;border-bottom:1px dashed #ff2a2a;color:#ff2a2a;font-weight:700}.use-motion .animated{animation-fill-mode:none;visibility:inherit}.use-motion .sidebar .animated{animation-fill-mode:both}header.header{background:var(--content-bg-color);border-radius:20px;box-shadow:0 2px 2px 0 rgba(0,0,0,.12),0 3px 1px -2px rgba(0,0,0,.06),0 1px 5px 0 rgba(0,0,0,.12)}.main{align-items:stretch;display:flex;justify-content:space-between;margin:0 auto;width:calc(100% - 20px)}@media (max-width:767px){.main{width:auto}}@media (min-width:1200px){.main{width:1160px}}@media (min-width:1600px){.main{width:73%}}@media (max-width:991px){header.header{border-radius:initial}.main{display:block;width:auto}}.main-inner{border-radius:20px;box-sizing:border-box;width:calc(100% - 252px)}.footer-inner{padding-left:252px}@media (max-width:991px){.main-inner{border-radius:initial;width:100%}.footer-inner{padding-left:0;padding-right:0;width:auto}}.column{width:240px}.site-brand-container{background:var(--theme-color)}.site-meta{padding:20px 0}.site-nav-right .toggle,.site-nav-toggle .toggle{color:#fff}.site-nav-right .toggle .toggle-line,.site-nav-toggle .toggle .toggle-line{background:#fff}@media (min-width:768px) and (max-width:991px){.site-nav-right,.site-nav-toggle{display:flex;flex-direction:column;justify-content:center}.site-nav{--scroll-height:0;height:0;overflow:hidden;transition:height .2s ease-in-out,visibility .2s ease-in-out;visibility:hidden}body:not(.site-nav-on) .site-nav .animated{animation:none}body.site-nav-on .site-nav{height:var(--scroll-height);visibility:unset}}.menu .menu-item{display:block;margin:0}.menu .menu-item a{padding:5px 20px;position:relative;transition-property:background-color;display:flex;align-items:center}.menu .menu-item a .badge{margin-left:auto}@media (max-width:991px){.column{width:auto}.site-nav-on .site-brand-container{box-shadow:0 0 16px rgba(0,0,0,.5)}.menu .menu-item.menu-item-search{display:none}}.main-menu .menu-item-active::after{background:#bbb;border-radius:50%;content:' ';height:6px;margin-top:-3px;position:absolute;right:15px;top:50%;width:6px}.sub-menu{margin:0;padding:6px 0}.sub-menu .menu-item{display:inline-block}.sub-menu .menu-item a{background:0 0;margin:5px 10px;padding:initial}.sub-menu .menu-item a:hover{background:0 0;color:#fc6423}.sub-menu .menu-item-active{border-bottom-color:#fc6423;color:#fc6423}.sub-menu .menu-item-active:hover{border-bottom-color:#fc6423}@media (min-width:992px){.sidebar{position:sticky;top:12px}.sidebar-toggle{display:none}.sidebar-inner{background:var(--content-bg-color);border-radius:20px;box-shadow:0 2px 2px 0 rgba(0,0,0,.12),0 3px 1px -2px rgba(0,0,0,.06),0 1px 5px 0 rgba(0,0,0,.12),0 -1px .5px 0 rgba(0,0,0,.09);box-sizing:border-box;color:var(--text-color);margin-top:12px;max-height:calc(100vh - 24px)}.site-state-item{padding:0 10px}.sidebar .sidebar-button{border-bottom:1px dotted #ccc;border-top:1px dotted #ccc}.sidebar .sidebar-button button{border:0;color:#fc6423;display:block;width:100%}.sidebar .sidebar-button button:hover{background:0 0;border:0;color:#e34603}.links-of-author{display:flex;flex-wrap:wrap;justify-content:center}.links-of-author-item{margin:5px 0 0;width:50%}.links-of-author-item a{border-bottom:0;border-radius:4px;padding:0 5px;box-sizing:border-box;display:inline-block;max-width:100%;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.links-of-author-item a:hover{background:var(--body-bg-color)}.links-of-blogroll-item a{padding:0 5px}.back-to-top{background:var(--body-bg-color);margin:-4px -10px -18px;transition-property:bottom,margin-top}.back-to-top.back-to-top-on{margin-top:16px}}.main-inner .comment-position .comments,.main-inner .pagination,.main-inner .post-block,.main-inner .sub-menu,.main-inner .tabs-comment,.main-inner>.comments{background:var(--content-bg-color);border-radius:20px;box-shadow:0 2px 2px 0 rgba(0,0,0,.12),0 3px 1px -2px rgba(0,0,0,.06),0 1px 5px 0 rgba(0,0,0,.12)}.main-inner .post-block:not(:first-child):not(:first-child){border-radius:20px;box-shadow:0 2px 2px 0 rgba(0,0,0,.12),0 3px 1px -2px rgba(0,0,0,.06),0 1px 5px 0 rgba(0,0,0,.12),0 -1px .5px 0 rgba(0,0,0,.09);margin-top:12px}@media (min-width:768px) and (max-width:991px){.main-inner .post-block:not(:first-child):not(:first-child){margin-top:10px}}@media (max-width:767px){.main-inner .post-block:not(:first-child):not(:first-child){margin-top:8px}}.main-inner .comment-position .comments,.main-inner .pagination,.main-inner .tabs-comment,.main-inner>.comments{border-radius:20px;box-shadow:0 2px 2px 0 rgba(0,0,0,.12),0 3px 1px -2px rgba(0,0,0,.06),0 1px 5px 0 rgba(0,0,0,.12),0 -1px .5px 0 rgba(0,0,0,.09);margin-top:12px}@media (min-width:768px) and (max-width:991px){.main-inner .comment-position .comments,.main-inner .pagination,.main-inner .tabs-comment,.main-inner>.comments{margin-top:10px}}@media (max-width:767px){.main-inner .comment-position .comments,.main-inner .pagination,.main-inner .tabs-comment,.main-inner>.comments{margin-top:8px}}.comments,.post-block{padding:40px}.post-eof{display:none}.pagination{border-top:initial;padding:10px 0}.post-body h1,.post-body h2{border-bottom:1px solid #eee}.post-body h3{border-bottom:1px dotted #eee}@media (min-width:768px) and (max-width:991px){.main-inner{padding:10px}.posts-expand .post-button{margin-top:20px}.post-block{padding:20px}.comments{padding:10px 20px}}.post-block{margin-top:12px!important}.main-inner .post-block:not(:first-child):not(:first-child)+mobile (),.post-block+mobile (){border-radius:0!important}ul.sub-menu{margin-top:12px}.site-title{opacity:0}.site-subtitle{font-family:"华文行楷";font-size:1em}.back-to-top{border-radius:0 0 100px 100px}@media (max-width:767px){.main-inner{padding:8px}.posts-expand .post-button{margin:12px 0}.post-block{padding:12px}.comments{padding:10px 12px}ul.sub-menu{margin-top:8px;border-radius:0!important}.back-to-top,.back-to-top-on{bottom:61px;position:absolute;right:20px;color:#fff;font-size:1em;height:26px;line-height:26px;margin:0}.followme{display:none}}.btn{background:rgba(255,255,255,.5)}.site-brand-container{background:url("/images/avatar.jpg") 50% 50%/cover}.post-body{font-family:'Noto Serif SC','Microsoft YaHei';text-align:start;color:#000}.menu .menu-item a,.posts-expand .post-title,.posts-expand .post-title-link{font-family:'Noto Serif SC','Microsoft YaHei';color:#000}.site-description{font-family:'Noto Serif SC','Microsoft YaHei'}.post-copyright ul{font-family:'Noto Serif SC','Microsoft YaHei';color:#000}.sidebar-inner{font-family:'Noto Serif SC','Microsoft YaHei'}@media (max-width:767px){.sidebar-blogroll{display:none;bottom:90px;position:absolute}}.search-popup .search-input-container,.search-popup .search-result-container{font-family:'Noto Serif SC','Microsoft YaHei'}h1{font-size:1.5em}h2{font-size:1.375em}h3{font-size:1.25em}h4{font-size:1.125em}h5{font-size:1em}h6{font-size:.875em}</style><link href=https://use.sevencdn.com/css2?family=Noto+Serif+SC:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&family=PingFang+SC:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&family=Microsoft+YaHei:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&family=sans-serif:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&family=Lato:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&family=Roboto+Mono:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&display=swap&subset=latin,latin-ext rel=stylesheet><link crossorigin href=https://use.sevencdn.com/ajax/libs/font-awesome/6.7.2/css/all.min.css integrity=sha256-dABdfBfUoC8vJUBOwGVdm8L9qlMWaHTIfXt+7GnZCIo= rel=stylesheet><link crossorigin href=https://use.sevencdn.com/ajax/libs/fancyapps-ui/5.0.31/fancybox/fancybox.css integrity=sha256-gkQVf8UKZgQ0HyuxL/VnacadJ+D2Kox2TCEBuNQg5+w= rel=stylesheet><script class=next-config data-name=main type=application/json>{"hostname":"xiaojianzheng.cn","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.22.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":true,"style":"mac"},"fold":{"enable":true,"height":500},"bookmark":{"enable":true,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":true,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":false,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.json","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":true,"trigger":"auto"}}</script><script src=https://use.sevencdn.com/ajax/libs/hexo-theme-next/8.22.0/config.min.js></script><meta content="本文大部分内容参考 周志明《深入理解 Java 虚拟机》 ，想要深入学习的话请看原书。 一、运行时数据区域  ¶程序计数器 记录正在执行的虚拟机字节码指令的地址（如果正在执行的是本地方法则为空）。 ¶Java 虚拟机栈 每个 Java 方法在执行的同时会创建一个栈帧用于存储局部变量表、操作数栈、常量池引用等信息。从方法调用直至执行完成的过程，对应着一个栈帧在 Java 虚拟机栈中入栈和出栈的过程。" name=description><meta content=website property=og:type><meta content="JiaHe - 家和的学习分享" property=og:title><meta content=http://xiaojianzheng.cn/docs/java/java-jvm.html property=og:url><meta content="JiaHe - 家和的学习分享" property=og:site_name><meta content="本文大部分内容参考 周志明《深入理解 Java 虚拟机》 ，想要深入学习的话请看原书。 一、运行时数据区域  ¶程序计数器 记录正在执行的虚拟机字节码指令的地址（如果正在执行的是本地方法则为空）。 ¶Java 虚拟机栈 每个 Java 方法在执行的同时会创建一个栈帧用于存储局部变量表、操作数栈、常量池引用等信息。从方法调用直至执行完成的过程，对应着一个栈帧在 Java 虚拟机栈中入栈和出栈的过程。" property=og:description><meta content=zh_CN property=og:locale><meta content=https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/5778d113-8e13-4c53-b5bf-801e58080b97.png property=og:image><meta content=https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/8442519f-0b4d-48f4-8229-56f984363c69.png property=og:image><meta content=https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/66a6899d-c6b0-4a47-8569-9d08f0baf86c.png property=og:image><meta content=https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/83d909d2-3858-4fe1-8ff4-16471db0b180.png property=og:image><meta content=https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/005b481b-502b-4e3f-985d-d043c2b330aa.png property=og:image><meta content=https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/ccd773a5-ad38-4022-895c-7ac318f31437.png property=og:image><meta content=https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/b2b77b9e-958c-4016-8ae5-9c6edd83871e.png property=og:image><meta content=https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/c625baa0-dde6-449e-93df-c3a67f2f430f.jpg property=og:image><meta content=https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/22fda4ae-4dd5-489d-ab10-9ebfdad22ae0.jpg property=og:image><meta content=https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/81538cd5-1bcf-4e31-86e5-e198df1e013b.jpg property=og:image><meta content=https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/08f32fd3-f736-4a67-81ca-295b2a7972f2.jpg property=og:image><meta content=https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/278fe431-af88-4a95-a895-9c3b80117de3.jpg property=og:image><meta content=https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/62e77997-6957-4b68-8d12-bfd609bb2c68.jpg property=og:image><meta content=https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/4cf711a8-7ab2-4152-b85c-d5c226733807.png property=og:image><meta content=https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/9bbddeeb-e939-41f0-8e8e-2b1a0aa7e0a7.png property=og:image><meta content=https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/f99ee771-c56f-47fb-9148-c0036695b5fe.jpg property=og:image><meta content=https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/335fe19c-4a76-45ab-9320-88c90d6a0d7e.png property=og:image><meta content=https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/0dd2d40a-5b2b-4d45-b176-e75a4cd4bdbf.png property=og:image><meta content=2025-01-23T04:13:56.579Z property=article:published_time><meta content=2025-01-23T04:13:56.579Z property=article:modified_time><meta content=JiaHe property=article:author><meta content="jiahe JiaHe JIAHE" property=article:tag><meta content=summary name=twitter:card><meta content=https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/5778d113-8e13-4c53-b5bf-801e58080b97.png name=twitter:image><link href=http://xiaojianzheng.cn/docs/java/java-jvm.html rel=canonical><script class=next-config data-name=page type=application/json>{"sidebar":"","isHome":false,"isPost":false,"lang":"zh-CN","comments":true,"permalink":"http://xiaojianzheng.cn/docs/java/java-jvm.html","path":"docs/java/java-jvm.html","title":""}</script><script class=next-config data-name=calendar type=application/json>""</script><title> | JiaHe - 家和的学习分享
</title><noscript><link href=/css/noscript.css rel=stylesheet></noscript><link title="JiaHe - 家和的学习分享" href=/atom.xml rel=alternate type=application/atom+xml><body itemscope itemtype=http://schema.org/WebPage><div class=headband></div><main class=main><div class=column><header class=header itemscope itemtype=http://schema.org/WPHeader><div class=site-brand-container><div class=site-nav-toggle><div aria-label=切换导航栏 class=toggle role=button><span class=toggle-line></span><span class=toggle-line></span><span class=toggle-line></span></div></div><div class=site-meta><a class=brand href=/ rel=start> <i class=logo-line></i> <p class=site-title>JiaHe - 家和的学习分享</p> <i class=logo-line></i> </a><p class=site-subtitle itemprop=description>相遇即是缘</div><div class=site-nav-right><div class="toggle popup-trigger" aria-label=搜索 role=button><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class=site-nav><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href=/ rel=section><i class="fa fa-home fa-fw"></i>首页</a><li class="menu-item menu-item-归档"><a href=/archives/ rel=section><i class="fa fa-archive fa-fw"></i>归档</a><li class="menu-item menu-item-导航"><a href=/navigation/ rel=section><i class="fa fa-location-arrow fa-fw"></i>导航</a><li class="menu-item menu-item-文档"><a href=/docs/ rel=section><i class="fa fa-book fa-fw fa-fw"></i>文档</a><li class="menu-item menu-item-测试"><a href=/test/ rel=section><i class="fas fa-check-double fa-fw"></i>测试</a><li class="menu-item menu-item-应用下载"><a href=/app-download/ rel=section><i class="fas fa-download fa-fw fa-fw"></i>应用下载</a><li class="menu-item menu-item-小贴士"><a href=/cheat-sheet/ rel=section><i class="fas fa-pen fa-fw"></i>小贴士</a><li class="menu-item menu-item-在线工具"><a href=https://tool.xiaojianzheng.cn/ rel=section target=_blank><i class="fas fa-regular fa-screwdriver-wrench fa-fw"></i>在线工具</a><li class="menu-item menu-item-在线转换"><a href=/online-convert/ rel=section><i class="fas fa-arrow-right-arrow-left fa-fw"></i>在线转换</a><li class="menu-item menu-item-软件安装部署"><a href=/software-install-and-deploy/ rel=section><i class="fab fa-windows fa-fw"></i>软件安装部署</a><li class="menu-item menu-item-linux命令"><a href=https://wangchujiang.com/linux-command/ rel=section target=_blank><i class="fab fa-linux fa-fw"></i>Linux命令</a><li class="menu-item menu-item-search"><a class=popup-trigger role=button><i class="fa fa-search fa-fw"></i>搜索 </a></ul></nav><div class=search-pop-overlay><div class="popup search-popup"><div class=search-header><span class=search-icon> <i class="fa fa-search"></i> </span><div class=search-input-container><input autocapitalize=off autocomplete=off class=search-input maxlength=80 placeholder=搜索... spellcheck=false type=search></div><span class=popup-btn-close role=button> <i class="fa fa-times-circle"></i> </span></div><div class=search-result-container><div class=search-result-icon><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></header><aside class=sidebar><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class=sidebar-nav><li class=sidebar-nav-toc>文章目录<li class=sidebar-nav-overview>站点概览</ul><div class=sidebar-panel-container><!--noindex--><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class=nav><li class="nav-item nav-level-1"><a class=nav-link><span class=nav-number>1.</span> <span class=nav-text>一、运行时数据区域</span></a><ol class=nav-child><li class="nav-item nav-level-2"><a class=nav-link href=#%E7%A8%8B%E5%BA%8F%E8%AE%A1%E6%95%B0%E5%99%A8><span class=nav-number>1.1.</span> <span class=nav-text>程序计数器</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#Java-%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%A0%88><span class=nav-number>1.2.</span> <span class=nav-text>Java 虚拟机栈</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#%E6%9C%AC%E5%9C%B0%E6%96%B9%E6%B3%95%E6%A0%88><span class=nav-number>1.3.</span> <span class=nav-text>本地方法栈</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#%E5%A0%86><span class=nav-number>1.4.</span> <span class=nav-text>堆</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#%E6%96%B9%E6%B3%95%E5%8C%BA><span class=nav-number>1.5.</span> <span class=nav-text>方法区</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#%E8%BF%90%E8%A1%8C%E6%97%B6%E5%B8%B8%E9%87%8F%E6%B1%A0><span class=nav-number>1.6.</span> <span class=nav-text>运行时常量池</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#%E7%9B%B4%E6%8E%A5%E5%86%85%E5%AD%98><span class=nav-number>1.7.</span> <span class=nav-text>直接内存</span></a></ol><li class="nav-item nav-level-1"><a class=nav-link><span class=nav-number>2.</span> <span class=nav-text>二、垃圾收集</span></a><ol class=nav-child><li class="nav-item nav-level-2"><a class=nav-link href=#%E5%88%A4%E6%96%AD%E4%B8%80%E4%B8%AA%E5%AF%B9%E8%B1%A1%E6%98%AF%E5%90%A6%E5%8F%AF%E8%A2%AB%E5%9B%9E%E6%94%B6><span class=nav-number>2.1.</span> <span class=nav-text>判断一个对象是否可被回收</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#1-%E5%BC%95%E7%94%A8%E8%AE%A1%E6%95%B0%E7%AE%97%E6%B3%95><span class=nav-number>2.1.1.</span> <span class=nav-text>1. 引用计数算法</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#2-%E5%8F%AF%E8%BE%BE%E6%80%A7%E5%88%86%E6%9E%90%E7%AE%97%E6%B3%95><span class=nav-number>2.1.2.</span> <span class=nav-text>2. 可达性分析算法</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#3-%E6%96%B9%E6%B3%95%E5%8C%BA%E7%9A%84%E5%9B%9E%E6%94%B6><span class=nav-number>2.1.3.</span> <span class=nav-text>3. 方法区的回收</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#finalize><span class=nav-number>2.1.4.</span> <span class=nav-text>finalize()</span></a></ol><li class="nav-item nav-level-2"><a class=nav-link href=#%E5%BC%95%E7%94%A8%E7%B1%BB%E5%9E%8B><span class=nav-number>2.2.</span> <span class=nav-text>引用类型</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#1-%E5%BC%BA%E5%BC%95%E7%94%A8><span class=nav-number>2.2.1.</span> <span class=nav-text>1. 强引用</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#2-%E8%BD%AF%E5%BC%95%E7%94%A8><span class=nav-number>2.2.2.</span> <span class=nav-text>2. 软引用</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#3-%E5%BC%B1%E5%BC%95%E7%94%A8><span class=nav-number>2.2.3.</span> <span class=nav-text>3. 弱引用</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#4-%E8%99%9A%E5%BC%95%E7%94%A8><span class=nav-number>2.2.4.</span> <span class=nav-text>4. 虚引用</span></a></ol><li class="nav-item nav-level-2"><a class=nav-link href=#%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E7%AE%97%E6%B3%95><span class=nav-number>2.3.</span> <span class=nav-text>垃圾收集算法</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#1-%E6%A0%87%E8%AE%B0-%E6%B8%85%E9%99%A4><span class=nav-number>2.3.1.</span> <span class=nav-text>1. 标记 - 清除</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#2-%E6%A0%87%E8%AE%B0-%E6%95%B4%E7%90%86><span class=nav-number>2.3.2.</span> <span class=nav-text>2. 标记 - 整理</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#3-%E5%A4%8D%E5%88%B6><span class=nav-number>2.3.3.</span> <span class=nav-text>3. 复制</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#4-%E5%88%86%E4%BB%A3%E6%94%B6%E9%9B%86><span class=nav-number>2.3.4.</span> <span class=nav-text>4. 分代收集</span></a></ol><li class="nav-item nav-level-2"><a class=nav-link href=#%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8><span class=nav-number>2.4.</span> <span class=nav-text>垃圾收集器</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#1-Serial-%E6%94%B6%E9%9B%86%E5%99%A8><span class=nav-number>2.4.1.</span> <span class=nav-text>1. Serial 收集器</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#2-ParNew-%E6%94%B6%E9%9B%86%E5%99%A8><span class=nav-number>2.4.2.</span> <span class=nav-text>2. ParNew 收集器</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#3-Parallel-Scavenge-%E6%94%B6%E9%9B%86%E5%99%A8><span class=nav-number>2.4.3.</span> <span class=nav-text>3. Parallel Scavenge 收集器</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#4-Serial-Old-%E6%94%B6%E9%9B%86%E5%99%A8><span class=nav-number>2.4.4.</span> <span class=nav-text>4. Serial Old 收集器</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#5-Parallel-Old-%E6%94%B6%E9%9B%86%E5%99%A8><span class=nav-number>2.4.5.</span> <span class=nav-text>5. Parallel Old 收集器</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#6-CMS-%E6%94%B6%E9%9B%86%E5%99%A8><span class=nav-number>2.4.6.</span> <span class=nav-text>6. CMS 收集器</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#7-G1-%E6%94%B6%E9%9B%86%E5%99%A8><span class=nav-number>2.4.7.</span> <span class=nav-text>7. G1 收集器</span></a></ol></ol><li class="nav-item nav-level-1"><a class=nav-link><span class=nav-number>3.</span> <span class=nav-text>三、内存分配与回收策略</span></a><ol class=nav-child><li class="nav-item nav-level-2"><a class=nav-link href=#Minor-GC-%E5%92%8C-Full-GC><span class=nav-number>3.1.</span> <span class=nav-text>Minor GC 和 Full GC</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D%E7%AD%96%E7%95%A5><span class=nav-number>3.2.</span> <span class=nav-text>内存分配策略</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#1-%E5%AF%B9%E8%B1%A1%E4%BC%98%E5%85%88%E5%9C%A8-Eden-%E5%88%86%E9%85%8D><span class=nav-number>3.2.1.</span> <span class=nav-text>1. 对象优先在 Eden 分配</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#2-%E5%A4%A7%E5%AF%B9%E8%B1%A1%E7%9B%B4%E6%8E%A5%E8%BF%9B%E5%85%A5%E8%80%81%E5%B9%B4%E4%BB%A3><span class=nav-number>3.2.2.</span> <span class=nav-text>2. 大对象直接进入老年代</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#3-%E9%95%BF%E6%9C%9F%E5%AD%98%E6%B4%BB%E7%9A%84%E5%AF%B9%E8%B1%A1%E8%BF%9B%E5%85%A5%E8%80%81%E5%B9%B4%E4%BB%A3><span class=nav-number>3.2.3.</span> <span class=nav-text>3. 长期存活的对象进入老年代</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#4-%E5%8A%A8%E6%80%81%E5%AF%B9%E8%B1%A1%E5%B9%B4%E9%BE%84%E5%88%A4%E5%AE%9A><span class=nav-number>3.2.4.</span> <span class=nav-text>4. 动态对象年龄判定</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#5-%E7%A9%BA%E9%97%B4%E5%88%86%E9%85%8D%E6%8B%85%E4%BF%9D><span class=nav-number>3.2.5.</span> <span class=nav-text>5. 空间分配担保</span></a></ol><li class="nav-item nav-level-2"><a class=nav-link href=#Full-GC-%E7%9A%84%E8%A7%A6%E5%8F%91%E6%9D%A1%E4%BB%B6><span class=nav-number>3.3.</span> <span class=nav-text>Full GC 的触发条件</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#1-%E8%B0%83%E7%94%A8-System-gc><span class=nav-number>3.3.1.</span> <span class=nav-text>1. 调用 System.gc()</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#2-%E8%80%81%E5%B9%B4%E4%BB%A3%E7%A9%BA%E9%97%B4%E4%B8%8D%E8%B6%B3><span class=nav-number>3.3.2.</span> <span class=nav-text>2. 老年代空间不足</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#3-%E7%A9%BA%E9%97%B4%E5%88%86%E9%85%8D%E6%8B%85%E4%BF%9D%E5%A4%B1%E8%B4%A5><span class=nav-number>3.3.3.</span> <span class=nav-text>3. 空间分配担保失败</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#4-JDK-1-7-%E5%8F%8A%E4%BB%A5%E5%89%8D%E7%9A%84%E6%B0%B8%E4%B9%85%E4%BB%A3%E7%A9%BA%E9%97%B4%E4%B8%8D%E8%B6%B3><span class=nav-number>3.3.4.</span> <span class=nav-text>4. JDK 1.7 及以前的永久代空间不足</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#5-Concurrent-Mode-Failure><span class=nav-number>3.3.5.</span> <span class=nav-text>5. Concurrent Mode Failure</span></a></ol></ol><li class="nav-item nav-level-1"><a class=nav-link><span class=nav-number>4.</span> <span class=nav-text>四、类加载机制</span></a><ol class=nav-child><li class="nav-item nav-level-2"><a class=nav-link href=#%E7%B1%BB%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F><span class=nav-number>4.1.</span> <span class=nav-text>类的生命周期</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#%E7%B1%BB%E5%8A%A0%E8%BD%BD%E8%BF%87%E7%A8%8B><span class=nav-number>4.2.</span> <span class=nav-text>类加载过程</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#1-%E5%8A%A0%E8%BD%BD><span class=nav-number>4.2.1.</span> <span class=nav-text>1. 加载</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#2-%E9%AA%8C%E8%AF%81><span class=nav-number>4.2.2.</span> <span class=nav-text>2. 验证</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#3-%E5%87%86%E5%A4%87><span class=nav-number>4.2.3.</span> <span class=nav-text>3. 准备</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#4-%E8%A7%A3%E6%9E%90><span class=nav-number>4.2.4.</span> <span class=nav-text>4. 解析</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#5-%E5%88%9D%E5%A7%8B%E5%8C%96><span class=nav-number>4.2.5.</span> <span class=nav-text>5. 初始化</span></a></ol><li class="nav-item nav-level-2"><a class=nav-link href=#%E7%B1%BB%E5%88%9D%E5%A7%8B%E5%8C%96%E6%97%B6%E6%9C%BA><span class=nav-number>4.3.</span> <span class=nav-text>类初始化时机</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#1-%E4%B8%BB%E5%8A%A8%E5%BC%95%E7%94%A8><span class=nav-number>4.3.1.</span> <span class=nav-text>1. 主动引用</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#2-%E8%A2%AB%E5%8A%A8%E5%BC%95%E7%94%A8><span class=nav-number>4.3.2.</span> <span class=nav-text>2. 被动引用</span></a></ol><li class="nav-item nav-level-2"><a class=nav-link href=#%E7%B1%BB%E4%B8%8E%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8><span class=nav-number>4.4.</span> <span class=nav-text>类与类加载器</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8%E5%88%86%E7%B1%BB><span class=nav-number>4.5.</span> <span class=nav-text>类加载器分类</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#%E5%8F%8C%E4%BA%B2%E5%A7%94%E6%B4%BE%E6%A8%A1%E5%9E%8B><span class=nav-number>4.6.</span> <span class=nav-text>双亲委派模型</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#1-%E5%B7%A5%E4%BD%9C%E8%BF%87%E7%A8%8B><span class=nav-number>4.6.1.</span> <span class=nav-text>1. 工作过程</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#2-%E5%A5%BD%E5%A4%84><span class=nav-number>4.6.2.</span> <span class=nav-text>2. 好处</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#3-%E5%AE%9E%E7%8E%B0><span class=nav-number>4.6.3.</span> <span class=nav-text>3. 实现</span></a></ol><li class="nav-item nav-level-2"><a class=nav-link href=#%E8%87%AA%E5%AE%9A%E4%B9%89%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8%E5%AE%9E%E7%8E%B0><span class=nav-number>4.7.</span> <span class=nav-text>自定义类加载器实现</span></a></ol><li class="nav-item nav-level-1"><a class=nav-link><span class=nav-number>5.</span> <span class=nav-text>参考资料</span></a></ol></div></div><!--/noindex--><div class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop=author itemscope itemtype=http://schema.org/Person><img alt=JiaHe class=site-author-image itemprop=image src=/images/avatar.jpg><p class=site-author-name itemprop=name>JiaHe<div class=site-description itemprop=description>无缘等有缘</div></div><div class="site-state-wrap animated"><nav class=site-state><div class="site-state-item site-state-posts"><a href=/archives/> <span class=site-state-item-count>163</span> <span class=site-state-item-name>日志</span> </a></div><div class="site-state-item site-state-categories"><a href=/categories/> <span class=site-state-item-count>26</span> <span class=site-state-item-name>分类</span></a></div><div class="site-state-item site-state-tags"><a href=/tags/> <span class=site-state-item-count>124</span> <span class=site-state-item-name>标签</span></a></div></nav></div><div class="links-of-author animated"><span class=links-of-author-item> <a rel="noopener me" title="RSS → /atom.xml" href=/atom.xml><i class="fa fa-rss fa-fw"></i>RSS</a> </span></div><div style="margin-top: 10px" class=digit-canvas><canvas id=canvas style=width:58%;></canvas></div><script>(function(){

   var digit=
    [
        [
            [0,0,1,1,1,0,0],
            [0,1,1,0,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,0,1,1,0],
            [0,0,1,1,1,0,0]
        ],//0
        [
            [0,0,0,1,1,0,0],
            [0,1,1,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [1,1,1,1,1,1,1]
        ],//1
        [
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,0,1,1,0,0,0],
            [0,1,1,0,0,0,0],
            [1,1,0,0,0,0,0],
            [1,1,0,0,0,1,1],
            [1,1,1,1,1,1,1]
        ],//2
        [
            [1,1,1,1,1,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,0,0,1,1,0],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//3
        [
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,1,0],
            [0,0,1,1,1,1,0],
            [0,1,1,0,1,1,0],
            [1,1,0,0,1,1,0],
            [1,1,1,1,1,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,0,1,1,0],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,1,1]
        ],//4
        [
            [1,1,1,1,1,1,1],
            [1,1,0,0,0,0,0],
            [1,1,0,0,0,0,0],
            [1,1,1,1,1,1,0],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//5
        [
            [0,0,0,0,1,1,0],
            [0,0,1,1,0,0,0],
            [0,1,1,0,0,0,0],
            [1,1,0,0,0,0,0],
            [1,1,0,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//6
        [
            [1,1,1,1,1,1,1],
            [1,1,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,1,1,0,0,0],
            [0,0,1,1,0,0,0],
            [0,0,1,1,0,0,0],
            [0,0,1,1,0,0,0]
        ],//7
        [
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//8
        [
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,1,1,0,0,0,0]
        ],//9
        [
            [0,0,0,0,0,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,0,0,0,0,0]
        ]//:
    ];

var canvas = document.getElementById('canvas');

//定义一个函数判断是手机端还是pc端
function isMobile(){
    if(window.navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i)) {
      document.querySelector('.digit-canvas').style.display = 'none'
      return true; // 移动端
    }else{
      return false; // PC端
    }
}

if(!isMobile() && canvas.getContext){
    var cxt = canvas.getContext('2d');
    //声明canvas的宽高
    var H = 100,W = 700;
    canvas.height = H;
    canvas.width = W;
    cxt.fillStyle = '#f00';
    cxt.fillRect(10,10,50,50);

    //存储时间数据
    var data = [];
    //存储运动的小球
    var balls = [];
    //设置粒子半径
    var R = canvas.height/20-1;
    (function(){
        var temp = /(\d)(\d):(\d)(\d):(\d)(\d)/.exec(new Date());
        //存储时间数字，由十位小时、个位小时、冒号、十位分钟、个位分钟、冒号、十位秒钟、个位秒钟这7个数字组成
        data.push(temp[1],temp[2],10,temp[3],temp[4],10,temp[5],temp[6]);
    })();

    /*生成点阵数字*/
    function renderDigit(index,num){
        for(var i = 0; i < digit[num].length; i++){
            for(var j = 0; j < digit[num][i].length; j++){
                if(digit[num][i][j] == 1){
                    cxt.beginPath();
                    cxt.arc(14*(R+2)*index + j*2*(R+1)+(R+1),i*2*(R+1)+(R+1),R,0,2*Math.PI);
                    cxt.closePath();
                    cxt.fill();
                }
            }
        }
    }

    /*更新时钟*/
    function updateDigitTime(){
        var changeNumArray = [];
        var temp = /(\d)(\d):(\d)(\d):(\d)(\d)/.exec(new Date());
        var NewData = [];
        NewData.push(temp[1],temp[2],10,temp[3],temp[4],10,temp[5],temp[6]);
        for(var i = data.length-1; i >=0 ; i--){
            //时间发生变化
            if(NewData[i] !== data[i]){
                //将变化的数字值和在data数组中的索引存储在changeNumArray数组中
                changeNumArray.push(i+'_'+(Number(data[i])+1)%10);
            }
        }
        //增加小球
        for(var i = 0; i< changeNumArray.length; i++){
            addBalls.apply(this,changeNumArray[i].split('_'));
        }
        data = NewData.concat();
    }

    /*更新小球状态*/
    function updateBalls(){
        for(var i = 0; i < balls.length; i++){
            balls[i].stepY += balls[i].disY;
            balls[i].x += balls[i].stepX;
            balls[i].y += balls[i].stepY;
            if(balls[i].x > W + R || balls[i].y > H + R){
                balls.splice(i,1);
                i--;
            }
        }
    }

    /*增加要运动的小球*/
    function addBalls(index,num){
        var numArray = [1,2,3];
        var colorArray =  ["#3BE","#09C","#A6C","#93C","#9C0","#690","#FB3","#F80","#F44","#C00"];
        for(var i = 0; i < digit[num].length; i++){
            for(var j = 0; j < digit[num][i].length; j++){
                if(digit[num][i][j] == 1){
                    var ball = {
                        x:14*(R+2)*index + j*2*(R+1)+(R+1),
                        y:i*2*(R+1)+(R+1),
                        stepX:Math.floor(Math.random() * 4 -2),
                        stepY:-2*numArray[Math.floor(Math.random()*numArray.length)],
                        color:colorArray[Math.floor(Math.random()*colorArray.length)],
                        disY:1
                    };
                    balls.push(ball);
                }
            }
        }
    }

    /*渲染*/
    function render(){
        //重置画布宽度，达到清空画布的效果
        canvas.height = 100;
        //渲染时钟
        for(var i = 0; i < data.length; i++){
            renderDigit(i,data[i]);
        }
        //渲染小球
        for(var i = 0; i < balls.length; i++){
            cxt.beginPath();
            cxt.arc(balls[i].x,balls[i].y,R,0,2*Math.PI);
            cxt.fillStyle = balls[i].color;
            cxt.closePath();
            cxt.fill();
        }
    }

    clearInterval(oTimer);
    var oTimer = setInterval(function(){
        //更新时钟
        updateDigitTime();
        //更新小球状态
        updateBalls();
        //渲染
        render();
    },50);
}

})();</script><div class="site-overview-wrap sidebar-panel sidebar-panel-active"><div class=site-overview></div></div></div></div><div class="back-to-top animated" aria-label=返回顶部 role=button><i class="fa fa-arrow-up"></i><span>0%</span></div></div><div class="sidebar-inner sidebar-blogroll"><div class="links-of-blogroll animated"><div class=links-of-blogroll-title><i class="fa fa-globe fa-fw"></i> 链接</div><ul class=links-of-blogroll-list><li class=links-of-blogroll-item><a href=https://cn.bing.com/ rel=noopener target=_blank title=https://cn.bing.com/>Bing</a><li class=links-of-blogroll-item><a href=https://www.google.com/ rel=noopener target=_blank title=https://www.google.com/>Google</a><li class=links-of-blogroll-item><a href=https://zh.wikipedia.org/wiki/Wikipedia:%E9%A6%96%E9%A1%B5 rel=noopener target=_blank title=https://zh.wikipedia.org/wiki/Wikipedia:%E9%A6%96%E9%A1%B5>Wiki</a><li class=links-of-blogroll-item><a href=https://linux.do/ rel=noopener target=_blank title=https://linux.do/>Linux DO</a><li class=links-of-blogroll-item><a href=https://docs.gitlab.com/ee/api/api_resources.html rel=noopener target=_blank title=https://docs.gitlab.com/ee/api/api_resources.html>Gitlab Api</a></ul></div></div></aside></div><div class="main-inner page posts-expand"><ul class="sub-menu menu"><li class="menu-item menu-item-基础概念"><a href=/docs/basic-concepts/ rel=section><i class="fas fa-star fa-fw"></i>基础概念</a><li class="menu-item menu-item-lua"><a href=https://lua.xiaojianzheng.cn/1.html rel=section target=_blank><i class="fa fa-moon fa-fw"></i>Lua</a><li class="menu-item menu-item-java"><a href=/docs/java/ rel=section><i class="fa-brands fa-java fa-fw"></i>Java</a><li class="menu-item menu-item-maven"><a href=/docs/maven/ rel=section><i class="fa fa-code fa-fw"></i>Maven</a><li class="menu-item menu-item-spring"><a href=/docs/spring-framework/ rel=section><i class="fa fa-code fa-fw"></i>Spring</a><li class="menu-item menu-item-springcloud"><a href=/docs/spring-cloud/ rel=section><i class="fa fa-cloud fa-fw"></i>SpringCloud</a><li class="menu-item menu-item-springintegration"><a href=/docs/spring-integration/ rel=section><i class="fas fa-arrow-right-arrow-left fa-fw"></i>SpringIntegration</a><li class="menu-item menu-item-mybatis3"><a href=/docs/mybatis/ rel=section><i class="fa fa-code fa-fw"></i>Mybatis3</a><li class="menu-item menu-item-数据库"><a href=/docs/database/ rel=section><i class="fas fa-database fa-fw"></i>数据库</a><li class="menu-item menu-item-计算机网络"><a href=/docs/network/ rel=section><i class="fas fa-network-wired fa-fw"></i>计算机网络</a><li class="menu-item menu-item-操作系统基础"><a href=/docs/os/ rel=section><i class="fas fa-laptop fa-fw"></i>操作系统基础</a><li class="menu-item menu-item-数据结构与算法"><a href=/docs/data-structure/ rel=section><i class="fas fa-poll fa-fw"></i>数据结构与算法</a><li class="menu-item menu-item-设计模式"><a href=/docs/design-pattern/ rel=section><i class="far fa-object-group fa-fw"></i>设计模式</a><li class="menu-item menu-item-hutool"><a href=/docs/hutool/ rel=section><i class="fa fa-gear fa-fw"></i>HuTool</a><li class="menu-item menu-item-apache-commons"><a href=/docs/apache/ rel=section><i class="fas fa-feather fa-fw"></i>Apache Commons</a><li class="menu-item menu-item-kubernetes"><a href=/docs/kubernetes/ rel=section><i class="fa fa-code fa-fw"></i>Kubernetes</a><li class="menu-item menu-item-superpatrick"><a href=/docs/super-patrick/ rel=section><i class="fas fa-arrow-pointer fa-fw"></i>SuperPatrick</a><li class="menu-item menu-item-dekauto4j"><a href=/docs/dekauto4j/ rel=section><i class="fas fa-arrow-pointer fa-fw"></i>DekAuto4J</a><li class="menu-item menu-item-autoit"><a href=/docs/autoit/ rel=section><i class="fas fa-arrow-pointer fa-fw"></i>AutoIt</a></ul><ul class="sub-menu menu"><li class="menu-item menu-item-java基础"><a href=/docs/java/java-basics.html rel=section>Java基础</a><li class="menu-item menu-item-java容器"><a href=/docs/java/java-container.html rel=section>Java容器</a><li class="menu-item menu-item-java并发"><a href=/docs/java/java-concurrent.html rel=section>Java并发</a><li class="menu-item menu-item-juc"><a href=/docs/java/juc.html rel=section>JUC</a><li class="menu-item menu-item-java虚拟机"><a href=/docs/java/java-jvm.html rel=section>Java虚拟机</a><li class="menu-item menu-item-java-i/o"><a href=/docs/java/java-io.html rel=section>Java I/O</a></ul><div class=post-block lang=zh-CN><header class=post-header><h1 itemprop="name headline" class=post-title></h1><div class=post-meta-container><ul class=breadcrumb><li><a href=/docs/>文档</a><li><a href=/docs/java/>JAVA</a><li>JAVA虚拟机</ul></div></header><div class=post-body><p>本文大部分内容参考 <strong>周志明《深入理解 Java 虚拟机》</strong> ，想要深入学习的话请看原书。<h1>一、运行时数据区域</h1><p><img alt=img data-src=https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/5778d113-8e13-4c53-b5bf-801e58080b97.png><h2 id=程序计数器><a class=header-anchor href=#程序计数器>¶</a>程序计数器</h2><p>记录正在执行的虚拟机字节码指令的地址（如果正在执行的是本地方法则为空）。<h2 id=Java-虚拟机栈><a class=header-anchor href=#Java-虚拟机栈>¶</a>Java 虚拟机栈</h2><p>每个 Java 方法在执行的同时会创建一个栈帧用于存储局部变量表、操作数栈、常量池引用等信息。从方法调用直至执行完成的过程，对应着一个栈帧在 Java 虚拟机栈中入栈和出栈的过程。<p><img alt=img data-src=https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/8442519f-0b4d-48f4-8229-56f984363c69.png><p>可以通过 -Xss 这个虚拟机参数来指定每个线程的 Java 虚拟机栈内存大小，在 JDK 1.4 中默认为 256K，而在 JDK 1.5+ 默认为 1M：<figure class="highlight java"><table><tr><td class=code><pre><span class=line>java -Xss2M HackTheJava</span><br></pre></table></figure><p>该区域可能抛出以下异常：<ul><li>当线程请求的栈深度超过最大值，会抛出 StackOverflowError 异常；<li>栈进行动态扩展时如果无法申请到足够内存，会抛出 OutOfMemoryError 异常。</ul><h2 id=本地方法栈><a class=header-anchor href=#本地方法栈>¶</a>本地方法栈</h2><p>本地方法栈与 Java 虚拟机栈类似，它们之间的区别只不过是本地方法栈为本地方法服务。<p>本地方法一般是用其它语言（C、C++ 或汇编语言等）编写的，并且被编译为基于本机硬件和操作系统的程序，对待这些方法需要特别处理。<p><img alt=img data-src=https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/66a6899d-c6b0-4a47-8569-9d08f0baf86c.png><h2 id=堆><a class=header-anchor href=#堆>¶</a>堆</h2><p>所有对象都在这里分配内存，是垃圾收集的主要区域（“GC 堆”）。<p>现代的垃圾收集器基本都是采用分代收集算法，其主要的思想是针对不同类型的对象采取不同的垃圾回收算法。可以将堆分成两块：<ul><li>新生代（Young Generation）<li>老年代（Old Generation）</ul><p>堆不需要连续内存，并且可以动态增加其内存，增加失败会抛出 OutOfMemoryError 异常。<p>可以通过 -Xms 和 -Xmx 这两个虚拟机参数来指定一个程序的堆内存大小，第一个参数设置初始值，第二个参数设置最大值。<figure class="highlight java"><table><tr><td class=code><pre><span class=line>java -Xms1M -Xmx2M HackTheJava</span><br></pre></table></figure><h2 id=方法区><a class=header-anchor href=#方法区>¶</a>方法区</h2><p>用于存放已被加载的类信息、常量、静态变量、即时编译器编译后的代码等数据。<p>和堆一样不需要连续的内存，并且可以动态扩展，动态扩展失败一样会抛出 OutOfMemoryError 异常。<p>对这块区域进行垃圾回收的主要目标是对常量池的回收和对类的卸载，但是一般比较难实现。<p>HotSpot 虚拟机把它当成永久代来进行垃圾回收。但很难确定永久代的大小，因为它受到很多因素影响，并且每次 Full GC 之后永久代的大小都会改变，所以经常会抛出 OutOfMemoryError 异常。为了更容易管理方法区，从 JDK 1.8 开始，移除永久代，并把方法区移至元空间，它位于本地内存中，而不是虚拟机内存中。<p>方法区是一个 JVM 规范，永久代与元空间都是其一种实现方式。在 JDK 1.8 之后，原来永久代的数据被分到了堆和元空间中。元空间存储类的元信息，静态变量和常量池等放入堆中。<h2 id=运行时常量池><a class=header-anchor href=#运行时常量池>¶</a>运行时常量池</h2><p>运行时常量池是方法区的一部分。<p>Class 文件中的常量池（编译器生成的字面量和符号引用）会在类加载后被放入这个区域。<p>除了在编译期生成的常量，还允许动态生成，例如 String 类的 intern()。<h2 id=直接内存><a class=header-anchor href=#直接内存>¶</a>直接内存</h2><p>在 JDK 1.4 中新引入了 NIO 类，它可以使用 Native 函数库直接分配堆外内存，然后通过 Java 堆里的 DirectByteBuffer 对象作为这块内存的引用进行操作。这样能在一些场景中显著提高性能，因为避免了在堆内存和堆外内存来回拷贝数据。<h1>二、垃圾收集</h1><p>垃圾收集主要是针对堆和方法区进行。程序计数器、虚拟机栈和本地方法栈这三个区域属于线程私有的，只存在于线程的生命周期内，线程结束之后就会消失，因此不需要对这三个区域进行垃圾回收。<h2 id=判断一个对象是否可被回收><a class=header-anchor href=#判断一个对象是否可被回收>¶</a>判断一个对象是否可被回收</h2><h3 id=1-引用计数算法><a class=header-anchor href=#1-引用计数算法>¶</a>1. 引用计数算法</h3><p>为对象添加一个引用计数器，当对象增加一个引用时计数器加 1，引用失效时计数器减 1。引用计数为 0 的对象可被回收。<p>在两个对象出现循环引用的情况下，此时引用计数器永远不为 0，导致无法对它们进行回收。正是因为循环引用的存在，因此 Java 虚拟机不使用引用计数算法。<figure class="highlight java"><table><tr><td class=code><pre><span class=line><span class=keyword>public</span> <span class=keyword>class</span> <span class="title class_">Test</span> {</span><br><span class=line></span><br><span class=line>    <span class=keyword>public</span> <span class=type>Object</span> <span class=variable>instance</span> <span class=operator>=</span> <span class=literal>null</span>;</span><br><span class=line></span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>static</span> <span class=keyword>void</span> <span class="title function_">main</span><span class=params>(String[] args)</span> {</span><br><span class=line>        <span class=type>Test</span> <span class=variable>a</span> <span class=operator>=</span> <span class=keyword>new</span> <span class="title class_">Test</span>();</span><br><span class=line>        <span class=type>Test</span> <span class=variable>b</span> <span class=operator>=</span> <span class=keyword>new</span> <span class="title class_">Test</span>();</span><br><span class=line>        a.instance = b;</span><br><span class=line>        b.instance = a;</span><br><span class=line>        a = <span class=literal>null</span>;</span><br><span class=line>        b = <span class=literal>null</span>;</span><br><span class=line>        doSomething();</span><br><span class=line>    }</span><br><span class=line>}</span><br></pre></table></figure><p>在上述代码中，a 与 b 引用的对象实例互相持有了对象的引用，因此当我们把对 a 对象与 b 对象的引用去除之后，由于两个对象还存在互相之间的引用，导致两个 Test 对象无法被回收。<h3 id=2-可达性分析算法><a class=header-anchor href=#2-可达性分析算法>¶</a>2. 可达性分析算法</h3><p>以 GC Roots 为起始点进行搜索，可达的对象都是存活的，不可达的对象可被回收。<p>Java 虚拟机使用该算法来判断对象是否可被回收，GC Roots 一般包含以下内容：<ul><li>虚拟机栈中局部变量表中引用的对象<li>本地方法栈中 JNI 中引用的对象<li>方法区中类静态属性引用的对象<li>方法区中的常量引用的对象</ul><p><img alt=img data-src=https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/83d909d2-3858-4fe1-8ff4-16471db0b180.png><h3 id=3-方法区的回收><a class=header-anchor href=#3-方法区的回收>¶</a>3. 方法区的回收</h3><p>因为方法区主要存放永久代对象，而永久代对象的回收率比新生代低很多，所以在方法区上进行回收性价比不高。<p>主要是对常量池的回收和对类的卸载。<p>为了避免内存溢出，在大量使用反射和动态代理的场景都需要虚拟机具备类卸载功能。<p>类的卸载条件很多，需要满足以下三个条件，并且满足了条件也不一定会被卸载：<ul><li>该类所有的实例都已经被回收，此时堆中不存在该类的任何实例。<li>加载该类的 ClassLoader 已经被回收。<li>该类对应的 Class 对象没有在任何地方被引用，也就无法在任何地方通过反射访问该类方法。</ul><h3 id=finalize><a class=header-anchor href=#finalize>¶</a>finalize()</h3><p>类似 C++ 的析构函数，用于关闭外部资源。但是 try-finally 等方式可以做得更好，并且该方法运行代价很高，不确定性大，无法保证各个对象的调用顺序，因此最好不要使用。<p>当一个对象可被回收时，如果需要执行该对象的 finalize() 方法，那么就有可能在该方法中让对象重新被引用，从而实现自救。自救只能进行一次，如果回收的对象之前调用了 finalize() 方法自救，后面回收时不会再调用该方法。<h2 id=引用类型><a class=header-anchor href=#引用类型>¶</a>引用类型</h2><p>无论是通过引用计数算法判断对象的引用数量，还是通过可达性分析算法判断对象是否可达，判定对象是否可被回收都与引用有关。<p>Java 提供了四种强度不同的引用类型。<h3 id=1-强引用><a class=header-anchor href=#1-强引用>¶</a>1. 强引用</h3><p>被强引用关联的对象不会被回收。<p>使用 new 一个新对象的方式来创建强引用。<figure class="highlight java"><table><tr><td class=code><pre><span class=line><span class=type>Object</span> <span class=variable>obj</span> <span class=operator>=</span> <span class=keyword>new</span> <span class="title class_">Object</span>();</span><br></pre></table></figure><h3 id=2-软引用><a class=header-anchor href=#2-软引用>¶</a>2. 软引用</h3><p>被软引用关联的对象只有在内存不够的情况下才会被回收。<p>使用 SoftReference 类来创建软引用。<figure class="highlight java"><table><tr><td class=code><pre><span class=line><span class=type>Object</span> <span class=variable>obj</span> <span class=operator>=</span> <span class=keyword>new</span> <span class="title class_">Object</span>();</span><br><span class=line>SoftReference&LTObject> sf = <span class=keyword>new</span> <span class="title class_">SoftReference</span>&LTObject>(obj);</span><br><span class=line>obj = <span class=literal>null</span>;  <span class=comment>// 使对象只被软引用关联</span></span><br></pre></table></figure><h3 id=3-弱引用><a class=header-anchor href=#3-弱引用>¶</a>3. 弱引用</h3><p>被弱引用关联的对象一定会被回收，也就是说它只能存活到下一次垃圾回收发生之前。<p>使用 WeakReference 类来创建弱引用。<figure class="highlight java"><table><tr><td class=code><pre><span class=line><span class=type>Object</span> <span class=variable>obj</span> <span class=operator>=</span> <span class=keyword>new</span> <span class="title class_">Object</span>();</span><br><span class=line>WeakReference&LTObject> wf = <span class=keyword>new</span> <span class="title class_">WeakReference</span>&LTObject>(obj);</span><br><span class=line>obj = <span class=literal>null</span>;</span><br></pre></table></figure><h3 id=4-虚引用><a class=header-anchor href=#4-虚引用>¶</a>4. 虚引用</h3><p>又称为幽灵引用或者幻影引用，一个对象是否有虚引用的存在，不会对其生存时间造成影响，也无法通过虚引用得到一个对象。<p>为一个对象设置虚引用的唯一目的是能在这个对象被回收时收到一个系统通知。<p>使用 PhantomReference 来创建虚引用。<figure class="highlight java"><table><tr><td class=code><pre><span class=line><span class=type>Object</span> <span class=variable>obj</span> <span class=operator>=</span> <span class=keyword>new</span> <span class="title class_">Object</span>();</span><br><span class=line>PhantomReference&LTObject> pf = <span class=keyword>new</span> <span class="title class_">PhantomReference</span>&LTObject>(obj, <span class=literal>null</span>);</span><br><span class=line>obj = <span class=literal>null</span>;</span><br></pre></table></figure><h2 id=垃圾收集算法><a class=header-anchor href=#垃圾收集算法>¶</a>垃圾收集算法</h2><h3 id=1-标记-清除><a class=header-anchor href=#1-标记-清除>¶</a>1. 标记 - 清除</h3><p><img alt=img data-src=https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/005b481b-502b-4e3f-985d-d043c2b330aa.png><p>在标记阶段，程序会检查每个对象是否为活动对象，如果是活动对象，则程序会在对象头部打上标记。<p>在清除阶段，会进行对象回收并取消标志位，另外，还会判断回收后的分块与前一个空闲分块是否连续，若连续，会合并这两个分块。回收对象就是把对象作为分块，连接到被称为 “空闲链表” 的单向链表，之后进行分配时只需要遍历这个空闲链表，就可以找到分块。<p>在分配时，程序会搜索空闲链表寻找空间大于等于新对象大小 size 的块 block。如果它找到的块等于 size，会直接返回这个分块；如果找到的块大于 size，会将块分割成大小为 size 与 (block - size) 的两部分，返回大小为 size 的分块，并把大小为 (block - size) 的块返回给空闲链表。<p>不足：<ul><li>标记和清除过程效率都不高；<li>会产生大量不连续的内存碎片，导致无法给大对象分配内存。</ul><h3 id=2-标记-整理><a class=header-anchor href=#2-标记-整理>¶</a>2. 标记 - 整理</h3><p><img alt=img data-src=https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/ccd773a5-ad38-4022-895c-7ac318f31437.png><p>让所有存活的对象都向一端移动，然后直接清理掉端边界以外的内存。<p>优点:<ul><li>不会产生内存碎片</ul><p>不足:<ul><li>需要移动大量对象，处理效率比较低。</ul><h3 id=3-复制><a class=header-anchor href=#3-复制>¶</a>3. 复制</h3><p><img alt=img data-src=https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/b2b77b9e-958c-4016-8ae5-9c6edd83871e.png><p>将内存划分为大小相等的两块，每次只使用其中一块，当这一块内存用完了就将还存活的对象复制到另一块上面，然后再把使用过的内存空间进行一次清理。<p>主要不足是只使用了内存的一半。<p>现在的商业虚拟机都采用这种收集算法回收新生代，但是并不是划分为大小相等的两块，而是一块较大的 Eden 空间和两块较小的 Survivor 空间，每次使用 Eden 和其中一块 Survivor。在回收时，将 Eden 和 Survivor 中还存活着的对象全部复制到另一块 Survivor 上，最后清理 Eden 和使用过的那一块 Survivor。<p>HotSpot 虚拟机的 Eden 和 Survivor 大小比例默认为 8:1，保证了内存的利用率达到 90%。如果每次回收有多于 10% 的对象存活，那么一块 Survivor 就不够用了，此时需要依赖于老年代进行空间分配担保，也就是借用老年代的空间存储放不下的对象。<h3 id=4-分代收集><a class=header-anchor href=#4-分代收集>¶</a>4. 分代收集</h3><p>现在的商业虚拟机采用分代收集算法，它根据对象存活周期将内存划分为几块，不同块采用适当的收集算法。<p>一般将堆分为新生代和老年代。<ul><li>新生代使用：复制算法<li>老年代使用：标记 - 清除 或者 标记 - 整理 算法</ul><h2 id=垃圾收集器><a class=header-anchor href=#垃圾收集器>¶</a>垃圾收集器</h2><p><img alt=img data-src=https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/c625baa0-dde6-449e-93df-c3a67f2f430f.jpg><p>以上是 HotSpot 虚拟机中的 7 个垃圾收集器，连线表示垃圾收集器可以配合使用。<ul><li>单线程与多线程：单线程指的是垃圾收集器只使用一个线程，而多线程使用多个线程；<li>串行与并行：串行指的是垃圾收集器与用户程序交替执行，这意味着在执行垃圾收集的时候需要停顿用户程序；并行指的是垃圾收集器和用户程序同时执行。除了 CMS 和 G1 之外，其它垃圾收集器都是以串行的方式执行。</ul><h3 id=1-Serial-收集器><a class=header-anchor href=#1-Serial-收集器>¶</a>1. Serial 收集器</h3><p><img alt=img data-src=https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/22fda4ae-4dd5-489d-ab10-9ebfdad22ae0.jpg><p>Serial 翻译为串行，也就是说它以串行的方式执行。<p>它是单线程的收集器，只会使用一个线程进行垃圾收集工作。<p>它的优点是简单高效，在单个 CPU 环境下，由于没有线程交互的开销，因此拥有最高的单线程收集效率。<p>它是 Client 场景下的默认新生代收集器，因为在该场景下内存一般来说不会很大。它收集一两百兆垃圾的停顿时间可以控制在一百多毫秒以内，只要不是太频繁，这点停顿时间是可以接受的。<h3 id=2-ParNew-收集器><a class=header-anchor href=#2-ParNew-收集器>¶</a>2. ParNew 收集器</h3><p><img alt=img data-src=https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/81538cd5-1bcf-4e31-86e5-e198df1e013b.jpg><p>它是 Serial 收集器的多线程版本。<p>它是 Server 场景下默认的新生代收集器，除了性能原因外，主要是因为除了 Serial 收集器，只有它能与 CMS 收集器配合使用。<h3 id=3-Parallel-Scavenge-收集器><a class=header-anchor href=#3-Parallel-Scavenge-收集器>¶</a>3. Parallel Scavenge 收集器</h3><p>与 ParNew 一样是多线程收集器。<p>其它收集器目标是尽可能缩短垃圾收集时用户线程的停顿时间，而它的目标是达到一个可控制的吞吐量，因此它被称为“吞吐量优先”收集器。这里的吞吐量指 CPU 用于运行用户程序的时间占总时间的比值。<p>停顿时间越短就越适合需要与用户交互的程序，良好的响应速度能提升用户体验。而高吞吐量则可以高效率地利用 CPU 时间，尽快完成程序的运算任务，适合在后台运算而不需要太多交互的任务。<p>缩短停顿时间是以牺牲吞吐量和新生代空间来换取的：新生代空间变小，垃圾回收变得频繁，导致吞吐量下降。<p>可以通过一个开关参数打开 GC 自适应的调节策略（GC Ergonomics），就不需要手工指定新生代的大小（-Xmn）、Eden 和 Survivor 区的比例、晋升老年代对象年龄等细节参数了。虚拟机会根据当前系统的运行情况收集性能监控信息，动态调整这些参数以提供最合适的停顿时间或者最大的吞吐量。<h3 id=4-Serial-Old-收集器><a class=header-anchor href=#4-Serial-Old-收集器>¶</a>4. Serial Old 收集器</h3><p><img alt=img data-src=https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/08f32fd3-f736-4a67-81ca-295b2a7972f2.jpg><p>是 Serial 收集器的老年代版本，也是给 Client 场景下的虚拟机使用。如果用在 Server 场景下，它有两大用途：<ul><li>在 JDK 1.5 以及之前版本（Parallel Old 诞生以前）中与 Parallel Scavenge 收集器搭配使用。<li>作为 CMS 收集器的后备预案，在并发收集发生 Concurrent Mode Failure 时使用。</ul><h3 id=5-Parallel-Old-收集器><a class=header-anchor href=#5-Parallel-Old-收集器>¶</a>5. Parallel Old 收集器</h3><p><img alt=img data-src=https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/278fe431-af88-4a95-a895-9c3b80117de3.jpg><p>是 Parallel Scavenge 收集器的老年代版本。<p>在注重吞吐量以及 CPU 资源敏感的场合，都可以优先考虑 Parallel Scavenge 加 Parallel Old 收集器。<h3 id=6-CMS-收集器><a class=header-anchor href=#6-CMS-收集器>¶</a>6. CMS 收集器</h3><p><img alt=img data-src=https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/62e77997-6957-4b68-8d12-bfd609bb2c68.jpg><p>CMS（Concurrent Mark Sweep），Mark Sweep 指的是标记 - 清除算法。<p>分为以下四个流程：<ul><li>初始标记：仅仅只是标记一下 GC Roots 能直接关联到的对象，速度很快，需要停顿。<li>并发标记：进行 GC Roots Tracing 的过程，它在整个回收过程中耗时最长，不需要停顿。<li>重新标记：为了修正并发标记期间因用户程序继续运作而导致标记产生变动的那一部分对象的标记记录，需要停顿。<li>并发清除：不需要停顿。</ul><p>在整个过程中耗时最长的并发标记和并发清除过程中，收集器线程都可以与用户线程一起工作，不需要进行停顿。<p>具有以下缺点：<ul><li>吞吐量低：低停顿时间是以牺牲吞吐量为代价的，导致 CPU 利用率不够高。<li>无法处理浮动垃圾，可能出现 Concurrent Mode Failure。浮动垃圾是指并发清除阶段由于用户线程继续运行而产生的垃圾，这部分垃圾只能到下一次 GC 时才能进行回收。由于浮动垃圾的存在，因此需要预留出一部分内存，意味着 CMS 收集不能像其它收集器那样等待老年代快满的时候再回收。如果预留的内存不够存放浮动垃圾，就会出现 Concurrent Mode Failure，这时虚拟机将临时启用 Serial Old 来替代 CMS。<li>标记 - 清除算法导致的空间碎片，往往出现老年代空间剩余，但无法找到足够大连续空间来分配当前对象，不得不提前触发一次 Full GC。</ul><h3 id=7-G1-收集器><a class=header-anchor href=#7-G1-收集器>¶</a>7. G1 收集器</h3><p>G1（Garbage-First），它是一款面向服务端应用的垃圾收集器，在多 CPU 和大内存的场景下有很好的性能。HotSpot 开发团队赋予它的使命是未来可以替换掉 CMS 收集器。<p>堆被分为新生代和老年代，其它收集器进行收集的范围都是整个新生代或者老年代，而 G1 可以直接对新生代和老年代一起回收。<p><img alt=img data-src=https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/4cf711a8-7ab2-4152-b85c-d5c226733807.png><p>G1 把堆划分成多个大小相等的独立区域（Region），新生代和老年代不再物理隔离。<p><img alt=img data-src=https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/9bbddeeb-e939-41f0-8e8e-2b1a0aa7e0a7.png><p>通过引入 Region 的概念，从而将原来的一整块内存空间划分成多个的小空间，使得每个小空间可以单独进行垃圾回收。这种划分方法带来了很大的灵活性，使得可预测的停顿时间模型成为可能。通过记录每个 Region 垃圾回收时间以及回收所获得的空间（这两个值是通过过去回收的经验获得），并维护一个优先列表，每次根据允许的收集时间，优先回收价值最大的 Region。<p>每个 Region 都有一个 Remembered Set，用来记录该 Region 对象的引用对象所在的 Region。通过使用 Remembered Set，在做可达性分析的时候就可以避免全堆扫描。<p><img alt=img data-src=https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/f99ee771-c56f-47fb-9148-c0036695b5fe.jpg><p>如果不计算维护 Remembered Set 的操作，G1 收集器的运作大致可划分为以下几个步骤：<ul><li>初始标记<li>并发标记<li>最终标记：为了修正在并发标记期间因用户程序继续运作而导致标记产生变动的那一部分标记记录，虚拟机将这段时间对象变化记录在线程的 Remembered Set Logs 里面，最终标记阶段需要把 Remembered Set Logs 的数据合并到 Remembered Set 中。这阶段需要停顿线程，但是可并行执行。<li>筛选回收：首先对各个 Region 中的回收价值和成本进行排序，根据用户所期望的 GC 停顿时间来制定回收计划。此阶段其实也可以做到与用户程序一起并发执行，但是因为只回收一部分 Region，时间是用户可控制的，而且停顿用户线程将大幅度提高收集效率。</ul><p>具备如下特点：<ul><li>空间整合：整体来看是基于“标记 - 整理”算法实现的收集器，从局部（两个 Region 之间）上来看是基于“复制”算法实现的，这意味着运行期间不会产生内存空间碎片。<li>可预测的停顿：能让使用者明确指定在一个长度为 M 毫秒的时间片段内，消耗在 GC 上的时间不得超过 N 毫秒。</ul><h1>三、内存分配与回收策略</h1><h2 id=Minor-GC-和-Full-GC><a class=header-anchor href=#Minor-GC-和-Full-GC>¶</a>Minor GC 和 Full GC</h2><ul><li>Minor GC：回收新生代，因为新生代对象存活时间很短，因此 Minor GC 会频繁执行，执行的速度一般也会比较快。<li>Full GC：回收老年代和新生代，老年代对象其存活时间长，因此 Full GC 很少执行，执行速度会比 Minor GC 慢很多。</ul><h2 id=内存分配策略><a class=header-anchor href=#内存分配策略>¶</a>内存分配策略</h2><h3 id=1-对象优先在-Eden-分配><a class=header-anchor href=#1-对象优先在-Eden-分配>¶</a>1. 对象优先在 Eden 分配</h3><p>大多数情况下，对象在新生代 Eden 上分配，当 Eden 空间不够时，发起 Minor GC。<h3 id=2-大对象直接进入老年代><a class=header-anchor href=#2-大对象直接进入老年代>¶</a>2. 大对象直接进入老年代</h3><p>大对象是指需要连续内存空间的对象，最典型的大对象是那种很长的字符串以及数组。<p>经常出现大对象会提前触发垃圾收集以获取足够的连续空间分配给大对象。<p>-XX:PretenureSizeThreshold，大于此值的对象直接在老年代分配，避免在 Eden 和 Survivor 之间的大量内存复制。<h3 id=3-长期存活的对象进入老年代><a class=header-anchor href=#3-长期存活的对象进入老年代>¶</a>3. 长期存活的对象进入老年代</h3><p>为对象定义年龄计数器，对象在 Eden 出生并经过 Minor GC 依然存活，将移动到 Survivor 中，年龄就增加 1 岁，增加到一定年龄则移动到老年代中。<p>-XX:MaxTenuringThreshold 用来定义年龄的阈值。<h3 id=4-动态对象年龄判定><a class=header-anchor href=#4-动态对象年龄判定>¶</a>4. 动态对象年龄判定</h3><p>虚拟机并不是永远要求对象的年龄必须达到 MaxTenuringThreshold 才能晋升老年代，如果在 Survivor 中相同年龄所有对象大小的总和大于 Survivor 空间的一半，则年龄大于或等于该年龄的对象可以直接进入老年代，无需等到 MaxTenuringThreshold 中要求的年龄。<h3 id=5-空间分配担保><a class=header-anchor href=#5-空间分配担保>¶</a>5. 空间分配担保</h3><p>在发生 Minor GC 之前，虚拟机先检查老年代最大可用的连续空间是否大于新生代所有对象总空间，如果条件成立的话，那么 Minor GC 可以确认是安全的。<p>如果不成立的话虚拟机会查看 HandlePromotionFailure 的值是否允许担保失败，如果允许那么就会继续检查老年代最大可用的连续空间是否大于历次晋升到老年代对象的平均大小，如果大于，将尝试着进行一次 Minor GC；如果小于，或者 HandlePromotionFailure 的值不允许冒险，那么就要进行一次 Full GC。<h2 id=Full-GC-的触发条件><a class=header-anchor href=#Full-GC-的触发条件>¶</a>Full GC 的触发条件</h2><p>对于 Minor GC，其触发条件非常简单，当 Eden 空间满时，就将触发一次 Minor GC。而 Full GC 则相对复杂，有以下条件：<h3 id=1-调用-System-gc><a class=header-anchor href=#1-调用-System-gc>¶</a>1. 调用 System.gc()</h3><p>只是建议虚拟机执行 Full GC，但是虚拟机不一定真正去执行。不建议使用这种方式，而是让虚拟机管理内存。<h3 id=2-老年代空间不足><a class=header-anchor href=#2-老年代空间不足>¶</a>2. 老年代空间不足</h3><p>老年代空间不足的常见场景为前文所讲的大对象直接进入老年代、长期存活的对象进入老年代等。<p>为了避免以上原因引起的 Full GC，应当尽量不要创建过大的对象以及数组。除此之外，可以通过 -Xmn 虚拟机参数调大新生代的大小，让对象尽量在新生代被回收掉，不进入老年代。还可以通过 -XX:MaxTenuringThreshold 调大对象进入老年代的年龄，让对象在新生代多存活一段时间。<h3 id=3-空间分配担保失败><a class=header-anchor href=#3-空间分配担保失败>¶</a>3. 空间分配担保失败</h3><p>使用复制算法的 Minor GC 需要老年代的内存空间作担保，如果担保失败会执行一次 Full GC。具体内容请参考上面的第 5 小节。<h3 id=4-JDK-1-7-及以前的永久代空间不足><a class=header-anchor href=#4-JDK-1-7-及以前的永久代空间不足>¶</a>4. JDK 1.7 及以前的永久代空间不足</h3><p>在 JDK 1.7 及以前，HotSpot 虚拟机中的方法区是用永久代实现的，永久代中存放的为一些 Class 的信息、常量、静态变量等数据。<p>当系统中要加载的类、反射的类和调用的方法较多时，永久代可能会被占满，在未配置为采用 CMS GC 的情况下也会执行 Full GC。如果经过 Full GC 仍然回收不了，那么虚拟机会抛出 java.lang.OutOfMemoryError。<p>为避免以上原因引起的 Full GC，可采用的方法为增大永久代空间或转为使用 CMS GC。<h3 id=5-Concurrent-Mode-Failure><a class=header-anchor href=#5-Concurrent-Mode-Failure>¶</a>5. Concurrent Mode Failure</h3><p>执行 CMS GC 的过程中同时有对象要放入老年代，而此时老年代空间不足（可能是 GC 过程中浮动垃圾过多导致暂时性的空间不足），便会报 Concurrent Mode Failure 错误，并触发 Full GC。<h1>四、类加载机制</h1><p>类是在运行期间第一次使用时动态加载的，而不是一次性加载所有类。因为如果一次性加载，那么会占用很多的内存。<h2 id=类的生命周期><a class=header-anchor href=#类的生命周期>¶</a>类的生命周期</h2><p><img alt=img data-src=https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/335fe19c-4a76-45ab-9320-88c90d6a0d7e.png><p>包括以下 7 个阶段：<ul><li><strong>加载（Loading）</strong><li><strong>验证（Verification）</strong><li><strong>准备（Preparation）</strong><li><strong>解析（Resolution）</strong><li><strong>初始化（Initialization）</strong><li>使用（Using）<li>卸载（Unloading）</ul><h2 id=类加载过程><a class=header-anchor href=#类加载过程>¶</a>类加载过程</h2><p>包含了加载、验证、准备、解析和初始化这 5 个阶段。<h3 id=1-加载><a class=header-anchor href=#1-加载>¶</a>1. 加载</h3><p>加载是类加载的一个阶段，注意不要混淆。<p>加载过程完成以下三件事：<ul><li>通过类的完全限定名称获取定义该类的二进制字节流。<li>将该字节流表示的静态存储结构转换为方法区的运行时存储结构。<li>在内存中生成一个代表该类的 Class 对象，作为方法区中该类各种数据的访问入口。</ul><p>其中二进制字节流可以从以下方式中获取：<ul><li>从 ZIP 包读取，成为 JAR、EAR、WAR 格式的基础。<li>从网络中获取，最典型的应用是 Applet。<li>运行时计算生成，例如动态代理技术，在 java.lang.reflect.Proxy 使用 ProxyGenerator.generateProxyClass 的代理类的二进制字节流。<li>由其他文件生成，例如由 JSP 文件生成对应的 Class 类。</ul><h3 id=2-验证><a class=header-anchor href=#2-验证>¶</a>2. 验证</h3><p>确保 Class 文件的字节流中包含的信息符合当前虚拟机的要求，并且不会危害虚拟机自身的安全。<h3 id=3-准备><a class=header-anchor href=#3-准备>¶</a>3. 准备</h3><p>类变量是被 static 修饰的变量，准备阶段为类变量分配内存并设置初始值，使用的是方法区的内存。<p>实例变量不会在这阶段分配内存，它会在对象实例化时随着对象一起被分配在堆中。应该注意到，实例化不是类加载的一个过程，类加载发生在所有实例化操作之前，并且类加载只进行一次，实例化可以进行多次。<p>初始值一般为 0 值，例如下面的类变量 value 被初始化为 0 而不是 123。<figure class="highlight java"><table><tr><td class=code><pre><span class=line><span class=keyword>public</span> <span class=keyword>static</span> <span class=type>int</span> <span class=variable>value</span> <span class=operator>=</span> <span class=number>123</span>;</span><br></pre></table></figure><p>如果类变量是常量，那么它将初始化为表达式所定义的值而不是 0。例如下面的常量 value 被初始化为 123 而不是 0。<figure class="highlight java"><table><tr><td class=code><pre><span class=line><span class=keyword>public</span> <span class=keyword>static</span> <span class=keyword>final</span> <span class=type>int</span> <span class=variable>value</span> <span class=operator>=</span> <span class=number>123</span>;</span><br></pre></table></figure><h3 id=4-解析><a class=header-anchor href=#4-解析>¶</a>4. 解析</h3><p>将常量池的符号引用替换为直接引用的过程。<p>其中解析过程在某些情况下可以在初始化阶段之后再开始，这是为了支持 Java 的动态绑定。<h3 id=5-初始化><a class=header-anchor href=#5-初始化>¶</a>5. 初始化</h3><p>初始化阶段才真正开始执行类中定义的 Java 程序代码。初始化阶段是虚拟机执行类构造器 <code>&LTclinit>()</code> 方法的过程。在准备阶段，类变量已经赋过一次系统要求的初始值，而在初始化阶段，根据程序员通过程序制定的主观计划去初始化类变量和其它资源。<p><code>&LTclinit>()</code> 是由编译器自动收集类中所有类变量的赋值动作和静态语句块中的语句合并产生的，编译器收集的顺序由语句在源文件中出现的顺序决定。特别注意的是，静态语句块只能访问到定义在它之前的类变量，定义在它之后的类变量只能赋值，不能访问。例如以下代码：<figure class="highlight java"><table><tr><td class=code><pre><span class=line><span class=keyword>public</span> <span class=keyword>class</span> <span class="title class_">Test</span> {</span><br><span class=line>    <span class=keyword>static</span> {</span><br><span class=line>        i = <span class=number>0</span>;                <span class=comment>// 给变量赋值可以正常编译通过</span></span><br><span class=line>        System.out.print(i);  <span class=comment>// 这句编译器会提示“非法向前引用”</span></span><br><span class=line>    }</span><br><span class=line>    <span class=keyword>static</span> <span class=type>int</span> <span class=variable>i</span> <span class=operator>=</span> <span class=number>1</span>;</span><br><span class=line>}</span><br></pre></table></figure><p>由于父类的 <code>&LTclinit>()</code> 方法先执行，也就意味着父类中定义的静态语句块的执行要优先于子类。例如以下代码：<figure class="highlight java"><table><tr><td class=code><pre><span class=line><span class=keyword>static</span> <span class=keyword>class</span> <span class="title class_">Parent</span> {</span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>static</span> <span class=type>int</span> <span class=variable>A</span> <span class=operator>=</span> <span class=number>1</span>;</span><br><span class=line>    <span class=keyword>static</span> {</span><br><span class=line>        A = <span class=number>2</span>;</span><br><span class=line>    }</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=keyword>static</span> <span class=keyword>class</span> <span class="title class_">Sub</span> <span class=keyword>extends</span> <span class="title class_">Parent</span> {</span><br><span class=line>    <span class=keyword>public</span> <span class=keyword>static</span> <span class=type>int</span> <span class=variable>B</span> <span class=operator>=</span> A;</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=keyword>public</span> <span class=keyword>static</span> <span class=keyword>void</span> <span class="title function_">main</span><span class=params>(String[] args)</span> {</span><br><span class=line>     System.out.println(Sub.B);  <span class=comment>// 2</span></span><br><span class=line>}</span><br></pre></table></figure><p>接口中不可以使用静态语句块，但仍然有类变量初始化的赋值操作，因此接口与类一样都会生成 <code>&LTclinit>()</code> 方法。但接口与类不同的是，执行接口的<code>&LTclinit>()</code>方法不需要先执行父接口的<code>&LTclinit>()</code>方法。只有当父接口中定义的变量使用时，父接口才会初始化。另外，接口的实现类在初始化时也一样不会执行接口的<code>&LTclinit>()</code>方法。<p>虚拟机会保证一个类的<code>&LTclinit>()</code>方法在多线程环境下被正确的加锁和同步，如果多个线程同时初始化一个类，只会有一个线程执行这个类的<code>&LTclinit>()</code>方法，其它线程都会阻塞等待，直到活动线程执行<code>&LTclinit>()</code>方法完毕。如果在一个类的<code>&LTclinit>()</code>方法中有耗时的操作，就可能造成多个线程阻塞，在实际过程中此种阻塞很隐蔽。<h2 id=类初始化时机><a class=header-anchor href=#类初始化时机>¶</a>类初始化时机</h2><h3 id=1-主动引用><a class=header-anchor href=#1-主动引用>¶</a>1. 主动引用</h3><p>虚拟机规范中并没有强制约束何时进行加载，但是规范严格规定了有且只有下列五种情况必须对类进行初始化（加载、验证、准备都会随之发生）：<ul><li>遇到 new、getstatic、putstatic、invokestatic 这四条字节码指令时，如果类没有进行过初始化，则必须先触发其初始化。最常见的生成这 4 条指令的场景是：使用 new 关键字实例化对象的时候；读取或设置一个类的静态字段（被 final 修饰、已在编译期把结果放入常量池的静态字段除外）的时候；以及调用一个类的静态方法的时候。<li>使用 java.lang.reflect 包的方法对类进行反射调用的时候，如果类没有进行初始化，则需要先触发其初始化。<li>当初始化一个类的时候，如果发现其父类还没有进行过初始化，则需要先触发其父类的初始化。<li>当虚拟机启动时，用户需要指定一个要执行的主类（包含 main() 方法的那个类），虚拟机会先初始化这个主类；<li>当使用 JDK 1.7 的动态语言支持时，如果一个 java.lang.invoke.MethodHandle 实例最后的解析结果为 REF_getStatic, REF_putStatic, REF_invokeStatic 的方法句柄，并且这个方法句柄所对应的类没有进行过初始化，则需要先触发其初始化；</ul><h3 id=2-被动引用><a class=header-anchor href=#2-被动引用>¶</a>2. 被动引用</h3><p>以上 5 种场景中的行为称为对一个类进行主动引用。除此之外，所有引用类的方式都不会触发初始化，称为被动引用。被动引用的常见例子包括：<ul><li>通过子类引用父类的静态字段，不会导致子类初始化。</ul><figure class="highlight java"><table><tr><td class=code><pre><span class=line>System.out.println(SubClass.value);  <span class=comment>// value 字段在 SuperClass 中定义</span></span><br></pre></table></figure><ul><li>通过数组定义来引用类，不会触发此类的初始化。该过程会对数组类进行初始化，数组类是一个由虚拟机自动生成的、直接继承自 Object 的子类，其中包含了数组的属性和方法。</ul><figure class="highlight java"><table><tr><td class=code><pre><span class=line>SuperClass[] sca = <span class=keyword>new</span> <span class="title class_">SuperClass</span>[<span class=number>10</span>];</span><br></pre></table></figure><ul><li>常量在编译阶段会存入调用类的常量池中，本质上并没有直接引用到定义常量的类，因此不会触发定义常量的类的初始化。</ul><figure class="highlight java"><table><tr><td class=code><pre><span class=line>System.out.println(ConstClass.HELLOWORLD);</span><br></pre></table></figure><h2 id=类与类加载器><a class=header-anchor href=#类与类加载器>¶</a>类与类加载器</h2><p>两个类相等，需要类本身相等，并且使用同一个类加载器进行加载。这是因为每一个类加载器都拥有一个独立的类名称空间。<p>这里的相等，包括类的 Class 对象的 equals() 方法、isAssignableFrom() 方法、isInstance() 方法的返回结果为 true，也包括使用 instanceof 关键字做对象所属关系判定结果为 true。<h2 id=类加载器分类><a class=header-anchor href=#类加载器分类>¶</a>类加载器分类</h2><p>从 Java 虚拟机的角度来讲，只存在以下两种不同的类加载器：<ul><li>启动类加载器（Bootstrap ClassLoader），使用 C++ 实现，是虚拟机自身的一部分；<li>所有其它类的加载器，使用 Java 实现，独立于虚拟机，继承自抽象类 java.lang.ClassLoader。</ul><p>从 Java 开发人员的角度看，类加载器可以划分得更细致一些：<ul><li>启动类加载器（Bootstrap ClassLoader）此类加载器负责将存放在 <code>&LTJRE_HOME>\lib</code> 目录中的，或者被 -Xbootclasspath 参数所指定的路径中的，并且是虚拟机识别的（仅按照文件名识别，如 rt.jar，名字不符合的类库即使放在 lib 目录中也不会被加载）类库加载到虚拟机内存中。启动类加载器无法被 Java 程序直接引用，用户在编写自定义类加载器时，如果需要把加载请求委派给启动类加载器，直接使用 null 代替即可。<li>扩展类加载器（Extension ClassLoader）这个类加载器是由 ExtClassLoader（sun.misc.Launcher$ExtClassLoader）实现的。它负责将 <code>&LTJAVA_HOME>/lib/ext</code> 或者被 <code>java.ext.dir</code> 系统变量所指定路径中的所有类库加载到内存中，开发者可以直接使用扩展类加载器。<li>应用程序类加载器（Application ClassLoader）这个类加载器是由 AppClassLoader（sun.misc.Launcher$AppClassLoader）实现的。由于这个类加载器是 ClassLoader 中的 getSystemClassLoader() 方法的返回值，因此一般称为系统类加载器。它负责加载用户类路径（ClassPath）上所指定的类库，开发者可以直接使用这个类加载器，如果应用程序中没有自定义过自己的类加载器，一般情况下这个就是程序中默认的类加载器。</ul><h2 id=双亲委派模型><a class=header-anchor href=#双亲委派模型>¶</a>双亲委派模型</h2><p>应用程序是由三种类加载器互相配合从而实现类加载，除此之外还可以加入自己定义的类加载器。<p>下图展示了类加载器之间的层次关系，称为双亲委派模型（Parents Delegation Model）。该模型要求除了顶层的启动类加载器外，其它的类加载器都要有自己的父类加载器。这里的父子关系一般通过组合关系（Composition）来实现，而不是继承关系（Inheritance）。<p><img alt=img data-src=https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/0dd2d40a-5b2b-4d45-b176-e75a4cd4bdbf.png><h3 id=1-工作过程><a class=header-anchor href=#1-工作过程>¶</a>1. 工作过程</h3><p>一个类加载器首先将类加载请求转发到父类加载器，只有当父类加载器无法完成时才尝试自己加载。<h3 id=2-好处><a class=header-anchor href=#2-好处>¶</a>2. 好处</h3><p>使得 Java 类随着它的类加载器一起具有一种带有优先级的层次关系，从而使得基础类得到统一。<p>例如 java.lang.Object 存放在 rt.jar 中，如果编写另外一个 java.lang.Object 并放到 ClassPath 中，程序可以编译通过。由于双亲委派模型的存在，所以在 rt.jar 中的 Object 比在 ClassPath 中的 Object 优先级更高，这是因为 rt.jar 中的 Object 使用的是启动类加载器，而 ClassPath 中的 Object 使用的是应用程序类加载器。rt.jar 中的 Object 优先级更高，那么程序中所有的 Object 都是这个 Object。<h3 id=3-实现><a class=header-anchor href=#3-实现>¶</a>3. 实现</h3><p>以下是抽象类 java.lang.ClassLoader 的代码片段，其中的 loadClass() 方法运行过程如下：先检查类是否已经加载过，如果没有则让父类加载器去加载。当父类加载器加载失败时抛出 ClassNotFoundException，此时尝试自己去加载。<figure class="highlight java"><table><tr><td class=code><pre><span class=line><span class=keyword>public</span> <span class=keyword>abstract</span> <span class=keyword>class</span> <span class="title class_">ClassLoader</span> {</span><br><span class=line>    <span class=comment>// The parent class loader for delegation</span></span><br><span class=line>    <span class=keyword>private</span> <span class=keyword>final</span> ClassLoader parent;</span><br><span class=line></span><br><span class=line>    <span class=keyword>public</span> Class&LT?> loadClass(String name) <span class=keyword>throws</span> ClassNotFoundException {</span><br><span class=line>        <span class=keyword>return</span> loadClass(name, <span class=literal>false</span>);</span><br><span class=line>    }</span><br><span class=line></span><br><span class=line>    <span class=keyword>protected</span> Class&LT?> loadClass(String name, <span class=type>boolean</span> resolve) <span class=keyword>throws</span> ClassNotFoundException {</span><br><span class=line>        <span class=keyword>synchronized</span> (getClassLoadingLock(name)) {</span><br><span class=line>            <span class=comment>// First, check if the class has already been loaded</span></span><br><span class=line>            Class&LT?> c = findLoadedClass(name);</span><br><span class=line>            <span class=keyword>if</span> (c == <span class=literal>null</span>) {</span><br><span class=line>                <span class=keyword>try</span> {</span><br><span class=line>                    <span class=keyword>if</span> (parent != <span class=literal>null</span>) {</span><br><span class=line>                        c = parent.loadClass(name, <span class=literal>false</span>);</span><br><span class=line>                    } <span class=keyword>else</span> {</span><br><span class=line>                        c = findBootstrapClassOrNull(name);</span><br><span class=line>                    }</span><br><span class=line>                } <span class=keyword>catch</span> (ClassNotFoundException e) {</span><br><span class=line>                    <span class=comment>// ClassNotFoundException thrown if class not found</span></span><br><span class=line>                    <span class=comment>// from the non-null parent class loader</span></span><br><span class=line>                }</span><br><span class=line></span><br><span class=line>                <span class=keyword>if</span> (c == <span class=literal>null</span>) {</span><br><span class=line>                    <span class=comment>// If still not found, then invoke findClass in order</span></span><br><span class=line>                    <span class=comment>// to find the class.</span></span><br><span class=line>                    c = findClass(name);</span><br><span class=line>                }</span><br><span class=line>            }</span><br><span class=line>            <span class=keyword>if</span> (resolve) {</span><br><span class=line>                resolveClass(c);</span><br><span class=line>            }</span><br><span class=line>            <span class=keyword>return</span> c;</span><br><span class=line>        }</span><br><span class=line>    }</span><br><span class=line></span><br><span class=line>    <span class=keyword>protected</span> Class&LT?> findClass(String name) <span class=keyword>throws</span> ClassNotFoundException {</span><br><span class=line>        <span class=keyword>throw</span> <span class=keyword>new</span> <span class="title class_">ClassNotFoundException</span>(name);</span><br><span class=line>    }</span><br><span class=line>}</span><br></pre></table></figure><h2 id=自定义类加载器实现><a class=header-anchor href=#自定义类加载器实现>¶</a>自定义类加载器实现</h2><p>以下代码中的 FileSystemClassLoader 是自定义类加载器，继承自 java.lang.ClassLoader，用于加载文件系统上的类。它首先根据类的全名在文件系统上查找类的字节代码文件（.class 文件），然后读取该文件内容，最后通过 defineClass() 方法来把这些字节代码转换成 java.lang.Class 类的实例。<p>java.lang.ClassLoader 的 loadClass() 实现了双亲委派模型的逻辑，自定义类加载器一般不去重写它，但是需要重写 findClass() 方法。<figure class="highlight java"><table><tr><td class=code><pre><span class=line><span class=keyword>public</span> <span class=keyword>class</span> <span class="title class_">FileSystemClassLoader</span> <span class=keyword>extends</span> <span class="title class_">ClassLoader</span> {</span><br><span class=line></span><br><span class=line>    <span class=keyword>private</span> String rootDir;</span><br><span class=line></span><br><span class=line>    <span class=keyword>public</span> <span class="title function_">FileSystemClassLoader</span><span class=params>(String rootDir)</span> {</span><br><span class=line>        <span class=built_in>this</span>.rootDir = rootDir;</span><br><span class=line>    }</span><br><span class=line></span><br><span class=line>    <span class=keyword>protected</span> Class&LT?> findClass(String name) <span class=keyword>throws</span> ClassNotFoundException {</span><br><span class=line>        <span class=type>byte</span>[] classData = getClassData(name);</span><br><span class=line>        <span class=keyword>if</span> (classData == <span class=literal>null</span>) {</span><br><span class=line>            <span class=keyword>throw</span> <span class=keyword>new</span> <span class="title class_">ClassNotFoundException</span>();</span><br><span class=line>        } <span class=keyword>else</span> {</span><br><span class=line>            <span class=keyword>return</span> defineClass(name, classData, <span class=number>0</span>, classData.length);</span><br><span class=line>        }</span><br><span class=line>    }</span><br><span class=line></span><br><span class=line>    <span class=keyword>private</span> <span class=type>byte</span>[] getClassData(String className) {</span><br><span class=line>        <span class=type>String</span> <span class=variable>path</span> <span class=operator>=</span> classNameToPath(className);</span><br><span class=line>        <span class=keyword>try</span> {</span><br><span class=line>            <span class=type>InputStream</span> <span class=variable>ins</span> <span class=operator>=</span> <span class=keyword>new</span> <span class="title class_">FileInputStream</span>(path);</span><br><span class=line>            <span class=type>ByteArrayOutputStream</span> <span class=variable>baos</span> <span class=operator>=</span> <span class=keyword>new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class=line>            <span class=type>int</span> <span class=variable>bufferSize</span> <span class=operator>=</span> <span class=number>4096</span>;</span><br><span class=line>            <span class=type>byte</span>[] buffer = <span class=keyword>new</span> <span class="title class_">byte</span>[bufferSize];</span><br><span class=line>            <span class=type>int</span> bytesNumRead;</span><br><span class=line>            <span class=keyword>while</span> ((bytesNumRead = ins.read(buffer)) != -<span class=number>1</span>) {</span><br><span class=line>                baos.write(buffer, <span class=number>0</span>, bytesNumRead);</span><br><span class=line>            }</span><br><span class=line>            <span class=keyword>return</span> baos.toByteArray();</span><br><span class=line>        } <span class=keyword>catch</span> (IOException e) {</span><br><span class=line>            e.printStackTrace();</span><br><span class=line>        }</span><br><span class=line>        <span class=keyword>return</span> <span class=literal>null</span>;</span><br><span class=line>    }</span><br><span class=line></span><br><span class=line>    <span class=keyword>private</span> String <span class="title function_">classNameToPath</span><span class=params>(String className)</span> {</span><br><span class=line>        <span class=keyword>return</span> rootDir + File.separatorChar</span><br><span class=line>                + className.replace(<span class=string>'.'</span>, File.separatorChar) + <span class=string>".class"</span>;</span><br><span class=line>    }</span><br><span class=line>}</span><br></pre></table></figure><h1>参考资料</h1><ul><li>周志明. 深入理解 Java 虚拟机 [M]. 机械工业出版社, 2011.<li><a href=https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-2.html#jvms-2.5.4 rel=noopener target=_blank>Chapter 2. The Structure of the Java Virtual Machine(opens new window)</a><li><a href=https://www.slideshare.net/benewu/jvm-memory rel=noopener target=_blank>Jvm memory (opens new window)</a><a href=http://www.oracle.com/webfolder/technetwork/tutorials/obe/java/G1GettingStarted/index.html rel=noopener target=_blank>Getting Started with the G1 Garbage Collector(opens new window)</a><li><a href=http://electrofriends.com/articles/jni/jni-part1-java-native-interface/ rel=noopener target=_blank>JNI Part1: Java Native Interface Introduction and “Hello World” application(opens new window)</a><li><a href=https://hackthejava.wordpress.com/2015/01/09/memory-architecture-by-jvmruntime-data-areas/ rel=noopener target=_blank>Memory Architecture Of JVM(Runtime Data Areas)(opens new window)</a><li><a href=https://www.programcreek.com/2013/04/jvm-run-time-data-areas/ rel=noopener target=_blank>JVM Run-Time Data Areas(opens new window)</a><li><a href=http://www.drdobbs.com/architecture-and-design/android-on-x86-java-native-interface-and/240166271 rel=noopener target=_blank>Android on x86: Java Native Interface and the Android Native Development Kit(opens new window)</a><li><a href=https://crowhawk.github.io/2017/08/10/jvm_2/ rel=noopener target=_blank>深入理解 JVM(2)——GC 算法与内存分配策略(opens new window)</a><li><a href=https://crowhawk.github.io/2017/08/15/jvm_3/ rel=noopener target=_blank>深入理解 JVM(3)——7 种垃圾收集器(opens new window)</a><li><a href=http://blog.jamesdbloom.com/JVMInternals.html rel=noopener target=_blank>JVM Internals(opens new window)</a><li><a href=https://www.ibm.com/developerworks/cn/java/j-lo-classloader/index.html#code6 rel=noopener target=_blank>深入探讨 Java 类加载器(opens new window)</a><li><a href=http://www.baeldung.com/java-weakhashmap rel=noopener target=_blank>Guide to WeakHashMap in Java(opens new window)</a><li><a href=https://alvinalexander.com/java/jwarehouse/apache-tomcat-6.0.16/java/org/apache/el/util/ConcurrentCache.java.shtml rel=noopener target=_blank>Tomcat example source code file (ConcurrentCache.java)</a></ul></div></div><ul class=breadcrumb><li><a href=/docs/>文档</a><li><a href=/docs/java/>JAVA</a><li>JAVA虚拟机</ul></div></main><footer class=footer><div class=footer-inner><div class=beian><a href=https://beian.miit.gov.cn/ rel=noopener target=_blank>湘ICP备2025102719号-1 </a><img alt src=/images/beian.png><a href=https://beian.mps.gov.cn/#/query/webSearch?code=43010402002086 rel=noopener target=_blank>湘公网安备43010402002086号 </a></div><div class=copyright>© 2021 – <span itemprop=copyrightYear>2025</span><span class=with-love> <i class="fa fa-heart"></i> </span><span class=author itemprop=copyrightHolder>JiaHe</span></div><div class=wordcount><span class=post-meta-item> <span class=post-meta-item-icon> <i class="fa fa-chart-line"></i> </span> <span title=站点总字数>333k</span> </span><span class=post-meta-item> <span class=post-meta-item-icon> <i class="fa fa-coffee"></i> </span> <span title=站点阅读时长>20:12</span> </span></div><div class=busuanzi-count><span class=post-meta-item id=busuanzi_container_site_uv> <span class=post-meta-item-icon> <i class="fa fa-user"></i> </span> <span class=site-uv title=总访客量> <span id=busuanzi_value_site_uv></span> </span> </span><span class=post-meta-item id=busuanzi_container_site_pv> <span class=post-meta-item-icon> <i class="fa fa-eye"></i> </span> <span class=site-pv title=总访问量> <span id=busuanzi_value_site_pv></span> </span> </span></div><div class=powered-by>由 <a href=https://hexo.io/ rel=noopener target=_blank>Hexo</a> & <a href=https://theme-next.js.org/ rel=noopener target=_blank>NexT.Gemini</a> 强力驱动</div></div></footer><div class="toggle sidebar-toggle" role=button><span class=toggle-line></span><span class=toggle-line></span><span class=toggle-line></span></div><div class=sidebar-dimmer></div><a class="book-mark-link book-mark-link-fixed" role=button></a><noscript><div class=noscript-warning>Theme NexT works best with JavaScript enabled</div></noscript><script alpha=0.6 size=300 src=https://use.sevencdn.com/ajax/libs/ribbon.js/1.0.2/ribbon.min.js zindex=-1></script><script crossorigin integrity=sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY= src=https://use.sevencdn.com/ajax/libs/animejs/3.2.1/anime.min.js></script><script crossorigin integrity=sha256-a+H7FYzJv6oU2hfsfDGM2Ohw/cR9v+hPfxHCLdmCrE8= src=https://use.sevencdn.com/ajax/libs/fancyapps-ui/5.0.31/fancybox/fancybox.umd.js></script><script crossorigin integrity=sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc= src=https://use.sevencdn.com/ajax/libs/lozad.js/1.16.0/lozad.min.js></script><script crossorigin integrity=sha256-j+yj56cdEY2CwkVtGyz18fNybFGpMGJ8JxG3GSyO2+I= src=https://use.sevencdn.com/ajax/libs/pangu/4.0.7/pangu.min.js></script><script src=https://use.sevencdn.com/ajax/libs/hexo-theme-next/8.22.0/comments.min.js></script><script src=https://use.sevencdn.com/ajax/libs/hexo-theme-next/8.22.0/utils.min.js></script><script src=https://use.sevencdn.com/ajax/libs/hexo-theme-next/8.22.0/sidebar.min.js></script><script src=https://use.sevencdn.com/ajax/libs/hexo-theme-next/8.22.0/next-boot.min.js></script><script src=https://use.sevencdn.com/ajax/libs/hexo-theme-next/8.22.0/bookmark.min.js></script><script crossorigin integrity=sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc= src=https://use.sevencdn.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js></script><script src=https://use.sevencdn.com/ajax/libs/hexo-theme-next/8.22.0/third-party/search/local-search.min.js></script><script class=next-config data-name=pdf type=application/json>{"object_url":{"url":"https://use.sevencdn.com/ajax/libs/pdfobject/2.3.0/pdfobject.min.js","integrity":"sha256-JJZNsid68vnh3/zyj0lY9BN5ynxVX/12XgOa1TlaYN0="},"url":"/lib/pdf/web/viewer.html"}</script><script src=https://use.sevencdn.com/ajax/libs/hexo-theme-next/8.22.0/third-party/tags/pdf.min.js></script><script src=https://use.sevencdn.com/ajax/libs/hexo-theme-next/8.22.0/third-party/fancybox.min.js></script><script async src=https://cn.vercount.one/js></script><script crossorigin integrity=sha256-yvJQOINiH9fWemHn0vCA5lsHWJaHs6/ZmO+1Ft04SvM= src=https://use.sevencdn.com/ajax/libs/quicklink/2.3.0/quicklink.umd.js></script><script class=next-config data-name=quicklink type=application/json>{"enable":true,"home":false,"archive":true,"delay":true,"timeout":3000,"priority":true,"ignores":null,"url":"http://xiaojianzheng.cn/docs/java/java-jvm.html"}</script><script src=https://use.sevencdn.com/ajax/libs/hexo-theme-next/8.22.0/third-party/quicklink.min.js></script>